<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Chapter 13. Storage Engines</title><link rel="stylesheet" href="mysql-html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"><link rel="start" href="index.html" title="MySQL 5.5 Reference Manual"><link rel="up" href="index.html" title="MySQL 5.5 Reference Manual"><link rel="prev" href="sql-syntax.html" title="Chapter 12. SQL Statement Syntax"><link rel="next" href="ha-overview.html" title="Chapter 14. High Availability and Scalability">
<script language="javascript" type="text/javascript">
  function addOnload(theFunc)
  {
    var previous = window.onload;
    if (typeof window.onload != 'function')
    {
      window.onload = theFunc;
    }
    else
    {
      window.onload = function()
      {
        previous();
        theFunc();
      }
    }
  }

  addOnload(function()
  {
    var base = new Date(1328790650*1000);
    var now = new Date();
    var diff = ((now-base)/1000)/(24*3600);

    if (diff > 90) {
      var nodes = document.getElementsByClassName('titlepage');
      nodes[0].innerHTML = '<p style="border: 5px #ff0000 solid; padding: 5px; margin 5px">' +
        'This copy of the manual is more than 90 days old. We encourage you to download a ' +
        'new version from <a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
    }
  });
</script>
<noscript></noscript>
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 13. Storage Engines</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="sql-syntax.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ha-overview.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="storage-engines"></a>Chapter 13. Storage Engines</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="storage-engines.html#storage-engine-setting">13.1. Setting the Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#pluggable-storage-overview">13.2. Overview of MySQL Storage Engine Architecture</a></span></dt><dd><dl><dt><span class="section"><a href="storage-engines.html#pluggable-storage">13.2.1. Pluggable Storage Engine Architecture</a></span></dt><dt><span class="section"><a href="storage-engines.html#pluggable-storage-common-layer">13.2.2. The Common Database Server Layer</a></span></dt></dl></dd><dt><span class="section"><a href="storage-engines.html#innodb-storage-engine">13.3. The <code class="literal">InnoDB</code> Storage Engine</a></span></dt><dd><dl><dt><span class="section"><a href="storage-engines.html#innodb-default-se">13.3.1. InnoDB as the Default MySQL Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-configuration">13.3.2. Configuring <code class="literal">InnoDB</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-multiple-tablespaces">13.3.3. Using Per-Table Tablespaces</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-parameters">13.3.4. <code class="literal">InnoDB</code> Startup Options and System Variables</a></span></dt><dt><span class="section"><a href="storage-engines.html#using-innodb-tables">13.3.5. Creating and Using <code class="literal">InnoDB</code> Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-data-log-reconfiguration">13.3.6. Adding, Removing, or Resizing <code class="literal">InnoDB</code> Data and Log
      Files</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-backup">13.3.7. Backing Up and Recovering an <code class="literal">InnoDB</code>
      Database</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-migration">13.3.8. Moving an <code class="literal">InnoDB</code> Database to Another Machine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-transaction-model">13.3.9. The <code class="literal">InnoDB</code> Transaction Model and Locking</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-multi-versioning">13.3.10. <code class="literal">InnoDB</code> Multi-Versioning</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-table-and-index">13.3.11. <code class="literal">InnoDB</code> Table and Index Structures</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-disk-management">13.3.12. <code class="literal">InnoDB</code> Disk I/O and File Space Management</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-error-handling">13.3.13. <code class="literal">InnoDB</code> Error Handling</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-tuning-troubleshooting">13.3.14. <code class="literal">InnoDB</code> Performance Tuning and Troubleshooting</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-restrictions">13.3.15. Limits on <code class="literal">InnoDB</code> Tables</a></span></dt></dl></dd><dt><span class="section"><a href="storage-engines.html#innodb-5-5">13.4. New Features of InnoDB 1.1</a></span></dt><dd><dl><dt><span class="section"><a href="storage-engines.html#innodb-introduction">13.4.1. Introduction to InnoDB 1.1</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-create-index">13.4.2. Fast Index Creation in the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-compression">13.4.3. InnoDB Data Compression</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-file-format">13.4.4. InnoDB File-Format Management</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-row-format">13.4.5. How InnoDB Stores Variable-Length Columns</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-information-schema">13.4.6. InnoDB <code class="literal">INFORMATION_SCHEMA</code> tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance">13.4.7. InnoDB Performance and Scalability Enhancements</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes">13.4.8. Changes for Flexibility, Ease of Use and Reliability</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-installation">13.4.9. Installing the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-upgrading">13.4.10. Upgrading the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-downgrading">13.4.11. Downgrading the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-changes">13.4.12. InnoDB Storage Engine Change History</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-contrib">13.4.13. Third-Party Software</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-parameter-changes">13.4.14. List of Parameters Changed in InnoDB 1.1 and InnoDB Plugin 1.0</a></span></dt></dl></dd><dt><span class="section"><a href="storage-engines.html#myisam-storage-engine">13.5. The <code class="literal">MyISAM</code> Storage Engine</a></span></dt><dd><dl><dt><span class="section"><a href="storage-engines.html#myisam-start">13.5.1. <code class="literal">MyISAM</code> Startup Options</a></span></dt><dt><span class="section"><a href="storage-engines.html#key-space">13.5.2. Space Needed for Keys</a></span></dt><dt><span class="section"><a href="storage-engines.html#myisam-table-formats">13.5.3. <code class="literal">MyISAM</code> Table Storage Formats</a></span></dt><dt><span class="section"><a href="storage-engines.html#myisam-table-problems">13.5.4. <code class="literal">MyISAM</code> Table Problems</a></span></dt></dl></dd><dt><span class="section"><a href="storage-engines.html#memory-storage-engine">13.6. The <code class="literal">MEMORY</code> Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#csv-storage-engine">13.7. The <code class="literal">CSV</code> Storage Engine</a></span></dt><dd><dl><dt><span class="section"><a href="storage-engines.html#se-csv-repair">13.7.1. Repairing and Checking CSV Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#se-csv-limitations">13.7.2. CSV Limitations</a></span></dt></dl></dd><dt><span class="section"><a href="storage-engines.html#archive-storage-engine">13.8. The <code class="literal">ARCHIVE</code> Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#blackhole-storage-engine">13.9. The <code class="literal">BLACKHOLE</code> Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#merge-storage-engine">13.10. The <code class="literal">MERGE</code> Storage Engine</a></span></dt><dd><dl><dt><span class="section"><a href="storage-engines.html#merge-table-advantages">13.10.1. <code class="literal">MERGE</code> Table Advantages and Disadvantages</a></span></dt><dt><span class="section"><a href="storage-engines.html#merge-table-problems">13.10.2. <code class="literal">MERGE</code> Table Problems</a></span></dt></dl></dd><dt><span class="section"><a href="storage-engines.html#federated-storage-engine">13.11. The <code class="literal">FEDERATED</code> Storage Engine</a></span></dt><dd><dl><dt><span class="section"><a href="storage-engines.html#federated-description">13.11.1. <code class="literal">FEDERATED</code> Storage Engine Overview</a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-create">13.11.2. How to Create <code class="literal">FEDERATED</code> Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-usagenotes">13.11.3. <code class="literal">FEDERATED</code> Storage Engine Notes and Tips</a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-storage-engine-resources">13.11.4. <code class="literal">FEDERATED</code> Storage Engine Resources</a></span></dt></dl></dd><dt><span class="section"><a href="storage-engines.html#example-storage-engine">13.12. The <code class="literal">EXAMPLE</code> Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#storage-engines-other">13.13. Other Storage Engines</a></span></dt></dl></div><a class="indexterm" name="id1090656"></a><a class="indexterm" name="id1090669"></a><a class="indexterm" name="id1090681"></a><a class="indexterm" name="id1090694"></a><a class="indexterm" name="id1090702"></a><a class="indexterm" name="id1090711"></a><a class="indexterm" name="id1090720"></a><a class="indexterm" name="id1090729"></a><a class="indexterm" name="id1090738"></a><a class="indexterm" name="id1090747"></a><a class="indexterm" name="id1090756"></a><a class="indexterm" name="id1090765"></a><a class="indexterm" name="id1090774"></a><a class="indexterm" name="id1090783"></a><p>
    MySQL supports several storage engines that act as handlers for
    different table types. MySQL storage engines include both those that
    handle transaction-safe tables and those that handle
    nontransaction-safe tables.
  </p><p>
    MySQL Server uses a pluggable storage engine architecture that
    enables storage engines to be loaded into and unloaded from a
    running MySQL server.
  </p><p>
    To determine which storage engines your server supports by using the
    <a href="sql-syntax.html#show-engines" title="12.7.5.17. SHOW ENGINES Syntax"><code class="literal">SHOW ENGINES</code></a> statement. The value in
    the <code class="literal">Support</code> column indicates whether an engine
    can be used. A value of <code class="literal">YES</code>,
    <code class="literal">NO</code>, or <code class="literal">DEFAULT</code> indicates that
    an engine is available, not available, or available and currently
    set as the default storage engine.
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW ENGINES\G</code></strong>
*************************** 1. row ***************************
      Engine: FEDERATED
     Support: NO
     Comment: Federated MySQL storage engine
Transactions: NULL
          XA: NULL
  Savepoints: NULL
*************************** 2. row ***************************
      Engine: MRG_MYISAM
     Support: YES
     Comment: Collection of identical MyISAM tables
Transactions: NO
          XA: NO
  Savepoints: NO
*************************** 3. row ***************************
      Engine: MyISAM
     Support: DEFAULT
     Comment: Default engine as of MySQL 3.23 with great performance
Transactions: NO
          XA: NO
  Savepoints: NO
...
</pre><p>
    This chapter describes each of the MySQL storage engines except for
    <code class="literal">NDBCLUSTER</code>, which is covered in
    <a href="http://dev.mysql.com/doc/refman/5.1/en/mysql-cluster.html" target="_top">MySQL Cluster NDB 6.X/7.X</a>. It also contains a
    description of the pluggable storage engine architecture (see
    <a href="storage-engines.html#pluggable-storage-overview" title="13.2. Overview of MySQL Storage Engine Architecture">Section 13.2, “Overview of MySQL Storage Engine Architecture”</a>).
  </p><p>
    For information about storage engine support offered in commercial
    MySQL Server binaries, see
    <a href="http://www.mysql.com/products/enterprise/server.html" target="_top"><em class="citetitle">MySQL
    Enterprise Server 5.1</em></a>, on the MySQL Web site.
    The storage engines available might depend on which edition of
    Enterprise Server you are using.
  </p><p>
    For answers to some commonly asked questions about MySQL storage
    engines, see <a href="faqs.html#faqs-storage-engines" title="B.2. MySQL 5.5 FAQ: Storage Engines">Section B.2, “MySQL 5.5 FAQ: Storage Engines”</a>.
  </p><p>
    <span class="bold"><strong>MySQL 5.5 supported storage
    engines</strong></span>
  </p><div class="itemizedlist"><ul type="disc"><li><p>
        <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>:
        A transaction-safe (ACID compliant) storage engine for MySQL
        that has commit, rollback, and crash-recovery capabilities to
        protect user data. <code class="literal">InnoDB</code> row-level locking
        (without escalation to coarser granularity locks) and
        Oracle-style consistent nonlocking reads increase multi-user
        concurrency and performance. <code class="literal">InnoDB</code> stores
        user data in clustered indexes to reduce I/O for common queries
        based on primary keys. To maintain data integrity,
        <code class="literal">InnoDB</code> also supports <code class="literal">FOREIGN
        KEY</code> referential-integrity constraints.
        <code class="literal">InnoDB</code> is the default storage engine as of
        MySQL 5.5.5.
      </p></li><li><p>
        <a href="storage-engines.html#myisam-storage-engine" title="13.5. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a>:
        The MySQL storage engine that is used the most in Web, data
        warehousing, and other application environments.
        <code class="literal">MyISAM</code> is supported in all MySQL
        configurations, and is the default storage engine prior to MySQL
        5.5.5.
      </p></li><li><p>
        <a href="storage-engines.html#memory-storage-engine" title="13.6. The MEMORY Storage Engine"><code class="literal">Memory</code></a>:
        Stores all data in RAM for extremely fast access in environments
        that require quick lookups of reference and other like data.
        This engine was formerly known as the <code class="literal">HEAP</code>
        engine.
      </p></li><li><p>
        <a href="storage-engines.html#merge-storage-engine" title="13.10. The MERGE Storage Engine"><code class="literal">Merge</code></a>:
        Enables a MySQL DBA or developer to logically group a series of
        identical <code class="literal">MyISAM</code> tables and reference them as
        one object. Good for VLDB environments such as data warehousing.
      </p></li><li><p>
        <a href="storage-engines.html#archive-storage-engine" title="13.8. The ARCHIVE Storage Engine"><code class="literal">Archive</code></a>:
        Provides the perfect solution for storing and retrieving large
        amounts of seldom-referenced historical, archived, or security
        audit information.
      </p></li><li><p>
        <a href="storage-engines.html#federated-storage-engine" title="13.11. The FEDERATED Storage Engine"><code class="literal">Federated</code></a>:
        Offers the ability to link separate MySQL servers to create one
        logical database from many physical servers. Very good for
        distributed or data mart environments.
      </p></li><li><p>
        <a href="storage-engines.html#csv-storage-engine" title="13.7. The CSV Storage Engine"><code class="literal">CSV</code></a>:
        The CSV storage engine stores data in text files using
        comma-separated values format. You can use the CSV engine to
        easily exchange data between other software and applications
        that can import and export in CSV format.
      </p></li><li><p>
        <a href="storage-engines.html#blackhole-storage-engine" title="13.9. The BLACKHOLE Storage Engine"><code class="literal">Blackhole</code></a>:
        The Blackhole storage engine accepts but does not store data and
        retrievals always return an empty set. The functionality can be
        used in distributed database design where data is automatically
        replicated, but not stored locally.
      </p></li><li><p>
        <a href="storage-engines.html#example-storage-engine" title="13.12. The EXAMPLE Storage Engine"><code class="literal">Example</code></a>:
        The Example storage engine is “<span class="quote">stub</span>” engine that
        does nothing. You can create tables with this engine, but no
        data can be stored in them or retrieved from them. The purpose
        of this engine is to serve as an example in the MySQL source
        code that illustrates how to begin writing new storage engines.
        As such, it is primarily of interest to developers.
      </p></li></ul></div><p>
    It is important to remember that you are not restricted to using the
    same storage engine for an entire server or schema: you can use a
    different storage engine for each table in your schema.
  </p><p>
    <span class="bold"><strong>Choosing a Storage Engine</strong></span>
  </p><p>
    The various storage engines provided with MySQL are designed with
    different use cases in mind. To use the pluggable storage
    architecture effectively, it is good to have an idea of the
    advantages and disadvantages of the various storage engines. The
    following table provides an overview of some storage engines
    provided with MySQL:
  </p><div class="table"><a name="id1091144"></a><p class="title"><b>Table 13.1. Storage Engines Feature Summary</b></p><table summary="Storage Engines Feature Summary" border="1"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th>Feature</th><th>MyISAM</th><th>Memory</th><th>InnoDB</th><th>Archive</th><th>NDB</th></tr></thead><tbody><tr><td>Storage limits</td><td>256TB</td><td>RAM</td><td>64TB</td><td>None</td><td>384EB</td></tr><tr><td>Transactions</td><td>No</td><td>No</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td>Locking granularity</td><td>Table</td><td>Table</td><td>Row</td><td>Table</td><td>Row</td></tr><tr><td>MVCC</td><td>No</td><td>No</td><td>Yes</td><td>No</td><td>No</td></tr><tr><td>Geospatial data type support</td><td>Yes</td><td>No</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Geospatial indexing support</td><td>Yes</td><td>No</td><td>No</td><td>No</td><td>No</td></tr><tr><td>B-tree indexes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td>Hash indexes</td><td>No</td><td>Yes</td><td>No<sup>[<a name="id1091365" href="#ftn.id1091365">a</a>]</sup></td><td>No</td><td>Yes</td></tr><tr><td>Full-text search indexes</td><td>Yes</td><td>No</td><td>No</td><td>No</td><td>No</td></tr><tr><td>Clustered indexes</td><td>No</td><td>No</td><td>Yes</td><td>No</td><td>No</td></tr><tr><td>Data caches</td><td>No</td><td>N/A</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td>Index caches</td><td>Yes</td><td>N/A</td><td>Yes</td><td>No</td><td>Yes</td></tr><tr><td>Compressed data</td><td>Yes<sup>[<a name="id1091466" href="#ftn.id1091466">b</a>]</sup></td><td>No</td><td>Yes<sup>[<a name="id1091477" href="#ftn.id1091477">c</a>]</sup></td><td>Yes</td><td>No</td></tr><tr><td>Encrypted data<sup>[<a name="id1091491" href="#ftn.id1091491">d</a>]</sup></td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Cluster database support</td><td>No</td><td>No</td><td>No</td><td>No</td><td>Yes</td></tr><tr><td>Replication support<sup>[<a name="id1091537" href="#ftn.id1091537">e</a>]</sup></td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Foreign key support</td><td>No</td><td>No</td><td>Yes</td><td>No</td><td>No</td></tr><tr><td>Backup / point-in-time recovery<sup>[<a name="id1091582" href="#ftn.id1091582">f</a>]</sup></td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Query cache support</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Update statistics for data dictionary</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr></tbody><tbody class="footnotes"><tr><td colspan="6"><div class="footnote"><p><sup>[<a name="ftn.id1091365" href="#id1091365">a</a>] </sup>InnoDB utilizes hash indexes internally for its Adaptive Hash Index feature.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1091466" href="#id1091466">b</a>] </sup>Compressed MyISAM tables are supported only when using the compressed row format. Tables using the compressed row format with MyISAM are read only.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1091477" href="#id1091477">c</a>] </sup>Compressed InnoDB tables require the InnoDB Barracuda file format.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1091491" href="#id1091491">d</a>] </sup>Implemented in the server (via encryption functions), rather than in the storage engine.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1091537" href="#id1091537">e</a>] </sup>Implemented in the server, rather than in the storage product.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1091582" href="#id1091582">f</a>] </sup>Implemented in the server, rather than in the storage product.</p></div></td></tr></tbody></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="storage-engine-setting"></a>13.1. Setting the Storage Engine</h2></div></div></div><p>
      When you create a new table, you can specify which storage engine
      to use by adding an <code class="literal">ENGINE</code> table option to the
      <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement:
    </p><pre class="programlisting">CREATE TABLE t (i INT) ENGINE = INNODB;</pre><p>
      If you omit the <code class="literal">ENGINE</code> option, the default
      storage engine is used. The default engine is
      <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> as of MySQL 5.5.5
      (<a href="storage-engines.html#myisam-storage-engine" title="13.5. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> before 5.5.5). You can
      specify the default engine by using the
      <a href="server-administration.html#option_mysqld_default-storage-engine"><code class="option">--default-storage-engine</code></a> server
      startup option, or by setting the
      <a href="server-administration.html#option_mysqld_default-storage-engine"><code class="option">default-storage-engine</code></a> option in
      the <code class="filename">my.cnf</code> configuration file.
    </p><p>
      You can set the default storage engine to be used during the
      current session by setting the
      <a href="server-administration.html#sysvar_default_storage_engine"><code class="literal">default_storage_engine</code></a> variable:
    </p><pre class="programlisting">SET default_storage_engine=MYISAM;</pre><p>
      When MySQL is installed on Windows using the MySQL Configuration
      Wizard, the <code class="literal">InnoDB</code> or <code class="literal">MyISAM</code>
      storage engine can be selected as the default. See
      <a href="installing.html#mysql-config-wizard-database-usage" title="2.3.5.5. The Database Usage Dialog">Section 2.3.5.5, “The Database Usage Dialog”</a>.
    </p><p>
      To convert a table from one storage engine to another, use an
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement that
      indicates the new engine:
    </p><pre class="programlisting">ALTER TABLE t ENGINE = MYISAM;</pre><p>
      See <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax">Section 12.1.17, “<code class="literal">CREATE TABLE</code> Syntax”</a>, and
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax">Section 12.1.7, “<code class="literal">ALTER TABLE</code> Syntax”</a>.
    </p><p>
      If you try to use a storage engine that is not compiled in or that
      is compiled in but deactivated, MySQL instead creates a table
      using the default storage engine. This behavior is convenient when
      you want to copy tables between MySQL servers that support
      different storage engines. (For example, in a replication setup,
      perhaps your master server supports transactional storage engines
      for increased safety, but the slave servers use only
      nontransactional storage engines for greater speed.)
    </p><p>
      This automatic substitution of the default storage engine for
      unavailable engines can be confusing for new MySQL users. A
      warning is generated whenever a storage engine is automatically
      changed. To prevent this from happening if the desired engine is
      unavailable, enable the
      <a href="server-administration.html#sqlmode_no_engine_substitution"><code class="literal">NO_ENGINE_SUBSTITUTION</code></a> SQL mode.
      In this case, an error occurs instead of a warning and the table
      is not created or altered if the desired engine is unavailable.
      See <a href="server-administration.html#server-sql-mode" title="5.1.6. Server SQL Modes">Section 5.1.6, “Server SQL Modes”</a>.
    </p><p>
      For new tables, MySQL always creates an <code class="filename">.frm</code>
      file to hold the table and column definitions. The table's index
      and data may be stored in one or more other files, depending on
      the storage engine. The server creates the
      <code class="filename">.frm</code> file above the storage engine level.
      Individual storage engines create any additional files required
      for the tables that they manage. If a table name contains special
      characters, the names for the table files contain encoded versions
      of those characters as described in
      <a href="language-structure.html#identifier-mapping" title="8.2.3. Mapping of Identifiers to File Names">Section 8.2.3, “Mapping of Identifiers to File Names”</a>.
    </p><p>
      A database may contain tables of different types. That is, tables
      need not all be created with the same storage engine.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="pluggable-storage-overview"></a>13.2. Overview of MySQL Storage Engine Architecture</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#pluggable-storage">13.2.1. Pluggable Storage Engine Architecture</a></span></dt><dt><span class="section"><a href="storage-engines.html#pluggable-storage-common-layer">13.2.2. The Common Database Server Layer</a></span></dt></dl></div><p>
      The MySQL pluggable storage engine architecture enables a database
      professional to select a specialized storage engine for a
      particular application need while being completely shielded from
      the need to manage any specific application coding requirements.
      The MySQL server architecture isolates the application programmer
      and DBA from all of the low-level implementation details at the
      storage level, providing a consistent and easy application model
      and API. Thus, although there are different capabilities across
      different storage engines, the application is shielded from these
      differences.
    </p><p>
      The MySQL pluggable storage engine architecture is shown in
      <a href="storage-engines.html#figure-storage-engine-architecture" title="Figure 13.1. MySQL Architecture with Pluggable Storage Engines">Figure 13.1, “MySQL Architecture with Pluggable Storage Engines”</a>.
    </p><div class="figure"><a name="figure-storage-engine-architecture"></a><p class="title"><b>Figure 13.1. MySQL Architecture with Pluggable Storage Engines</b></p><div class="mediaobject"><img src="images/PSEArch.png" width="578" height="394" alt="MySQL Architecture with Pluggable Storage
          Engines"></div></div><p>
      The pluggable storage engine architecture provides a standard set
      of management and support services that are common among all
      underlying storage engines. The storage engines themselves are the
      components of the database server that actually perform actions on
      the underlying data that is maintained at the physical server
      level.
    </p><p>
      This efficient and modular architecture provides huge benefits for
      those wishing to specifically target a particular application
      need—such as data warehousing, transaction processing, or
      high availability situations—while enjoying the advantage of
      utilizing a set of interfaces and services that are independent of
      any one storage engine.
    </p><p>
      The application programmer and DBA interact with the MySQL
      database through Connector APIs and service layers that are above
      the storage engines. If application changes bring about
      requirements that demand the underlying storage engine change, or
      that one or more storage engines be added to support new needs, no
      significant coding or process changes are required to make things
      work. The MySQL server architecture shields the application from
      the underlying complexity of the storage engine by presenting a
      consistent and easy-to-use API that applies across storage
      engines.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pluggable-storage"></a>13.2.1. Pluggable Storage Engine Architecture</h3></div></div></div><p>
        MySQL Server uses a pluggable storage engine architecture that
        enables storage engines to be loaded into and unloaded from a
        running MySQL server.
      </p><p>
        <span class="bold"><strong>Plugging in a Storage Engine</strong></span>
      </p><p>
        Before a storage engine can be used, the storage engine plugin
        shared library must be loaded into MySQL using the
        <a href="sql-syntax.html#install-plugin" title="12.7.3.3. INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> statement. For
        example, if the <code class="literal">EXAMPLE</code> engine plugin is
        named <code class="literal">example</code> and the shared library is named
        <code class="filename">ha_example.so</code>, you load it with the
        following statement:
      </p><pre class="programlisting">mysql&gt; INSTALL PLUGIN example SONAME 'ha_example.so';</pre><p>
        To install a pluggable storage engine, the plugin file must be
        located in the MySQL plugin directory, and the user issuing the
        <a href="sql-syntax.html#install-plugin" title="12.7.3.3. INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> statement must
        have <a href="server-administration.html#priv_insert"><code class="literal">INSERT</code></a> privilege for the
        <code class="literal">mysql.plugin</code> table.
      </p><p>
        The shared library must be located in the MySQL server plugin
        directory, the location of which is given by the
        <a href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable.
      </p><p>
        <span class="bold"><strong>Unplugging a Storage Engine</strong></span>
      </p><p>
        To unplug a storage engine, use the
        <a href="sql-syntax.html#uninstall-plugin" title="12.7.3.4. UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a> statement:
      </p><pre class="programlisting">mysql&gt; UNINSTALL PLUGIN example;</pre><p>
        If you unplug a storage engine that is needed by existing
        tables, those tables become inaccessible, but will still be
        present on disk (where applicable). Ensure that there are no
        tables using a storage engine before you unplug the storage
        engine.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pluggable-storage-common-layer"></a>13.2.2. The Common Database Server Layer</h3></div></div></div><p>
        A MySQL pluggable storage engine is the component in the MySQL
        database server that is responsible for performing the actual
        data I/O operations for a database as well as enabling and
        enforcing certain feature sets that target a specific
        application need. A major benefit of using specific storage
        engines is that you are only delivered the features needed for a
        particular application, and therefore you have less system
        overhead in the database, with the end result being more
        efficient and higher database performance. This is one of the
        reasons that MySQL has always been known to have such high
        performance, matching or beating proprietary monolithic
        databases in industry standard benchmarks.
      </p><p>
        From a technical perspective, what are some of the unique
        supporting infrastructure components that are in a storage
        engine? Some of the key feature differentiations include:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <span class="emphasis"><em>Concurrency</em></span>: Some applications have
            more granular lock requirements (such as row-level locks)
            than others. Choosing the right locking strategy can reduce
            overhead and therefore improve overall performance. This
            area also includes support for capabilities such as
            multi-version concurrency control or “<span class="quote">snapshot</span>”
            read.
          </p></li><li><p>
            <span class="emphasis"><em>Transaction Support</em></span>: Not every
            application needs transactions, but for those that do, there
            are very well defined requirements such as ACID compliance
            and more.
          </p></li><li><p>
            <span class="emphasis"><em>Referential Integrity</em></span>: The need to have
            the server enforce relational database referential integrity
            through DDL defined foreign keys.
          </p></li><li><p>
            <span class="emphasis"><em>Physical Storage</em></span>: This involves
            everything from the overall page size for tables and indexes
            as well as the format used for storing data to physical
            disk.
          </p></li><li><p>
            <span class="emphasis"><em>Index Support</em></span>: Different application
            scenarios tend to benefit from different index strategies.
            Each storage engine generally has its own indexing methods,
            although some (such as B-tree indexes) are common to nearly
            all engines.
          </p></li><li><p>
            <span class="emphasis"><em>Memory Caches</em></span>: Different applications
            respond better to some memory caching strategies than
            others, so although some memory caches are common to all
            storage engines (such as those used for user connections or
            MySQL's high-speed Query Cache), others are uniquely defined
            only when a particular storage engine is put in play.
          </p></li><li><p>
            <span class="emphasis"><em>Performance Aids</em></span>: This includes
            multiple I/O threads for parallel operations, thread
            concurrency, database checkpointing, bulk insert handling,
            and more.
          </p></li><li><p>
            <span class="emphasis"><em>Miscellaneous Target Features</em></span>: This may
            include support for geospatial operations, security
            restrictions for certain data manipulation operations, and
            other similar features.
          </p></li></ul></div><p>
        Each set of the pluggable storage engine infrastructure
        components are designed to offer a selective set of benefits for
        a particular application. Conversely, avoiding a set of
        component features helps reduce unnecessary overhead. It stands
        to reason that understanding a particular application's set of
        requirements and selecting the proper MySQL storage engine can
        have a dramatic impact on overall system efficiency and
        performance.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="innodb-storage-engine"></a>13.3. The <code class="literal">InnoDB</code> Storage Engine</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-default-se">13.3.1. InnoDB as the Default MySQL Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-configuration">13.3.2. Configuring <code class="literal">InnoDB</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-multiple-tablespaces">13.3.3. Using Per-Table Tablespaces</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-parameters">13.3.4. <code class="literal">InnoDB</code> Startup Options and System Variables</a></span></dt><dt><span class="section"><a href="storage-engines.html#using-innodb-tables">13.3.5. Creating and Using <code class="literal">InnoDB</code> Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-data-log-reconfiguration">13.3.6. Adding, Removing, or Resizing <code class="literal">InnoDB</code> Data and Log
      Files</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-backup">13.3.7. Backing Up and Recovering an <code class="literal">InnoDB</code>
      Database</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-migration">13.3.8. Moving an <code class="literal">InnoDB</code> Database to Another Machine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-transaction-model">13.3.9. The <code class="literal">InnoDB</code> Transaction Model and Locking</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-multi-versioning">13.3.10. <code class="literal">InnoDB</code> Multi-Versioning</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-table-and-index">13.3.11. <code class="literal">InnoDB</code> Table and Index Structures</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-disk-management">13.3.12. <code class="literal">InnoDB</code> Disk I/O and File Space Management</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-error-handling">13.3.13. <code class="literal">InnoDB</code> Error Handling</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-tuning-troubleshooting">13.3.14. <code class="literal">InnoDB</code> Performance Tuning and Troubleshooting</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-restrictions">13.3.15. Limits on <code class="literal">InnoDB</code> Tables</a></span></dt></dl></div><a class="indexterm" name="id1092256"></a><a class="indexterm" name="id1092268"></a><a class="indexterm" name="id1092277"></a><a class="indexterm" name="id1092290"></a><a class="indexterm" name="id1092299"></a><a class="indexterm" name="id1092311"></a><a class="indexterm" name="id1092320"></a><p>
    <code class="literal">InnoDB</code> is a high-reliability and high-performance
    storage engine for MySQL. Starting with MySQL 5.5, it is the default
    MySQL storage engine. Key advantages of InnoDB include:
  </p><div class="itemizedlist"><ul type="disc"><li><p>
        Its design follows the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_acid" target="_top">ACID</a>
        model, with <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_transaction" target="_top">transactions</a>
        featuring <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_commit" target="_top">commit</a>,
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_rollback" target="_top">rollback</a>, and
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_crash_recovery" target="_top">crash-recovery</a>
        capabilities to protect user data.
      </p></li><li><p>
        Row-level <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_locking" target="_top">locking</a> and
        Oracle-style <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_consistent_read" target="_top">consistent
        reads</a> increase multi-user concurrency and performance.
      </p></li><li><p>
        <code class="literal">InnoDB</code> tables arrange your data on disk to
        optimize common queries based on
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_primary_key" target="_top">primary keys</a>. Each
        <code class="literal">InnoDB</code> table has a primary key index called
        the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_clustered_index" target="_top">clustered index</a>
        that organizes the data to minimize I/O for primary key lookups.
      </p></li><li><p>
        To maintain data integrity, <code class="literal">InnoDB</code> also
        supports <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_foreign_key" target="_top"><code class="literal">FOREIGN
        KEY</code></a> referential-integrity constraints.
      </p></li><li><p>
        You can freely mix <code class="literal">InnoDB</code> tables with tables
        from other MySQL storage engines, even within the same
        statement. For example, you can use a join operation to combine
        data from <code class="literal">InnoDB</code> and
        <code class="literal">MEMORY</code> tables in a single query.
      </p></li></ul></div><p>
    To determine whether your server supports <code class="literal">InnoDB</code>
    use the <a href="sql-syntax.html#show-engines" title="12.7.5.17. SHOW ENGINES Syntax"><code class="literal">SHOW ENGINES</code></a> statement. See
    <a href="sql-syntax.html#show-engines" title="12.7.5.17. SHOW ENGINES Syntax">Section 12.7.5.17, “<code class="literal">SHOW ENGINES</code> Syntax”</a>.
  </p><div class="table"><a name="id1092505"></a><p class="title"><b>Table 13.2. <code class="literal">InnoDB</code> Storage Engine
    Features</b></p><table summary="InnoDB Storage Engine
    Features" border="1"><colgroup><col><col><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Storage limits</strong></span></td><td>64TB</td><td><span class="bold"><strong>Transactions</strong></span></td><td>Yes</td><td><span class="bold"><strong>Locking granularity</strong></span></td><td>Row</td></tr><tr><td><span class="bold"><strong>MVCC</strong></span></td><td>Yes</td><td><span class="bold"><strong>Geospatial data type support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Geospatial indexing support</strong></span></td><td>No</td></tr><tr><td><span class="bold"><strong>B-tree indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>Hash indexes</strong></span></td><td>No<sup>[<a name="id1092632" href="#ftn.id1092632">a</a>]</sup></td><td><span class="bold"><strong>Full-text search indexes</strong></span></td><td>No</td></tr><tr><td><span class="bold"><strong>Clustered indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>Data caches</strong></span></td><td>Yes</td><td><span class="bold"><strong>Index caches</strong></span></td><td>Yes</td></tr><tr><td><span class="bold"><strong>Compressed data</strong></span></td><td>Yes<sup>[<a name="id1092689" href="#ftn.id1092689">b</a>]</sup></td><td><span class="bold"><strong>Encrypted data<sup>[<a name="id1092699" href="#ftn.id1092699">c</a>]</sup></strong></span></td><td>Yes</td><td><span class="bold"><strong>Cluster database support</strong></span></td><td>No</td></tr><tr><td><span class="bold"><strong>Replication support<sup>[<a name="id1092725" href="#ftn.id1092725">d</a>]</sup></strong></span></td><td>Yes</td><td><span class="bold"><strong>Foreign key support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Backup / point-in-time recovery<sup>[<a name="id1092749" href="#ftn.id1092749">e</a>]</sup></strong></span></td><td>Yes</td></tr><tr><td><span class="bold"><strong>Query cache support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Update statistics for data dictionary</strong></span></td><td>Yes</td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr></tbody><tbody class="footnotes"><tr><td colspan="6"><div class="footnote"><p><sup>[<a name="ftn.id1092632" href="#id1092632">a</a>] </sup>InnoDB utilizes hash indexes internally for its Adaptive Hash Index feature.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1092689" href="#id1092689">b</a>] </sup>Compressed InnoDB tables require the InnoDB Barracuda file format.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1092699" href="#id1092699">c</a>] </sup>Implemented in the server (via encryption functions), rather than in the storage engine.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1092725" href="#id1092725">d</a>] </sup>Implemented in the server, rather than in the storage product.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1092749" href="#id1092749">e</a>] </sup>Implemented in the server, rather than in the storage product.</p></div></td></tr></tbody></table></div><p>
    <code class="literal">InnoDB</code> has been designed for maximum performance
    when processing large data volumes. Its CPU efficiency is probably
    not matched by any other disk-based relational database engine.
  </p><p>
    The <code class="literal">InnoDB</code> storage engine maintains its own
    buffer pool for caching data and indexes in main memory.
    <code class="literal">InnoDB</code> stores its tables and indexes in a
    tablespace, which may consist of several files (or raw disk
    partitions). This is different from, for example,
    <code class="literal">MyISAM</code> tables where each table is stored using
    separate files. <code class="literal">InnoDB</code> tables can be very large
    even on operating systems where file size is limited to 2GB.
  </p><p>
    <code class="literal">InnoDB</code> is published under the same GNU GPL
    License Version 2 (of June 1991) as MySQL. For more information on
    MySQL licensing, see http://www.mysql.com/company/legal/licensing/.
  </p><h3><a name="id1092831"></a>
    Additional Resources
  </h3><div class="itemizedlist"><ul type="disc"><li><p>
        A forum dedicated to the <code class="literal">InnoDB</code> storage
        engine is available at <a href="http://forums.mysql.com/list.php?22" target="_top">http://forums.mysql.com/list.php?22</a>.
      </p></li><li><p>
        The InnoDB storage engine in MySQL 5.5 releases
        includes a number performance improvements that in MySQL 5.1
        were only available by installing the InnoDB Plugin. This latest
        InnoDB (now known as InnoDB 1.1) offers new features, improved
        performance and scalability, enhanced reliability and new
        capabilities for flexibility and ease of use. Among the top
        features are Fast Index Creation, table and index compression,
        file format management, new
        <code class="literal">INFORMATION_SCHEMA</code> tables, capacity tuning,
        multiple background I/O threads, multiple buffer pools, and
        group commit.
      </p><p>
        For information about these features, see
        <a href="storage-engines.html#innodb-5-5" title="13.4. New Features of InnoDB 1.1">Section 13.4, “New Features of InnoDB 1.1”</a>.
      </p></li><li><p>
        The MySQL Enterprise Backup product lets you back up a running
        MySQL database, including <code class="literal">InnoDB</code> and
        <code class="literal">MyISAM</code> tables, with minimal disruption to
        operations while producing a consistent snapshot of the
        database. When MySQL Enterprise Backup is copying
        <code class="literal">InnoDB</code> tables, reads and writes to both
        <code class="literal">InnoDB</code> and <code class="literal">MyISAM</code> tables
        can continue. During the copying of <code class="literal">MyISAM</code>
        and other non-InnoDB tables, reads (but not writes) to those
        tables are permitted. In addition, MySQL Enterprise Backup can
        create compressed backup files, and back up subsets of
        <code class="literal">InnoDB</code> tables. In conjunction with the MySQL
        binary log, you can perform point-in-time recovery. MySQL
        Enterprise Backup is included as part of the MySQL Enterprise
        subscription.
      </p><p>
        For a more complete description of MySQL Enterprise Backup, see
        <a href="http://dev.mysql.com/doc/mysql-enterprise-backup/3.5/en/index.html" target="_top">MySQL Enterprise Backup User's Guide (Version 3.5.4)</a>.
      </p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-default-se"></a>13.3.1. InnoDB as the Default MySQL Storage Engine</h3></div></div></div><a class="indexterm" name="id1092955"></a><a class="indexterm" name="id1092967"></a><p>
      MySQL has a well-earned reputation for being easy-to-use and
      delivering performance and scalability. In previous versions of
      MySQL, MyISAM was the default storage engine. In our experience,
      most users never changed the default settings. With MySQL 5.5,
      InnoDB becomes the default storage engine. Again, we expect most
      users will not change the default settings. But, because of
      InnoDB, the default settings deliver the benefits users expect
      from their RDBMS: ACID Transactions, Referential Integrity, and
      Crash Recovery. Let's explore how using InnoDB tables improves
      your life as a MySQL user, DBA, or developer.
    </p><h4><a name="id1092989"></a>
      Trends in Storage Engine Usage
    </h4><p>
      In the first years of MySQL growth, early web-based applications
      didn't push the limits of concurrency and availability. In 2010,
      hard drive and memory capacity and the performance/price ratio
      have all gone through the roof. Users pushing the performance
      boundaries of MySQL care a lot about reliability and crash
      recovery. MySQL databases are big, busy, robust, distributed, and
      important.
    </p><p>
      InnoDB hits the sweet spot of these top user priorities. The trend
      of storage engine usage has shifted in favor of the more efficient
      InnoDB. With MySQL 5.5, the time is right to make InnoDB the
      default storage engine.
    </p><h4><a name="id1093005"></a>
      Consequences of InnoDB as Default MySQL Storage Engine
    </h4><p>
      Starting from MySQL 5.5.5, the default storage engine for new
      tables is InnoDB. This change applies to newly created tables that
      don't specify a storage engine with a clause such as
      <code class="literal">ENGINE=MyISAM</code>. (Given this change of default
      behavior, MySQL 5.5 might be a logical point to evaluate whether
      your tables that do use MyISAM could benefit from switching to
      InnoDB.)
    </p><p>
      The <code class="literal">mysql</code> and
      <code class="literal">information_schema</code> databases, that implement
      some of the MySQL internals, still use MyISAM. In particular, you
      cannot switch the grant tables to use InnoDB.
    </p><h4><a name="id1093038"></a>
      Benefits of InnoDB Tables
    </h4><p>
      If you use MyISAM tables but aren't tied to them for technical
      reasons, you'll find many things more convenient when you use
      InnoDB tables in MySQL 5.5:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          If your server crashes because of a hardware or software
          issue, regardless of what was happening in the database at the
          time, you don't need to do anything special after restarting
          the database. InnoDB automatically finalizes any changes that
          were committed before the time of the crash, and undoes any
          changes that were in process but not committed. Just restart
          and continue where you left off.
        </p></li><li><p>
          The InnoDB buffer pool caches table and index data as the data
          is accessed. Frequently used data is processed directly from
          memory. This cache applies to so many types of information,
          and speeds up processing so much, that dedicated database
          servers assign up to 80% of their physical memory to the
          InnoDB buffer pool.
        </p></li><li><p>
          If you split up related data into different tables, you can
          set up foreign keys that enforce referential integrity. Update
          or delete data, and the related data in other tables is
          updated or deleted automatically. Try to insert data into a
          secondary table without corresponding data in the primary
          table, and it gets kicked out automatically.
        </p></li><li><p>
          If data becomes corrupted on disk or in memory, a checksum
          mechanism alerts you to the bogus data before you use it.
        </p></li><li><p>
          When you design your database with appropriate primary key
          columns for each table, operations involving those columns are
          automatically optimized. It is very fast to reference the
          primary key columns in <code class="literal">WHERE</code> clauses,
          <code class="literal">ORDER BY</code> clauses, <code class="literal">GROUP
          BY</code> clauses, and join operations.
        </p></li><li><p>
          Inserts, updates, deletes are optimized by an automatic
          mechanism called change buffering. InnoDB not only allows
          concurrent read and write access to the same table, it caches
          changed data to streamline disk I/O.
        </p></li><li><p>
          Performance benefits are not limited to giant tables with
          long-running queries. When the same rows are accessed over and
          over from a table, a feature called the Adaptive Hash Index
          takes over to make these lookups even faster, as if they came
          out of a hash table.
        </p></li></ul></div><h4><a name="id1093132"></a>
      Best Practices for InnoDB Tables
    </h4><p>
      If you have been using InnoDB for a long time, you already know
      about features like transactions and foreign keys. If not, read
      about them throughout this chapter. To make a long story short:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          Specify a primary key for every table using the most
          frequently queried column or columns, or an auto-increment
          value if there isn't an obvious primary key.
        </p></li><li><p>
          Embrace the idea of joins, where data is pulled from multiple
          tables based on identical ID values from those tables. For
          fast join performance, define foreign keys on the join
          columns, and declare those columns with the same datatype in
          each table. The foreign keys also propagate deletes or updates
          to all affected tables, and prevent insertion of data in a
          child table if the corresponding IDs are not present in the
          parent table.
        </p></li><li><p>
          Turn off autocommit. Committing hundreds of times a second
          puts a cap on performance (limited by the write speed of your
          storage device).
        </p></li><li><p>
          Bracket sets of related changes, logical units of work, with
          <code class="literal">START TRANSACTION</code> and
          <code class="literal">COMMIT</code> statements. While you don't want to
          commit too often, you also don't want to issue huge batches of
          <code class="literal">INSERT</code>, <code class="literal">UPDATE</code>, or
          <code class="literal">DELETE</code> statements that run for hours
          without committing.
        </p></li><li><p>
          Stop using <code class="literal">LOCK TABLE</code> statements. InnoDB
          can handle multiple sessions all reading and writing to the
          same table at once, without sacrificing reliability or high
          performance. To get exclusive write access to a set of rows,
          use the <code class="literal">SELECT ... FOR UPDATE</code> syntax to
          lock just the rows you intend to update.
        </p></li><li><p>
          Enable the <code class="literal">innodb_file_per_table</code> option to
          put the data and indexes for individual tables into separate
          files, instead of in a single giant system tablespace. (This
          setting is required to use some of the other features, such as
          table compression and fast truncation.)
        </p></li><li><p>
          Evaluate whether your data and access patterns benefit from
          the new InnoDB table compression feature
          (<code class="literal">ROW_FORMAT=COMPRESSED</code> on the
          <code class="literal">CREATE TABLE</code> statement. You can compress
          InnoDB tables without sacrificing read/write capability.
        </p></li><li><p>
          Run your server with the option
          <code class="literal">--sql_mode=NO_ENGINE_SUBSTITUTION</code> to
          prevent tables being created with a different storage engine
          if there is an issue with the one specified in the
          <code class="literal">ENGINE=</code> clause of <code class="literal">CREATE
          TABLE</code>.
        </p></li></ul></div><h4><a name="id1093292"></a>
      Recent Improvements for InnoDB Tables (from the Plugin Era)
    </h4><p>
      If you have experience with InnoDB, but not the recent incarnation
      known as the InnoDB Plugin, read about the latest enhancements in
      <a href="storage-engines.html#innodb-5-5" title="13.4. New Features of InnoDB 1.1">Section 13.4, “New Features of InnoDB 1.1”</a>. To make a long story short:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          You can compress tables and associated indexes.
        </p></li><li><p>
          You can create and drop indexes with much less performance or
          availability impact than before.
        </p></li><li><p>
          Truncating a table is very fast, and can free up disk space
          for the operating system to reuse, rather than freeing up
          space within the system tablespace that only InnoDB could
          reuse.
        </p></li><li><p>
          The storage layout for table data is more efficient for BLOBs
          and long text fields.
        </p></li><li><p>
          You can monitor the internal workings of the storage engine by
          querying <code class="literal">INFORMATION_SCHEMA</code> tables.
        </p></li><li><p>
          You can monitor the performance details of the storage engine
          by querying <code class="literal">performance_schema</code> tables.
        </p></li><li><p>
          There are many many performance improvements. In particular,
          crash recovery, the automatic process that makes all data
          consistent when the database is restarted, is fast and
          reliable. (Now much much faster than long-time InnoDB users
          are used to.) The bigger the database, the more dramatic the
          speedup.
        </p><p>
          Most new performance features are automatic, or at most
          require setting a value for a configuration option. For
          details, see <a href="storage-engines.html#innodb-performance" title="13.4.7. InnoDB Performance and Scalability Enhancements">Section 13.4.7, “InnoDB Performance and Scalability Enhancements”</a>. For
          InnoDB-specific tuning techniques you can apply in your
          application code, see <a href="optimization.html#optimizing-innodb" title="7.5. Optimizing for InnoDB Tables">Section 7.5, “Optimizing for <code class="literal">InnoDB</code> Tables”</a>.
          Advanced users can review <a href="storage-engines.html#innodb-parameters" title="13.3.4. InnoDB Startup Options and System Variables">Section 13.3.4, “<code class="literal">InnoDB</code> Startup Options and System Variables”</a>.
        </p></li></ul></div><h4><a name="id1093395"></a>
      Testing and Benchmarking with InnoDB as Default Storage Engine
    </h4><p>
      Even before completing your upgrade to MySQL 5.5, you can preview
      whether your database server or application works correctly with
      InnoDB as the default storage engine. To set up InnoDB as the
      default storage engine with an earlier MySQL release, either
      specify on the command line
      <code class="literal">--default-storage-engine=InnoDB</code>, or add to your
      <code class="literal">my.cnf</code> file
      <code class="literal">default-storage-engine=innodb</code> in the
      <code class="literal">[mysqld]</code> section, then restart the server.
    </p><p>
      Since changing the default storage engine only affects new tables
      as they are created, run all your application installation and
      setup steps to confirm that everything installs properly. Then
      exercise all the application features to make sure all the data
      loading, editing, and querying features work. If a table relies on
      some MyISAM-specific feature, you'll receive an error; add the
      <code class="literal">ENGINE=MyISAM</code> clause to the <code class="literal">CREATE
      TABLE</code> statement to avoid the error. (For example, tables
      that rely on full-text search must be MyISAM tables rather than
      InnoDB ones.)
    </p><p>
      If you didn't make a deliberate decision about the storage engine,
      and you just want to preview how certain tables work when they're
      created under InnoDB, issue the command <code class="literal">ALTER TABLE
      table_name ENGINE=InnoDB;</code> for each table. Or, to run
      test queries and other statements without disturbing the original
      table, make a copy like so:
    </p><p>
      <code class="literal">CREATE TABLE InnoDB_Table (...) ENGINE=InnoDB AS SELECT *
      FROM MyISAM_Table;</code>
    </p><p>
      Since there are so many performance enhancements in the InnoDB
      that is part of MySQL 5.5, to get a true idea of the performance
      with a full application under a realistic workload, install the
      real MySQL 5.5 and run benchmarks.
    </p><p>
      Test the full application lifecycle, from installation, through
      heavy usage, and server restart. Kill the server process while the
      database is busy to simulate a power failure, and verify that the
      data is recovered successfully when you restart the server.
    </p><p>
      Test any replication configurations, especially if you use
      different MySQL versions and options on the master and the slaves.
    </p><h4><a name="id1093487"></a>
      Verifying that InnoDB is the Default Storage Engine
    </h4><p>
      To know what the status of InnoDB is, whether you're doing what-if
      testing with an older MySQL or comprehensive testing with MySQL
      5.5:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          Issue the command <code class="literal">SHOW VARIABLES LIKE
          'have_innodb';</code> to confirm that InnoDB is available
          at all. If the result is <code class="literal">NO</code>, you have a
          mysqld binary that was compiled without InnoDB support and you
          need to get a different one. If the result is
          <code class="literal">DISABLED</code>, go back through your startup
          options and configuration file and get rid of any
          <code class="literal">skip-innodb</code> option.
        </p></li><li><p>
          Issue the command <code class="literal">SHOW ENGINES;</code> to see all
          the different MySQL storage engines. Look for
          <code class="literal">DEFAULT</code> in the InnoDB line.
        </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-configuration"></a>13.3.2. Configuring <code class="literal">InnoDB</code></h3></div></div></div><a class="indexterm" name="id1093565"></a><p>
      The first decisions to make about InnoDB configuration involve how
      to lay out InnoDB data files, and how much memory to allocate for
      the InnoDB storage engine. You record these choices either by
      recording them in a configuration file that MySQL reads at
      startup, or by specifying them as command-line options in a
      startup script.
    </p><h4><a name="id1093584"></a>
      Overview of InnoDB Tablespace and Log Files
    </h4><p>
      Two important disk-based resources managed by the
      <code class="literal">InnoDB</code> storage engine are its tablespace data
      files and its log files. If you specify no
      <code class="literal">InnoDB</code> configuration options, MySQL creates an
      auto-extending 10MB data file named <code class="filename">ibdata1</code>
      and two 5MB log files named <code class="filename">ib_logfile0</code> and
      <code class="filename">ib_logfile1</code> in the MySQL data directory. To
      get good performance, explicitly provide <code class="literal">InnoDB</code>
      parameters as discussed in the following examples. Naturally, edit
      the settings to suit your hardware and requirements.
    </p><p>
      The examples shown here are representative. See
      <a href="storage-engines.html#innodb-parameters" title="13.3.4. InnoDB Startup Options and System Variables">Section 13.3.4, “<code class="literal">InnoDB</code> Startup Options and System Variables”</a> for additional information
      about <code class="literal">InnoDB</code>-related configuration parameters.
    </p><h4><a name="id1093646"></a>
      Considerations for Storage Devices
    </h4><p>
      In some cases, database performance improves if the data is not
      all placed on the same physical disk. Putting log files on a
      different disk from data is very often beneficial for performance.
      The example illustrates how to do this. It places the two data
      files on different disks and places the log files on the third
      disk. <code class="literal">InnoDB</code> fills the tablespace beginning
      with the first data file. You can also use raw disk partitions
      (raw devices) as <code class="literal">InnoDB</code> data files, which may
      speed up I/O. See <a href="storage-engines.html#innodb-raw-devices" title="13.3.3.1. Using Raw Devices for the Shared Tablespace">Section 13.3.3.1, “Using Raw Devices for the Shared Tablespace”</a>.
    </p><div xmlns="http://www.w3.org/1999/xhtml" class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Caution</div><p xmlns="">
        <code class="literal">InnoDB</code> is a transaction-safe (ACID compliant)
        storage engine for MySQL that has commit, rollback, and
        crash-recovery capabilities to protect user data.
        <span class="bold"><strong>However, it cannot do so</strong></span> if the
        underlying operating system or hardware does not work as
        advertised. Many operating systems or disk subsystems may delay
        or reorder write operations to improve performance. On some
        operating systems, the very <code class="literal">fsync()</code> system
        call that should wait until all unwritten data for a file has
        been flushed might actually return before the data has been
        flushed to stable storage. Because of this, an operating system
        crash or a power outage may destroy recently committed data, or
        in the worst case, even corrupt the database because of write
        operations having been reordered. If data integrity is important
        to you, perform some “<span class="quote">pull-the-plug</span>” tests before
        using anything in production. On Mac OS X 10.3 and up,
        <code class="literal">InnoDB</code> uses a special
        <code class="literal">fcntl()</code> file flush method. Under Linux, it is
        advisable to <span class="bold"><strong>disable the write-back
        cache</strong></span>.
      </p><p xmlns="">
        On ATA/SATA disk drives, a command such <code class="literal">hdparm -W0
        /dev/hda</code> may work to disable the write-back cache.
        <span class="bold"><strong>Beware that some drives or disk
        controllers may be unable to disable the write-back
        cache.</strong></span>
      </p></div><div xmlns="http://www.w3.org/1999/xhtml" class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Caution</div><a xmlns="" class="indexterm" name="id1093747"></a><a xmlns="" class="indexterm" name="id1093759"></a><p xmlns="">
        If reliability is a consideration for your data, do not
        configure <code class="literal">InnoDB</code> to use data files or log
        files on NFS volumes. Potential problems vary according to OS
        and version of NFS, and include such issues as lack of
        protection from conflicting writes, and limitations on maximum
        file sizes.
      </p></div><h4><a name="id1093784"></a>
      Specifying the Location and Size for InnoDB Tablespace Files
    </h4><p>
      To set up the <code class="literal">InnoDB</code> tablespace files, use the
      <a href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> option in
      the <code class="literal">[mysqld]</code> section of the
      <code class="filename">my.cnf</code> option file. On Windows, you can use
      <code class="filename">my.ini</code> instead. The value of
      <a href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> should be a
      list of one or more data file specifications. If you name more
      than one data file, separate them by semicolon
      (“<span class="quote"><code class="literal">;</code></span>”) characters:
    </p><pre class="programlisting">innodb_data_file_path=<em class="replaceable"><code>datafile_spec1</code></em>[;<em class="replaceable"><code>datafile_spec2</code></em>]...
</pre><p>
      For example, the following setting explicitly creates a tablespace
      having the same characteristics as the default:
    </p><pre class="programlisting">[mysqld]
innodb_data_file_path=ibdata1:10M:autoextend</pre><p>
      This setting configures a single 10MB data file named
      <code class="filename">ibdata1</code> that is auto-extending. No location
      for the file is given, so by default, <code class="literal">InnoDB</code>
      creates it in the MySQL data directory.
    </p><p>
      Sizes are specified using <code class="literal">K</code>,
      <code class="literal">M</code>, or <code class="literal">G</code> suffix letters to
      indicate units of KB, MB, or GB.
    </p><p>
      A tablespace containing a fixed-size 50MB data file named
      <code class="filename">ibdata1</code> and a 50MB auto-extending file named
      <code class="filename">ibdata2</code> in the data directory can be
      configured like this:
    </p><pre class="programlisting">[mysqld]
innodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend</pre><p>
      The full syntax for a data file specification includes the file
      name, its size, and several optional attributes:
    </p><pre class="programlisting"><em class="replaceable"><code>file_name</code></em>:<em class="replaceable"><code>file_size</code></em>[:autoextend[:max:<em class="replaceable"><code>max_file_size</code></em>]]
</pre><p>
      The <code class="literal">autoextend</code> and <code class="literal">max</code>
      attributes can be used only for the last data file in the
      <a href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> line.
    </p><p>
      If you specify the <code class="literal">autoextend</code> option for the
      last data file, <code class="literal">InnoDB</code> extends the data file if
      it runs out of free space in the tablespace. The increment is 8MB
      at a time by default. To modify the increment, change the
      <a href="storage-engines.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
      system variable.
    </p><p>
      If the disk becomes full, you might want to add another data file
      on another disk. For tablespace reconfiguration instructions, see
      <a href="storage-engines.html#innodb-data-log-reconfiguration" title="13.3.6. Adding, Removing, or Resizing InnoDB Data and Log
      Files">Section 13.3.6, “Adding, Removing, or Resizing <code class="literal">InnoDB</code> Data and Log
      Files”</a>.
    </p><p>
      <code class="literal">InnoDB</code> is not aware of the file system maximum
      file size, so be cautious on file systems where the maximum file
      size is a small value such as 2GB. To specify a maximum size for
      an auto-extending data file, use the <code class="literal">max</code>
      attribute following the <code class="literal">autoextend</code> attribute.
      Use the <code class="literal">max</code> attribute only in cases where
      constraining disk usage is of critical importance, because
      exceeding the maximum size causes a fatal error, possibly
      including a crash. The following configuration permits
      <code class="filename">ibdata1</code> to grow up to a limit of 500MB:
    </p><pre class="programlisting">[mysqld]
innodb_data_file_path=ibdata1:10M:autoextend:max:500M</pre><p>
      <code class="literal">InnoDB</code> creates tablespace files in the MySQL
      data directory by default. To specify a location explicitly, use
      the <a href="storage-engines.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> option.
      For example, to use two files named <code class="filename">ibdata1</code>
      and <code class="filename">ibdata2</code> but create them in the
      <code class="filename">/ibdata</code> directory, configure
      <code class="literal">InnoDB</code> like this:
    </p><pre class="programlisting">[mysqld]
innodb_data_home_dir = /ibdata
innodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend</pre><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
        <code class="literal">InnoDB</code> does not create directories, so make
        sure that the <code class="filename">/ibdata</code> directory exists
        before you start the server. This is also true of any log file
        directories that you configure. Use the Unix or DOS
        <code class="literal">mkdir</code> command to create any necessary
        directories.
      </p><p xmlns="">
        Make sure that the MySQL server has the proper access rights to
        create files in the data directory. More generally, the server
        must have access rights in any directory where it needs to
        create data files or log files.
      </p></div><p>
      <code class="literal">InnoDB</code> forms the directory path for each data
      file by textually concatenating the value of
      <a href="storage-engines.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> to the data
      file name, adding a path name separator (slash or backslash)
      between values if necessary. If the
      <a href="storage-engines.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> option is
      not specified in <code class="filename">my.cnf</code> at all, the default
      value is the “<span class="quote">dot</span>” directory <code class="filename">./</code>,
      which means the MySQL data directory. (The MySQL server changes
      its current working directory to its data directory when it begins
      executing.)
    </p><p>
      If you specify
      <a href="storage-engines.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> as an empty
      string, you can specify absolute paths for the data files listed
      in the <a href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
      value. The following example is equivalent to the preceding one:
    </p><pre class="programlisting">[mysqld]
innodb_data_home_dir =
innodb_data_file_path=/ibdata/ibdata1:50M;/ibdata/ibdata2:50M:autoextend</pre><h4><a name="id1094196"></a>
      Specifying InnoDB Configuration Options
    </h4><p>
      <span class="bold"><strong>Sample <code class="filename">my.cnf</code> file for
      small systems.</strong></span> Suppose that you have a computer with
      512MB RAM and one hard disk. The following example shows possible
      configuration parameters in <code class="filename">my.cnf</code> or
      <code class="filename">my.ini</code> for <code class="literal">InnoDB</code>,
      including the <code class="literal">autoextend</code> attribute. The example
      suits most users, both on Unix and Windows, who do not want to
      distribute <code class="literal">InnoDB</code> data files and log files onto
      several disks. It creates an auto-extending data file
      <code class="filename">ibdata1</code> and two <code class="literal">InnoDB</code> log
      files <code class="filename">ib_logfile0</code> and
      <code class="filename">ib_logfile1</code> in the MySQL data directory.
    </p><pre class="programlisting">[mysqld]
# You can write your other MySQL server options here
# ...
# Data files must be able to hold your data and indexes.
# Make sure that you have enough free disk space.
innodb_data_file_path = ibdata1:10M:autoextend
#
# Set buffer pool size to 50-80% of your computer's memory
innodb_buffer_pool_size=256M
innodb_additional_mem_pool_size=20M
#
# Set the log file size to about 25% of the buffer pool size
innodb_log_file_size=64M
innodb_log_buffer_size=8M
#
innodb_flush_log_at_trx_commit=1</pre><p>
      Note that data files must be less than 2GB in some file systems.
      The combined size of the log files must be less than 4GB. The
      combined size of data files must be at least 10MB.
    </p><h4><a name="id1094287"></a>
      Setting Up the InnoDB System Tablespace
    </h4><p>
      When you create an <code class="literal">InnoDB</code> system tablespace for
      the first time, it is best that you start the MySQL server from
      the command prompt. <code class="literal">InnoDB</code> then prints the
      information about the database creation to the screen, so you can
      see what is happening. For example, on Windows, if
      <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> is located in <code class="filename">C:\Program
      Files\MySQL\MySQL Server 5.5\bin</code>, you can
      start it like this:
    </p><pre class="programlisting">C:\&gt; <strong class="userinput"><code>"C:\Program Files\MySQL\MySQL Server 5.5\bin\mysqld" --console</code></strong>
</pre><p>
      If you do not send server output to the screen, check the server's
      error log to see what <code class="literal">InnoDB</code> prints during the
      startup process.
    </p><p>
      For an example of what the information displayed by
      <code class="literal">InnoDB</code> should look like, see
      <a href="storage-engines.html#innodb-init" title="13.3.3.2. Creating the InnoDB Tablespace">Section 13.3.3.2, “Creating the <code class="literal">InnoDB</code> Tablespace”</a>.
    </p><h4><a name="id1094358"></a>
      Editing the MySQL Configuration File
    </h4><p>
      You can place <code class="literal">InnoDB</code> options in the
      <code class="literal">[mysqld]</code> group of any option file that your
      server reads when it starts. The locations for option files are
      described in <a href="programs.html#option-files" title="4.2.3.3. Using Option Files">Section 4.2.3.3, “Using Option Files”</a>.
    </p><p>
      If you installed MySQL on Windows using the installation and
      configuration wizards, the option file will be the
      <code class="filename">my.ini</code> file located in your MySQL
      installation directory. See
      <a href="installing.html#mysql-config-wizard-starting" title="2.3.5.1. Starting the MySQL Server Instance Configuration Wizard">Section 2.3.5.1, “Starting the MySQL Server Instance Configuration Wizard”</a>.
    </p><p>
      If your PC uses a boot loader where the <code class="filename">C:</code>
      drive is not the boot drive, your only option is to use the
      <code class="filename">my.ini</code> file in your Windows directory
      (typically <code class="filename">C:\WINDOWS</code>). You can use the
      <code class="literal">SET</code> command at the command prompt in a console
      window to print the value of <code class="literal">WINDIR</code>:
    </p><pre class="programlisting">C:\&gt; <strong class="userinput"><code>SET WINDIR</code></strong>
windir=C:\WINDOWS
</pre><p>
      To make sure that <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> reads options only
      from a specific file, use the
      <a href="programs.html#option_general_defaults-file"><code class="option">--defaults-file</code></a> option as the
      first option on the command line when starting the server:
    </p><pre class="programlisting">mysqld --defaults-file=<em class="replaceable"><code>your_path_to_my_cnf</code></em>
</pre><p>
      <span class="bold"><strong>Sample <code class="filename">my.cnf</code> file for
      large systems.</strong></span> Suppose that you have a Linux computer
      with 2GB RAM and three 60GB hard disks at directory paths
      <code class="filename">/</code>, <code class="filename">/dr2</code> and
      <code class="filename">/dr3</code>. The following example shows possible
      configuration parameters in <code class="filename">my.cnf</code> for
      <code class="literal">InnoDB</code>.
    </p><pre class="programlisting">[mysqld]
# You can write your other MySQL server options here
# ...
innodb_data_home_dir =
#
# Data files must be able to hold your data and indexes
innodb_data_file_path = /db/ibdata1:2000M;/dr2/db/ibdata2:2000M:autoextend
#
# Set buffer pool size to 50-80% of your computer's memory,
# but make sure on Linux x86 total memory usage is &lt; 2GB
innodb_buffer_pool_size=1G
innodb_additional_mem_pool_size=20M
innodb_log_group_home_dir = /dr3/iblogs
#
# Set the log file size to about 25% of the buffer pool size
innodb_log_file_size=250M
innodb_log_buffer_size=8M
#
innodb_flush_log_at_trx_commit=1
innodb_lock_wait_timeout=50
#
# Uncomment the next line if you want to use it
#innodb_thread_concurrency=5</pre><h4><a name="id1094542"></a>
      Determining the Maximum Memory Allocation for InnoDB
    </h4><div xmlns="http://www.w3.org/1999/xhtml" class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Warning</div><p xmlns="">
        On 32-bit GNU/Linux x86, be careful not to set memory usage too
        high. <code class="literal">glibc</code> may permit the process heap to
        grow over thread stacks, which crashes your server. It is a risk
        if the value of the following expression is close to or exceeds
        2GB:
      </p><pre xmlns="" class="programlisting">innodb_buffer_pool_size
+ key_buffer_size
+ max_connections*(sort_buffer_size+read_buffer_size+binlog_cache_size)
+ max_connections*2MB</pre><p xmlns="">
        Each thread uses a stack (often 2MB, but only 256KB in MySQL
        binaries provided by Oracle Corporation.) and in the worst case
        also uses <code class="literal">sort_buffer_size + read_buffer_size</code>
        additional memory.
      </p></div><p>
      <span class="bold"><strong>Tuning other <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>
      server parameters.</strong></span> The following values are typical and
      suit most users:
    </p><pre class="programlisting">[mysqld]
skip-external-locking
max_connections=200
read_buffer_size=1M
sort_buffer_size=1M
#
# Set key_buffer to 5 - 50% of your RAM depending on how much
# you use MyISAM tables, but keep key_buffer_size + InnoDB
# buffer pool size &lt; 80% of your RAM
key_buffer_size=<em class="replaceable"><code>value</code></em>
</pre><p>
      On Linux, if the kernel is enabled for large page support,
      <code class="literal">InnoDB</code> can use large pages to allocate memory
      for its buffer pool and additional memory pool. See
      <a href="optimization.html#large-page-support" title="7.11.4.2. Enabling Large Page Support">Section 7.11.4.2, “Enabling Large Page Support”</a>.
    </p><h4><a name="id1094624"></a>
      Turning Off InnoDB
    </h4><p>
      Oracle recommends InnoDB as the preferred storage engine for
      typical database applications, from single-user wikis and blogs
      running on a local system, to high-end applications pushing the
      limits of performance. In MySQL 5.5, InnoDB is is the
      default storage engine for new tables.
    </p><p>
      If you do not want to use <code class="literal">InnoDB</code> tables, start
      the server with the
      <a href="storage-engines.html#option_mysqld_innodb"><code class="option">--innodb=OFF</code></a> or
      <a href="storage-engines.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>
      option to disable the <code class="literal">InnoDB</code> storage engine. In
      this case, because the default storage engine is
      <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>, the server will not start
      unless you also use
      <a href="server-administration.html#option_mysqld_default-storage-engine"><code class="option">--default-storage-engine</code></a> to set the
      default to some other engine.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-multiple-tablespaces"></a>13.3.3. Using Per-Table Tablespaces</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-raw-devices">13.3.3.1. Using Raw Devices for the Shared Tablespace</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-init">13.3.3.2. Creating the <code class="literal">InnoDB</code> Tablespace</a></span></dt><dt><span class="section"><a href="storage-engines.html#error-creating-innodb">13.3.3.3. Troubleshooting <code class="literal">InnoDB</code> I/O Problems</a></span></dt></dl></div><a class="indexterm" name="id1094688"></a><p>
      By default, all InnoDB tables and indexes are stored in the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_system_tablespace" target="_top">system tablespace</a>.
      As an alternative, you can store each <code class="literal">InnoDB</code>
      table and its indexes in its own file. This feature is called
      “<span class="quote">multiple tablespaces</span>” because each table that is
      created when this setting is in effect has its own tablespace.
    </p><p>
      Using multiple tablespaces is useful in a number of situations:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          You can back up or restore a single table quickly without
          interrupting the use of other <code class="literal">InnoDB</code>
          tables, using the MySQL Enterprise Backup product. See
          <a href="http://dev.mysql.com/doc/mysql-enterprise-backup/3.5/en/partial.html#partial.restoring.single" target="_top">Restoring a Single <code class="literal">.ibd</code> File</a> for the procedure
          and restrictions.
        </p></li><li><p>
          Storing specific tables on separate physical disks, for I/O
          optimization or backup purposes.
        </p></li><li><p>
          Restoring backups of single tables quickly without
          interrupting the use of other <code class="literal">InnoDB</code>
          tables.
        </p></li><li><p>
          Using <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_compressed_row_format" target="_top">compressed
          row format</a> to compress table data.
        </p></li><li><p>
          Reclaiming disk space when truncating a table.
        </p></li></ul></div><h4><a name="id1094796"></a>
      Enabling and Disabling Multiple Tablespaces
    </h4><p>
      To enable multiple tablespaces, start the server with the
      <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="option">--innodb_file_per_table</code></a> option. For
      example, add a line to the <code class="literal">[mysqld]</code> section of
      <code class="filename">my.cnf</code>:
    </p><pre class="programlisting">[mysqld]
innodb_file_per_table</pre><p>
      With multiple tablespaces enabled, <code class="literal">InnoDB</code>
      stores each newly created table in its own
      <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.ibd</code> file
      in the appropriate database directory. Unlike the
      <code class="literal">MyISAM</code> storage engine, with its separate
      <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYD</code> and
      <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYI</code> files
      for indexes and data, <code class="literal">InnoDB</code> stores the data
      and the indexes together in a single <code class="filename">.ibd</code>
      file. The
      <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.frm</code> file
      is still created as usual.
    </p><p>
      If you remove the
      <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> line from
      <code class="filename">my.cnf</code> and restart the server,
      <code class="literal">InnoDB</code> creates any new tables inside the shared
      tablespace files.
    </p><p>
      You can always access both tables in the system tablespace and
      tables in their own tablespaces, regardless of the file-per-table
      setting. To move a table from the system tablespace to its own
      tablespace, or vice versa, you can change the
      <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> setting and
      issue the command:
    </p><pre class="programlisting">-- Move table from system tablespace to its own tablespace.
SET GLOBAL innodb_file_per_table=1;
ALTER TABLE <em class="replaceable"><code>table_name</code></em> ENGINE=InnoDB;
-- Move table from its own tablespace to system tablespace.
SET GLOBAL innodb_file_per_table=0;
ALTER TABLE <em class="replaceable"><code>table_name</code></em> ENGINE=InnoDB;
</pre><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
        <code class="literal">InnoDB</code> always needs the shared tablespace
        because it puts its internal data dictionary and undo logs
        there. The <code class="filename">.ibd</code> files are not sufficient
        for <code class="literal">InnoDB</code> to operate.
      </p><p xmlns="">
        When a table is moved out of the system tablespace into its own
        <code class="filename">.ibd</code> file, the data files that make up the
        system tablespace remain the same size. The space formerly
        occupied by the table can be reused for new
        <code class="literal">InnoDB</code> data, but is not reclaimed for use by
        the operating system. When moving large
        <code class="literal">InnoDB</code> tables out of the system tablespace,
        where disk space is limited, you might prefer to turn on
        <code class="literal">innodb_file_per_table</code> and then recreate the
        entire instance using the <a href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span><strong class="command">mysqldump</strong></span></a> command.
      </p></div><h4><a name="id1095007"></a>
      Portability Considerations for .ibd Files
    </h4><p>
      You cannot freely move <code class="filename">.ibd</code> files between
      database directories as you can with <code class="literal">MyISAM</code>
      table files. The table definition stored in the
      <code class="literal">InnoDB</code> shared tablespace includes the database
      name. The transaction IDs and log sequence numbers stored in the
      tablespace files also differ between databases.
    </p><p>
      To move an <code class="filename">.ibd</code> file and the associated table
      from one database to another, use a <a href="sql-syntax.html#rename-table" title="12.1.32. RENAME TABLE Syntax"><code class="literal">RENAME
      TABLE</code></a> statement:
    </p><pre class="programlisting">RENAME TABLE <em class="replaceable"><code>db1.tbl_name</code></em> TO <em class="replaceable"><code>db2.tbl_name</code></em>;
</pre><a class="indexterm" name="id1095064"></a><a class="indexterm" name="id1095073"></a><p>
      

      If you have a “<span class="quote">clean</span>” backup of an
      <code class="filename">.ibd</code> file, you can restore it to the MySQL
      installation from which it originated as follows:
    </p><div class="orderedlist"><ol type="1"><li><p>
          The table must not have been dropped or truncated since you
          copied the <code class="filename">.ibd</code> file, because doing so
          changes the table ID stored inside the tablespace.
        </p></li><li><p>
          Issue this <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          statement to delete the current <code class="filename">.ibd</code>
          file:
        </p><pre class="programlisting">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> DISCARD TABLESPACE;
</pre></li><li><p>
          Copy the backup <code class="filename">.ibd</code> file to the proper
          database directory.
        </p></li><li><p>
          Issue this <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          statement to tell <code class="literal">InnoDB</code> to use the new
          <code class="filename">.ibd</code> file for the table:
        </p><pre class="programlisting">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> IMPORT TABLESPACE;
</pre></li></ol></div><p>
      In this context, a “<span class="quote">clean</span>” <code class="filename">.ibd</code>
      file backup is one for which the following requirements are
      satisfied:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          There are no uncommitted modifications by transactions in the
          <code class="filename">.ibd</code> file.
        </p></li><li><p>
          There are no unmerged insert buffer entries in the
          <code class="filename">.ibd</code> file.
        </p></li><li><p>
          Purge has removed all delete-marked index records from the
          <code class="filename">.ibd</code> file.
        </p></li><li><p>
          <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> has flushed all modified pages of
          the <code class="filename">.ibd</code> file from the buffer pool to the
          file.
        </p></li></ul></div><p>
      You can make a clean backup <code class="filename">.ibd</code> file using
      the following method:
    </p><div class="orderedlist"><ol type="1"><li><p>
          Stop all activity from the <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> server
          and commit all transactions.
        </p></li><li><p>
          Wait until <a href="sql-syntax.html#show-engine" title="12.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW
          ENGINE INNODB STATUS</code></a> shows that there are no active
          transactions in the database, and the main thread status of
          <code class="literal">InnoDB</code> is <code class="literal">Waiting for server
          activity</code>. Then you can make a copy of the
          <code class="filename">.ibd</code> file.
        </p></li></ol></div><p>
      Another method for making a clean copy of an
      <code class="filename">.ibd</code> file is to use the MySQL Enterprise
      Backup product:
    </p><div class="orderedlist"><ol type="1"><li><p>
          Use MySQL Enterprise Backup to back up the
          <code class="literal">InnoDB</code> installation.
        </p></li><li><p>
          Start a second <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> server on the backup
          and let it clean up the <code class="filename">.ibd</code> files in the
          backup.
        </p></li></ol></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-raw-devices"></a>13.3.3.1. Using Raw Devices for the Shared Tablespace</h4></div></div></div><a class="indexterm" name="id1095407"></a><p>
        You can use raw disk partitions as data files in the system
        tablespace. Using a raw disk, you can perform nonbuffered I/O on
        Windows and on some Unix systems without file system overhead.
        Perform tests with and without raw partitions to verify whether
        this change actually improves performance on your system.
      </p><p>
        When you create a new data file, put the keyword
        <code class="literal">newraw</code> immediately after the data file size
        in <a href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>. The
        partition must be at least as large as the size that you
        specify. Note that 1MB in <code class="literal">InnoDB</code> is 1024
        × 1024 bytes, whereas 1MB in disk specifications usually
        means 1,000,000 bytes.
      </p><pre class="programlisting">[mysqld]
innodb_data_home_dir=
innodb_data_file_path=/dev/hdd1:3Gnewraw;/dev/hdd2:2Gnewraw</pre><p>
        The next time you start the server, <code class="literal">InnoDB</code>
        notices the <code class="literal">newraw</code> keyword and initializes
        the new partition. However, do not create or change any
        <code class="literal">InnoDB</code> tables yet. Otherwise, when you next
        restart the server, <code class="literal">InnoDB</code> reinitializes the
        partition and your changes are lost. (As a safety measure
        <code class="literal">InnoDB</code> prevents users from modifying data
        when any partition with <code class="literal">newraw</code> is specified.)
      </p><p>
        After <code class="literal">InnoDB</code> has initialized the new
        partition, stop the server, change <code class="literal">newraw</code> in
        the data file specification to <code class="literal">raw</code>:
      </p><pre class="programlisting">[mysqld]
innodb_data_home_dir=
innodb_data_file_path=/dev/hdd1:3Graw;/dev/hdd2:2Graw</pre><p>
        Then restart the server and <code class="literal">InnoDB</code> permits
        changes to be made.
      </p><p>
        On Windows, you can allocate a disk partition as a data file
        like this:
      </p><pre class="programlisting">[mysqld]
innodb_data_home_dir=
innodb_data_file_path=//./D::10Gnewraw</pre><p>
        The <code class="filename">//./</code> corresponds to the Windows syntax
        of <code class="filename">\\.\</code> for accessing physical drives.
      </p><p>
        When you use a raw disk partition, be sure that it has
        permissions that enable read and write access by the account
        used for running the MySQL server. For example, if you run the
        server as the <code class="literal">mysql</code> user, the partition must
        permit read and write access to <code class="literal">mysql</code>. If you
        run the server with the <a href="server-administration.html#option_mysqld_memlock"><code class="option">--memlock</code></a>
        option, the server must be run as <code class="literal">root</code>, so
        the partition must permit access to <code class="literal">root</code>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-init"></a>13.3.3.2. Creating the <code class="literal">InnoDB</code> Tablespace</h4></div></div></div><a class="indexterm" name="id1095616"></a><p>
        Suppose that you have installed MySQL and have edited your
        option file so that it contains the necessary
        <code class="literal">InnoDB</code> configuration parameters. Before
        starting MySQL, verify that the directories you have specified
        for <code class="literal">InnoDB</code> data files and log files exist and
        that the MySQL server has access rights to those directories.
        <code class="literal">InnoDB</code> does not create directories, only
        files. Check also that you have enough disk space for the data
        and log files.
      </p><p>
        It is best to run the MySQL server <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>
        from the command prompt when you first start the server with
        <code class="literal">InnoDB</code> enabled, not from
        <a href="programs.html#mysqld-safe" title="4.3.2. mysqld_safe — MySQL Server Startup Script"><span><strong class="command">mysqld_safe</strong></span></a> or as a Windows service. When you
        run from a command prompt you see what <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>
        prints and what is happening. On Unix, just invoke
        <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>. On Windows, start
        <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> with the
        <a href="server-administration.html#option_mysqld_console"><code class="option">--console</code></a> option to direct the
        output to the console window.
      </p><p>
        When you start the MySQL server after initially configuring
        <code class="literal">InnoDB</code> in your option file,
        <code class="literal">InnoDB</code> creates your data files and log files,
        and prints something like this:
      </p><pre class="programlisting">InnoDB: The first specified datafile /home/heikki/data/ibdata1
did not exist:
InnoDB: a new database to be created!
InnoDB: Setting file /home/heikki/data/ibdata1 size to 134217728
InnoDB: Database physically writes the file full: wait...
InnoDB: datafile /home/heikki/data/ibdata2 did not exist:
new to be created
InnoDB: Setting file /home/heikki/data/ibdata2 size to 262144000
InnoDB: Database physically writes the file full: wait...
InnoDB: Log file /home/heikki/data/logs/ib_logfile0 did not exist:
new to be created
InnoDB: Setting log file /home/heikki/data/logs/ib_logfile0 size
to 5242880
InnoDB: Log file /home/heikki/data/logs/ib_logfile1 did not exist:
new to be created
InnoDB: Setting log file /home/heikki/data/logs/ib_logfile1 size
to 5242880
InnoDB: Doublewrite buffer not found: creating new
InnoDB: Doublewrite buffer created
InnoDB: Creating foreign key constraint system tables
InnoDB: Foreign key constraint system tables created
InnoDB: Started
mysqld: ready for connections</pre><p>
        At this point <code class="literal">InnoDB</code> has initialized its
        tablespace and log files. You can connect to the MySQL server
        with the usual MySQL client programs like
        <a href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span><strong class="command">mysql</strong></span></a>. When you shut down the MySQL server
        with <a href="programs.html#mysqladmin" title="4.5.2. mysqladmin — Client for Administering a MySQL Server"><span><strong class="command">mysqladmin shutdown</strong></span></a>, the output is like
        this:
      </p><pre class="programlisting">010321 18:33:34  mysqld: Normal shutdown
010321 18:33:34  mysqld: Shutdown Complete
InnoDB: Starting shutdown...
InnoDB: Shutdown completed</pre><p>
        You can look at the data file and log directories and you see
        the files created there. When MySQL is started again, the data
        files and log files have been created already, so the output is
        much briefer:
      </p><pre class="programlisting">InnoDB: Started
mysqld: ready for connections</pre><p>
        If you add the
        <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option to
        <code class="filename">my.cnf</code>, <code class="literal">InnoDB</code> stores
        each table in its own <code class="filename">.ibd</code> file in the same
        MySQL database directory where the <code class="filename">.frm</code>
        file is created. See
        <a href="storage-engines.html#innodb-multiple-tablespaces" title="13.3.3. Using Per-Table Tablespaces">Section 13.3.3, “Using Per-Table Tablespaces”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="error-creating-innodb"></a>13.3.3.3. Troubleshooting <code class="literal">InnoDB</code> I/O Problems</h4></div></div></div><a class="indexterm" name="id1095837"></a><p>
        The troubleshooting steps for <code class="literal">InnoDB</code> I/O
        problems depend on when the problem occurs: during startup of
        the MySQL server, or during normal operations when a DML or DDL
        statement fails due to problems at the file system level.
      </p><h5><a name="id1095864"></a>
        Initialization Problems
      </h5><p>
        If something goes wrong when <code class="literal">InnoDB</code> attempts
        to initialize its tablespace or its log files, delete all files
        created by <code class="literal">InnoDB</code>: all
        <code class="filename">ibdata</code> files and all
        <code class="filename">ib_logfile</code> files. If you already created
        some <code class="literal">InnoDB</code> tables, also delete the
        corresponding <code class="filename">.frm</code> files for these tables,
        and any <code class="filename">.ibd</code> files if you are using
        multiple tablespaces, from the MySQL database directories. Then
        try the <code class="literal">InnoDB</code> database creation again. For
        easiest troubleshooting, start the MySQL server from a command
        prompt so that you see what is happening.
      </p><h5><a name="id1095923"></a>
        Runtime Problems
      </h5><p>
        If <code class="literal">InnoDB</code> prints an operating system error
        during a file operation, usually the problem has one of the
        following solutions:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Make sure the <code class="literal">InnoDB</code> data file directory
            and the <code class="literal">InnoDB</code> log directory exist.
          </p></li><li><p>
            Make sure <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> has access rights to
            create files in those directories.
          </p></li><li><p>
            Make sure <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> can read the proper
            <code class="filename">my.cnf</code> or <code class="filename">my.ini</code>
            option file, so that it starts with the options that you
            specified.
          </p></li><li><p>
            Make sure the disk is not full and you are not exceeding any
            disk quota.
          </p></li><li><p>
            Make sure that the names you specify for subdirectories and
            data files do not clash.
          </p></li><li><p>
            Doublecheck the syntax of the
            <a href="storage-engines.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> and
            <a href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
            values. In particular, any <code class="literal">MAX</code> value in
            the <a href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
            option is a hard limit, and exceeding that limit causes a
            fatal error.
          </p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-parameters"></a>13.3.4. <code class="literal">InnoDB</code> Startup Options and System Variables</h3></div></div></div><a class="indexterm" name="id1096065"></a><a class="indexterm" name="id1096078"></a><p>
      This section describes the <code class="literal">InnoDB</code>-related
      command options and system variables. System variables that are
      true or false can be enabled at server startup by naming them, or
      disabled by using a <code class="literal">--skip-</code> prefix. For
      example, to enable or disable <code class="literal">InnoDB</code> checksums,
      you can use <a href="storage-engines.html#sysvar_innodb_checksums"><code class="option">--innodb_checksums</code></a> or
      <a href="storage-engines.html#sysvar_innodb_checksums"><code class="option">--skip-innodb_checksums</code></a>
      on the command line, or
      <a href="storage-engines.html#sysvar_innodb_checksums"><code class="literal">innodb_checksums</code></a> or
      <code class="literal">skip-innodb_checksums</code> in an option file. System
      variables that take a numeric value can be specified as
      <code class="option">--<em class="replaceable"><code>var_name</code></em>=<em class="replaceable"><code>value</code></em></code>
      on the command line or as
      <code class="literal"><em class="replaceable"><code>var_name</code></em>=<em class="replaceable"><code>value</code></em></code>
      in option files. For more information on specifying options and
      system variables, see <a href="programs.html#program-options" title="4.2.3. Specifying Program Options">Section 4.2.3, “Specifying Program Options”</a>. Many of
      the system variables can be changed at runtime (see
      <a href="server-administration.html#dynamic-system-variables" title="5.1.4.2. Dynamic System Variables">Section 5.1.4.2, “Dynamic System Variables”</a>).
    </p><p>
      Certain options control the locations and layout of the
      <code class="literal">InnoDB</code> data files.
      <a href="storage-engines.html#innodb-configuration" title="13.3.2. Configuring InnoDB">Section 13.3.2, “Configuring <code class="literal">InnoDB</code>”</a> explains how to use these
      options. Many other options, that you might not use initially,
      help to tune <code class="literal">InnoDB</code> performance characteristics
      based on machine capacity and your database
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_workload" target="_top">workload</a>. The
      performance-related options are explained in
      <a href="storage-engines.html#innodb-tuning-troubleshooting" title="13.3.14. InnoDB Performance Tuning and Troubleshooting">Section 13.3.14, “<code class="literal">InnoDB</code> Performance Tuning and Troubleshooting”</a> and
      <a href="storage-engines.html#innodb-performance" title="13.4.7. InnoDB Performance and Scalability Enhancements">Section 13.4.7, “InnoDB Performance and Scalability Enhancements”</a>.
    </p><div class="table"><a name="id1096210"></a><p class="title"><b>Table 13.3. <code class="literal">InnoDB</code> Option/Variable
      Reference</b></p><table summary="InnoDB Option/Variable
      Reference" border="1"><colgroup><col><col><col><col><col><col><col></colgroup><thead><tr><th>Name</th><th>Cmd-Line</th><th>Option file</th><th>System Var</th><th>Status Var</th><th>Var Scope</th><th>Dynamic</th></tr></thead><tbody><tr><td><a href="server-administration.html#sysvar_foreign_key_checks">foreign_key_checks</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td><a href="server-administration.html#sysvar_have_innodb">have_innodb</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#option_mysqld_ignore-builtin-innodb">ignore-builtin-innodb</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td> - <span class="emphasis"><em>Variable</em></span>: ignore_builtin_innodb</td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#option_mysqld_innodb">innodb</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_adaptive_flushing">innodb_adaptive_flushing</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_adaptive_hash_index">innodb_adaptive_hash_index</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_additional_mem_pool_size">innodb_additional_mem_pool_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_autoextend_increment">innodb_autoextend_increment</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode">innodb_autoinc_lock_mode</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_buffer_pool_instances">innodb_buffer_pool_instances</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_buffer_pool_pages_data">Innodb_buffer_pool_pages_data</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_buffer_pool_pages_dirty">Innodb_buffer_pool_pages_dirty</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_buffer_pool_pages_flushed">Innodb_buffer_pool_pages_flushed</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_buffer_pool_pages_free">Innodb_buffer_pool_pages_free</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_buffer_pool_pages_latched">Innodb_buffer_pool_pages_latched</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_buffer_pool_pages_misc">Innodb_buffer_pool_pages_misc</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_buffer_pool_pages_total">Innodb_buffer_pool_pages_total</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead">Innodb_buffer_pool_read_ahead</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_evicted">Innodb_buffer_pool_read_ahead_evicted</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_buffer_pool_read_requests">Innodb_buffer_pool_read_requests</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_buffer_pool_reads">Innodb_buffer_pool_reads</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_buffer_pool_size">innodb_buffer_pool_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_buffer_pool_wait_free">Innodb_buffer_pool_wait_free</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_buffer_pool_write_requests">Innodb_buffer_pool_write_requests</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_change_buffering">innodb_change_buffering</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_checksums">innodb_checksums</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_commit_concurrency">innodb_commit_concurrency</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_concurrency_tickets">innodb_concurrency_tickets</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_data_file_path">innodb_data_file_path</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_data_fsyncs">Innodb_data_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_data_home_dir">innodb_data_home_dir</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_data_pending_fsyncs">Innodb_data_pending_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_data_pending_reads">Innodb_data_pending_reads</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_data_pending_writes">Innodb_data_pending_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_data_read">Innodb_data_read</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_data_reads">Innodb_data_reads</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_data_writes">Innodb_data_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_data_written">Innodb_data_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_dblwr_pages_written">Innodb_dblwr_pages_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_dblwr_writes">Innodb_dblwr_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_doublewrite">innodb_doublewrite</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_fast_shutdown">innodb_fast_shutdown</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_file_format">innodb_file_format</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_file_format_check">innodb_file_format_check</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_file_format_max">innodb_file_format_max</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_file_per_table">innodb_file_per_table</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_flush_log_at_trx_commit">innodb_flush_log_at_trx_commit</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_flush_method">innodb_flush_method</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_force_recovery">innodb_force_recovery</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_have_atomic_builtins">Innodb_have_atomic_builtins</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_io_capacity">innodb_io_capacity</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_large_prefix">innodb_large_prefix</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_lock_wait_timeout">innodb_lock_wait_timeout</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog">innodb_locks_unsafe_for_binlog</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_log_buffer_size">innodb_log_buffer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_log_file_size">innodb_log_file_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_log_files_in_group">innodb_log_files_in_group</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_log_group_home_dir">innodb_log_group_home_dir</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_log_waits">Innodb_log_waits</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_log_write_requests">Innodb_log_write_requests</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_log_writes">Innodb_log_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct">innodb_max_dirty_pages_pct</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_max_purge_lag">innodb_max_purge_lag</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_mirrored_log_groups">innodb_mirrored_log_groups</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_old_blocks_pct">innodb_old_blocks_pct</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_old_blocks_time">innodb_old_blocks_time</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_open_files">innodb_open_files</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_os_log_fsyncs">Innodb_os_log_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_os_log_pending_fsyncs">Innodb_os_log_pending_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_os_log_pending_writes">Innodb_os_log_pending_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_os_log_written">Innodb_os_log_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_page_size">Innodb_page_size</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_pages_created">Innodb_pages_created</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_pages_read">Innodb_pages_read</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_pages_written">Innodb_pages_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_purge_batch_size">innodb_purge_batch_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_purge_threads">innodb_purge_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_read_ahead_threshold">innodb_read_ahead_threshold</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_read_io_threads">innodb_read_io_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_replication_delay">innodb_replication_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_rollback_on_timeout">innodb_rollback_on_timeout</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_rollback_segments">innodb_rollback_segments</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_row_lock_current_waits">Innodb_row_lock_current_waits</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_row_lock_time">Innodb_row_lock_time</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_row_lock_time_avg">Innodb_row_lock_time_avg</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_row_lock_time_max">Innodb_row_lock_time_max</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_row_lock_waits">Innodb_row_lock_waits</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_rows_deleted">Innodb_rows_deleted</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_rows_inserted">Innodb_rows_inserted</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_rows_read">Innodb_rows_read</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_rows_updated">Innodb_rows_updated</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_spin_wait_delay">innodb_spin_wait_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_stats_method">innodb_stats_method</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_stats_on_metadata">innodb_stats_on_metadata</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_stats_sample_pages">innodb_stats_sample_pages</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#option_mysqld_innodb-status-file">innodb-status-file</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_strict_mode">innodb_strict_mode</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_support_xa">innodb_support_xa</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_sync_spin_loops">innodb_sync_spin_loops</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_table_locks">innodb_table_locks</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_thread_concurrency">innodb_thread_concurrency</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_thread_sleep_delay">innodb_thread_sleep_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="server-administration.html#statvar_Innodb_truncated_status_writes">Innodb_truncated_status_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_use_native_aio">innodb_use_native_aio</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_use_sys_malloc">innodb_use_sys_malloc</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_version">innodb_version</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="storage-engines.html#sysvar_innodb_write_io_threads">innodb_write_io_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#sysvar_timed_mutexes">timed_mutexes</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="server-administration.html#sysvar_unique_checks">unique_checks</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr></tbody></table></div><h4><a name="id1099206"></a>
      <code class="literal">InnoDB</code> Command Options
    </h4><div class="itemizedlist"><ul type="disc"><li><p><a name="option_mysqld_ignore-builtin-innodb"></a>
          <a class="indexterm" name="id1099224"></a>

          <a class="indexterm" name="id1099237"></a>

          <a href="storage-engines.html#option_mysqld_ignore-builtin-innodb"><code class="option">--ignore-builtin-innodb</code></a>
        </p><div class="informaltable"><table summary="Options for ignore-builtin-innodb" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--ignore-builtin-innodb</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">ignore-builtin-innodb</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_ignore_builtin_innodb"><code class="literal">ignore_builtin_innodb</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">ignore-builtin-innodb</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr></tbody></table></div><p>
          This option causes the server to behave as if the built-in
          <code class="literal">InnoDB</code> is not present. It has these
          effects:
        </p><div class="itemizedlist"><ul type="circle"><li><p>
              Other <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> options
              (including <a href="storage-engines.html#option_mysqld_innodb"><code class="option">--innodb</code></a> and
              <a href="storage-engines.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>)
              will not be recognized and should not be used.
            </p></li><li><p>
              The server will not start if the default storage engine is
              set to <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>. Use
              <a href="server-administration.html#option_mysqld_default-storage-engine"><code class="option">--default-storage-engine</code></a> to
              set the default to some other engine if necessary.
            </p></li><li><p>
              <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> will not appear in the
              output of <a href="sql-syntax.html#show-engines" title="12.7.5.17. SHOW ENGINES Syntax"><code class="literal">SHOW ENGINES</code></a>.
            </p></li></ul></div></li><li><p><a name="option_mysqld_innodb"></a>
          <a class="indexterm" name="id1099523"></a>

          <a class="indexterm" name="id1099535"></a>

          <a href="storage-engines.html#option_mysqld_innodb"><code class="option">--innodb[=<em class="replaceable"><code>value</code></em>]</code></a>
        </p><p>
          Controls loading of the <code class="literal">InnoDB</code> storage
          engine, if the server was compiled with
          <code class="literal">InnoDB</code> support. This option has a tristate
          format, with possible values of <code class="literal">OFF</code>,
          <code class="literal">ON</code>, or <code class="literal">FORCE</code>. See
          <a href="server-administration.html#server-plugin-loading" title="5.1.7.1. Installing and Uninstalling Plugins">Section 5.1.7.1, “Installing and Uninstalling Plugins”</a>.
        </p><p>
          To disable <code class="literal">InnoDB</code>, use
          <a href="storage-engines.html#option_mysqld_innodb"><code class="option">--innodb=OFF</code></a>
          or
          <a href="storage-engines.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>.
          In this case, because the default storage engine is
          <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>, the server will not start
          unless you also use
          <a href="server-administration.html#option_mysqld_default-storage-engine"><code class="option">--default-storage-engine</code></a> to set
          the default to some other engine.
        </p></li><li><p><a name="option_mysqld_innodb-status-file"></a>
          <a class="indexterm" name="id1099645"></a>

          <a class="indexterm" name="id1099657"></a>

          <a href="storage-engines.html#option_mysqld_innodb-status-file"><code class="option">--innodb-status-file</code></a>
        </p><div class="informaltable"><table summary="Options for innodb-status-file" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb-status-file</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb-status-file</code></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb-status-file</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table></div><p>
          Controls whether <code class="literal">InnoDB</code> creates a file
          named
          <code class="filename">innodb_status.<em class="replaceable"><code>&lt;pid&gt;</code></em></code>
          in the MySQL data directory. If enabled,
          <code class="literal">InnoDB</code> periodically writes the output of
          <a href="sql-syntax.html#show-engine" title="12.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> to this file.
        </p><p>
          By default, the file is not created. To create it, start
          <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> with the
          <a href="storage-engines.html#option_mysqld_innodb-status-file"><code class="option">--innodb-status-file=1</code></a> option.
          The file is deleted during normal shutdown.
        </p></li><li><p>
          <a class="indexterm" name="id1099910"></a>

          <a class="indexterm" name="id1099923"></a>

          <a href="storage-engines.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>
        </p><p>
          Disable the <code class="literal">InnoDB</code> storage engine. See the
          description of <a href="storage-engines.html#option_mysqld_innodb"><code class="option">--innodb</code></a>.
        </p></li></ul></div><h4><a name="id1099962"></a>
      <code class="literal">InnoDB</code> System Variables
    </h4><div class="itemizedlist"><ul type="disc"><li><p><a name="sysvar_ignore_builtin_innodb"></a>
          <a class="indexterm" name="id1099980"></a>

          <a class="indexterm" name="id1099989"></a>

          <a href="storage-engines.html#sysvar_ignore_builtin_innodb"><code class="literal">ignore_builtin_innodb</code></a>
        </p><p>
          Whether the server was started with the
          <a href="storage-engines.html#option_mysqld_ignore-builtin-innodb"><code class="option">--ignore-builtin-innodb</code></a> option,
          which causes the server to behave as if the built-in
          <code class="literal">InnoDB</code> is not present. For more
          information, see the description of
          <a href="storage-engines.html#option_mysqld_ignore-builtin-innodb"><code class="option">--ignore-builtin-innodb</code></a> under
          “<span class="quote"><code class="literal">InnoDB</code> Command Options</span>”
          earlier in this section.
        </p></li><li><p><a name="sysvar_innodb_adaptive_flushing"></a>
          <a class="indexterm" name="id1100051"></a>

          <a class="indexterm" name="id1100060"></a>

          <code class="literal">innodb_adaptive_flushing</code>
        </p><div class="informaltable"><table summary="Options for innodb_adaptive_flushing" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_adaptive_flushing=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_adaptive_flushing</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_adaptive_flushing</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table></div><a class="indexterm" name="id1100271"></a><p>
          Specifies whether to dynamically adjust the rate of flushing
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_dirty_page" target="_top">dirty pages</a> in the
          <code class="literal">InnoDB</code>
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_buffer_pool" target="_top">buffer pool</a> based on
          the workload. Adjusting the flush rate dynamically is intended
          to avoid bursts of I/O activity. This setting is enabled by
          default.
        </p></li><li><p><a name="sysvar_innodb_adaptive_hash_index"></a>
          <a class="indexterm" name="id1100312"></a>

          <a class="indexterm" name="id1100321"></a>

          <code class="literal">innodb_adaptive_hash_index</code>
        </p><div class="informaltable"><table summary="Options for innodb_adaptive_hash_index" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_adaptive_hash_index=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_adaptive_hash_index</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_adaptive_hash_index</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table></div><p>
          Whether InnoDB adaptive hash indexes are enabled or disabled
          (see <a href="storage-engines.html#innodb-adaptive-hash" title="13.3.11.4. Adaptive Hash Indexes">Section 13.3.11.4, “Adaptive Hash Indexes”</a>). This variable is
          enabled by default. Use
          <code class="option">--skip-innodb_adaptive_hash_index</code> at server
          startup to disable it.
        </p></li><li><p><a name="sysvar_innodb_additional_mem_pool_size"></a>
          <a class="indexterm" name="id1100553"></a>

          <a class="indexterm" name="id1100562"></a>

          <code class="literal">innodb_additional_mem_pool_size</code>
        </p><div class="informaltable"><table summary="Options for innodb_additional_mem_pool_size" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_additional_mem_pool_size=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_additional_mem_pool_size</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_additional_mem_pool_size"><code class="literal">innodb_additional_mem_pool_size</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_additional_mem_pool_size</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8388608</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">2097152 .. 4294967295</code></td></tr></tbody></table></div><p>
          The size in bytes of a memory pool <code class="literal">InnoDB</code>
          uses to store data dictionary information and other internal
          data structures. The more tables you have in your application,
          the more memory you need to allocate here. If
          <code class="literal">InnoDB</code> runs out of memory in this pool, it
          starts to allocate memory from the operating system and writes
          warning messages to the MySQL error log. The default value is
          8MB.
        </p></li><li><p><a name="sysvar_innodb_autoextend_increment"></a>
          <a class="indexterm" name="id1100834"></a>

          <a class="indexterm" name="id1100844"></a>

          <code class="literal">innodb_autoextend_increment</code>
        </p><div class="informaltable"><table summary="Options for innodb_autoextend_increment" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_autoextend_increment=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_autoextend_increment</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_autoextend_increment</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 1000</code></td></tr></tbody></table></div><p>
          The increment size (in MB) for extending the size of an
          auto-extending shared tablespace file when it becomes full.
          The default value is 8. This variable does not affect the
          per-table tablespace files that are created if you use
          <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table=1</code></a>.
          Those files are auto-extending regardless of the value of
          <a href="storage-engines.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>.
          The initial extensions are by small amounts, after which
          extensions occur in increments of 4MB.
        </p></li><li><p><a name="sysvar_innodb_autoinc_lock_mode"></a>
          <a class="indexterm" name="id1101103"></a>

          <a class="indexterm" name="id1101112"></a>

          <code class="literal">innodb_autoinc_lock_mode</code>
        </p><div class="informaltable"><table summary="Options for innodb_autoinc_lock_mode" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_autoinc_lock_mode=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_autoinc_lock_mode</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_autoinc_lock_mode</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><p><code class="literal">0</code></p><p><code class="literal">1</code></p><p><code class="literal">2</code></p></td></tr></tbody></table></div><p>
          The locking mode to use for generating auto-increment values.
          The permissible values are 0, 1, or 2, for
          “<span class="quote">traditional</span>”, “<span class="quote">consecutive</span>”, or
          “<span class="quote">interleaved</span>” lock mode, respectively.
          <a href="storage-engines.html#innodb-auto-increment-handling" title="13.3.5.3. AUTO_INCREMENT Handling in InnoDB">Section 13.3.5.3, “<code class="literal">AUTO_INCREMENT</code> Handling in <code class="literal">InnoDB</code>”</a>, describes
          the characteristics of these modes.
        </p><p>
          This variable has a default of 1 (“<span class="quote">consecutive</span>”
          lock mode).
        </p></li><li><p><a name="sysvar_innodb_buffer_pool_instances"></a>
          <a class="indexterm" name="id1101390"></a>

          <a class="indexterm" name="id1101399"></a>

          <code class="literal">innodb_buffer_pool_instances</code>
        </p><div class="informaltable"><table summary="Options for innodb_buffer_pool_instances" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Version Introduced</strong></span></td><td colspan="3">5.5.4</td></tr><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_instances=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_buffer_pool_instances</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_buffer_pool_instances</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 64</code></td></tr></tbody></table></div><p>
          The number of regions that the
          <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> buffer pool is divided
          into. For systems with buffer pools in the multi-gigabyte
          range, dividing the buffer pool into separate instances can
          improve concurrency, by reducing contention as different
          threads read and write to cached pages. Each page that is
          stored in or read from the buffer pool is assigned to one of
          the buffer pool instances randomly, using a hashing function.
          Each buffer pool manages its own free lists, flush lists,
          LRUs, and all other data structures connected to a buffer
          pool, and is protected by its own buffer pool mutex.
        </p><p>
          This option only takes effect when you set the
          <code class="literal">innodb_buffer_pool_size</code> to a size of 1
          gigabyte or more. The total size you specify is divided up
          among all the buffer pools. We recommend specifying a
          combination of <code class="literal">innodb_buffer_pool_instances</code>
          and <code class="literal">innodb_buffer_pool_size</code> so that each
          buffer pool instance is at least 1 gigabyte.
        </p></li><li><p><a name="sysvar_innodb_buffer_pool_size"></a>
          <a class="indexterm" name="id1101692"></a>

          <a class="indexterm" name="id1101701"></a>

          <code class="literal">innodb_buffer_pool_size</code>
        </p><div class="informaltable"><table summary="Options for innodb_buffer_pool_size" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_size=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_buffer_pool_size</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_buffer_pool_size</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Platform Bit Size</strong></span></td><td colspan="2"><code class="literal">32</code></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">134217728</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1048576 .. 2**32-1</code></td></tr></tbody></table></div><p>
          The size in bytes of the memory buffer
          <code class="literal">InnoDB</code> uses to cache data and indexes of
          its tables. The default value is 128MB, increased from a
          historical default of 8MB. The maximum value depends on the
          CPU architecture, 32-bit or 64-bit. For 32-bit systems, the
          CPU architecture and operating system sometimes impose a lower
          practical maximum size.
        </p><p>
          The larger you set this value, the less disk I/O is needed to
          access data in tables. On a dedicated database server, you may
          set this to up to 80% of the machine physical memory size. Be
          prepared to scale back this value if these other issues occur:
        </p><div class="itemizedlist"><ul type="circle"><li><p>
              Competition for physical memory might cause paging in the
              operating system.
            </p></li><li><p>
              InnoDB reserves additional memory for buffers and control
              structures, so that the total allocated space is
              approximately 10% greater than the specified size.
            </p></li><li><p>
              The address space must be contiguous, which can be an
              issue on Windows systems with DLLs that load at specific
              addresses.
            </p></li><li><p>
              The time to initialize the buffer pool is roughly
              proportional to its size. On large installations, this
              initialization time may be significant. For example, on a
              modern Linux x86_64 server, initialization of a 10GB
              buffer pool takes approximately 6 seconds. See
              <a href="optimization.html#innodb-buffer-pool" title="7.9.1. The InnoDB Buffer Pool">Section 7.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
            </p></li></ul></div></li><li><p><a name="sysvar_innodb_change_buffering"></a>
          <a class="indexterm" name="id1102016"></a>

          <a class="indexterm" name="id1102025"></a>

          <code class="literal">innodb_change_buffering</code>
        </p><div class="informaltable"><table summary="Options for innodb_change_buffering" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_change_buffering=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_change_buffering</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_change_buffering</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.5.3)</strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">inserts</code></td></tr><tr><td><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><p><code class="literal">inserts</code></p><p><code class="literal">none</code></p></td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.5.4)</strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">all</code></td></tr><tr><td><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><p><code class="literal">inserts</code></p><p><code class="literal">deletes</code></p><p><code class="literal">purges</code></p><p><code class="literal">changes</code></p><p><code class="literal">all</code></p><p><code class="literal">none</code></p></td></tr></tbody></table></div><p>
          Whether <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> performs change
          buffering, an optimization that delays write operations to
          secondary indexes so that the I/O operations can be performed
          sequentially. The permitted values are
          <code class="literal">inserts</code> (buffer insert operations),
          <code class="literal">deletes</code> (buffer delete operations; strictly
          speaking, the writes that mark index records for later
          deletion during a purge operation), <code class="literal">changes</code>
          (buffer insert and delete-marking operations),
          <code class="literal">purges</code> (buffer purge operations, the writes
          when deleted index entries are finally garbage-collected),
          <code class="literal">all</code> (buffer insert, delete-marking, and
          purge operations) and <code class="literal">none</code> (do not buffer
          any operations). The default is <code class="literal">all</code>. For
          details, see
          <a href="storage-engines.html#innodb-performance-change_buffering" title="13.4.7.4. Controlling InnoDB Change Buffering">Section 13.4.7.4, “Controlling InnoDB Change Buffering”</a>.
        </p></li><li><p><a name="sysvar_innodb_checksums"></a>
          <a class="indexterm" name="id1102432"></a>

          <a class="indexterm" name="id1102441"></a>

          <code class="literal">innodb_checksums</code>
        </p><div class="informaltable"><table summary="Options for innodb_checksums" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_checksums</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_checksums</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_checksums"><code class="literal">innodb_checksums</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_checksums</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table></div><p>
          <code class="literal">InnoDB</code> can use checksum validation on all
          pages read from the disk to ensure extra fault tolerance
          against broken hardware or data files. This validation is
          enabled by default. However, under some rare circumstances
          (such as when running benchmarks) this extra safety feature is
          unneeded and can be disabled with
          <a href="storage-engines.html#sysvar_innodb_checksums"><code class="option">--skip-innodb-checksums</code></a>.
        </p></li><li><p><a name="sysvar_innodb_commit_concurrency"></a>
          <a class="indexterm" name="id1102678"></a>

          <a class="indexterm" name="id1102687"></a>

          <code class="literal">innodb_commit_concurrency</code>
        </p><div class="informaltable"><table summary="Options for innodb_commit_concurrency" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_commit_concurrency=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_commit_concurrency</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_commit_concurrency"><code class="literal">innodb_commit_concurrency</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_commit_concurrency</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 1000</code></td></tr></tbody></table></div><p>
          The number of threads that can commit at the same time. A
          value of 0 (the default) permits any number of transactions to
          commit simultaneously.
        </p><p>
          The value of
          <a href="storage-engines.html#sysvar_innodb_commit_concurrency"><code class="literal">innodb_commit_concurrency</code></a>
          cannot be changed at runtime from zero to nonzero or vice
          versa. The value can be changed from one nonzero value to
          another.
        </p></li><li><p><a name="sysvar_innodb_concurrency_tickets"></a>
          <a class="indexterm" name="id1102942"></a>

          <a class="indexterm" name="id1102951"></a>

          <code class="literal">innodb_concurrency_tickets</code>
        </p><div class="informaltable"><table summary="Options for innodb_concurrency_tickets" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_concurrency_tickets=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_concurrency_tickets</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_concurrency_tickets</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">500</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 4294967295</code></td></tr></tbody></table></div><p>
          The number of threads that can enter <code class="literal">InnoDB</code>
          concurrently is determined by the
          <a href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
          variable. A thread is placed in a queue when it tries to enter
          <code class="literal">InnoDB</code> if the number of threads has already
          reached the concurrency limit. When a thread is permitted to
          enter <code class="literal">InnoDB</code>, it is given a number of
          “<span class="quote">free tickets</span>” equal to the value of
          <a href="storage-engines.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a>,
          and the thread can enter and leave <code class="literal">InnoDB</code>
          freely until it has used up its tickets. After that point, the
          thread again becomes subject to the concurrency check (and
          possible queuing) the next time it tries to enter
          <code class="literal">InnoDB</code>. The default value is 500.
        </p></li><li><p><a name="sysvar_innodb_data_file_path"></a>
          <a class="indexterm" name="id1103245"></a>

          <a class="indexterm" name="id1103254"></a>

          <code class="literal">innodb_data_file_path</code>
        </p><div class="informaltable"><table summary="Options for innodb_data_file_path" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_data_file_path=name</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_data_file_path</code></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_data_file_path</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">file name</code></td></tr></tbody></table></div><p>
          The paths to individual data files and their sizes. The full
          directory path to each data file is formed by concatenating
          <a href="storage-engines.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> to each
          path specified here. The file sizes are specified in KB, MB,
          or GB (1024MB) by appending <code class="literal">K</code>,
          <code class="literal">M</code>, or <code class="literal">G</code> to the size
          value. The sum of the sizes of the files must be at least
          10MB. If you do not specify
          <a href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>, the
          default behavior is to create a single 10MB auto-extending
          data file named <code class="filename">ibdata1</code>. The size limit
          of individual files is determined by your operating system.
          You can set the file size to more than 4GB on those operating
          systems that support big files. You can also use raw disk
          partitions as data files. For detailed information on
          configuring <code class="literal">InnoDB</code> tablespace files, see
          <a href="storage-engines.html#innodb-configuration" title="13.3.2. Configuring InnoDB">Section 13.3.2, “Configuring <code class="literal">InnoDB</code>”</a>.
        </p></li><li><p><a name="sysvar_innodb_data_home_dir"></a>
          <a class="indexterm" name="id1103490"></a>

          <a class="indexterm" name="id1103499"></a>

          <code class="literal">innodb_data_home_dir</code>
        </p><div class="informaltable"><table summary="Options for innodb_data_home_dir" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_data_home_dir=path</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_data_home_dir</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_data_home_dir</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">file name</code></td></tr></tbody></table></div><p>
          The common part of the directory path for all
          <code class="literal">InnoDB</code> data files in the shared tablespace.
          This setting does not affect the location of per-file
          tablespaces when
          <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
          enabled. The default value is the MySQL data directory. If you
          specify the value as an empty string, you can use absolute
          file paths in
          <a href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>.
        </p></li><li><p><a name="sysvar_innodb_doublewrite"></a>
          <a class="indexterm" name="id1103726"></a>

          <a class="indexterm" name="id1103735"></a>

          <code class="literal">innodb_doublewrite</code>
        </p><div class="informaltable"><table summary="Options for innodb_doublewrite" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb-doublewrite</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_doublewrite</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_doublewrite</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr></tbody></table></div><p>
          If this variable is enabled (the default),
          <code class="literal">InnoDB</code> stores all data twice, first to the
          doublewrite buffer, and then to the actual data files. This
          variable can be turned off with
          <a href="storage-engines.html#sysvar_innodb_doublewrite"><code class="option">--skip-innodb_doublewrite</code></a>
          for benchmarks or cases when top performance is needed rather
          than concern for data integrity or possible failures.
        </p></li><li><p><a name="sysvar_innodb_fast_shutdown"></a>
          <a class="indexterm" name="id1103954"></a>

          <a class="indexterm" name="id1103963"></a>

          <code class="literal">innodb_fast_shutdown</code>
        </p><div class="informaltable"><table summary="Options for innodb_fast_shutdown" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_fast_shutdown[=#]</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_fast_shutdown</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_fast_shutdown</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><p><code class="literal">0</code></p><p><code class="literal">1</code></p><p><code class="literal">2</code></p></td></tr></tbody></table></div><p>
          The <code class="literal">InnoDB</code> shutdown mode. If the value is
          0, <code class="literal">InnoDB</code> does a
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_slow_shutdown" target="_top">slow shutdown</a>, a
          full <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_purge" target="_top">purge</a> and an insert
          buffer merge before shutting down. If the value is 1 (the
          default), <code class="literal">InnoDB</code> skips these operations at
          shutdown, a process known as a
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_fast_shutdown" target="_top">fast shutdown</a>. If
          the value is 2, <code class="literal">InnoDB</code> flushes its logs and
          shuts down cold, as if MySQL had crashed; no committed
          transactions are lost, but the
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_crash_recovery" target="_top">crash recovery</a>
          operation makes the next startup take longer.
        </p><p>
          The slow shutdown can take minutes, or even hours in extreme
          cases where substantial amounts of data are still buffered.
          Use the slow shutdown technique before upgrading or
          downgrading between MySQL major releases, so that all data
          files are fully prepared in case the upgrade process updates
          the file format.
        </p><p>
          Use <code class="literal">innodb_fast_shutdown=2</code> in emergency or
          troubleshooting situations, to get the absolute fastest
          shutdown if data is at risk of corruption.
        </p></li><li><p><a name="sysvar_innodb_file_format"></a>
          <a class="indexterm" name="id1104285"></a>

          <a class="indexterm" name="id1104294"></a>

          <code class="literal">innodb_file_format</code>
        </p><div class="informaltable"><table summary="Options for innodb_file_format" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_format=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_file_format</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_file_format</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.5.0, &lt;= 5.5.6)</strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Barracuda</code></td></tr><tr><td><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><p><code class="literal">Antelope</code></p><p><code class="literal">Barracuda</code></p></td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.5.7)</strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><p><code class="literal">Antelope</code></p><p><code class="literal">Barracuda</code></p></td></tr></tbody></table></div><p>
          The file format to use for new
          <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> tables. Currently,
          <code class="literal">Antelope</code> and <code class="literal">Barracuda</code>
          are supported. This applies only for tables that have their
          own tablespace, so for it to have an effect,
          <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must be
          enabled. The <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_barracuda" target="_top">Barracuda</a>
          file format is required for certain InnoDB features such as
          table compression.
        </p></li><li><p><a name="sysvar_innodb_file_format_check"></a>
          <a class="indexterm" name="id1104655"></a>

          <a class="indexterm" name="id1104664"></a>

          <code class="literal">innodb_file_format_check</code>
        </p><div class="informaltable"><table summary="Options for innodb_file_format_check" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_format_check=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_file_format_check</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_file_format_check</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&lt;= 5.5.0)</strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.5.4)</strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Barracuda</code></td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.5.5)</strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table></div><p>
          As of MySQL 5.5.5, this variable can be set to 1 or 0 at
          server startup to enable or disable whether
          <code class="literal">InnoDB</code> checks the file format tag in the
          shared tablespace (for example, <code class="literal">Antelope</code> or
          <code class="literal">Barracuda</code>). If the tag is checked and is
          higher than that supported by the current version of
          <code class="literal">InnoDB</code>, an error occurs and
          <code class="literal">InnoDB</code> does not start. If the tag is not
          higher, <code class="literal">InnoDB</code> sets the value of
          <a href="storage-engines.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a> to the
          file format tag.
        </p><p>
          Before MySQL 5.5.5, this variable can be set to 1 or 0 at
          server startup to enable or disable whether
          <code class="literal">InnoDB</code> checks the file format tag in the
          shared tablespace. If the tag is checked and is higher than
          that supported by the current version of
          <code class="literal">InnoDB</code>, an error occurs and
          <code class="literal">InnoDB</code> does not start. If the tag is not
          higher, <code class="literal">InnoDB</code> sets the value of
          <a href="storage-engines.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> to
          the file format tag, which is the value seen at runtime.
        </p></li><li><p><a name="sysvar_innodb_file_format_max"></a>
          <a class="indexterm" name="id1105078"></a>

          <a class="indexterm" name="id1105087"></a>

          <code class="literal">innodb_file_format_max</code>
        </p><div class="informaltable"><table summary="Options for innodb_file_format_max" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Version Introduced</strong></span></td><td colspan="3">5.5.5</td></tr><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_format_max=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_file_format_max</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_file_format_max</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><p><code class="literal">Antelope</code></p><p><code class="literal">Barracuda</code></p></td></tr></tbody></table></div><p>
          At server startup, <code class="literal">InnoDB</code> sets the value of
          <a href="storage-engines.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a> to the
          file format tag in the shared tablespace (for example,
          <code class="literal">Antelope</code> or <code class="literal">Barracuda</code>).
          If the server creates or opens a table with a
          “<span class="quote">higher</span>” file format, it sets the value of
          <a href="storage-engines.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a> to
          that format.
        </p><p>
          This variable was added in MySQL 5.5.5.
        </p></li><li><p><a name="sysvar_innodb_file_per_table"></a>
          <a class="indexterm" name="id1105391"></a>

          <a class="indexterm" name="id1105400"></a>

          <code class="literal">innodb_file_per_table</code>
        </p><div class="informaltable"><table summary="Options for innodb_file_per_table" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_per_table</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_file_per_table</code></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_file_per_table</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.5.0, &lt;= 5.5.6)</strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.5.7)</strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table></div><p>
          If <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
          disabled (the default), <code class="literal">InnoDB</code> creates
          tables in the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_system_tablespace" target="_top">system
          tablespace</a>. If
          <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
          enabled, <code class="literal">InnoDB</code> creates each new table
          using its own
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_ibd_file" target="_top"><code class="filename">.ibd</code>
          file</a> for storing data and indexes, rather than in the
          system tablespace. See
          <a href="storage-engines.html#innodb-multiple-tablespaces" title="13.3.3. Using Per-Table Tablespaces">Section 13.3.3, “Using Per-Table Tablespaces”</a> for information
          about the features, such as <code class="literal">InnoDB</code> table
          compression, that only work for tables stored in separate
          tablespaces.
        </p></li><li><p><a name="sysvar_innodb_flush_log_at_trx_commit"></a>
          <a class="indexterm" name="id1105711"></a>

          <a class="indexterm" name="id1105720"></a>

          <code class="literal">innodb_flush_log_at_trx_commit</code>
        </p><div class="informaltable"><table summary="Options for innodb_flush_log_at_trx_commit" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_flush_log_at_trx_commit[=#]</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_flush_log_at_trx_commit</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_flush_log_at_trx_commit</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><p><code class="literal">0</code></p><p><code class="literal">1</code></p><p><code class="literal">2</code></p></td></tr></tbody></table></div><p>
          If the value of
          <a href="storage-engines.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit</code></a>
          is 0, the log buffer is written out to the log file once per
          second and the flush to disk operation is performed on the log
          file, but nothing is done at a transaction commit. When the
          value is 1 (the default), the log buffer is written out to the
          log file at each transaction commit and the flush to disk
          operation is performed on the log file. When the value is 2,
          the log buffer is written out to the file at each commit, but
          the flush to disk operation is not performed on it. However,
          the flushing on the log file takes place once per second also
          when the value is 2. Note that the once-per-second flushing is
          not 100% guaranteed to happen every second, due to process
          scheduling issues.
        </p><p>
          The default value of 1 is required for full ACID compliance.
          You can achieve better performance by setting the value
          different from 1, but then you can lose up to one second worth
          of transactions in a crash. With a value of 0, any
          <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> process crash can erase the last
          second of transactions. With a value of 2, only an operating
          system crash or a power outage can erase the last second of
          transactions. <code class="literal">InnoDB</code>'s
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_crash_recovery" target="_top">crash recovery</a>
          works regardless of the value.
        </p><p>
          For the greatest possible durability and consistency in a
          replication setup using <code class="literal">InnoDB</code> with
          transactions, use
          <code class="literal">innodb_flush_log_at_trx_commit=1</code> and
          <code class="literal">sync_binlog=1</code> in your master server
          <code class="filename">my.cnf</code> file.
        </p><div xmlns="http://www.w3.org/1999/xhtml" class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Caution</div><p xmlns="">
            Many operating systems and some disk hardware fool the
            flush-to-disk operation. They may tell
            <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> that the flush has taken place,
            even though it has not. Then the durability of transactions
            is not guaranteed even with the setting 1, and in the worst
            case a power outage can even corrupt the
            <code class="literal">InnoDB</code> database. Using a battery-backed
            disk cache in the SCSI disk controller or in the disk itself
            speeds up file flushes, and makes the operation safer. You
            can also try using the Unix command
            <span><strong class="command">hdparm</strong></span> to disable the caching of disk
            writes in hardware caches, or use some other command
            specific to the hardware vendor.
          </p></div></li><li><p><a name="sysvar_innodb_flush_method"></a>
          <a class="indexterm" name="id1106075"></a>

          <a class="indexterm" name="id1106084"></a>

          <code class="literal">innodb_flush_method</code>
        </p><div class="informaltable"><table summary="Options for innodb_flush_method" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_flush_method=name</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_flush_method</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_flush_method</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span> (solaris)</td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">fdatasync</code></td></tr><tr><td><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><p><code class="literal">O_DSYNC</code></p><p><code class="literal">O_DIRECT</code></p></td></tr></tbody></table></div><p>
          By default, <code class="literal">InnoDB</code> uses the
          <code class="literal">fsync()</code> system call to flush both the data
          and log files. If
          <a href="storage-engines.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> option is
          set to <code class="literal">O_DSYNC</code>, <code class="literal">InnoDB</code>
          uses <code class="literal">O_SYNC</code> to open and flush the log
          files, and <code class="literal">fsync()</code> to flush the data files.
          If <code class="literal">O_DIRECT</code> is specified (available on some
          GNU/Linux versions, FreeBSD, and Solaris),
          <code class="literal">InnoDB</code> uses <code class="literal">O_DIRECT</code> (or
          <code class="literal">directio()</code> on Solaris) to open the data
          files, and uses <code class="literal">fsync()</code> to flush both the
          data and log files. Note that <code class="literal">InnoDB</code> uses
          <code class="literal">fsync()</code> instead of
          <code class="literal">fdatasync()</code>, and it does not use
          <code class="literal">O_DSYNC</code> by default because there have been
          problems with it on many varieties of Unix. This variable is
          relevant only for Unix. On Windows, the flush method is always
          <code class="literal">async_unbuffered</code> and cannot be changed.
        </p><p>
          Depending on hardware configuration, setting
          <code class="literal">innodb_flush_method</code> to
          <code class="literal">O_DIRECT</code> can either have either a positive
          or negative effect on performance. Benchmark your particular
          configuration to decide which setting to use. The mix of read
          and write operations in your workload can also affect which
          setting performs better for you. For example, on a system with
          a hardware RAID controller and battery-backed write cache,
          <code class="literal">O_DIRECT</code> can help to avoid double buffering
          between the <code class="literal">InnoDB</code> buffer pool and the
          operating system's filesystem cache. On some systems where
          <code class="literal">InnoDB</code> data and log files are located on a
          SAN, the default value or <code class="literal">O_DSYNC</code> might be
          faster for a read-heavy workload with mostly
          <code class="literal">SELECT</code> statements. Always test this
          parameter with the same type of hardware and workload that
          reflects your production environment.
        </p><p>
          Formerly, a value of <code class="literal">fdatasync</code> also
          specified the default behavior. This value was removed, due to
          confusion that a value of <code class="literal">fdatasync</code> caused
          <code class="literal">fsync()</code> system calls rather than
          <code class="literal">fdatasync()</code> for flushing. To obtain the
          default value now, do not set any value for
          <a href="storage-engines.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> at
          startup.
        </p></li><li><p><a name="sysvar_innodb_force_recovery"></a>
          <a class="indexterm" name="id1106536"></a>

          <a class="indexterm" name="id1106545"></a>

          <code class="literal">innodb_force_recovery</code>
        </p><div class="informaltable"><table summary="Options for innodb_force_recovery" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_force_recovery=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_force_recovery</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_force_recovery</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><p><code class="literal">0</code></p><p><code class="literal">1</code></p><p><code class="literal">2</code></p><p><code class="literal">3</code></p><p><code class="literal">4</code></p><p><code class="literal">5</code></p><p><code class="literal">6</code></p></td></tr></tbody></table></div><p>
          The crash recovery mode. Possible values are from 0 to 6. The
          meanings of these values are described in
          <a href="storage-engines.html#forcing-innodb-recovery" title="13.3.7.2. Forcing InnoDB Recovery">Section 13.3.7.2, “Forcing <code class="literal">InnoDB</code> Recovery”</a>.
        </p><div xmlns="http://www.w3.org/1999/xhtml" class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Warning</div><p xmlns="">
            Only set this variable greater than 0 in an emergency
            situation, to dump your tables from a corrupt database. As a
            safety measure, <code class="literal">InnoDB</code> prevents any
            changes to its data when this variable is greater than 0.
            This restriction also prohibits some queries that use
            <code class="literal">WHERE</code> or <code class="literal">ORDER BY</code>
            clauses, because high values can prevent queries from using
            indexes.
          </p></div></li><li><p><a name="sysvar_innodb_io_capacity"></a>
          <a class="indexterm" name="id1106853"></a>

          <a class="indexterm" name="id1106862"></a>

          <code class="literal">innodb_io_capacity</code>
        </p><div class="informaltable"><table summary="Options for innodb_io_capacity" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_io_capacity=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_io_capacity</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_io_capacity</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Platform Bit Size</strong></span></td><td colspan="2"><code class="literal">32</code></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">200</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">100 .. 2**32-1</code></td></tr><tr><td rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Platform Bit Size</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">200</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">100 .. 2**64-1</code></td></tr></tbody></table></div><p>
          An upper limit on the I/O activity performed by the
          <code class="literal">InnoDB</code> background tasks, such as flushing
          pages from the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_buffer_pool" target="_top">buffer
          pool</a> and merging data from the
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_insert_buffer" target="_top">insert buffer</a>. The
          default value is 200. For busy systems capable of higher I/O
          rates, you can set a higher value at server startup, to help
          the server handle the background maintenance work associated
          with a high rate of row changes. For systems with individual
          5400 RPM or 7200 RPM drives, you might lower the value to the
          former default of <code class="literal">100</code>.
        </p><p>
          This parameter should be set to approximately the number of
          I/O operations that the system can perform per second. The
          Ideally, keep this setting as low as practical, but not so low
          that these background activities fall behind. If the value is
          too high, data is removed from the buffer pool and insert
          buffer too quickly to provide significant benefit from the
          caching.
        </p><p>
          The value represents an estimated proportion of the I/O
          operations per second (IOPS) available to older-generation
          disk drives that could perform about 100 IOPS. The current
          default of 200 reflects that modern storage devices are
          capable of much higher I/O rates.
        </p><p>
          In general, you can increase the value as a function of the
          number of drives used for <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>
          I/O, particularly fast drives capable of high numbers of IOPS.
          For example, systems that use multiple disks or solid-state
          disks for <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> are likely to
          benefit from the ability to control this parameter.
        </p><p>
          Although you can specify a very high number, in practice such
          large values cease to have any benefit; for example, a value
          of one million would be considered very high.
        </p><p>
          You can set the <code class="literal">innodb_io_capacity</code> value to
          any number 100 or greater, and the default value is
          <code class="literal">200</code>. You can set the value of this
          parameter in the MySQL option file (<code class="literal">my.cnf</code>
          or <code class="literal">my.ini</code>) or change it dynamically with
          the <code class="literal">SET GLOBAL</code> command, which requires the
          <code class="literal">SUPER</code> privilege.
        </p><p>
          See <a href="storage-engines.html#innodb-performance-thread_io_rate" title="13.4.7.11. Controlling the Master Thread I/O Rate">Section 13.4.7.11, “Controlling the Master Thread I/O Rate”</a> for
          more guidelines about this option. For general information
          about InnoDB I/O performance, see
          <a href="optimization.html#optimizing-innodb-diskio" title="7.5.7. Optimizing InnoDB Disk I/O">Section 7.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
        </p></li><li><p><a name="sysvar_innodb_large_prefix"></a>
          <a class="indexterm" name="id1107332"></a>

          <a class="indexterm" name="id1107342"></a>

          <code class="literal">innodb_large_prefix</code>
        </p><div class="informaltable"><table summary="Options for innodb_large_prefix" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Version Introduced</strong></span></td><td colspan="3">5.5.14</td></tr><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_large_prefix</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_large_prefix</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_large_prefix</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table></div><p>
          Enable this option to allow index key prefixes longer than 767
          bytes (up to 3072 bytes), for <code class="literal">InnoDB</code> tables
          that use the
          <code class="literal"><a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_dynamic_row_format" target="_top">DYNAMIC</a></code>
          and
          <code class="literal"><a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_compressed_row_format" target="_top">COMPRESSED</a></code>
          row formats. (Creating such tables also requires the option
          values
          <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format=barracuda</code></a>
          and
          <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table=true</code></a>.)
          See <a href="storage-engines.html#innodb-restrictions" title="13.3.15. Limits on InnoDB Tables">Section 13.3.15, “Limits on <code class="literal">InnoDB</code> Tables”</a> for the relevant
          maximums associated with index key prefixes under various
          settings.
        </p><p>
          For tables using the
          <code class="literal"><a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_redundant_row_format" target="_top">REDUNDANT</a></code>
          and
          <code class="literal"><a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_compact_row_format" target="_top">COMPACT</a></code>
          row formats, this option does not affect the allowed key
          prefix length. It does introduce a new error possibility. When
          this setting is enabled, attempting to create an index prefix
          with a key length greater than 3072 for a
          <code class="literal">REDUNDANT</code> or <code class="literal">COMPACT</code>
          table causes an error
          <code class="literal">ER_INDEX_COLUMN_TOO_LONG</code> (1727).
        </p></li><li><p><a name="sysvar_innodb_lock_wait_timeout"></a>
          <a class="indexterm" name="id1107670"></a>

          <a class="indexterm" name="id1107680"></a>

          <code class="literal">innodb_lock_wait_timeout</code>
        </p><div class="informaltable"><table summary="Options for innodb_lock_wait_timeout" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_lock_wait_timeout=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_lock_wait_timeout</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_lock_wait_timeout</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global, Session</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">50</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 1073741824</code></td></tr></tbody></table></div><p>
          The timeout in seconds an <code class="literal">InnoDB</code>
          transaction waits for a row lock before giving up. The default
          value is 50 seconds. A transaction that tries to access a row
          that is locked by another <code class="literal">InnoDB</code>
          transaction waits at most this many seconds for write access
          to the row before issuing the following error:
        </p><pre class="programlisting">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</pre><p>
          When a lock wait timeout occurs, the current statement is
          rolled back (not the entire transaction). To have the entire
          transaction roll back, start the server with the
          <a href="storage-engines.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a>
          option. See also <a href="storage-engines.html#innodb-error-handling" title="13.3.13. InnoDB Error Handling">Section 13.3.13, “<code class="literal">InnoDB</code> Error Handling”</a>.
        </p><p>
          You might decrease this value for highly interactive
          applications or <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_oltp" target="_top">OLTP</a> systems,
          to display user feedback quickly or put the update into a
          queue for processing later. You might increase this value for
          long-running back-end operations, such as a transform step in
          a data warehouse that waits for other large insert or update
          operations to finish.
        </p><p>
          <a href="storage-engines.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>
          applies to <code class="literal">InnoDB</code> row locks only. A MySQL
          table lock does not happen inside <code class="literal">InnoDB</code>
          and this timeout does not apply to waits for table locks.
        </p><p>
          The lock wait timeout value does not apply to deadlocks,
          because <code class="literal">InnoDB</code> detects them immediately and
          rolls back one of the deadlocked transactions.
        </p></li><li><p><a name="sysvar_innodb_locks_unsafe_for_binlog"></a>
          <a class="indexterm" name="id1108006"></a>

          <a class="indexterm" name="id1108015"></a>

          <code class="literal">innodb_locks_unsafe_for_binlog</code>
        </p><div class="informaltable"><table summary="Options for innodb_locks_unsafe_for_binlog" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_locks_unsafe_for_binlog</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_locks_unsafe_for_binlog</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_locks_unsafe_for_binlog</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table></div><a class="indexterm" name="id1108242"></a><a class="indexterm" name="id1108254"></a><a class="indexterm" name="id1108266"></a><a class="indexterm" name="id1108279"></a><a class="indexterm" name="id1108291"></a><a class="indexterm" name="id1108304"></a><a class="indexterm" name="id1108316"></a><a class="indexterm" name="id1108328"></a><a class="indexterm" name="id1108341"></a><a class="indexterm" name="id1108353"></a><p>
          This variable affects how <code class="literal">InnoDB</code> uses gap
          locking for searches and index scans. Normally,
          <code class="literal">InnoDB</code> uses an algorithm called
          <em class="firstterm">next-key locking</em> that combines
          index-row locking with gap locking. <code class="literal">InnoDB</code>
          performs row-level locking in such a way that when it searches
          or scans a table index, it sets shared or exclusive locks on
          the index records it encounters. Thus, the row-level locks are
          actually index-record locks. In addition, a next-key lock on
          an index record also affects the “<span class="quote">gap</span>” before
          that index record. That is, a next-key lock is an index-record
          lock plus a gap lock on the gap preceding the index record. If
          one session has a shared or exclusive lock on record
          <code class="literal">R</code> in an index, another session cannot
          insert a new index record in the gap immediately before
          <code class="literal">R</code> in the index order. See
          <a href="storage-engines.html#innodb-record-level-locks" title="13.3.9.4. InnoDB Record, Gap, and Next-Key Locks">Section 13.3.9.4, “<code class="literal">InnoDB</code> Record, Gap, and Next-Key Locks”</a>.
        </p><p>
          By default, the value of
          <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
          is 0 (disabled), which means that gap locking is enabled:
          <code class="literal">InnoDB</code> uses next-key locks for searches and
          index scans. To enable the variable, set it to 1. This causes
          gap locking to be disabled: <code class="literal">InnoDB</code> uses
          only index-record locks for searches and index scans.
        </p><p>
          Enabling
          <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
          does not disable the use of gap locking for foreign-key
          constraint checking or duplicate-key checking.
        </p><p>
          The effect of enabling
          <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
          is similar to but not identical to setting the transaction
          isolation level to <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
          COMMITTED</code></a>:
        </p><div class="itemizedlist"><ul type="circle"><li><p>
              Enabling
              <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
              is a global setting and affects all sessions, whereas the
              isolation level can be set globally for all sessions, or
              individually per session.
            </p></li><li><p>
              <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
              can be set only at server startup, whereas the isolation
              level can be set at startup or changed at runtime.
            </p></li></ul></div><p>
          <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> therefore
          offers finer and more flexible control than
          <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>.
          For additional details about the effect of isolation level on
          gap locking, see <a href="sql-syntax.html#set-transaction" title="12.3.6. SET TRANSACTION Syntax">Section 12.3.6, “<code class="literal">SET TRANSACTION</code> Syntax”</a>.
        </p><p>
          Enabling
          <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
          may cause phantom problems because other sessions can insert
          new rows into the gaps when gap locking is disabled. Suppose
          that there is an index on the <code class="literal">id</code> column of
          the <code class="literal">child</code> table and that you want to read
          and lock all rows from the table having an identifier value
          larger than 100, with the intention of updating some column in
          the selected rows later:
        </p><pre class="programlisting">SELECT * FROM child WHERE id &gt; 100 FOR UPDATE;</pre><p>
          The query scans the index starting from the first record where
          <code class="literal">id</code> is greater than 100. If the locks set on
          the index records in that range do not lock out inserts made
          in the gaps, another session can insert a new row into the
          table. Consequently, if you were to execute the same
          <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> again within the same
          transaction, you would see a new row in the result set
          returned by the query. This also means that if new items are
          added to the database, <code class="literal">InnoDB</code> does not
          guarantee serializability. Therefore, if
          <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
          is enabled, <code class="literal">InnoDB</code> guarantees at most an
          isolation level of <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
          COMMITTED</code></a>. (Conflict serializability is still
          guaranteed.) For additional information about phantoms, see
          <a href="storage-engines.html#innodb-next-key-locking" title="13.3.9.5. Avoiding the Phantom Problem Using Next-Key Locking">Section 13.3.9.5, “Avoiding the Phantom Problem Using Next-Key Locking”</a>.
        </p><p>
          Enabling
          <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
          has additional effects:
        </p><div class="itemizedlist"><ul type="circle"><li><p>
              For <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> or
              <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> statements,
              <code class="literal">InnoDB</code> holds locks only for rows that
              it updates or deletes. Record locks for nonmatching rows
              are released after MySQL has evaluated the
              <code class="literal">WHERE</code> condition. This greatly reduces
              the probability of deadlocks, but they can still happen.
            </p></li><li><p>
              For <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> statements, if a
              row is already locked, <code class="literal">InnoDB</code> performs
              a “<span class="quote">semi-consistent</span>” read, returning the
              latest committed version to MySQL so that MySQL can
              determine whether the row matches the
              <code class="literal">WHERE</code> condition of the
              <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>. If the row matches
              (must be updated), MySQL reads the row again and this time
              <code class="literal">InnoDB</code> either locks it or waits for a
              lock on it.
            </p></li></ul></div><p>
          Consider the following example, beginning with this table:
        </p><pre class="programlisting">CREATE TABLE t (a INT NOT NULL, b INT) ENGINE = InnoDB;
INSERT INTO t VALUES (1,2),(2,3),(3,2),(4,3),(5,2);
COMMIT;</pre><p>
          In this case, table has no indexes, so searches and index
          scans use the hidden clustered index for record locking (see
          <a href="storage-engines.html#innodb-index-types" title="13.3.11.1. Clustered and Secondary Indexes">Section 13.3.11.1, “Clustered and Secondary Indexes”</a>).
        </p><p>
          Suppose that one client performs an
          <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> using these statements:
        </p><pre class="programlisting">SET autocommit = 0;
UPDATE t SET b = 5 WHERE b = 3;</pre><p>
          Suppose also that a second client performs an
          <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> by executing these
          statements following those of the first client:
        </p><pre class="programlisting">SET autocommit = 0;
UPDATE t SET b = 4 WHERE b = 2;</pre><p>
          As <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> executes each
          <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, it first acquires an
          exclusive lock for each row, and then determines whether to
          modify it. If <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> does not
          modify the row and
          <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
          is enabled, it releases the lock. Otherwise,
          <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> retains the lock until the
          end of the transaction. This affects transaction processing as
          follows.
        </p><p>
          If
          <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
          is disabled, the first <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>
          acquires x-locks and does not release any of them:
        </p><pre class="programlisting">x-lock(1,2); retain x-lock
x-lock(2,3); update(2,3) to (2,5); retain x-lock
x-lock(3,2); retain x-lock
x-lock(4,3); update(4,3) to (4,5); retain x-lock
x-lock(5,2); retain x-lock</pre><p>
          The second <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> blocks as
          soon as it tries to acquire any locks (because first update
          has retained locks on all rows), and does not proceed until
          the first <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> commits or
          rolls back:
        </p><pre class="programlisting">x-lock(1,2); block and wait for first UPDATE to commit or roll back</pre><p>
          If
          <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
          is enabled, the first <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>
          acquires x-locks and releases those for rows that it does not
          modify:
        </p><pre class="programlisting">x-lock(1,2); unlock(1,2)
x-lock(2,3); update(2,3) to (2,5); retain x-lock
x-lock(3,2); unlock(3,2)
x-lock(4,3); update(4,3) to (4,5); retain x-lock
x-lock(5,2); unlock(5,2)</pre><p>
          For the second <code class="literal">UPDATE</code>,
          <code class="literal">InnoDB</code> does a
          “<span class="quote">semi-consistent</span>” read, returning the latest
          committed version of each row to MySQL so that MySQL can
          determine whether the row matches the <code class="literal">WHERE</code>
          condition of the <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>:
        </p><pre class="programlisting">x-lock(1,2); update(1,2) to (1,4); retain x-lock
x-lock(2,3); unlock(2,3)
x-lock(3,2); update(3,2) to (3,4); retain x-lock
x-lock(4,3); unlock(4,3)
x-lock(5,2); update(5,2) to (5,4); retain x-lock</pre></li><li><p><a name="sysvar_innodb_log_buffer_size"></a>
          <a class="indexterm" name="id1108931"></a>

          <a class="indexterm" name="id1108940"></a>

          <code class="literal">innodb_log_buffer_size</code>
        </p><div class="informaltable"><table summary="Options for innodb_log_buffer_size" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_buffer_size=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_log_buffer_size</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_log_buffer_size"><code class="literal">innodb_log_buffer_size</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_log_buffer_size</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8388608</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">262144 .. 4294967295</code></td></tr></tbody></table></div><p>
          The size in bytes of the buffer that <code class="literal">InnoDB</code>
          uses to write to the log files on disk. The default value is
          8MB. A large log buffer enables large transactions to run
          without a need to write the log to disk before the
          transactions commit. Thus, if you have big transactions,
          making the log buffer larger saves disk I/O.
        </p></li><li><p><a name="sysvar_innodb_log_file_size"></a>
          <a class="indexterm" name="id1109190"></a>

          <a class="indexterm" name="id1109199"></a>

          <code class="literal">innodb_log_file_size</code>
        </p><div class="informaltable"><table summary="Options for innodb_log_file_size" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_file_size=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_log_file_size</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_log_file_size</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">5242880</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">108576 .. 4294967295</code></td></tr></tbody></table></div><p>
          The size in bytes of each log file in a log group. The
          combined size of log files must be less than 4GB. The default
          value is 5MB. Sensible values range from 1MB to
          1/<em class="replaceable"><code>N</code></em>-th of the size of the buffer
          pool, where <em class="replaceable"><code>N</code></em> is the number of log
          files in the group. The larger the value, the less checkpoint
          flush activity is needed in the buffer pool, saving disk I/O.
          But larger log files also mean that recovery is slower in case
          of a crash.
        </p></li><li><p><a name="sysvar_innodb_log_files_in_group"></a>
          <a class="indexterm" name="id1109450"></a>

          <a class="indexterm" name="id1109459"></a>

          <code class="literal">innodb_log_files_in_group</code>
        </p><div class="informaltable"><table summary="Options for innodb_log_files_in_group" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_files_in_group=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_log_files_in_group</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_log_files_in_group</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">2</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">2 .. 100</code></td></tr></tbody></table></div><p>
          The number of log files in the log group.
          <code class="literal">InnoDB</code> writes to the files in a circular
          fashion. The default (and recommended) value is 2.
        </p></li><li><p><a name="sysvar_innodb_log_group_home_dir"></a>
          <a class="indexterm" name="id1109708"></a>

          <a class="indexterm" name="id1109717"></a>

          <code class="literal">innodb_log_group_home_dir</code>
        </p><div class="informaltable"><table summary="Options for innodb_log_group_home_dir" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_group_home_dir=path</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_log_group_home_dir</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_log_group_home_dir"><code class="literal">innodb_log_group_home_dir</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_log_group_home_dir</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="2"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">file name</code></td></tr></tbody></table></div><p>
          The directory path to the <code class="literal">InnoDB</code>
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_redo_log" target="_top">redo log</a> files. If you do
          not specify any <code class="literal">InnoDB</code> log variables, the
          default is to create two 5MB files named
          <code class="filename">ib_logfile0</code> and
          <code class="filename">ib_logfile1</code> in the MySQL data directory.
        </p></li><li><p><a name="sysvar_innodb_max_dirty_pages_pct"></a>
          <a class="indexterm" name="id1109952"></a>

          <a class="indexterm" name="id1109961"></a>

          <code class="literal">innodb_max_dirty_pages_pct</code>
        </p><div class="informaltable"><table summary="Options for innodb_max_dirty_pages_pct" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_max_dirty_pages_pct=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_max_dirty_pages_pct</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_max_dirty_pages_pct</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">75</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 99</code></td></tr></tbody></table></div><p>
          This is an integer in the range from 0 to 99. The default
          value is 75. The main thread in <code class="literal">InnoDB</code>
          tries to write pages from the buffer pool so that the
          percentage of dirty (not yet written) pages will not exceed
          this value.
        </p></li><li><p><a name="sysvar_innodb_max_purge_lag"></a>
          <a class="indexterm" name="id1110210"></a>

          <a class="indexterm" name="id1110219"></a>

          <code class="literal">innodb_max_purge_lag</code>
        </p><div class="informaltable"><table summary="Options for innodb_max_purge_lag" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_max_purge_lag=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_max_purge_lag</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_max_purge_lag</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 4294967295</code></td></tr></tbody></table></div><p>
          This variable controls how to delay
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> operations when purge
          operations are lagging (see
          <a href="storage-engines.html#innodb-multi-versioning" title="13.3.10. InnoDB Multi-Versioning">Section 13.3.10, “<code class="literal">InnoDB</code> Multi-Versioning”</a>). The default value
          0 (no delays).
        </p><p>
          The <code class="literal">InnoDB</code> transaction system maintains a
          list of transactions that have index records delete-marked by
          <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> or
          <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> operations. Let the
          length of this list be <em class="replaceable"><code>purge_lag</code></em>.
          When <em class="replaceable"><code>purge_lag</code></em> exceeds
          <a href="storage-engines.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a>, each
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> operation is delayed by
          ((<em class="replaceable"><code>purge_lag</code></em>/<a href="storage-engines.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a>)×10)–5
          milliseconds. The delay is computed in the beginning of a
          purge batch, every ten seconds. The operations are not delayed
          if purge cannot run because of an old
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_consistent_read" target="_top">consistent read</a>
          view that could see the rows to be purged.
        </p><p>
          A typical setting for a problematic workload might be 1
          million, assuming that transactions are small, only 100 bytes
          in size, and it is permissible to have 100MB of unpurged
          <code class="literal">InnoDB</code> table rows.
        </p><p>
          The lag value is displayed as the history list length in the
          <code class="literal">TRANSACTIONS</code> section of InnoDB Monitor
          output. For example, if the output includes the following
          lines, the lag value is 20:
        </p><pre class="programlisting">------------
TRANSACTIONS
------------
Trx id counter 0 290328385
Purge done for trx's n:o &lt; 0 290315608 undo n:o &lt; 0 17
History list length 20</pre></li><li><p><a name="sysvar_innodb_mirrored_log_groups"></a>
          <a class="indexterm" name="id1110597"></a>

          <a class="indexterm" name="id1110606"></a>

          <code class="literal">innodb_mirrored_log_groups</code>
        </p><p>
          The number of identical copies of log groups to keep for the
          database. This should be set to 1.
        </p></li><li><p><a name="sysvar_innodb_old_blocks_pct"></a>
          <a class="indexterm" name="id1110638"></a>

          <a class="indexterm" name="id1110647"></a>

          <code class="literal">innodb_old_blocks_pct</code>
        </p><div class="informaltable"><table summary="Options for innodb_old_blocks_pct" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_old_blocks_pct=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_old_blocks_pct</code></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_old_blocks_pct</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">37</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">5 .. 95</code></td></tr></tbody></table></div><p>
          Specifies the approximate percentage of the
          <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> buffer pool used for the
          old block sublist. The range of values is 5 to 95. The default
          value is 37 (that is, 3/8 of the pool). See
          <a href="optimization.html#innodb-buffer-pool" title="7.9.1. The InnoDB Buffer Pool">Section 7.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>
        </p></li><li><p><a name="sysvar_innodb_old_blocks_time"></a>
          <a class="indexterm" name="id1110879"></a>

          <a class="indexterm" name="id1110888"></a>

          <code class="literal">innodb_old_blocks_time</code>
        </p><div class="informaltable"><table summary="Options for innodb_old_blocks_time" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_old_blocks_time=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_old_blocks_time</code></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_old_blocks_time</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 2**32-1</code></td></tr></tbody></table></div><p>
          Specifies how long in milliseconds (ms) a block inserted into
          the old sublist must stay there after its first access before
          it can be moved to the new sublist. The default value is 0: A
          block inserted into the old sublist moves immediately to the
          new sublist the first time it is accessed, no matter how soon
          after insertion the access occurs. If the value is greater
          than 0, blocks remain in the old sublist until an access
          occurs at least that many ms after the first access. For
          example, a value of 1000 causes blocks to stay in the old
          sublist for 1 second after the first access before they become
          eligible to move to the new sublist. See
          <a href="optimization.html#innodb-buffer-pool" title="7.9.1. The InnoDB Buffer Pool">Section 7.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>
        </p></li><li><p><a name="sysvar_innodb_open_files"></a>
          <a class="indexterm" name="id1111118"></a>

          <a class="indexterm" name="id1111127"></a>

          <code class="literal">innodb_open_files</code>
        </p><div class="informaltable"><table summary="Options for innodb_open_files" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_open_files=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_open_files</code></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_open_files</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">300</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">10 .. 4294967295</code></td></tr></tbody></table></div><p>
          This variable is relevant only if you use multiple
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_tablespace" target="_top">tablespaces</a> in
          <code class="literal">InnoDB</code>. It specifies the maximum number of
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_ibd_file" target="_top"><code class="filename">.ibd</code>
          files</a> that <code class="literal">InnoDB</code> can keep open at
          one time. The minimum value is 10. The default value is 300.
        </p><p>
          The file descriptors used for <code class="filename">.ibd</code> files
          are for <code class="literal">InnoDB</code> only. They are independent
          of those specified by the
          <a href="server-administration.html#option_mysqld_open-files-limit"><code class="option">--open-files-limit</code></a> server
          option, and do not affect the operation of the table cache.
        </p></li><li><p><a name="sysvar_innodb_purge_batch_size"></a>
          <a class="indexterm" name="id1111401"></a>

          <a class="indexterm" name="id1111410"></a>

          <code class="literal">innodb_purge_batch_size</code>
        </p><div class="informaltable"><table summary="Options for innodb_purge_batch_size" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Version Introduced</strong></span></td><td colspan="3">5.5.4</td></tr><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_purge_batch_size=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_purge_batch_size</code></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_purge_batch_size</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.5.4)</strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">20</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 5000</code></td></tr></tbody></table></div><p>
          The granularity of changes, expressed in units of redo log
          records, that trigger a purge operation, flushing the changed
          buffer pool blocks to disk. The default value is 20, and the
          range is 1-5000. This option is intended for tuning
          performance in combination with the setting
          <code class="literal">innodb_purge_threads=1</code>, and typical users
          do not need to modify it.
        </p></li><li><p><a name="sysvar_innodb_purge_threads"></a>
          <a class="indexterm" name="id1111654"></a>

          <a class="indexterm" name="id1111663"></a>

          <code class="literal">innodb_purge_threads</code>
        </p><div class="informaltable"><table summary="Options for innodb_purge_threads" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Version Introduced</strong></span></td><td colspan="3">5.5.4</td></tr><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_purge_threads=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_purge_threads</code></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_purge_threads</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values (&gt;= 5.5.4)</strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 1</code></td></tr></tbody></table></div><p>
          The number of background threads devoted to the InnoDB purge
          operation. Currently, can only be 0 (the default) or 1. The
          default value of 0 signifies that the purge operation is
          performed as part of the master thread. Running the purge
          operation in its own thread can reduce internal contention
          within InnoDB, improving scalability. Currently, the
          performance gain might be minimal because the background
          thread might encounter different kinds of contention than
          before. This feature primarily lays the groundwork for future
          performance work.
        </p></li><li><p><a name="sysvar_innodb_read_ahead_threshold"></a>
          <a class="indexterm" name="id1111903"></a>

          <a class="indexterm" name="id1111912"></a>

          <code class="literal">innodb_read_ahead_threshold</code>
        </p><div class="informaltable"><table summary="Options for innodb_read_ahead_threshold" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_read_ahead_threshold=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_read_ahead_threshold</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_read_ahead_threshold</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">56</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 64</code></td></tr></tbody></table></div><p>
          Controls the sensitivity of linear read-ahead that
          <code class="literal">InnoDB</code> uses to prefetch pages into the
          buffer cache. If <code class="literal">InnoDB</code> reads at least
          <a href="storage-engines.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>
          pages sequentially from an extent (64 pages), it initiates an
          asynchronous read for the entire following extent. The
          permissible range of values is 0 to 64. The default is 56:
          <code class="literal">InnoDB</code> must read at least 56 pages
          sequentially from an extent to initiate an asynchronous read
          for the following extent.
        </p></li><li><p><a name="sysvar_innodb_read_io_threads"></a>
          <a class="indexterm" name="id1112182"></a>

          <a class="indexterm" name="id1112191"></a>

          <code class="literal">innodb_read_io_threads</code>
        </p><div class="informaltable"><table summary="Options for innodb_read_io_threads" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_read_io_threads=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_read_io_threads</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_read_io_threads</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">4</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 64</code></td></tr></tbody></table></div><p>
          The number of I/O threads for read operations in
          <code class="literal">InnoDB</code>. The default value is 4.
        </p></li><li><p><a name="sysvar_innodb_replication_delay"></a>
          <a class="indexterm" name="id1112438"></a>

          <a class="indexterm" name="id1112447"></a>

          <code class="literal">innodb_replication_delay</code>
        </p><div class="informaltable"><table summary="Options for innodb_replication_delay" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_replication_delay=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_replication_delay</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_replication_delay"><code class="literal">innodb_replication_delay</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_replication_delay</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 4294967295</code></td></tr></tbody></table></div><p>
          The replication thread delay (in ms) on a slave server if
          <a href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is
          reached.
        </p></li><li><p><a name="sysvar_innodb_rollback_on_timeout"></a>
          <a class="indexterm" name="id1112696"></a>

          <a class="indexterm" name="id1112705"></a>

          <code class="literal">innodb_rollback_on_timeout</code>
        </p><div class="informaltable"><table summary="Options for innodb_rollback_on_timeout" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_rollback_on_timeout</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_rollback_on_timeout</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_rollback_on_timeout"><code class="literal">innodb_rollback_on_timeout</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_rollback_on_timeout</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table></div><p>
          In MySQL 5.5, <code class="literal">InnoDB</code> rolls
          back only the last statement on a transaction timeout by
          default. If
          <a href="storage-engines.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a> is
          specified, a transaction timeout causes
          <code class="literal">InnoDB</code> to abort and roll back the entire
          transaction (the same behavior as in MySQL 4.1).
        </p></li><li><p><a name="sysvar_innodb_rollback_segments"></a>
          <a class="indexterm" name="id1112949"></a>

          <a class="indexterm" name="id1112958"></a>

          <code class="literal">innodb_rollback_segments</code>
        </p><div class="informaltable"><table summary="Options for innodb_rollback_segments" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Version Introduced</strong></span></td><td colspan="3">5.5.11</td></tr><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_rollback_segments=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_rollback_segments</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_rollback_segments"><code class="literal">innodb_rollback_segments</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_rollback_segments</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">128</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 128</code></td></tr></tbody></table></div><p>
          Defines how many of the
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_rollback_segment" target="_top">rollback segments</a>
          in the system tablespace that InnoDB uses within a
          transaction. You might reduce this value from its default of
          128 if a smaller number of rollback segments performs better
          for your workload.
        </p></li><li><p><a name="sysvar_innodb_spin_wait_delay"></a>
          <a class="indexterm" name="id1113223"></a>

          <a class="indexterm" name="id1113232"></a>

          <code class="literal">innodb_spin_wait_delay</code>
        </p><div class="informaltable"><table summary="Options for innodb_spin_wait_delay" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_spin_wait_delay=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_spin_wait_delay</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_spin_wait_delay</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">6</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 4294967295</code></td></tr></tbody></table></div><p>
          The maximum delay between polls for a spin lock. The default
          value is 6.
        </p></li><li><p><a name="sysvar_innodb_stats_method"></a>
          <a class="indexterm" name="id1113473"></a>

          <a class="indexterm" name="id1113482"></a>

          <code class="literal">innodb_stats_method</code>
        </p><div class="informaltable"><table summary="Options for innodb_stats_method" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Version Introduced</strong></span></td><td colspan="3">5.5.10</td></tr><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_method=name</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_stats_method</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_stats_method"><code class="literal">innodb_stats_method</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_stats_method</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global, Session</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">nulls_equal</code></td></tr></tbody></table></div><p>
          How the server treats <code class="literal">NULL</code> values when
          collecting statistics about the distribution of index values
          for <code class="literal">InnoDB</code> tables. This variable has three
          possible values, <code class="literal">nulls_equal</code>,
          <code class="literal">nulls_unequal</code>, and
          <code class="literal">nulls_ignored</code>. For
          <code class="literal">nulls_equal</code>, all <code class="literal">NULL</code>
          index values are considered equal and form a single value
          group that has a size equal to the number of
          <code class="literal">NULL</code> values. For
          <code class="literal">nulls_unequal</code>, <code class="literal">NULL</code>
          values are considered unequal, and each
          <code class="literal">NULL</code> forms a distinct value group of size
          1. For <code class="literal">nulls_ignored</code>,
          <code class="literal">NULL</code> values are ignored.
        </p><p>
          The method that is used for generating table statistics
          influences how the optimizer chooses indexes for query
          execution, as described in
          <a href="optimization.html#myisam-index-statistics" title="7.3.7. InnoDB and MyISAM Index Statistics
        Collection">Section 7.3.7, “<code class="literal">InnoDB</code> and <code class="literal">MyISAM</code> Index Statistics
        Collection”</a>.
        </p></li><li><p><a name="sysvar_innodb_stats_on_metadata"></a>
          <a class="indexterm" name="id1113810"></a>

          <a class="indexterm" name="id1113819"></a>

          <code class="literal">innodb_stats_on_metadata</code>
        </p><div class="informaltable"><table summary="Options for innodb_stats_on_metadata" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Version Introduced</strong></span></td><td colspan="3">5.5.4</td></tr><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_on_metadata</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_stats_on_metadata</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_stats_on_metadata"><code class="literal">innodb_stats_on_metadata</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_stats_on_metadata</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table></div><p>
          When this variable is enabled (which is the default, as before
          the variable was created), <code class="literal">InnoDB</code> updates
          statistics during metadata statements such as
          <a href="sql-syntax.html#show-table-status" title="12.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> or
          <a href="sql-syntax.html#show-index" title="12.7.5.23. SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a>, or when accessing
          the <code class="literal">INFORMATION_SCHEMA</code> tables
          <a href="information-schema.html#tables-table" title="19.22. The INFORMATION_SCHEMA TABLES Table"><code class="literal">TABLES</code></a> or
          <a href="information-schema.html#statistics-table" title="19.21. The INFORMATION_SCHEMA STATISTICS Table"><code class="literal">STATISTICS</code></a>. (These updates are
          similar to what happens for <a href="sql-syntax.html#analyze-table" title="12.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a>.) When disabled, <code class="literal">InnoDB</code>
          does not update statistics during these operations. Disabling
          this variable can improve access speed for schemas that have a
          large number of tables or indexes. It can also improve the
          stability of execution plans for queries that involve
          <code class="literal">InnoDB</code> tables.
        </p></li><li><p><a name="sysvar_innodb_stats_sample_pages"></a>
          <a class="indexterm" name="id1114120"></a>

          <a class="indexterm" name="id1114129"></a>

          <code class="literal">innodb_stats_sample_pages</code>
        </p><div class="informaltable"><table summary="Options for innodb_stats_sample_pages" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_sample_pages=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_stats_sample_pages</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_stats_sample_pages</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 2**64-1</code></td></tr></tbody></table></div><p>
          The number of index pages to sample for index distribution
          statistics such as are calculated by
          <a href="sql-syntax.html#analyze-table" title="12.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>. The default
          value is 8. For more information, see
          <a href="storage-engines.html#innodb-other-changes" title="13.4.8. Changes for Flexibility, Ease of Use and Reliability">Section 13.4.8, “Changes for Flexibility, Ease of Use and Reliability”</a>.
        </p></li><li><p><a name="sysvar_innodb_strict_mode"></a>
          <a class="indexterm" name="id1114399"></a>

          <a class="indexterm" name="id1114408"></a>

          <code class="literal">innodb_strict_mode</code>
        </p><div class="informaltable"><table summary="Options for innodb_strict_mode" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_strict_mode=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_strict_mode</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_strict_mode</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global, Session</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table></div><p>
          Whether <code class="literal">InnoDB</code> returns errors rather than
          warnings for certain conditions. This is analogous to strict
          SQL mode. The default value is <code class="literal">OFF</code>. See
          <a href="storage-engines.html#innodb-other-changes-strict-mode" title="13.4.8.4. InnoDB Strict Mode">Section 13.4.8.4, “InnoDB Strict Mode”</a> for a list
          of the conditions that are affected.
        </p></li><li><p><a name="sysvar_innodb_support_xa"></a>
          <a class="indexterm" name="id1114647"></a>

          <a class="indexterm" name="id1114656"></a>

          <code class="literal">innodb_support_xa</code>
        </p><div class="informaltable"><table summary="Options for innodb_support_xa" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_support_xa</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_support_xa</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_support_xa"><code class="literal">innodb_support_xa</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_support_xa</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global, Session</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">TRUE</code></td></tr></tbody></table></div><p>
          Enables <code class="literal">InnoDB</code> support for two-phase commit
          in XA transactions, causing an extra disk flush for
          transaction preparation. This setting is the default. The XA
          mechanism is used internally and is essential for any server
          that has its binary log turned on and is accepting changes to
          its data from more than one thread. If you turn it off,
          transactions can be written to the binary log in a different
          order from the one in which the live database is committing
          them. This can produce different data when the binary log is
          replayed in disaster recovery or on a replication slave. Do
          not turn it off on a replication master server unless you have
          an unusual setup where only one thread is able to change data.
        </p><p>
          For a server that is accepting data changes from only one
          thread, it is safe and recommended to turn off this option to
          improve performance for <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>
          tables. For example, you can turn it off on replication slaves
          where only the replication SQL thread is changing data.
        </p><p>
          You can also turn off this option if you do not need it for
          safe binary logging or replication, and you also do not use an
          external XA transaction manager.
        </p></li><li><p><a name="sysvar_innodb_sync_spin_loops"></a>
          <a class="indexterm" name="id1114908"></a>

          <a class="indexterm" name="id1114918"></a>

          <code class="literal">innodb_sync_spin_loops</code>
        </p><div class="informaltable"><table summary="Options for innodb_sync_spin_loops" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_sync_spin_loops=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_sync_spin_loops</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_sync_spin_loops"><code class="literal">innodb_sync_spin_loops</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_sync_spin_loops</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">30</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 4294967295</code></td></tr></tbody></table></div><p>
          The number of times a thread waits for an
          <code class="literal">InnoDB</code> mutex to be freed before the thread
          is suspended. The default value is 30.
        </p></li><li><p><a name="sysvar_innodb_table_locks"></a>
          <a class="indexterm" name="id1115165"></a>

          <a class="indexterm" name="id1115174"></a>

          <code class="literal">innodb_table_locks</code>
        </p><div class="informaltable"><table summary="Options for innodb_table_locks" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_table_locks</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_table_locks</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_table_locks</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global, Session</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">TRUE</code></td></tr></tbody></table></div><p>
          If <a href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>,
          <code class="literal">InnoDB</code> honors <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK
          TABLES</code></a>; MySQL does not return from <code class="literal">LOCK
          TABLES ... WRITE</code> until all other threads have
          released all their locks to the table. The default value of
          <a href="storage-engines.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks</code></a> is 1,
          which means that <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
          causes InnoDB to lock a table internally if
          <a href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>.
        </p><p>
          As of MySQL 5.5.3, <a href="storage-engines.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks =
          0</code></a> has no effect for tables locked explicitly with
          <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a>. It still has an effect for tables locked for
          read or write by
          <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a> implicitly (for example, through triggers) or
          by <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES
          ... READ</code></a>.
        </p></li><li><p><a name="sysvar_innodb_thread_concurrency"></a>
          <a class="indexterm" name="id1115479"></a>

          <a class="indexterm" name="id1115488"></a>

          <code class="literal">innodb_thread_concurrency</code>
        </p><div class="informaltable"><table summary="Options for innodb_thread_concurrency" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_thread_concurrency=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_thread_concurrency</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_thread_concurrency</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 1000</code></td></tr></tbody></table></div><p>
          <code class="literal">InnoDB</code> tries to keep the number of
          operating system threads concurrently inside
          <code class="literal">InnoDB</code> less than or equal to the limit
          given by this variable. Once the number of threads reaches
          this limit, additional threads are placed into a wait state
          within a FIFO queue for execution. Threads waiting for locks
          are not counted in the number of concurrently executing
          threads.
        </p><p>
          The correct value for this variable is dependent on
          environment and workload. Try a range of different values to
          determine what value works for your applications. A
          recommended value is 2 times the number of CPUs plus the
          number of disks.
        </p><p>
          The range of this variable is 0 to 1000. A value of 0 (the
          default) is interpreted as infinite concurrency (no
          concurrency checking). Disabling thread concurrency checking
          enables InnoDB to create as many threads as it needs.
        </p></li><li><p><a name="sysvar_innodb_thread_sleep_delay"></a>
          <a class="indexterm" name="id1115755"></a>

          <a class="indexterm" name="id1115764"></a>

          <code class="literal">innodb_thread_sleep_delay</code>
        </p><div class="informaltable"><table summary="Options for innodb_thread_sleep_delay" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_thread_sleep_delay=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_thread_sleep_delay</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_thread_sleep_delay</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">10000</code></td></tr></tbody></table></div><p>
          How long <code class="literal">InnoDB</code> threads sleep before
          joining the <code class="literal">InnoDB</code> queue, in microseconds.
          The default value is 10,000. A value of 0 disables sleep.
        </p></li><li><p><a name="sysvar_innodb_use_native_aio"></a>
          <a class="indexterm" name="id1116000"></a>

          <a class="indexterm" name="id1116009"></a>

          <code class="literal">innodb_use_native_aio</code>
        </p><div class="informaltable"><table summary="Options for innodb_use_native_aio" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Version Introduced</strong></span></td><td colspan="3">5.5.4</td></tr><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_use_native_aio=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_use_native_aio</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_use_native_aio</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table></div><p>
          Specifies whether to use the Linux asynchronous I/O subsystem.
          This variable applies to Linux systems only, and cannot be
          changed while the server is running.
        </p><p>
          Normally, you do not need to touch this option, because it is
          enabled by default. If a problem with the asynchronous I/O
          subsystem in the OS prevents <code class="literal">InnoDB</code> from
          starting, start the server with this variable disabled (use
          <a href="storage-engines.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio=0</code></a> in
          the option file). This option could also be turned off
          automatically during startup, if <code class="literal">InnoDB</code>
          detects a potential problem such as a combination of
          <code class="literal">tmpdir</code> location, <code class="literal">tmpfs</code>
          filesystem, and Linux kernel that that does not support AIO on
          <code class="literal">tmpfs</code>.
        </p><p>
          This variable was added in MySQL 5.5.4.
        </p></li><li><p><a name="sysvar_innodb_use_sys_malloc"></a>
          <a class="indexterm" name="id1116296"></a>

          <a class="indexterm" name="id1116305"></a>

          <code class="literal">innodb_use_sys_malloc</code>
        </p><div class="informaltable"><table summary="Options for innodb_use_sys_malloc" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_use_sys_malloc=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_use_sys_malloc</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_use_sys_malloc</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.6.3</td></tr><tr><td rowspan="3"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table></div><p>
          Whether <code class="literal">InnoDB</code> uses the operating system
          memory allocator (<code class="literal">ON</code>) or its own
          (<code class="literal">OFF</code>). The default value is
          <code class="literal">ON</code>.
        </p></li><li><p><a name="sysvar_innodb_version"></a>
          <a class="indexterm" name="id1116565"></a>

          <a class="indexterm" name="id1116574"></a>

          <code class="literal">innodb_version</code>
        </p><p>
          The <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> version number.
        </p></li><li><p><a name="sysvar_innodb_write_io_threads"></a>
          <a class="indexterm" name="id1116612"></a>

          <a class="indexterm" name="id1116621"></a>

          <code class="literal">innodb_write_io_threads</code>
        </p><div class="informaltable"><table summary="Options for innodb_write_io_threads" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_write_io_threads=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">innodb_write_io_threads</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="storage-engines.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">innodb_write_io_threads</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">No</td></tr><tr><td rowspan="4"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">4</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">1 .. 64</code></td></tr></tbody></table></div><p>
          The number of I/O threads for write operations in
          <code class="literal">InnoDB</code>. The default value is 4.
        </p></li><li><p>
          <a href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a>
        </p><div class="informaltable"><table summary="Options for sync_binlog" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--sync-binlog=#</code></td></tr><tr><td><span class="bold"><strong>Option-File Format</strong></span></td><td colspan="3"><code class="literal">sync_binlog</code></td></tr><tr><td><span class="bold"><strong>Option Sets Variable</strong></span></td><td colspan="3">Yes, <a href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a></td></tr><tr><td><span class="bold"><strong>Variable Name</strong></span></td><td colspan="3"><code class="literal">sync_binlog</code></td></tr><tr><td><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="3">Global</td></tr><tr><td><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="3">Yes</td></tr><tr><td rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Platform Bit Size</strong></span></td><td colspan="2"><code class="literal">32</code></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 4294967295</code></td></tr><tr><td rowspan="5"> </td><td colspan="3"><span class="bold"><strong>Permitted Values </strong></span></td></tr><tr><td><span class="bold"><strong>Platform Bit Size</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr><tr><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td><span class="bold"><strong>Range</strong></span></td><td colspan="2"><code class="literal">0 .. 18446744073709547520</code></td></tr></tbody></table></div><p>
          If the value of this variable is greater than 0, the MySQL
          server synchronizes its binary log to disk (using
          <code class="literal">fdatasync()</code>) after every
          <a href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a> writes to the
          binary log. There is one write to the binary log per statement
          if autocommit is enabled, and one write per transaction
          otherwise. The default value of
          <a href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a> is 0, which does
          no synchronizing to disk. A value of 1 is the safest choice,
          because in the event of a crash you lose at most one statement
          or transaction from the binary log. However, it is also the
          slowest choice (unless the disk has a battery-backed cache,
          which makes synchronization very fast).
        </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="using-innodb-tables"></a>13.3.5. Creating and Using <code class="literal">InnoDB</code> Tables</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-transactions-with-different-apis">13.3.5.1. Using <code class="literal">InnoDB</code> Transactions</a></span></dt><dt><span class="section"><a href="storage-engines.html#converting-tables-to-innodb">13.3.5.2. Converting Tables from Other Storage Engines to
        <code class="literal">InnoDB</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-auto-increment-handling">13.3.5.3. <code class="literal">AUTO_INCREMENT</code> Handling in <code class="literal">InnoDB</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-foreign-key-constraints">13.3.5.4. <code class="literal">FOREIGN KEY</code> Constraints</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-and-mysql-replication">13.3.5.5. <code class="literal">InnoDB</code> and MySQL Replication</a></span></dt></dl></div><a class="indexterm" name="id1117238"></a><p>
      To create an <code class="literal">InnoDB</code> table, specify an
      <code class="literal">ENGINE=InnoDB</code> option in the
      <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement:
    </p><pre class="programlisting">CREATE TABLE customers (a INT, b CHAR (20), INDEX (a)) ENGINE=InnoDB;</pre><p>
      The statement creates a table and an index on column
      <code class="literal">a</code> in the <code class="literal">InnoDB</code> tablespace
      that consists of the data files that you specified in
      <code class="filename">my.cnf</code>. In addition, MySQL creates a file
      <code class="filename">customers.frm</code> in the
      <code class="filename">test</code> directory under the MySQL database
      directory. Internally, <code class="literal">InnoDB</code> adds an entry for
      the table to its own data dictionary. The entry includes the
      database name. For example, if <code class="literal">test</code> is the
      database in which the <code class="literal">customers</code> table is
      created, the entry is for <code class="literal">'test/customers'</code>.
      This means you can create a table of the same name
      <code class="literal">customers</code> in some other database, and the table
      names do not collide inside <code class="literal">InnoDB</code>.
    </p><p>
      You can query the amount of free space in the
      <code class="literal">InnoDB</code> tablespace by issuing a
      <a href="sql-syntax.html#show-table-status" title="12.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> statement for any
      <code class="literal">InnoDB</code> table. The amount of free space in the
      tablespace appears in the <code class="literal">Data_free</code> section in
      the output of <a href="sql-syntax.html#show-table-status" title="12.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a>.
      For example:
    </p><pre class="programlisting">SHOW TABLE STATUS FROM test LIKE 'customers'</pre><p>
      The statistics <a href="sql-syntax.html#show" title="12.7.5. SHOW Syntax"><code class="literal">SHOW</code></a> displays for
      <code class="literal">InnoDB</code> tables are only approximate. They are
      used in SQL optimization. Table and index reserved sizes in bytes
      are accurate, though.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-transactions-with-different-apis"></a>13.3.5.1. Using <code class="literal">InnoDB</code> Transactions</h4></div></div></div><a class="indexterm" name="id1117427"></a><h5><a name="id1117439"></a>
        Transactions in SQL
      </h5><p>
        By default, each client that connects to the MySQL server begins
        with <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_autocommit" target="_top">autocommit</a> mode
        enabled, which automatically commits every SQL statement as you
        execute it. To use multiple-statement transactions, you can
        switch autocommit off with the SQL statement <code class="literal">SET
        autocommit = 0</code> and end each transaction with either
        <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
        <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>. If
        you want to leave autocommit on, you can begin your transactions
        within <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">START
        TRANSACTION</code></a> and end them with
        <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
        <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>. The
        following example shows two transactions. The first is
        committed; the second is rolled back.
      </p><pre class="programlisting">shell&gt; <strong class="userinput"><code>mysql test</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE customer (a INT, b CHAR (20), INDEX (a))</code></strong>
    -&gt; <strong class="userinput"><code>ENGINE=InnoDB;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>INSERT INTO customer VALUES (10, 'Heikki');</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>COMMIT;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>SET autocommit=0;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>INSERT INTO customer VALUES (15, 'John');</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>ROLLBACK;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>SELECT * FROM customer;</code></strong>
+------+--------+
| a    | b      |
+------+--------+
|   10 | Heikki |
+------+--------+
1 row in set (0.00 sec)
mysql&gt;
</pre><h5><a name="id1117571"></a>
        Transactions in Client-Side Languages
      </h5><p>
        In APIs such as PHP, Perl DBI, JDBC, ODBC, or the standard C
        call interface of MySQL, you can send transaction control
        statements such as <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">COMMIT</code></a> to the
        MySQL server as strings just like any other SQL statements such
        as <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> or
        <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>. Some APIs also offer
        separate special transaction commit and rollback functions or
        methods.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="converting-tables-to-innodb"></a>13.3.5.2. Converting Tables from Other Storage Engines to
        <code class="literal">InnoDB</code></h4></div></div></div><a class="indexterm" name="id1117616"></a><p>
        To convert a non-<code class="literal">InnoDB</code> table to use
        <code class="literal">InnoDB</code> use <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a>:
      </p><pre class="programlisting">ALTER TABLE <em class="replaceable"><code>table_name</code></em> ENGINE=InnoDB;
</pre><div xmlns="http://www.w3.org/1999/xhtml" class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Important</div><p xmlns="">
          Do not convert MySQL system tables in the
          <code class="literal">mysql</code> database (such as
          <code class="literal">user</code> or <code class="literal">host</code>) to the
          <code class="literal">InnoDB</code> type. This is an unsupported
          operation. The system tables must always be of the
          <code class="literal">MyISAM</code> type.
        </p></div><p>
        To make an InnoDB table that is a clone of a MyISAM table:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Create an empty <code class="literal">InnoDB</code> table with
            identical definitions.
          </p></li><li><p>
            Create the appropriate indexes.
          </p></li><li><p>
            Insert the rows with <code class="literal">INSERT INTO
            <em class="replaceable"><code>innodb_table</code></em> SELECT * FROM
            <em class="replaceable"><code>myisam_table</code></em></code>.
          </p></li></ul></div><p>
        You can also create the indexes after inserting the data.
        Historically, creating new secondary indexes was a slow
        operation for InnoDB, but this is no longer the case.
      </p><p>
        If you have <code class="literal">UNIQUE</code> constraints on secondary
        keys, you can speed up a table import by turning off the
        uniqueness checks temporarily during the import operation:
      </p><pre class="programlisting">SET unique_checks=0;<em class="replaceable"><code>... import operation ...</code></em>
SET unique_checks=1;
</pre><p>
        For big tables, this saves disk I/O because
        <code class="literal">InnoDB</code> can use its
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_insert_buffer" target="_top">insert buffer</a> to write
        secondary index records as a batch. Be certain that the data
        contains no duplicate keys.
        <a href="server-administration.html#sysvar_unique_checks"><code class="literal">unique_checks</code></a> permits but does
        not require storage engines to ignore duplicate keys.
      </p><p>
        To get better control over the insertion process, you might
        insert big tables in pieces:
      </p><pre class="programlisting">INSERT INTO newtable SELECT * FROM oldtable
   WHERE yourkey &gt; <em class="replaceable"><code>something</code></em> AND yourkey &lt;= <em class="replaceable"><code>somethingelse</code></em>;
</pre><p>
        After all records have been inserted, you can rename the tables.
      </p><p>
        During the conversion of big tables, increase the size of the
        <code class="literal">InnoDB</code> buffer pool to reduce disk I/O, to a
        maximum of 80% of physical memory. You can also increase the
        sizes of the <code class="literal">InnoDB</code> log files.
      </p><p>
        Make sure that you do not fill up the tablespace:
        <code class="literal">InnoDB</code> tables require a lot more disk space
        than <code class="literal">MyISAM</code> tables. If an
        <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation runs out of
        space, it starts a rollback, and that can take hours if it is
        disk-bound. For inserts, <code class="literal">InnoDB</code> uses the
        insert buffer to merge secondary index records to indexes in
        batches. That saves a lot of disk I/O. For rollback, no such
        mechanism is used, and the rollback can take 30 times longer
        than the insertion.
      </p><p>
        In the case of a runaway rollback, if you do not have valuable
        data in your database, it may be advisable to kill the database
        process rather than wait for millions of disk I/O operations to
        complete. For the complete procedure, see
        <a href="storage-engines.html#forcing-innodb-recovery" title="13.3.7.2. Forcing InnoDB Recovery">Section 13.3.7.2, “Forcing <code class="literal">InnoDB</code> Recovery”</a>.
      </p><p>
        If you want all new user-created tables to use the
        <code class="literal">InnoDB</code> storage engine, add the line
        <code class="literal">default-storage-engine=innodb</code> to the
        <code class="literal">[mysqld]</code> section of your server option file.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-auto-increment-handling"></a>13.3.5.3. <code class="literal">AUTO_INCREMENT</code> Handling in <code class="literal">InnoDB</code></h4></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-auto-increment-traditional">13.3.5.3.1. “<span class="quote">Traditional</span>” <code class="literal">InnoDB</code> Auto-Increment
          Locking</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-auto-increment-configurable">13.3.5.3.2. Configurable <code class="literal">InnoDB</code> Auto-Increment Locking</a></span></dt></dl></div><a class="indexterm" name="id1117921"></a><p>
        <code class="literal">InnoDB</code> provides an optimization that
        significantly improves scalability and performance of SQL
        statements that insert rows into tables with
        <code class="literal">AUTO_INCREMENT</code> columns. This section provides
        background information on the original
        (“<span class="quote">traditional</span>”) implementation of auto-increment
        locking in <code class="literal">InnoDB</code>, explains the configurable
        locking mechanism, documents the parameter for configuring the
        mechanism, and describes its behavior and interaction with
        replication.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-auto-increment-traditional"></a>13.3.5.3.1. “<span class="quote">Traditional</span>” <code class="literal">InnoDB</code> Auto-Increment
          Locking</h5></div></div></div><p>
          The original implementation of auto-increment handling in
          <code class="literal">InnoDB</code> uses the following strategy to
          prevent problems when using the binary log for statement-based
          replication or for certain recovery scenarios.
        </p><p>
          If you specify an <code class="literal">AUTO_INCREMENT</code> column for
          an <code class="literal">InnoDB</code> table, the table handle in the
          <code class="literal">InnoDB</code> data dictionary contains a special
          counter called the auto-increment counter that is used in
          assigning new values for the column. This counter is stored
          only in main memory, not on disk.
        </p><p>
          <code class="literal">InnoDB</code> uses the following algorithm to
          initialize the auto-increment counter for a table
          <code class="literal">t</code> that contains an
          <code class="literal">AUTO_INCREMENT</code> column named
          <code class="literal">ai_col</code>: After a server startup, for the
          first insert into a table <code class="literal">t</code>,
          <code class="literal">InnoDB</code> executes the equivalent of this
          statement:
        </p><pre class="programlisting">SELECT MAX(ai_col) FROM t FOR UPDATE;</pre><p>
          <code class="literal">InnoDB</code> increments the value retrieved by
          the statement and assigns it to the column and to the
          auto-increment counter for the table. By default, the value is
          incremented by one. This default can be overridden by the
          <a href="replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a>
          configuration setting.
        </p><p>
          If the table is empty, <code class="literal">InnoDB</code> uses the
          value <code class="literal">1</code>. This default can be overridden by
          the <a href="replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a>
          configuration setting.
        </p><p>
          If a <a href="sql-syntax.html#show-table-status" title="12.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a>
          statement examines the table <code class="literal">t</code> before the
          auto-increment counter is initialized,
          <code class="literal">InnoDB</code> initializes but does not increment
          the value and stores it for use by later inserts. This
          initialization uses a normal exclusive-locking read on the
          table and the lock lasts to the end of the transaction.
        </p><p>
          <code class="literal">InnoDB</code> follows the same procedure for
          initializing the auto-increment counter for a freshly created
          table.
        </p><p>
          After the auto-increment counter has been initialized, if a
          you do not explicitly specify a value for an
          <code class="literal">AUTO_INCREMENT</code> column,
          <code class="literal">InnoDB</code> increments the counter and assigns
          the new value to the column. If you insert a row that
          explicitly specifies the column value, and the value is bigger
          than the current counter value, the counter is set to the
          specified column value.
        </p><p>
          When accessing the auto-increment counter,
          <code class="literal">InnoDB</code> uses a special table-level
          <code class="literal">AUTO-INC</code> lock that it keeps to the end of
          the current SQL statement, not to the end of the transaction.
          The special lock release strategy was introduced to improve
          concurrency for inserts into a table containing an
          <code class="literal">AUTO_INCREMENT</code> column. Nevertheless, two
          transactions cannot have the <code class="literal">AUTO-INC</code> lock
          on the same table simultaneously, which can have a performance
          impact if the <code class="literal">AUTO-INC</code> lock is held for a
          long time. That might be the case for a statement such as
          <code class="literal">INSERT INTO t1 ... SELECT ... FROM t2</code> that
          inserts all rows from one table into another.
        </p><p>
          <code class="literal">InnoDB</code> uses the in-memory auto-increment
          counter as long as the server runs. When the server is stopped
          and restarted, <code class="literal">InnoDB</code> reinitializes the
          counter for each table for the first
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> to the table, as
          described earlier.
        </p><p>
          You may see gaps in the sequence of values assigned to the
          <code class="literal">AUTO_INCREMENT</code> column if you roll back
          transactions that have generated numbers using the counter.
        </p><p>
          If a user specifies <code class="literal">NULL</code> or
          <code class="literal">0</code> for the <code class="literal">AUTO_INCREMENT</code>
          column in an <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
          <code class="literal">InnoDB</code> treats the row as if the value was
          not specified and generates a new value for it.
        </p><p>
          The behavior of the auto-increment mechanism is not defined if
          you assign a negative value to the column, or if the value
          becomes bigger than the maximum integer that can be stored in
          the specified integer type.
        </p><p>
          An <code class="literal">AUTO_INCREMENT</code> column must appear as the
          first column in an index on an <code class="literal">InnoDB</code>
          table.
        </p><p>
          <code class="literal">InnoDB</code> supports the <code class="literal">AUTO_INCREMENT
          = <em class="replaceable"><code>N</code></em></code> table option in
          <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
          <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements, to set
          the initial counter value or alter the current counter value.
          The effect of this option is canceled by a server restart, for
          reasons discussed earlier in this section.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-auto-increment-configurable"></a>13.3.5.3.2. Configurable <code class="literal">InnoDB</code> Auto-Increment Locking</h5></div></div></div><p>
          As described in the previous section,
          <code class="literal">InnoDB</code> uses a special lock called the
          table-level <code class="literal">AUTO-INC</code> lock for inserts into
          tables with <code class="literal">AUTO_INCREMENT</code> columns. This
          lock is normally held to the end of the statement (not to the
          end of the transaction), to ensure that auto-increment numbers
          are assigned in a predictable and repeatable order for a given
          sequence of <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements.
        </p><p>
          In the case of statement-based replication, this means that
          when an SQL statement is replicated on a slave server, the
          same values are used for the auto-increment column as on the
          master server. The result of execution of multiple
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements is
          deterministic, and the slave reproduces the same data as on
          the master. If auto-increment values generated by multiple
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements were
          interleaved, the result of two concurrent
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements would be
          nondeterministic, and could not reliably be propagated to a
          slave server using statement-based replication.
        </p><p>
          To make this clear, consider an example that uses this table:
        </p><pre class="programlisting">CREATE TABLE t1 (
  c1 INT(11) NOT NULL AUTO_INCREMENT,
  c2 VARCHAR(10) DEFAULT NULL,
  PRIMARY KEY (c1)
) ENGINE=InnoDB;</pre><p>
          Suppose that there are two transactions running, each
          inserting rows into a table with an
          <code class="literal">AUTO_INCREMENT</code> column. One transaction is
          using an <a href="sql-syntax.html#insert-select" title="12.2.5.1. INSERT ...
        SELECT Syntax"><code class="literal">INSERT
          ... SELECT</code></a> statement that inserts 1000 rows, and
          another is using a simple
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement that inserts
          one row:
        </p><pre class="programlisting">Tx1: INSERT INTO t1 (c2) SELECT 1000 rows from another table ...
Tx2: INSERT INTO t1 (c2) VALUES ('xxx');</pre><p>
          <code class="literal">InnoDB</code> cannot tell in advance how many rows
          will be retrieved from the
          <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> in the
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement in Tx1, and it
          assigns the auto-increment values one at a time as the
          statement proceeds. With a table-level lock, held to the end
          of the statement, only one
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement referring to
          table <code class="literal">t1</code> can execute at a time, and the
          generation of auto-increment numbers by different statements
          is not interleaved. The auto-increment value generated by the
          Tx1 <a href="sql-syntax.html#insert-select" title="12.2.5.1. INSERT ...
        SELECT Syntax"><code class="literal">INSERT ...
          SELECT</code></a> statement will be consecutive, and the
          (single) auto-increment value used by the
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement in Tx2 will
          either be smaller or larger than all those used for Tx1,
          depending on which statement executes first.
        </p><p>
          As long as the SQL statements execute in the same order when
          replayed from the binary log (when using statement-based
          replication, or in recovery scenarios), the results will be
          the same as they were when Tx1 and Tx2 first ran. Thus,
          table-level locks held until the end of a statement make
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements using
          auto-increment safe for use with statement-based replication.
          However, those locks limit concurrency and scalability when
          multiple transactions are executing insert statements at the
          same time.
        </p><p>
          In the preceding example, if there were no table-level lock,
          the value of the auto-increment column used for the
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> in Tx2 depends on
          precisely when the statement executes. If the
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> of Tx2 executes while
          the <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> of Tx1 is running
          (rather than before it starts or after it completes), the
          specific auto-increment values assigned by the two
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements are
          nondeterministic, and may vary from run to run.
        </p><p>
          <code class="literal">InnoDB</code> can avoid using the table-level
          <code class="literal">AUTO-INC</code> lock for a class of
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements where the
          number of rows is known in advance, and still preserve
          deterministic execution and safety for statement-based
          replication. Further, if you are not using the binary log to
          replay SQL statements as part of recovery or replication, you
          can entirely eliminate use of the table-level
          <code class="literal">AUTO-INC</code> lock for even greater concurrency
          and performance—at the cost of permitting gaps in
          auto-increment numbers assigned by a statement and potentially
          having the numbers assigned by concurrently executing
          statements interleaved.
        </p><p>
          For <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements where the
          number of rows to be inserted is known at the beginning of
          processing the statement, <code class="literal">InnoDB</code> quickly
          allocates the required number of auto-increment values without
          taking any lock, but only if there is no concurrent session
          already holding the table-level <code class="literal">AUTO-INC</code>
          lock (because that other statement will be allocating
          auto-increment values one-by-one as it proceeds). More
          precisely, such an <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>
          statement obtains auto-increment values under the control of a
          mutex (a light-weight lock) that is <span class="emphasis"><em>not</em></span>
          held until the statement completes, but only for the duration
          of the allocation process.
        </p><p>
          This new locking scheme enables much greater scalability, but
          it does introduce some subtle differences in how
          auto-increment values are assigned compared to the original
          mechanism. To describe the way auto-increment works in
          <code class="literal">InnoDB</code>, the following discussion defines
          some terms, and explains how <code class="literal">InnoDB</code> behaves
          using different settings of the new
          <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
          configuration parameter. Additional considerations are
          described following the explanation of auto-increment locking
          behavior.
        </p><p>
          First, some definitions:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              “<span class="quote"><a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”
              statements
            </p><p>
              All statements that generate new rows in a table,
              including <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
              <a href="sql-syntax.html#insert-select" title="12.2.5.1. INSERT ...
        SELECT Syntax"><code class="literal">INSERT ...
              SELECT</code></a>, <a href="sql-syntax.html#replace" title="12.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a>,
              <a href="sql-syntax.html#replace" title="12.2.8. REPLACE Syntax"><code class="literal">REPLACE ...
              SELECT</code></a>, and <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD
              DATA</code></a>.
            </p></li><li><p>
              “<span class="quote">Simple inserts</span>”
            </p><p>
              Statements for which the number of rows to be inserted can
              be determined in advance (when the statement is initially
              processed). This includes single-row and multiple-row
              <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> and
              <a href="sql-syntax.html#replace" title="12.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a> statements that do
              not have a nested subquery, but not
              <a href="sql-syntax.html#insert-on-duplicate" title="12.2.5.3. INSERT ... ON
        DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
              ... ON DUPLICATE KEY UPDATE</code></a>.
            </p></li><li><p>
              “<span class="quote">Bulk inserts</span>”
            </p><p>
              Statements for which the number of rows to be inserted
              (and the number of required auto-increment values) is not
              known in advance. This includes
              <a href="sql-syntax.html#insert-select" title="12.2.5.1. INSERT ...
        SELECT Syntax"><code class="literal">INSERT ...
              SELECT</code></a>,
              <a href="sql-syntax.html#replace" title="12.2.8. REPLACE Syntax"><code class="literal">REPLACE ...
              SELECT</code></a>, and <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD
              DATA</code></a> statements, but not plain
              <code class="literal">INSERT</code>. <code class="literal">InnoDB</code> will
              assign new values for the
              <code class="literal">AUTO_INCREMENT</code> column one at a time as
              each row is processed.
            </p></li><li><p>
              “<span class="quote">Mixed-mode inserts</span>”
            </p><p>
              These are “<span class="quote">simple insert</span>” statements that
              specify the auto-increment value for some (but not all) of
              the new rows. An example follows, where
              <code class="literal">c1</code> is an
              <code class="literal">AUTO_INCREMENT</code> column of table
              <code class="literal">t1</code>:
            </p><pre class="programlisting">INSERT INTO t1 (c1,c2) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');</pre><p>
              Another type of “<span class="quote">mixed-mode insert</span>” is
              <a href="sql-syntax.html#insert-on-duplicate" title="12.2.5.3. INSERT ... ON
        DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
              ... ON DUPLICATE KEY UPDATE</code></a>, which in the worst
              case is in effect an <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>
              followed by a <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, where
              the allocated value for the
              <code class="literal">AUTO_INCREMENT</code> column may or may not be
              used during the update phase.
            </p></li></ul></div><p>
          In MySQL 5.5, there is a configuration parameter
          that controls how <code class="literal">InnoDB</code> uses locking when
          generating values for <code class="literal">AUTO_INCREMENT</code>
          columns. This parameter can be set using the
          <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="option">--innodb-autoinc-lock-mode</code></a>
          option at <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> startup.
        </p><p>
          In general, if you encounter problems with the way
          auto-increment works (which will most likely involve
          replication), you can force use of the original behavior by
          setting the lock mode to 0.
        </p><p>
          There are three possible settings for the
          <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
          parameter:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <code class="literal">innodb_autoinc_lock_mode = 0</code>
              (“<span class="quote">traditional</span>” lock mode)
            </p><p>
              This lock mode provides the same behavior as before
              <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
              existed. For all
              “<span class="quote"><a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”
              statements, a special table-level
              <code class="literal">AUTO-INC</code> lock is obtained and held to
              the end of the statement. This assures that the
              auto-increment values assigned by any given statement are
              consecutive (although “<span class="quote">gaps</span>” can exist within
              a table if a transaction that generated auto-increment
              values is rolled back, as discussed later).
            </p><p>
              This lock mode is provided only for backward compatibility
              and performance testing. There is little reason to use
              this lock mode unless you use “<span class="quote">mixed-mode
              inserts</span>” and care about the important difference in
              semantics described later.
            </p></li><li><p>
              <code class="literal">innodb_autoinc_lock_mode = 1</code>
              (“<span class="quote">consecutive</span>” lock mode)
            </p><p>
              This is the default lock mode. In this mode, “<span class="quote">bulk
              inserts</span>” use the special
              <code class="literal">AUTO-INC</code> table-level lock and hold it
              until the end of the statement. This applies to all
              <a href="sql-syntax.html#insert-select" title="12.2.5.1. INSERT ...
        SELECT Syntax"><code class="literal">INSERT ...
              SELECT</code></a>,
              <a href="sql-syntax.html#replace" title="12.2.8. REPLACE Syntax"><code class="literal">REPLACE ...
              SELECT</code></a>, and <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD
              DATA</code></a> statements. Only one statement holding the
              <code class="literal">AUTO-INC</code> lock can execute at a time.
            </p><p>
              With this lock mode, “<span class="quote">simple inserts</span>” (only)
              use a new locking model where a light-weight mutex is used
              during the allocation of auto-increment values, and no
              table-level <code class="literal">AUTO-INC</code> lock is used,
              unless an <code class="literal">AUTO-INC</code> lock is held by
              another transaction. If another transaction does hold an
              <code class="literal">AUTO-INC</code> lock, a “<span class="quote">simple
              insert</span>” waits for the <code class="literal">AUTO-INC</code>
              lock, as if it too were a “<span class="quote">bulk insert.</span>”
            </p><p>
              This lock mode ensures that, in the presence of
              <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statements where the
              number of rows is not known in advance (and where
              auto-increment numbers are assigned as the statement
              progresses), all auto-increment values assigned by any
              “<span class="quote"><a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”
              statement are consecutive, and operations are safe for
              statement-based replication.
            </p><p>
              Simply put, the important impact of this lock mode is
              significantly better scalability. This mode is safe for
              use with statement-based replication. Further, as with
              “<span class="quote">traditional</span>” lock mode, auto-increment
              numbers assigned by any given statement are
              <span class="emphasis"><em>consecutive</em></span>. In this mode, there is
              <span class="emphasis"><em>no change</em></span> in semantics compared to
              “<span class="quote">traditional</span>” mode for any statement that
              uses auto-increment, with one important exception.
            </p><p>
              The exception is for “<span class="quote">mixed-mode inserts</span>”,
              where the user provides explicit values for an
              <code class="literal">AUTO_INCREMENT</code> column for some, but not
              all, rows in a multiple-row “<span class="quote">simple insert.</span>”
              For such inserts, <code class="literal">InnoDB</code> will allocate
              more auto-increment values than the number of rows to be
              inserted. However, all values automatically assigned are
              consecutively generated (and thus higher than) the
              auto-increment value generated by the most recently
              executed previous statement. “<span class="quote">Excess</span>” numbers
              are lost.
            </p><p>
              A similar situation exists if you use
              <a href="sql-syntax.html#insert-on-duplicate" title="12.2.5.3. INSERT ... ON
        DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
              ... ON DUPLICATE KEY UPDATE</code></a>. This statement is
              also classified as a “<span class="quote">mixed-mode insert</span>”
              since an auto-increment value is not necessarily generated
              for each row. Because <code class="literal">InnoDB</code> allocates
              the auto-increment value before the insert is actually
              attempted, it cannot know whether an inserted value will
              be a duplicate of an existing value and thus cannot know
              whether the auto-increment value it generates will be used
              for a new row. Therefore, if you are using statement-based
              replication, either avoid
              <a href="sql-syntax.html#insert-on-duplicate" title="12.2.5.3. INSERT ... ON
        DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
              ... ON DUPLICATE KEY UPDATE</code></a> or use
              <code class="literal">innodb_autoinc_lock_mode = 0</code>
              (“<span class="quote">traditional</span>” lock mode).
            </p></li><li><p>
              <code class="literal">innodb_autoinc_lock_mode = 2</code>
              (“<span class="quote">interleaved</span>” lock mode)
            </p><p>
              In this lock mode, no
              “<span class="quote"><a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”
              statements use the table-level <code class="literal">AUTO-INC</code>
              lock, and multiple statements can execute at the same
              time. This is the fastest and most scalable lock mode, but
              it is <span class="emphasis"><em>not safe</em></span> when using
              statement-based replication or recovery scenarios when SQL
              statements are replayed from the binary log.
            </p><p>
              In this lock mode, auto-increment values are guaranteed to
              be unique and monotonically increasing across all
              concurrently executing
              “<span class="quote"><a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”
              statements. However, because multiple statements can be
              generating numbers at the same time (that is, allocation
              of numbers is <span class="emphasis"><em>interleaved</em></span> across
              statements), the values generated for the rows inserted by
              any given statement may not be consecutive.
            </p><p>
              If the only statements executing are “<span class="quote">simple
              inserts</span>” where the number of rows to be inserted is
              known ahead of time, there will be no gaps in the numbers
              generated for a single statement, except for
              “<span class="quote">mixed-mode inserts.</span>” However, when
              “<span class="quote">bulk inserts</span>” are executed, there may be
              gaps in the auto-increment values assigned by any given
              statement.
            </p></li></ul></div><p>
          The auto-increment locking modes provided by
          <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a> have
          several usage implications:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              Using auto-increment with replication
            </p><p>
              If you are using statement-based replication, set
              <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
              to 0 or 1 and use the same value on the master and its
              slaves. Auto-increment values are not ensured to be the
              same on the slaves as on the master if you use
              <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
              = 2 (“<span class="quote">interleaved</span>”) or configurations where
              the master and slaves do not use the same lock mode.
            </p><p>
              If you are using row-based replication, all of the
              auto-increment lock modes are safe. Row-based replication
              is not sensitive to the order of execution of the SQL
              statements.
            </p></li><li><p>
              “<span class="quote">Lost</span>” auto-increment values and sequence
              gaps
            </p><p>
              In all lock modes (0, 1, and 2), if a transaction that
              generated auto-increment values rolls back, those
              auto-increment values are “<span class="quote">lost.</span>” Once a
              value is generated for an auto-increment column, it cannot
              be rolled back, whether or not the
              “<span class="quote"><a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”
              statement is completed, and whether or not the containing
              transaction is rolled back. Such lost values are not
              reused. Thus, there may be gaps in the values stored in an
              <code class="literal">AUTO_INCREMENT</code> column of a table.
            </p></li><li><p>
              Gaps in auto-increment values for “<span class="quote">bulk
              inserts</span>”
            </p><p>
              With
              <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
              set to 0 (“<span class="quote">traditional</span>”) or 1
              (“<span class="quote">consecutive</span>”), the auto-increment values
              generated by any given statement will be consecutive,
              without gaps, because the table-level
              <code class="literal">AUTO-INC</code> lock is held until the end of
              the statement, and only one such statement can execute at
              a time.
            </p><p>
              With
              <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
              set to 2 (“<span class="quote">interleaved</span>”), there may be gaps
              in the auto-increment values generated by “<span class="quote">bulk
              inserts,</span>” but only if there are concurrently
              executing
              “<span class="quote"><a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”
              statements.
            </p><p>
              For lock modes 1 or 2, gaps may occur between successive
              statements because for bulk inserts the exact number of
              auto-increment values required by each statement may not
              be known and overestimation is possible.
            </p></li><li><p>
              Auto-increment values assigned by “<span class="quote">mixed-mode
              inserts</span>”
            </p><p>
              Consider a “<span class="quote">mixed-mode insert,</span>” where a
              “<span class="quote">simple insert</span>” specifies the auto-increment
              value for some (but not all) resulting rows. Such a
              statement will behave differently in lock modes 0, 1, and
              2. For example, assume <code class="literal">c1</code> is an
              <code class="literal">AUTO_INCREMENT</code> column of table
              <code class="literal">t1</code>, and that the most recent
              automatically generated sequence number is 100. Consider
              the following “<span class="quote">mixed-mode insert</span>” statement:
            </p><pre class="programlisting">INSERT INTO t1 (c1,c2) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');</pre><p>
              With
              <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
              set to 0 (“<span class="quote">traditional</span>”), the four new rows
              will be:
            </p><pre class="programlisting">
+-----+------+
| c1  | c2   |
+-----+------+
|   1 | a    |
| 101 | b    |
|   5 | c    |
| 102 | d    |
+-----+------+</pre><p>
              The next available auto-increment value will be 103
              because the auto-increment values are allocated one at a
              time, not all at once at the beginning of statement
              execution. This result is true whether or not there are
              concurrently executing
              “<span class="quote"><a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”
              statements (of any type).
            </p><p>
              With
              <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
              set to 1 (“<span class="quote">consecutive</span>”), the four new rows
              will also be:
            </p><pre class="programlisting">+-----+------+
| c1  | c2   |
+-----+------+
|   1 | a    |
| 101 | b    |
|   5 | c    |
| 102 | d    |
+-----+------+</pre><p>
              However, in this case, the next available auto-increment
              value will be 105, not 103 because four auto-increment
              values are allocated at the time the statement is
              processed, but only two are used. This result is true
              whether or not there are concurrently executing
              “<span class="quote"><a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”
              statements (of any type).
            </p><p>
              With
              <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
              set to mode 2 (“<span class="quote">interleaved</span>”), the four new
              rows will be:
            </p><pre class="programlisting">+-----+------+
| c1  | c2   |
+-----+------+
|   1 | a    |
|   <em class="replaceable"><code>x</code></em> | b    |
|   5 | c    |
|   <em class="replaceable"><code>y</code></em> | d    |
+-----+------+
</pre><p>
              The values of <em class="replaceable"><code>x</code></em> and
              <em class="replaceable"><code>y</code></em> will be unique and larger
              than any previously generated rows. However, the specific
              values of <em class="replaceable"><code>x</code></em> and
              <em class="replaceable"><code>y</code></em> will depend on the number of
              auto-increment values generated by concurrently executing
              statements.
            </p><p>
              Finally, consider the following statement, issued when the
              most-recently generated sequence number was the value 4:
            </p><pre class="programlisting">INSERT INTO t1 (c1,c2) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');</pre><p>
              With any
              <a href="storage-engines.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
              setting, this statement will generate a duplicate-key
              error 23000 (<code class="literal">Can't write; duplicate key in
              table</code>) because 5 will be allocated for the row
              <code class="literal">(NULL, 'b')</code> and insertion of the row
              <code class="literal">(5, 'c')</code> will fail.
            </p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-foreign-key-constraints"></a>13.3.5.4. <code class="literal">FOREIGN KEY</code> Constraints</h4></div></div></div><a class="indexterm" name="id1119688"></a><a class="indexterm" name="id1119701"></a><p>
        <code class="literal">InnoDB</code> supports foreign key constraints. The
        syntax for a foreign key constraint definition in
        <code class="literal">InnoDB</code> looks like this:
      </p><pre class="programlisting">[CONSTRAINT [<em class="replaceable"><code>symbol</code></em>]] FOREIGN KEY
    [<em class="replaceable"><code>index_name</code></em>] (<em class="replaceable"><code>index_col_name</code></em>, ...)
    REFERENCES <em class="replaceable"><code>tbl_name</code></em> (<em class="replaceable"><code>index_col_name</code></em>,...)
    [ON DELETE <em class="replaceable"><code>reference_option</code></em>]
    [ON UPDATE <em class="replaceable"><code>reference_option</code></em>]

<em class="replaceable"><code>reference_option</code></em>:
    RESTRICT | CASCADE | SET NULL | NO ACTION
</pre><p>
        <em class="replaceable"><code>index_name</code></em> represents a foreign key
        ID. If given, this is ignored if an index for the foreign key is
        defined explicitly. Otherwise, if <code class="literal">InnoDB</code>
        creates an index for the foreign key, it uses
        <em class="replaceable"><code>index_name</code></em> for the index name.
      </p><p>
        Foreign keys definitions are subject to the following
        conditions:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Both tables must be <code class="literal">InnoDB</code> tables and
            they must not be <code class="literal">TEMPORARY</code> tables.
          </p></li><li><p>
            Corresponding columns in the foreign key and the referenced
            key must have similar internal data types inside
            <code class="literal">InnoDB</code> so that they can be compared
            without a type conversion. <span class="emphasis"><em>The size and sign of
            integer types must be the same</em></span>. The length of
            string types need not be the same. For nonbinary (character)
            string columns, the character set and collation must be the
            same.
          </p></li><li><p>
            <code class="literal">InnoDB</code> requires indexes on foreign keys
            and referenced keys so that foreign key checks can be fast
            and not require a table scan. In the referencing table,
            there must be an index where the foreign key columns are
            listed as the <span class="emphasis"><em>first</em></span> columns in the same
            order. Such an index is created on the referencing table
            automatically if it does not exist. This index might be
            silently dropped later, if you create another index that can
            be used to enforce the foreign key constraint.
            <em class="replaceable"><code>index_name</code></em>, if given, is used as
            described previously.
          </p></li><li><p>
            <code class="literal">InnoDB</code> permits a foreign key to reference
            any index column or group of columns. However, in the
            referenced table, there must be an index where the
            referenced columns are listed as the
            <span class="emphasis"><em>first</em></span> columns in the same order.
          </p></li><li><p>
            Index prefixes on foreign key columns are not supported. One
            consequence of this is that
            <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> and
            <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a> columns cannot be
            included in a foreign key because indexes on those columns
            must always include a prefix length.
          </p></li><li><p>
            If the <code class="literal">CONSTRAINT
            <em class="replaceable"><code>symbol</code></em></code> clause is given,
            the <em class="replaceable"><code>symbol</code></em> value must be unique
            in the database. If the clause is not given,
            <code class="literal">InnoDB</code> creates the name automatically.
          </p></li></ul></div><p>
        <code class="literal">InnoDB</code> rejects any
        <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> or
        <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> operation that attempts to
        create a foreign key value in a child table if there is no a
        matching candidate key value in the parent table. When an
        <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> or
        <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> operation affects a key
        value in the parent table that has matching rows in the child
        table, the result depends on the <span class="emphasis"><em>referential
        action</em></span> specified using <code class="literal">ON UPDATE</code>
        and <code class="literal">ON DELETE</code> subclauses of the
        <code class="literal">FOREIGN KEY</code> clause. <code class="literal">InnoDB</code>
        supports five options regarding the action to be taken. If
        <code class="literal">ON DELETE</code> or <code class="literal">ON UPDATE</code> are
        not specified, the default action is
        <code class="literal">RESTRICT</code>.
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <code class="literal">CASCADE</code>: Delete or update the row from
            the parent table, and automatically delete or update the
            matching rows in the child table. Both <code class="literal">ON DELETE
            CASCADE</code> and <code class="literal">ON UPDATE CASCADE</code>
            are supported. Between two tables, do not define several
            <code class="literal">ON UPDATE CASCADE</code> clauses that act on the
            same column in the parent table or in the child table.
          </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
              Currently, cascaded foreign key actions do not activate
              triggers.
            </p></div></li><li><p>
            <code class="literal">SET NULL</code>: Delete or update the row from
            the parent table, and set the foreign key column or columns
            in the child table to <code class="literal">NULL</code>. Both
            <code class="literal">ON DELETE SET NULL</code> and <code class="literal">ON UPDATE
            SET NULL</code> clauses are supported.
          </p><p>
            If you specify a <code class="literal">SET NULL</code> action,
            <span class="emphasis"><em>make sure that you have not declared the columns
            in the child table as <code class="literal">NOT
            NULL</code></em></span>.
          </p></li><li><p>
            <code class="literal">RESTRICT</code>: Rejects the delete or update
            operation for the parent table. Specifying
            <code class="literal">RESTRICT</code> (or <code class="literal">NO
            ACTION</code>) is the same as omitting the <code class="literal">ON
            DELETE</code> or <code class="literal">ON UPDATE</code> clause.
          </p></li><li><p>
            <code class="literal">NO ACTION</code>: A keyword from standard SQL.
            In MySQL, equivalent to <code class="literal">RESTRICT</code>.
            <code class="literal">InnoDB</code> rejects the delete or update
            operation for the parent table if there is a related foreign
            key value in the referenced table. Some database systems
            have deferred checks, and <code class="literal">NO ACTION</code> is a
            deferred check. In MySQL, foreign key constraints are
            checked immediately, so <code class="literal">NO ACTION</code> is the
            same as <code class="literal">RESTRICT</code>.
          </p></li><li><p>
            <code class="literal">SET DEFAULT</code>: This action is recognized by
            the parser, but <code class="literal">InnoDB</code> rejects table
            definitions containing <code class="literal">ON DELETE SET
            DEFAULT</code> or <code class="literal">ON UPDATE SET
            DEFAULT</code> clauses.
          </p></li></ul></div><p>
        <code class="literal">InnoDB</code> supports foreign key references
        between one column and another within a table. (A column cannot
        have a foreign key reference to itself.) In these cases,
        “<span class="quote">child table records</span>” really refers to dependent
        records within the same table.
      </p><h5><a name="id1120258"></a>
        Examples of Foreign Key Clauses
      </h5><p>
        Here is a simple example that relates <code class="literal">parent</code>
        and <code class="literal">child</code> tables through a single-column
        foreign key:
      </p><pre class="programlisting">CREATE TABLE parent (id INT NOT NULL,
                     PRIMARY KEY (id)
) ENGINE=INNODB;
CREATE TABLE child (id INT, parent_id INT,
                    INDEX par_ind (parent_id),
                    FOREIGN KEY (parent_id) REFERENCES parent(id)
                      ON DELETE CASCADE
) ENGINE=INNODB;</pre><p>
        A more complex example in which a
        <code class="literal">product_order</code> table has foreign keys for two
        other tables. One foreign key references a two-column index in
        the <code class="literal">product</code> table. The other references a
        single-column index in the <code class="literal">customer</code> table:
      </p><pre class="programlisting">CREATE TABLE product (category INT NOT NULL, id INT NOT NULL,
                      price DECIMAL,
                      PRIMARY KEY(category, id)) ENGINE=INNODB;
CREATE TABLE customer (id INT NOT NULL,
                       PRIMARY KEY (id)) ENGINE=INNODB;
CREATE TABLE product_order (no INT NOT NULL AUTO_INCREMENT,
                            product_category INT NOT NULL,
                            product_id INT NOT NULL,
                            customer_id INT NOT NULL,
                            PRIMARY KEY(no),
                            INDEX (product_category, product_id),
                            FOREIGN KEY (product_category, product_id)
                              REFERENCES product(category, id)
                              ON UPDATE CASCADE ON DELETE RESTRICT,
                            INDEX (customer_id),
                            FOREIGN KEY (customer_id)
                              REFERENCES customer(id)) ENGINE=INNODB;</pre><p>
        <code class="literal">InnoDB</code> enables you to add a new foreign key
        constraint to a table by using <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a>:
      </p><pre class="programlisting">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em>
    ADD [CONSTRAINT [<em class="replaceable"><code>symbol</code></em>]] FOREIGN KEY
    [<em class="replaceable"><code>index_name</code></em>] (<em class="replaceable"><code>index_col_name</code></em>, ...)
    REFERENCES <em class="replaceable"><code>tbl_name</code></em> (<em class="replaceable"><code>index_col_name</code></em>,...)
    [ON DELETE <em class="replaceable"><code>reference_option</code></em>]
    [ON UPDATE <em class="replaceable"><code>reference_option</code></em>]
</pre><p>
        The foreign key can be self referential (referring to the same
        table). When you add a foreign key constraint to a table using
        <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, <span class="emphasis"><em>remember
        to create the required indexes first.</em></span>
      </p><a class="indexterm" name="id1120394"></a><a class="indexterm" name="id1120403"></a><a class="indexterm" name="id1120415"></a><h5><a name="id1120428"></a>
        Foreign Keys and ALTER TABLE
      </h5><p>
        <code class="literal">InnoDB</code> supports the use of
        <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to drop foreign keys:
      </p><pre class="programlisting">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> DROP FOREIGN KEY <em class="replaceable"><code>fk_symbol</code></em>;
</pre><p>
        If the <code class="literal">FOREIGN KEY</code> clause included a
        <code class="literal">CONSTRAINT</code> name when you created the foreign
        key, you can refer to that name to drop the foreign key.
        Otherwise, the <em class="replaceable"><code>fk_symbol</code></em> value is
        internally generated by <code class="literal">InnoDB</code> when the
        foreign key is created. To find out the symbol value when you
        want to drop a foreign key, use the <a href="sql-syntax.html#show-create-table" title="12.7.5.12. SHOW CREATE TABLE Syntax"><code class="literal">SHOW
        CREATE TABLE</code></a> statement. For example:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW CREATE TABLE ibtest11c\G</code></strong>
*************************** 1. row ***************************
       Table: ibtest11c
Create Table: CREATE TABLE `ibtest11c` (
  `A` int(11) NOT NULL auto_increment,
  `D` int(11) NOT NULL default '0',
  `B` varchar(200) NOT NULL default '',
  `C` varchar(175) default NULL,
  PRIMARY KEY  (`A`,`D`,`B`),
  KEY `B` (`B`,`C`),
  KEY `C` (`C`),
  CONSTRAINT `0_38775` FOREIGN KEY (`A`, `D`)
REFERENCES `ibtest11a` (`A`, `D`)
ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `0_38776` FOREIGN KEY (`B`, `C`)
REFERENCES `ibtest11a` (`B`, `C`)
ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=INNODB CHARSET=latin1
1 row in set (0.01 sec)

mysql&gt; <strong class="userinput"><code>ALTER TABLE ibtest11c DROP FOREIGN KEY `0_38775`;</code></strong>
</pre><p>
        You cannot add a foreign key and drop a foreign key in separate
        clauses of a single <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
        statement. Separate statements are required.
      </p><p>
        If <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> for an
        <code class="literal">InnoDB</code> table results in changes to column
        values (for example, because a column is truncated),
        <code class="literal">InnoDB</code>'s <code class="literal">FOREIGN KEY</code>
        constraint checks do not notice possible violations caused by
        changing the values.
      </p><h5><a name="id1120565"></a>
        How Foreign Keys Work with Other MySQL Command
      </h5><p>
        The <code class="literal">InnoDB</code> parser permits table and column
        identifiers in a <code class="literal">FOREIGN KEY ... REFERENCES
        ...</code> clause to be quoted within backticks.
        (Alternatively, double quotation marks can be used if the
        <a href="server-administration.html#sqlmode_ansi_quotes"><code class="literal">ANSI_QUOTES</code></a> SQL mode is
        enabled.) The <code class="literal">InnoDB</code> parser also takes into
        account the setting of the
        <a href="server-administration.html#sysvar_lower_case_table_names"><code class="literal">lower_case_table_names</code></a> system
        variable.
      </p><p>
        <code class="literal">InnoDB</code> returns a table's foreign key
        definitions as part of the output of the
        <a href="sql-syntax.html#show-create-table" title="12.7.5.12. SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE TABLE</code></a> statement:
      </p><pre class="programlisting">SHOW CREATE TABLE <em class="replaceable"><code>tbl_name</code></em>;
</pre><p>
        <a href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span><strong class="command">mysqldump</strong></span></a> also produces correct definitions
        of tables in the dump file, and does not forget about the
        foreign keys.
      </p><p>
        To make it easier to reload dump files for tables that have
        foreign key relationships, <a href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span><strong class="command">mysqldump</strong></span></a>
        automatically includes a statement in the dump output to set
        <a href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a> to 0. This
        avoids problems with tables having to be reloaded in a
        particular order when the dump is reloaded. It is also possible
        to set this variable manually:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET foreign_key_checks = 0;</code></strong>
mysql&gt; <strong class="userinput"><code>SOURCE <em class="replaceable"><code>dump_file_name</code></em>;</code></strong>
mysql&gt; <strong class="userinput"><code>SET foreign_key_checks = 1;</code></strong>
</pre><p>
        This enables you to import the tables in any order if the dump
        file contains tables that are not correctly ordered for foreign
        keys. It also speeds up the import operation. Setting
        <a href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a> to 0 can
        also be useful for ignoring foreign key constraints during
        <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD DATA</code></a> and
        <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operations. However,
        even if <a href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks = 0</code></a>,
        InnoDB does not permit the creation of a foreign key constraint
        where a column references a nonmatching column type. Also, if an
        <code class="literal">InnoDB</code> table has foreign key constraints,
        <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> cannot be used to
        change the table to use another storage engine. To alter the
        storage engine, drop any foreign key constraints first.
      </p><p>
        <code class="literal">InnoDB</code> does not permit you to drop a table
        that is referenced by a <code class="literal">FOREIGN KEY</code>
        constraint, unless you do <code class="literal">SET foreign_key_checks =
        0</code>. When you drop a table, the constraints that were
        defined in its create statement are also dropped.
      </p><p>
        If you re-create a table that was dropped, it must have a
        definition that conforms to the foreign key constraints
        referencing it. It must have the right column names and types,
        and it must have indexes on the referenced keys, as stated
        earlier. If these are not satisfied, MySQL returns error number
        1005 and refers to error 150 in the error message.
      </p><p>
        If MySQL reports an error number 1005 from a
        <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement, and the
        error message refers to error 150, table creation failed because
        a foreign key constraint was not correctly formed. Similarly, if
        an <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> fails and it
        refers to error 150, that means a foreign key definition would
        be incorrectly formed for the altered table. You can use
        <a href="sql-syntax.html#show-engine" title="12.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> to display a detailed explanation of the most
        recent <code class="literal">InnoDB</code> foreign key error in the
        server.
      </p><div xmlns="http://www.w3.org/1999/xhtml" class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Important</div><p xmlns="">
          For users familiar with the ANSI/ISO SQL Standard, please note
          that no storage engine, including <code class="literal">InnoDB</code>,
          recognizes or enforces the <code class="literal">MATCH</code> clause
          used in referential-integrity constraint definitions. Use of
          an explicit <code class="literal">MATCH</code> clause will not have the
          specified effect, and also causes <code class="literal">ON DELETE</code>
          and <code class="literal">ON UPDATE</code> clauses to be ignored. For
          these reasons, specifying <code class="literal">MATCH</code> should be
          avoided.
        </p><p xmlns="">
          The <code class="literal">MATCH</code> clause in the SQL standard
          controls how <code class="literal">NULL</code> values in a composite
          (multiple-column) foreign key are handled when comparing to a
          primary key. <code class="literal">InnoDB</code> essentially implements
          the semantics defined by <code class="literal">MATCH SIMPLE</code>,
          which permit a foreign key to be all or partially
          <code class="literal">NULL</code>. In that case, the (child table) row
          containing such a foreign key is permitted to be inserted, and
          does not match any row in the referenced (parent) table. It is
          possible to implement other semantics using triggers.
        </p><p xmlns="">
          Additionally, MySQL and <code class="literal">InnoDB</code> require that
          the referenced columns be indexed for performance. However,
          the system does not enforce a requirement that the referenced
          columns be <code class="literal">UNIQUE</code> or be declared
          <code class="literal">NOT NULL</code>. The handling of foreign key
          references to nonunique keys or keys that contain
          <code class="literal">NULL</code> values is not well defined for
          operations such as <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> or
          <code class="literal">DELETE CASCADE</code>. You are advised to use
          foreign keys that reference only <code class="literal">UNIQUE</code> and
          <code class="literal">NOT NULL</code> keys.
        </p><p xmlns="">
          Furthermore, <code class="literal">InnoDB</code> does not recognize or
          support “<span class="quote">inline <code class="literal">REFERENCES</code>
          specifications</span>” (as defined in the SQL standard) where
          the references are defined as part of the column
          specification. <code class="literal">InnoDB</code> accepts
          <code class="literal">REFERENCES</code> clauses only when specified as
          part of a separate <code class="literal">FOREIGN KEY</code>
          specification. For other storage engines, MySQL Server parses
          and ignores foreign key specifications.
        </p></div><p>
        <span class="bold"><strong>Deviation from SQL standards</strong></span>:
        If there are several rows in the parent table that have the same
        referenced key value, <code class="literal">InnoDB</code> acts in foreign
        key checks as if the other parent rows with the same key value
        do not exist. For example, if you have defined a
        <code class="literal">RESTRICT</code> type constraint, and there is a
        child row with several parent rows, <code class="literal">InnoDB</code>
        does not permit the deletion of any of those parent rows.
      </p><p>
        <code class="literal">InnoDB</code> performs cascading operations through
        a depth-first algorithm, based on records in the indexes
        corresponding to the foreign key constraints.
      </p><p>
        <span class="bold"><strong>Deviation from SQL standards</strong></span>: A
        <code class="literal">FOREIGN KEY</code> constraint that references a
        non-<code class="literal">UNIQUE</code> key is not standard SQL. It is an
        <code class="literal">InnoDB</code> extension to standard SQL.
      </p><p>
        <span class="bold"><strong>Deviation from SQL standards</strong></span>:
        If <code class="literal">ON UPDATE CASCADE</code> or <code class="literal">ON UPDATE
        SET NULL</code> recurses to update the <span class="emphasis"><em>same
        table</em></span> it has previously updated during the cascade,
        it acts like <code class="literal">RESTRICT</code>. This means that you
        cannot use self-referential <code class="literal">ON UPDATE CASCADE</code>
        or <code class="literal">ON UPDATE SET NULL</code> operations. This is to
        prevent infinite loops resulting from cascaded updates. A
        self-referential <code class="literal">ON DELETE SET NULL</code>, on the
        other hand, is possible, as is a self-referential <code class="literal">ON
        DELETE CASCADE</code>. Cascading operations may not be nested
        more than 15 levels deep.
      </p><p>
        <span class="bold"><strong>Deviation from SQL standards</strong></span>:
        Like MySQL in general, in an SQL statement that inserts,
        deletes, or updates many rows, <code class="literal">InnoDB</code> checks
        <code class="literal">UNIQUE</code> and <code class="literal">FOREIGN KEY</code>
        constraints row-by-row. When performing foreign key checks,
        <code class="literal">InnoDB</code> sets shared row-level locks on child
        or parent records it has to look at. <code class="literal">InnoDB</code>
        checks foreign key constraints immediately; the check is not
        deferred to transaction commit. According to the SQL standard,
        the default behavior should be deferred checking. That is,
        constraints are only checked after the <span class="emphasis"><em>entire SQL
        statement</em></span> has been processed. Until
        <code class="literal">InnoDB</code> implements deferred constraint
        checking, some things will be impossible, such as deleting a
        record that refers to itself using a foreign key.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-and-mysql-replication"></a>13.3.5.5. <code class="literal">InnoDB</code> and MySQL Replication</h4></div></div></div><a class="indexterm" name="id1121179"></a><p>
        MySQL replication works for <code class="literal">InnoDB</code> tables as
        it does for <code class="literal">MyISAM</code> tables. It is also
        possible to use replication in a way where the storage engine on
        the slave is not the same as the original storage engine on the
        master. For example, you can replicate modifications to an
        <code class="literal">InnoDB</code> table on the master to a
        <code class="literal">MyISAM</code> table on the slave.
      </p><p>
        To set up a new slave for a master, you have to make a copy of
        the <code class="literal">InnoDB</code> tablespace and the log files, as
        well as the <code class="filename">.frm</code> files of the
        <code class="literal">InnoDB</code> tables, and move the copies to the
        slave. If the
        <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> variable
        is enabled, copy the <code class="filename">.ibd</code> files as well.
        For the proper procedure to do this, see
        <a href="storage-engines.html#innodb-backup" title="13.3.7. Backing Up and Recovering an InnoDB
      Database">Section 13.3.7, “Backing Up and Recovering an <code class="literal">InnoDB</code>
      Database”</a>.
      </p><p>
        If you can shut down the master or an existing slave, you can
        take a cold backup of the <code class="literal">InnoDB</code> tablespace
        and log files and use that to set up a slave. To make a new
        slave without taking down any server you can also use the MySQL
        Enterprise Backup product.
      </p><p>
        Transactions that fail on the master do not affect replication
        at all. MySQL replication is based on the binary log where MySQL
        writes SQL statements that modify data. A transaction that fails
        (for example, because of a foreign key violation, or because it
        is rolled back) is not written to the binary log, so it is not
        sent to slaves. See <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax">Section 12.3.1, “<code class="literal">START TRANSACTION</code>,
      <code class="literal">COMMIT</code>, and
      <code class="literal">ROLLBACK</code> Syntax”</a>.
      </p><p><b>Replication and <code class="literal">CASCADE</code>. </b>
          Cascading actions for <code class="literal">InnoDB</code> tables on the
          master are replicated on the slave <span class="emphasis"><em>only</em></span>
          if the tables sharing the foreign key relation use
          <code class="literal">InnoDB</code> on both the master and slave. This
          is true whether you are using statement-based or row-based
          replication. Suppose that you have started replication, and
          then create two tables on the master using the following
          <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements:
        </p><pre class="programlisting">CREATE TABLE fc1 (
    i INT PRIMARY KEY,
    j INT
) ENGINE = InnoDB;

CREATE TABLE fc2 (
    m INT PRIMARY KEY,
    n INT,
    FOREIGN KEY ni (n) REFERENCES fc1 (i)
        ON DELETE CASCADE
) ENGINE = InnoDB;</pre><p>
        Suppose that the slave does not have <code class="literal">InnoDB</code>
        support enabled. If this is the case, then the tables on the
        slave are created, but they use the <code class="literal">MyISAM</code>
        storage engine, and the <code class="literal">FOREIGN KEY</code> option is
        ignored. Now we insert some rows into the tables on the master:
      </p><pre class="programlisting">master&gt; <strong class="userinput"><code>INSERT INTO fc1 VALUES (1, 1), (2, 2);</code></strong>
Query OK, 2 rows affected (0.09 sec)
Records: 2  Duplicates: 0  Warnings: 0

master&gt; <strong class="userinput"><code>INSERT INTO fc2 VALUES (1, 1), (2, 2), (3, 1);</code></strong>
Query OK, 3 rows affected (0.19 sec)
Records: 3  Duplicates: 0  Warnings: 0
</pre><p>
        At this point, on both the master and the slave, table
        <code class="literal">fc1</code> contains 2 rows, and table
        <code class="literal">fc2</code> contains 3 rows, as shown here:
      </p><pre class="programlisting">master&gt; <strong class="userinput"><code>SELECT * FROM fc1;</code></strong>
+---+------+
| i | j    |
+---+------+
| 1 |    1 |
| 2 |    2 |
+---+------+
2 rows in set (0.00 sec)

master&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+------+
| m | n    |
+---+------+
| 1 |    1 |
| 2 |    2 |
| 3 |    1 |
+---+------+
3 rows in set (0.00 sec)

slave&gt; <strong class="userinput"><code>SELECT * FROM fc1;</code></strong>
+---+------+
| i | j    |
+---+------+
| 1 |    1 |
| 2 |    2 |
+---+------+
2 rows in set (0.00 sec)

slave&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+------+
| m | n    |
+---+------+
| 1 |    1 |
| 2 |    2 |
| 3 |    1 |
+---+------+
3 rows in set (0.00 sec)
</pre><p>
        Now suppose that you perform the following
        <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> statement on the master:
      </p><pre class="programlisting">master&gt; <strong class="userinput"><code>DELETE FROM fc1 WHERE i=1;</code></strong>
Query OK, 1 row affected (0.09 sec)
</pre><p>
        Due to the cascade, table <code class="literal">fc2</code> on the master
        now contains only 1 row:
      </p><pre class="programlisting">master&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+---+
| m | n |
+---+---+
| 2 | 2 |
+---+---+
1 row in set (0.00 sec)
</pre><p>
        However, the cascade does not propagate on the slave because on
        the slave the <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> for
        <code class="literal">fc1</code> deletes no rows from
        <code class="literal">fc2</code>. The slave's copy of
        <code class="literal">fc2</code> still contains all of the rows that were
        originally inserted:
      </p><pre class="programlisting">slave&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+---+
| m | n |
+---+---+
| 1 | 1 |
| 3 | 1 |
| 2 | 2 |
+---+---+
3 rows in set (0.00 sec)
</pre><p>
        This difference is due to the fact that the cascading deletes
        are handled internally by the <code class="literal">InnoDB</code> storage
        engine, which means that none of the changes are logged.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-data-log-reconfiguration"></a>13.3.6. Adding, Removing, or Resizing <code class="literal">InnoDB</code> Data and Log
      Files</h3></div></div></div><a class="indexterm" name="id1121542"></a><a class="indexterm" name="id1121555"></a><p>
      This section describes what you can do when your
      <code class="literal">InnoDB</code> tablespace runs out of room or when you
      want to change the size of the log files.
    </p><p>
      The easiest way to increase the size of the
      <code class="literal">InnoDB</code> tablespace is to configure it from the
      beginning to be auto-extending. Specify the
      <code class="literal">autoextend</code> attribute for the last data file in
      the tablespace definition. Then <code class="literal">InnoDB</code>
      increases the size of that file automatically in 8MB increments
      when it runs out of space. The increment size can be changed by
      setting the value of the
      <a href="storage-engines.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
      system variable, which is measured in MB.
    </p><p>
      Alternatively, you can increase the size of your tablespace by
      adding another data file. To do this, you have to shut down the
      MySQL server, change the tablespace configuration to add a new
      data file to the end of
      <a href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>, and start
      the server again.
    </p><p>
      If your last data file was defined with the keyword
      <code class="literal">autoextend</code>, the procedure for reconfiguring the
      tablespace must take into account the size to which the last data
      file has grown. Obtain the size of the data file, round it down to
      the closest multiple of 1024 × 1024 bytes (= 1MB), and
      specify the rounded size explicitly in
      <a href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>. Then you
      can add another data file. Remember that only the last data file
      in the <a href="storage-engines.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> can
      be specified as auto-extending.
    </p><p>
      As an example, assume that the tablespace has just one
      auto-extending data file <code class="filename">ibdata1</code>:
    </p><pre class="programlisting">innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:10M:autoextend</pre><p>
      Suppose that this data file, over time, has grown to 988MB. Here
      is the configuration line after modifying the original data file
      to not be auto-extending and adding another auto-extending data
      file:
    </p><pre class="programlisting">innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:988M;/disk2/ibdata2:50M:autoextend</pre><p>
      When you add a new file to the tablespace configuration, make sure
      that it does not exist. <code class="literal">InnoDB</code> will create and
      initialize the file when you restart the server.
    </p><p>
      Currently, you cannot remove a data file from the tablespace. To
      decrease the size of your tablespace, use this procedure:
    </p><div class="orderedlist"><ol type="1"><li><p>
          Use <a href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span><strong class="command">mysqldump</strong></span></a> to dump all your
          <code class="literal">InnoDB</code> tables.
        </p></li><li><p>
          Stop the server.
        </p></li><li><p>
          Remove all the existing tablespace files, including the
          <code class="filename">ibdata</code> and <code class="filename">ib_log</code>
          files. If you want to keep a backup copy of the information,
          then copy all the <code class="filename">ib*</code> files to another
          location before the removing the files in your MySQL
          installation.
        </p></li><li><p>
          Remove any <code class="filename">.frm</code> files for
          <code class="literal">InnoDB</code> tables.
        </p></li><li><p>
          Configure a new tablespace.
        </p></li><li><p>
          Restart the server.
        </p></li><li><p>
          Import the dump files.
        </p></li></ol></div><p>
      If you want to change the number or the size of your
      <code class="literal">InnoDB</code> log files, use the following
      instructions. The procedure to use depends on the value of
      <a href="storage-engines.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a>:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          If <a href="storage-engines.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> is
          not set to 2: Stop the MySQL server and make sure that it
          shuts down without errors (to ensure that there is no
          information for outstanding transactions in the log). Copy the
          old log files into a safe place in case something went wrong
          during the shutdown and you need them to recover the
          tablespace. Delete the old log files from the log file
          directory, edit <code class="filename">my.cnf</code> to change the log
          file configuration, and start the MySQL server again.
          <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> sees that no
          <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> log files exist at startup
          and creates new ones.
        </p></li><li><p>
          If <a href="storage-engines.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> is
          set to 2: Set
          <a href="storage-engines.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> to 1:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_fast_shutdown = 1;</code></strong>
</pre><p>
          Then follow the instructions in the previous item.
        </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-backup"></a>13.3.7. Backing Up and Recovering an <code class="literal">InnoDB</code>
      Database</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-recovery">13.3.7.1. The <code class="literal">InnoDB</code> Recovery Process</a></span></dt><dt><span class="section"><a href="storage-engines.html#forcing-innodb-recovery">13.3.7.2. Forcing <code class="literal">InnoDB</code> Recovery</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-checkpoints">13.3.7.3. <code class="literal">InnoDB</code> Checkpoints</a></span></dt></dl></div><a class="indexterm" name="id1121905"></a><a class="indexterm" name="id1121918"></a><p>
      The key to safe database management is making regular backups.
      Depending on your data volume, number of MySQL servers, and
      database workload, you can use these techniques, alone or in
      combination: <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_hot_backup" target="_top">hot backup</a>
      with MySQL Enterprise Backup;
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_cold_backup" target="_top">cold backup</a> by copying
      files while the MySQL server is shut down;
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_physical_backup" target="_top">physical backup</a> for
      fast operation (especially for restore);
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_logical_backup" target="_top">logical backup</a> with
      <a href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span><strong class="command">mysqldump</strong></span></a> for smaller data volumes or to record
      the structure of schema objects.
    </p><h4><a name="id1121970"></a>
      Hot Backups
    </h4><p>
      The <span><strong class="command">mysqlbackup</strong></span> command, part of the MySQL
      Enterprise Backup component, lets you back up a running MySQL
      instance, including <code class="literal">InnoDB</code> and
      <a href="storage-engines.html#myisam-storage-engine" title="13.5. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> tables, with minimal
      disruption to operations while producing a consistent snapshot of
      the database. When <span><strong class="command">mysqlbackup</strong></span> is copying
      <code class="literal">InnoDB</code> tables, reads and writes to both
      <code class="literal">InnoDB</code> and <a href="storage-engines.html#myisam-storage-engine" title="13.5. The MyISAM Storage Engine"><code class="literal">MyISAM</code></a>
      tables can continue. During the copying of
      <code class="literal">MyISAM</code> tables, reads (but not writes) to those
      tables are permitted. MySQL Enterprise Backup can also create
      compressed backup files, and back up subsets of tables and
      databases. In conjunction with MySQL’s binary log, users can
      perform point-in-time recovery. MySQL Enterprise Backup is part of
      the MySQL Enterprise subscription. For more details, see
      <a href="mysql-enterprise-backup.html" title="Chapter 24. MySQL Enterprise Backup">Chapter 24, <i>MySQL Enterprise Backup</i></a>.
    </p><h4><a name="id1122040"></a>
      Cold Backups
    </h4><p>
      If you can shut down your MySQL server, you can make a binary
      backup that consists of all files used by
      <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> to manage its tables. Use the
      following procedure:
    </p><div class="orderedlist"><ol type="1"><li><p>
          Do a <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_slow_shutdown" target="_top">slow shutdown</a>
          of the MySQL server and make sure that it stops without
          errors.
        </p></li><li><p>
          Copy all <code class="literal">InnoDB</code> data files
          (<code class="filename">ibdata</code> files and
          <code class="filename">.ibd</code> files) into a safe place.
        </p></li><li><p>
          Copy all the <code class="filename">.frm</code> files for
          <code class="literal">InnoDB</code> tables to a safe place.
        </p></li><li><p>
          Copy all <code class="literal">InnoDB</code> log files
          (<code class="filename">ib_logfile</code> files) to a safe place.
        </p></li><li><p>
          Copy your <code class="filename">my.cnf</code> configuration file or
          files to a safe place.
        </p></li></ol></div><h4><a name="id1122153"></a>
      Alternative Backup Types
    </h4><p>
      In addition to making binary backups as just described, regularly
      make dumps of your tables with <a href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span><strong class="command">mysqldump</strong></span></a>. A
      binary file might be corrupted without you noticing it. Dumped
      tables are stored into text files that are human-readable, so
      spotting table corruption becomes easier. Also, because the format
      is simpler, the chance for serious data corruption is smaller.
      <a href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span><strong class="command">mysqldump</strong></span></a> also has a
      <a href="programs.html#option_mysqldump_single-transaction"><code class="option">--single-transaction</code></a> option for
      making a consistent snapshot without locking out other clients.
      See <a href="backup-and-recovery.html#backup-policy" title="6.3.1. Establishing a Backup Policy">Section 6.3.1, “Establishing a Backup Policy”</a>.
    </p><p>
      Replication works with <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> tables,
      so you can use MySQL replication capabilities to keep a copy of
      your database at database sites requiring high availability.
    </p><h4><a name="id1122201"></a>
      Performing Recovery
    </h4><p>
      To recover your <code class="literal">InnoDB</code> database to the present
      from the time at which the binary backup was made, you must run
      your MySQL server with binary logging turned on, even before
      taking the backup. To achieve point-in-time recovery after
      restoring a backup, you can apply changes from the binary log that
      occurred after the backup was made. See
      <a href="backup-and-recovery.html#point-in-time-recovery" title="6.5. Point-in-Time (Incremental) Recovery Using the Binary Log">Section 6.5, “Point-in-Time (Incremental) Recovery Using the Binary Log”</a>.
    </p><p>
      To recover from a crash of your MySQL server, the only requirement
      is to restart it. <code class="literal">InnoDB</code> automatically checks
      the logs and performs a roll-forward of the database to the
      present. <code class="literal">InnoDB</code> automatically rolls back
      uncommitted transactions that were present at the time of the
      crash. During recovery, <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> displays output
      something like this:
    </p><pre class="programlisting">InnoDB: Database was not shut down normally.
InnoDB: Starting recovery from log files...
InnoDB: Starting log scan based on checkpoint at
InnoDB: log sequence number 0 13674004
InnoDB: Doing recovery: scanned up to log sequence number 0 13739520
InnoDB: Doing recovery: scanned up to log sequence number 0 13805056
InnoDB: Doing recovery: scanned up to log sequence number 0 13870592
InnoDB: Doing recovery: scanned up to log sequence number 0 13936128
...
InnoDB: Doing recovery: scanned up to log sequence number 0 20555264
InnoDB: Doing recovery: scanned up to log sequence number 0 20620800
InnoDB: Doing recovery: scanned up to log sequence number 0 20664692
InnoDB: 1 uncommitted transaction(s) which must be rolled back
InnoDB: Starting rollback of uncommitted transactions
InnoDB: Rolling back trx no 16745
InnoDB: Rolling back of trx no 16745 completed
InnoDB: Rollback of uncommitted transactions completed
InnoDB: Starting an apply batch of log records to the database...
InnoDB: Apply batch completed
InnoDB: Started
mysqld: ready for connections</pre><p>
      If your database becomes corrupted or disk failure occurs, you
      must perform the recovery using a backup. In the case of
      corruption, first find a backup that is not corrupted. After
      restoring the base backup, do a point-in-time recovery from the
      binary log files using <a href="programs.html#mysqlbinlog" title="4.6.7. mysqlbinlog — Utility for Processing Binary Log Files"><span><strong class="command">mysqlbinlog</strong></span></a> and
      <a href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span><strong class="command">mysql</strong></span></a> to restore the changes that occurred
      after the backup was made.
    </p><a class="indexterm" name="id1122285"></a><a class="indexterm" name="id1122297"></a><a class="indexterm" name="id1122309"></a><p>
      In some cases of database corruption it is enough just to dump,
      drop, and re-create one or a few corrupt tables. You can use the
      <a href="sql-syntax.html#check-table" title="12.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> SQL statement to check
      whether a table is corrupt, although <a href="sql-syntax.html#check-table" title="12.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK
      TABLE</code></a> naturally cannot detect every possible kind of
      corruption. You can use the Tablespace Monitor to check the
      integrity of the file space management inside the tablespace
      files.
    </p><p>
      In some cases, apparent database page corruption is actually due
      to the operating system corrupting its own file cache, and the
      data on disk may be okay. It is best first to try restarting your
      computer. Doing so may eliminate errors that appeared to be
      database page corruption.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-recovery"></a>13.3.7.1. The <code class="literal">InnoDB</code> Recovery Process</h4></div></div></div><a class="indexterm" name="id1122362"></a><p>
        <code class="literal">InnoDB</code> crash recovery consists of several
        steps. The first step, redo log application, is performed during
        the initialization, before accepting any connections. If all
        changes were flushed from the buffer pool to the tablespaces
        (<code class="filename">ibdata*</code> and <code class="filename">*.ibd</code>
        files) at the time of the shutdown or crash, the redo log
        application can be skipped. If the redo log files are missing at
        startup, <code class="literal">InnoDB</code> skips the redo log
        application.
      </p><p>
        The remaining steps after redo log application do not depend on
        the redo log (other than for logging the writes) and are
        performed in parallel with normal processing. These include:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Rolling back incomplete transactions: Any transactions that
            were active at the time of crash or fast shutdown.
          </p></li><li><p>
            Insert buffer merge: Applying changes from the insert buffer
            tree (from the shared tablespace) to leaf pages of secondary
            indexes as the index pages are read to the buffer pool.
          </p></li><li><p>
            Purge: Deleting delete-marked records that are no longer
            visible for any active transaction.
          </p></li></ul></div><p>
        Of these, only rollback of incomplete transactions is special to
        crash recovery. The insert buffer merge and the purge are
        performed during normal processing.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="forcing-innodb-recovery"></a>13.3.7.2. Forcing <code class="literal">InnoDB</code> Recovery</h4></div></div></div><a class="indexterm" name="id1122457"></a><p>
        If there is database page corruption, you may want to dump your
        tables from the database with
        <a href="sql-syntax.html#select-into" title="12.2.9.1. SELECT ... INTO
        Syntax"><code class="literal">SELECT ... INTO
        OUTFILE</code></a>. Usually, most of the data obtained in this
        way is intact. However, it is possible that the corruption might
        cause <code class="literal">SELECT * FROM
        <em class="replaceable"><code>tbl_name</code></em></code> statements or
        <code class="literal">InnoDB</code> background operations to crash or
        assert, or even cause <code class="literal">InnoDB</code> roll-forward
        recovery to crash. In such cases, you can use the
        <a href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> option to
        force the <code class="literal">InnoDB</code> storage engine to start up
        while preventing background operations from running, so that you
        can dump your tables. For example, you can add the following
        line to the <code class="literal">[mysqld]</code> section of your option
        file before restarting the server:
      </p><pre class="programlisting">[mysqld]
innodb_force_recovery = 4</pre><p>
        <a href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> is 0 by
        default (normal startup without forced recovery). The
        permissible nonzero values for
        <a href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> follow. A
        larger number includes all precautions of smaller numbers. If
        you can dump your tables with an option value of at most 4, then
        you are relatively safe that only some data on corrupt
        individual pages is lost. A value of 6 is more drastic because
        database pages are left in an obsolete state, which in turn may
        introduce more corruption into B-trees and other database
        structures.
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <code class="literal">1</code>
            (<code class="literal">SRV_FORCE_IGNORE_CORRUPT</code>)
          </p><p>
            Let the server run even if it detects a corrupt page. Try to
            make <code class="literal">SELECT * FROM
            <em class="replaceable"><code>tbl_name</code></em></code> jump over
            corrupt index records and pages, which helps in dumping
            tables.
          </p></li><li><p>
            <code class="literal">2</code>
            (<code class="literal">SRV_FORCE_NO_BACKGROUND</code>)
          </p><p>
            Prevent the main thread from running. If a crash would occur
            during the purge operation, this recovery value prevents it.
          </p></li><li><p>
            <code class="literal">3</code>
            (<code class="literal">SRV_FORCE_NO_TRX_UNDO</code>)
          </p><p>
            Do not run transaction rollbacks after recovery.
          </p></li><li><p>
            <code class="literal">4</code>
            (<code class="literal">SRV_FORCE_NO_IBUF_MERGE</code>)
          </p><p>
            Prevent insert buffer merge operations. If they would cause
            a crash, do not do them. Do not calculate table statistics.
          </p></li><li><p>
            <code class="literal">5</code>
            (<code class="literal">SRV_FORCE_NO_UNDO_LOG_SCAN</code>)
          </p><p>
            Do not look at undo logs when starting the database:
            <code class="literal">InnoDB</code> treats even incomplete
            transactions as committed.
          </p></li><li><p>
            <code class="literal">6</code>
            (<code class="literal">SRV_FORCE_NO_LOG_REDO</code>)
          </p><p>
            Do not do the log roll-forward in connection with recovery.
          </p><p>
            With this value, you might not be able to do queries other
            than a basic <code class="literal">SELECT * FROM t</code>, with no
            <code class="literal">WHERE</code>, <code class="literal">ORDER BY</code>, or
            other clauses. More complex queries could encounter
            corrupted data structures and fail.
          </p><p>
            If corruption within the table data prevents you from
            dumping the entire table contents, a query with an
            <code class="literal">ORDER BY <em class="replaceable"><code>primary_key</code></em>
            DESC</code> clause might be able to dump the portion of
            the table after the corrupted part.
          </p></li></ul></div><p>
        <span class="emphasis"><em>The database must not otherwise be used with any
        nonzero value of
        <a href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a></em></span>.
        As a safety measure, <code class="literal">InnoDB</code> prevents users
        from performing <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
        <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> operations when
        <a href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> is
        greater than 0.
      </p><p>
        You can <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> from tables to
        dump them, or <code class="literal">DROP</code> or
        <code class="literal">CREATE</code> tables even if forced recovery is
        used. If you know that a given table is causing a crash on
        rollback, you can drop it. You can also use this to stop a
        runaway rollback caused by a failing mass import or
        <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>. You can kill the
        <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> process and set
        <a href="storage-engines.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> to
        <code class="literal">3</code> to bring the database up without the
        rollback, then <code class="literal">DROP</code> the table that is causing
        the runaway rollback.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-checkpoints"></a>13.3.7.3. <code class="literal">InnoDB</code> Checkpoints</h4></div></div></div><a class="indexterm" name="id1122872"></a><p>
        Making your log files very large may reduce disk I/O during
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_checkpoint" target="_top">checkpointing</a>. It often
        makes sense to set the total size of the log files as large as
        the buffer pool or even larger. Although in the past large log
        files could make crash recovery take excessive time, starting
        with MySQL 5.5, performance enhancements to crash recovery make
        it possible to use large log files with fast startup after a
        crash. (Strictly speaking, this performance improvement is
        available for MySQL 5.1 with the InnoDB Plugin 1.0.7 and higher.
        It is with MySQL 5.5 and InnoDB 1.1 that this improvement is
        available in the default InnoDB storage engine.)
      </p><h5><a name="id1122900"></a>
        How Checkpoint Processing Works
      </h5><p>
        <code class="literal">InnoDB</code> implements a checkpoint mechanism
        known as “<span class="quote">fuzzy</span>” checkpointing.
        <code class="literal">InnoDB</code> flushes modified database pages from
        the buffer pool in small batches. There is no need to flush the
        buffer pool in one single batch, which would in practice stop
        processing of user SQL statements during the checkpointing
        process.
      </p><p>
        During crash recovery, <code class="literal">InnoDB</code> looks for a
        checkpoint label written to the log files. It knows that all
        modifications to the database before the label are present in
        the disk image of the database. Then <code class="literal">InnoDB</code>
        scans the log files forward from the checkpoint, applying the
        logged modifications to the database.
      </p><p>
        <code class="literal">InnoDB</code> writes to its log files on a rotating
        basis. It also writes checkpoint information to the first log
        file at each checkpoint. All committed modifications that make
        the database pages in the buffer pool different from the images
        on disk must be available in the log files in case
        <code class="literal">InnoDB</code> has to do a recovery. This means that
        when <code class="literal">InnoDB</code> starts to reuse a log file, it
        has to make sure that the database page images on disk contain
        the modifications logged in the log file that
        <code class="literal">InnoDB</code> is going to reuse. In other words,
        <code class="literal">InnoDB</code> must create a checkpoint and this
        often involves flushing of modified database pages to disk.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-migration"></a>13.3.8. Moving an <code class="literal">InnoDB</code> Database to Another Machine</h3></div></div></div><a class="indexterm" name="id1122998"></a><p>
      On Windows, <code class="literal">InnoDB</code> always stores database and
      table names internally in lowercase. To move databases in a binary
      format from Unix to Windows or from Windows to Unix, create all
      databases and tables using lowercase names. A convenient way to
      accomplish this is to add the following line to the
      <code class="literal">[mysqld]</code> section of your
      <code class="filename">my.cnf</code> or <code class="filename">my.ini</code> file
      before creating any databases or tables:
    </p><pre class="programlisting">[mysqld]
lower_case_table_names=1</pre><p>
      Like <code class="literal">MyISAM</code> data files,
      <code class="literal">InnoDB</code> data and log files are binary-compatible
      on all platforms having the same floating-point number format. You
      can move an <code class="literal">InnoDB</code> database simply by copying
      all the relevant files listed in <a href="storage-engines.html#innodb-backup" title="13.3.7. Backing Up and Recovering an InnoDB
      Database">Section 13.3.7, “Backing Up and Recovering an <code class="literal">InnoDB</code>
      Database”</a>.
      If the floating-point formats differ but you have not used
      <a href="data-types.html#numeric-types" title="10.2. Numeric Types"><code class="literal">FLOAT</code></a> or
      <a href="data-types.html#numeric-types" title="10.2. Numeric Types"><code class="literal">DOUBLE</code></a> data types in your tables,
      then the procedure is the same: simply copy the relevant files. If
      you use <a href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span><strong class="command">mysqldump</strong></span></a> to dump your tables on one
      machine and then import the dump files on the other machine, it
      does not matter whether the formats differ or your tables contain
      floating-point data.
    </p><p>
      One way to increase performance is to switch off autocommit mode
      when importing data, assuming that the tablespace has enough space
      for the big rollback segment that the import transactions
      generate. Do the commit only after importing a whole table or a
      segment of a table.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-transaction-model"></a>13.3.9. The <code class="literal">InnoDB</code> Transaction Model and Locking</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-lock-modes">13.3.9.1. <code class="literal">InnoDB</code> Lock Modes</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-consistent-read">13.3.9.2. Consistent Nonlocking Reads</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-locking-reads">13.3.9.3. <code class="literal">SELECT ... FOR UPDATE</code>
        and <code class="literal">SELECT ... LOCK IN
        SHARE MODE</code> Locking Reads</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-record-level-locks">13.3.9.4. <code class="literal">InnoDB</code> Record, Gap, and Next-Key Locks</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-next-key-locking">13.3.9.5. Avoiding the Phantom Problem Using Next-Key Locking</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-locks-set">13.3.9.6. Locks Set by Different SQL Statements in <code class="literal">InnoDB</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-implicit-commit">13.3.9.7. Implicit Transaction Commit and Rollback</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-deadlock-detection">13.3.9.8. Deadlock Detection and Rollback</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-deadlocks">13.3.9.9. How to Cope with Deadlocks</a></span></dt></dl></div><a class="indexterm" name="id1123119"></a><a class="indexterm" name="id1123131"></a><p>
      To implement a large-scale, busy, or highly reliable database
      application, to port substantial code from a different database
      system, or to push MySQL performance to the limits of the laws of
      physics, you must understand the notions of
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_transaction" target="_top">transactions</a> and
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_locking" target="_top">locking</a> as they relate to the
      InnoDB storage engine.
    </p><p>
      In the <code class="literal">InnoDB</code> transaction model, the goal is to
      combine the best properties of a multi-versioning database with
      traditional two-phase locking. <code class="literal">InnoDB</code> does
      locking on the row level and runs queries as nonlocking consistent
      reads by default, in the style of Oracle. The lock information in
      <code class="literal">InnoDB</code> is stored so space-efficiently that lock
      escalation is not needed: Typically, several users are permitted
      to lock every row in <code class="literal">InnoDB</code> tables, or any
      random subset of the rows, without causing
      <code class="literal">InnoDB</code> memory exhaustion.
    </p><p>
      In <code class="literal">InnoDB</code>, all user activity occurs inside a
      transaction. If autocommit mode is enabled, each SQL statement
      forms a single transaction on its own. By default, MySQL starts
      the session for each new connection with autocommit enabled, so
      MySQL does a commit after each SQL statement if that statement did
      not return an error. If a statement returns an error, the commit
      or rollback behavior depends on the error. See
      <a href="storage-engines.html#innodb-error-handling" title="13.3.13. InnoDB Error Handling">Section 13.3.13, “<code class="literal">InnoDB</code> Error Handling”</a>.
    </p><p>
      A session that has autocommit enabled can perform a
      multiple-statement transaction by starting it with an explicit
      <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">START
      TRANSACTION</code></a> or
      <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">BEGIN</code></a> statement
      and ending it with a <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
      <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
      statement. See <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax">Section 12.3.1, “<code class="literal">START TRANSACTION</code>,
      <code class="literal">COMMIT</code>, and
      <code class="literal">ROLLBACK</code> Syntax”</a>.
    </p><p>
      If autocommit mode is disabled within a session with <code class="literal">SET
      autocommit = 0</code>, the session always has a transaction
      open. A <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
      <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
      statement ends the current transaction and a new one starts.
    </p><p>
      A <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">COMMIT</code></a> means that the changes
      made in the current transaction are made permanent and become
      visible to other sessions. A
      <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
      statement, on the other hand, cancels all modifications made by
      the current transaction. Both
      <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">COMMIT</code></a> and
      <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> release
      all <code class="literal">InnoDB</code> locks that were set during the
      current transaction.
    </p><a class="indexterm" name="id1123320"></a><p>
      In terms of the SQL:1992 transaction isolation levels, the default
      <code class="literal">InnoDB</code> level is
      <a href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>.
      <code class="literal">InnoDB</code> offers all four transaction isolation
      levels described by the SQL standard:
      <a href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>,
      <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>,
      <a href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>, and
      <a href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>.
    </p><p>
      A user can change the isolation level for a single session or for
      all subsequent connections with the <a href="sql-syntax.html#set-transaction" title="12.3.6. SET TRANSACTION Syntax"><code class="literal">SET
      TRANSACTION</code></a> statement. To set the server's default
      isolation level for all connections, use the
      <a href="server-administration.html#option_mysqld_transaction-isolation"><code class="option">--transaction-isolation</code></a> option on
      the command line or in an option file. For detailed information
      about isolation levels and level-setting syntax, see
      <a href="sql-syntax.html#set-transaction" title="12.3.6. SET TRANSACTION Syntax">Section 12.3.6, “<code class="literal">SET TRANSACTION</code> Syntax”</a>.
    </p><a class="indexterm" name="id1123410"></a><a class="indexterm" name="id1123422"></a><a class="indexterm" name="id1123434"></a><a class="indexterm" name="id1123447"></a><a class="indexterm" name="id1123459"></a><a class="indexterm" name="id1123472"></a><a class="indexterm" name="id1123484"></a><a class="indexterm" name="id1123496"></a><p>
      In row-level locking, <code class="literal">InnoDB</code> normally uses
      next-key locking. That means that besides index records,
      <code class="literal">InnoDB</code> can also lock the “<span class="quote">gap</span>”
      preceding an index record to block insertions by other sessions in
      the gap immediately before the index record. A next-key lock
      refers to a lock that locks an index record and the gap before it.
      A gap lock refers to a lock that locks only the gap before some
      index record.
    </p><p>
      For more information about row-level locking, and the
      circumstances under which gap locking is disabled, see
      <a href="storage-engines.html#innodb-record-level-locks" title="13.3.9.4. InnoDB Record, Gap, and Next-Key Locks">Section 13.3.9.4, “<code class="literal">InnoDB</code> Record, Gap, and Next-Key Locks”</a>.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-lock-modes"></a>13.3.9.1. <code class="literal">InnoDB</code> Lock Modes</h4></div></div></div><a class="indexterm" name="id1123553"></a><p>
        <code class="literal">InnoDB</code> implements standard row-level locking
        where there are two types of locks:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            A shared (<em class="replaceable"><code>S</code></em>) lock permits a
            transaction to read a row.
          </p></li><li><p>
            An exclusive (<em class="replaceable"><code>X</code></em>) lock permits a
            transaction to update or delete a row.
          </p></li></ul></div><p>
        If transaction <code class="literal">T1</code> holds a shared
        (<em class="replaceable"><code>S</code></em>) lock on row <code class="literal">r</code>,
        then requests from some distinct transaction
        <code class="literal">T2</code> for a lock on row <code class="literal">r</code> are
        handled as follows:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            A request by <code class="literal">T2</code> for an
            <em class="replaceable"><code>S</code></em> lock can be granted
            immediately. As a result, both <code class="literal">T1</code> and
            <code class="literal">T2</code> hold an <em class="replaceable"><code>S</code></em>
            lock on <code class="literal">r</code>.
          </p></li><li><p>
            A request by <code class="literal">T2</code> for an
            <em class="replaceable"><code>X</code></em> lock cannot be granted
            immediately.
          </p></li></ul></div><p>
        If a transaction <code class="literal">T1</code> holds an exclusive
        (<em class="replaceable"><code>X</code></em>) lock on row <code class="literal">r</code>,
        a request from some distinct transaction <code class="literal">T2</code>
        for a lock of either type on <code class="literal">r</code> cannot be
        granted immediately. Instead, transaction <code class="literal">T2</code>
        has to wait for transaction <code class="literal">T1</code> to release its
        lock on row <code class="literal">r</code>.
      </p><p>
        Additionally, <code class="literal">InnoDB</code> supports
        <span class="emphasis"><em>multiple granularity locking</em></span> which permits
        coexistence of record locks and locks on entire tables. To make
        locking at multiple granularity levels practical, additional
        types of locks called <span class="emphasis"><em>intention locks</em></span> are
        used. Intention locks are table locks in
        <code class="literal">InnoDB</code>. The idea behind intention locks is
        for a transaction to indicate which type of lock (shared or
        exclusive) it will require later for a row in that table. There
        are two types of intention locks used in
        <code class="literal">InnoDB</code> (assume that transaction
        <code class="literal">T</code> has requested a lock of the indicated type
        on table <code class="literal">t</code>):
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Intention shared (<em class="replaceable"><code>IS</code></em>):
            Transaction <code class="literal">T</code> intends to set
            <em class="replaceable"><code>S</code></em> locks on individual rows in
            table <code class="literal">t</code>.
          </p></li><li><p>
            Intention exclusive (<em class="replaceable"><code>IX</code></em>):
            Transaction <code class="literal">T</code> intends to set
            <em class="replaceable"><code>X</code></em> locks on those rows.
          </p></li></ul></div><p>
        For example, <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ...
        LOCK IN SHARE MODE</code></a> sets an
        <em class="replaceable"><code>IS</code></em> lock and
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ... FOR
        UPDATE</code></a> sets an <em class="replaceable"><code>IX</code></em> lock.
      </p><p>
        The intention locking protocol is as follows:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Before a transaction can acquire an
            <em class="replaceable"><code>S</code></em> lock on a row in table
            <code class="literal">t</code>, it must first acquire an
            <em class="replaceable"><code>IS</code></em> or stronger lock on
            <code class="literal">t</code>.
          </p></li><li><p>
            Before a transaction can acquire an
            <em class="replaceable"><code>X</code></em> lock on a row, it must first
            acquire an <em class="replaceable"><code>IX</code></em> lock on
            <code class="literal">t</code>.
          </p></li></ul></div><p>
        These rules can be conveniently summarized by means of the
        following <span class="emphasis"><em>lock type compatibility matrix</em></span>.
      </p><div class="informaltable"><table border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th> </th><th><em class="replaceable"><code>X</code></em></th><th><em class="replaceable"><code>IX</code></em></th><th><em class="replaceable"><code>S</code></em></th><th><em class="replaceable"><code>IS</code></em></th></tr></thead><tbody><tr><td><em class="replaceable"><code>X</code></em></td><td>Conflict</td><td>Conflict</td><td>Conflict</td><td>Conflict</td></tr><tr><td><em class="replaceable"><code>IX</code></em></td><td>Conflict</td><td>Compatible</td><td>Conflict</td><td>Compatible</td></tr><tr><td><em class="replaceable"><code>S</code></em></td><td>Conflict</td><td>Conflict</td><td>Compatible</td><td>Compatible</td></tr><tr><td><em class="replaceable"><code>IS</code></em></td><td>Conflict</td><td>Compatible</td><td>Compatible</td><td>Compatible</td></tr></tbody></table></div><p>
        A lock is granted to a requesting transaction if it is
        compatible with existing locks, but not if it conflicts with
        existing locks. A transaction waits until the conflicting
        existing lock is released. If a lock request conflicts with an
        existing lock and cannot be granted because it would cause
        deadlock, an error occurs.
      </p><p>
        Thus, intention locks do not block anything except full table
        requests (for example, <code class="literal">LOCK TABLES ...
        WRITE</code>). The main purpose of
        <em class="replaceable"><code>IX</code></em> and <em class="replaceable"><code>IS</code></em>
        locks is to show that someone is locking a row, or going to lock
        a row in the table.
      </p><p>
        The following example illustrates how an error can occur when a
        lock request would cause a deadlock. The example involves two
        clients, A and B.
      </p><p>
        First, client A creates a table containing one row, and then
        begins a transaction. Within the transaction, A obtains an
        <em class="replaceable"><code>S</code></em> lock on the row by selecting it in
        share mode:
      </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t (i INT) ENGINE = InnoDB;</code></strong>
Query OK, 0 rows affected (1.07 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO t (i) VALUES(1);</code></strong>
Query OK, 1 row affected (0.09 sec)

mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT * FROM t WHERE i = 1 LOCK IN SHARE MODE;</code></strong>
+------+
| i    |
+------+
|    1 |
+------+
1 row in set (0.10 sec)
</pre><p>
        Next, client B begins a transaction and attempts to delete the
        row from the table:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>DELETE FROM t WHERE i = 1;</code></strong>
</pre><p>
        The delete operation requires an <em class="replaceable"><code>X</code></em>
        lock. The lock cannot be granted because it is incompatible with
        the <em class="replaceable"><code>S</code></em> lock that client A holds, so
        the request goes on the queue of lock requests for the row and
        client B blocks.
      </p><p>
        Finally, client A also attempts to delete the row from the
        table:
      </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>DELETE FROM t WHERE i = 1;</code></strong>
ERROR 1213 (40001): Deadlock found when trying to get lock;
try restarting transaction
</pre><p>
        Deadlock occurs here because client A needs an
        <em class="replaceable"><code>X</code></em> lock to delete the row. However,
        that lock request cannot be granted because client B already has
        a request for an <em class="replaceable"><code>X</code></em> lock and is
        waiting for client A to release its <em class="replaceable"><code>S</code></em>
        lock. Nor can the <em class="replaceable"><code>S</code></em> lock held by A be
        upgraded to an <em class="replaceable"><code>X</code></em> lock because of the
        prior request by B for an <em class="replaceable"><code>X</code></em> lock. As
        a result, <code class="literal">InnoDB</code> generates an error for
        client A and releases its locks. At that point, the lock request
        for client B can be granted and B deletes the row from the
        table.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-consistent-read"></a>13.3.9.2. Consistent Nonlocking Reads</h4></div></div></div><a class="indexterm" name="id1124223"></a><a class="indexterm" name="id1124235"></a><p>
        A consistent read means that <code class="literal">InnoDB</code> uses
        multi-versioning to present to a query a snapshot of the
        database at a point in time. The query sees the changes made by
        transactions that committed before that point of time, and no
        changes made by later or uncommitted transactions. The exception
        to this rule is that the query sees the changes made by earlier
        statements within the same transaction. This exception causes
        the following anomaly: If you update some rows in a table, a
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> sees the latest version of
        the updated rows, but it might also see older versions of any
        rows. If other sessions simultaneously update the same table,
        the anomaly means that you might see the table in a state that
        never existed in the database.
      </p><p>
        If the transaction isolation level is
        <a href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> (the default
        level), all consistent reads within the same transaction read
        the snapshot established by the first such read in that
        transaction. You can get a fresher snapshot for your queries by
        committing the current transaction and after that issuing new
        queries.
      </p><p>
        With <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
        level, each consistent read within a transaction sets and reads
        its own fresh snapshot.
      </p><p>
        Consistent read is the default mode in which
        <code class="literal">InnoDB</code> processes
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements in
        <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> and
        <a href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> isolation
        levels. A consistent read does not set any locks on the tables
        it accesses, and therefore other sessions are free to modify
        those tables at the same time a consistent read is being
        performed on the table.
      </p><p>
        Suppose that you are running in the default
        <a href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> isolation
        level. When you issue a consistent read (that is, an ordinary
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement),
        <code class="literal">InnoDB</code> gives your transaction a timepoint
        according to which your query sees the database. If another
        transaction deletes a row and commits after your timepoint was
        assigned, you do not see the row as having been deleted. Inserts
        and updates are treated similarly.
      </p><p>
        You can advance your timepoint by committing your transaction
        and then doing another <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> or
        <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">START TRANSACTION WITH
        CONSISTENT SNAPSHOT</code></a>.
      </p><p>
        This is called <em class="firstterm">multi-versioned concurrency
        control</em>.
      </p><p>
        In the following example, session A sees the row inserted by B
        only when B has committed the insert and A has committed as
        well, so that the timepoint is advanced past the commit of B.
      </p><pre class="programlisting">             Session A              Session B

           SET autocommit=0;      SET autocommit=0;
time
|          SELECT * FROM t;
|          empty set
|                                 INSERT INTO t VALUES (1, 2);
|
v          SELECT * FROM t;
           empty set
                                  COMMIT;

           SELECT * FROM t;
           empty set

           COMMIT;

           SELECT * FROM t;
           ---------------------
           |    1    |    2    |
           ---------------------
           1 row in set</pre><p>
        If you want to see the “<span class="quote">freshest</span>” state of the
        database, use either the <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
        COMMITTED</code></a> isolation level or a locking read:
      </p><pre class="programlisting">SELECT * FROM t LOCK IN SHARE MODE;</pre><p>
        With <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
        level, each consistent read within a transaction sets and reads
        its own fresh snapshot. With <code class="literal">LOCK IN SHARE
        MODE</code>, a locking read occurs instead: A
        <code class="literal">SELECT</code> blocks until the transaction
        containing the freshest rows ends (see
        <a href="storage-engines.html#innodb-locking-reads" title="13.3.9.3. SELECT ... FOR UPDATE
        and SELECT ... LOCK IN
        SHARE MODE Locking Reads">Section 13.3.9.3, “<code class="literal">SELECT ... FOR UPDATE</code>
        and <code class="literal">SELECT ... LOCK IN
        SHARE MODE</code> Locking Reads”</a>).
      </p><p>
        Consistent read does not work over certain DDL statements:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Consistent read does not work over <a href="sql-syntax.html#drop-table" title="12.1.28. DROP TABLE Syntax"><code class="literal">DROP
            TABLE</code></a>, because MySQL cannot use a table that has
            been dropped and <code class="literal">InnoDB</code> destroys the
            table.
          </p></li><li><p>
            Consistent read does not work over
            <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, because that
            statement makes a temporary copy of the original table and
            deletes the original table when the temporary copy is built.
            When you reissue a consistent read within a transaction,
            rows in the new table are not visible because those rows did
            not exist when the transaction's snapshot was taken.
          </p></li></ul></div><p>
        The type of read varies for selects in clauses like
        <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT INTO ...
        SELECT</code></a>, <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE
        ... (SELECT)</code></a>, and
        <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
        SELECT</code></a> that do not specify <code class="literal">FOR
        UPDATE</code> or <code class="literal">LOCK IN SHARE MODE</code>:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            By default, <code class="literal">InnoDB</code> uses stronger locks
            and the <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> part acts like
            <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>, where
            each consistent read, even within the same transaction, sets
            and reads its own fresh snapshot.
          </p></li><li><p>
            To use a consistent read in such cases, enable the
            <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
            option and set the isolation level of the transaction to
            <a href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>,
            <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>, or
            <a href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> (that is,
            anything other than
            <a href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>). In this
            case, no locks are set on rows read from the selected table.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-locking-reads"></a>13.3.9.3. <code class="literal">SELECT ... FOR UPDATE</code>
        and <code class="literal">SELECT ... LOCK IN
        SHARE MODE</code> Locking Reads</h4></div></div></div><a class="indexterm" name="id1124617"></a><p>
        If you query data and then insert or update related data within
        the same transaction, the regular <code class="literal">SELECT</code>
        statement does not give enough protection. Other transactions
        can update or delete the same rows you just queried.
        <code class="literal">InnoDB</code> supports two types of locking reads
        that offer extra safety:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ... LOCK IN
            SHARE MODE</code></a> sets a shared mode lock on any rows
            that are read. Other sessions can read the rows, but cannot
            modify them until your transaction commits. If any of these
            rows were changed by another transaction that has not yet
            committed, your query waits until that transaction ends and
            then uses the latest values.
          </p></li><li><p>
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ... FOR
            UPDATE</code></a> locks the rows and any associated index
            entries, the same as if you issued an
            <code class="literal">UPDATE</code> statement for those rows. Other
            transactions are blocked from updating those rows, from
            doing <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ...
            LOCK IN SHARE MODE</code></a>, or from reading the data in
            certain transaction isolation levels. Consistent reads
            ignore any locks set on the records that exist in the read
            view. (Old versions of a record cannot be locked; they are
            reconstructed by applying undo logs on an in-memory copy of
            the record.)
          </p></li></ul></div><p>
        These clauses are primarily useful when dealing with
        tree-structured or graph-structured data, either in a single
        table or split across multiple tables.
      </p><p>
        All locks set by <code class="literal">LOCK IN SHARE MODE</code> and
        <code class="literal">FOR UPDATE</code> queries are released when the
        transaction is committed or rolled back.
      </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
          Locking of rows for update using <code class="literal">SELECT FOR
          UPDATE</code> only applies when autocommit is disabled
          (either by beginning transaction with
          <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">START
          TRANSACTION</code></a> or by setting
          <a href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> to 0. If
          autocommit is enabled, the rows matching the specification are
          not locked.
        </p></div><h5><a name="id1124749"></a>
        Usage Examples
      </h5><p>
        Suppose that you want to insert a new row into a table
        <code class="literal">child</code>, and make sure that the child row has a
        parent row in table <code class="literal">parent</code>. Your application
        code can ensure referential integrity throughout this sequence
        of operations.
      </p><p>
        First, use a consistent read to query the table
        <code class="literal">PARENT</code> and verify that the parent row exists.
        Can you safely insert the child row to table
        <code class="literal">CHILD</code>? No, because some other session could
        delete the parent row in the moment between your
        <code class="literal">SELECT</code> and your <code class="literal">INSERT</code>,
        without you being aware of it.
      </p><p>
        To avoid this potential issue, perform the
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> using <code class="literal">LOCK IN
        SHARE MODE</code>:
      </p><pre class="programlisting">SELECT * FROM parent WHERE NAME = 'Jones' LOCK IN SHARE MODE;</pre><p>
        After the <code class="literal">LOCK IN SHARE MODE</code> query returns
        the parent <code class="literal">'Jones'</code>, you can safely add the
        child record to the <code class="literal">CHILD</code> table and commit
        the transaction. Any transaction that tries to read or write to
        the applicable row in the <code class="literal">PARENT</code> table waits
        until you are finished, that is, the data in all tables is in a
        consistent state.
      </p><p>
        For another example, consider an integer counter field in a
        table <code class="literal">CHILD_CODES</code>, used to assign a unique
        identifier to each child added to table
        <code class="literal">CHILD</code>. Do not use either consistent read or a
        shared mode read to read the present value of the counter,
        because two users of the database could see the same value for
        the counter, and a duplicate-key error occurs if two
        transactions attempt to add rows with the same identifier to the
        <code class="literal">CHILD</code> table.
      </p><p>
        Here, <code class="literal">LOCK IN SHARE MODE</code> is not a good
        solution because if two users read the counter at the same time,
        at least one of them ends up in deadlock when it attempts to
        update the counter.
      </p><p>
        Here are two ways to implement reading and incrementing the
        counter without interference from another transaction:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            First update the counter by incrementing it by 1, then read
            it and use the new value in the <code class="literal">CHILD</code>
            table. Any other transaction that tries to read the counter
            waits until your transaction commits. If another transaction
            is in the middle of this same sequence, your transaction
            waits until the other one commits.
          </p></li><li><p>
            First perform a locking read of the counter using
            <code class="literal">FOR UPDATE</code>, and then increment the
            counter:
          </p><pre class="programlisting">SELECT counter_field FROM child_codes FOR UPDATE;
UPDATE child_codes SET counter_field = counter_field + 1;</pre></li></ul></div><p>
        A <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ... FOR
        UPDATE</code></a> reads the latest available data, setting
        exclusive locks on each row it reads. Thus, it sets the same
        locks a searched SQL <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> would
        set on the rows.
      </p><p>
        The preceding description is merely an example of how
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ... FOR
        UPDATE</code></a> works. In MySQL, the specific task of
        generating a unique identifier actually can be accomplished
        using only a single access to the table:
      </p><pre class="programlisting">UPDATE child_codes SET counter_field = LAST_INSERT_ID(counter_field + 1);
SELECT LAST_INSERT_ID();</pre><p>
        The <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement merely
        retrieves the identifier information (specific to the current
        connection). It does not access any table.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-record-level-locks"></a>13.3.9.4. <code class="literal">InnoDB</code> Record, Gap, and Next-Key Locks</h4></div></div></div><a class="indexterm" name="id1124994"></a><a class="indexterm" name="id1125007"></a><a class="indexterm" name="id1125019"></a><a class="indexterm" name="id1125032"></a><a class="indexterm" name="id1125044"></a><a class="indexterm" name="id1125056"></a><a class="indexterm" name="id1125069"></a><a class="indexterm" name="id1125081"></a><p>
        <code class="literal">InnoDB</code> has several types of record-level
        locks:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Record lock: This is a lock on an index record.
          </p></li><li><p>
            Gap lock: This is a lock on a gap between index records, or
            a lock on the gap before the first or after the last index
            record.
          </p></li><li><p>
            Next-key lock: This is a combination of a record lock on the
            index record and a gap lock on the gap before the index
            record.
          </p></li></ul></div><p>
        Record locks always lock index records, even if a table is
        defined with no indexes. For such cases,
        <code class="literal">InnoDB</code> creates a hidden clustered index and
        uses this index for record locking. See
        <a href="storage-engines.html#innodb-index-types" title="13.3.11.1. Clustered and Secondary Indexes">Section 13.3.11.1, “Clustered and Secondary Indexes”</a>.
      </p><p>
        By default, <code class="literal">InnoDB</code> operates in
        <a href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> transaction
        isolation level and with the
        <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
        system variable disabled. In this case,
        <code class="literal">InnoDB</code> uses next-key locks for searches and
        index scans, which prevents phantom rows (see
        <a href="storage-engines.html#innodb-next-key-locking" title="13.3.9.5. Avoiding the Phantom Problem Using Next-Key Locking">Section 13.3.9.5, “Avoiding the Phantom Problem Using Next-Key Locking”</a>).
      </p><p>
        Next-key locking combines index-row locking with gap locking.
        <code class="literal">InnoDB</code> performs row-level locking in such a
        way that when it searches or scans a table index, it sets shared
        or exclusive locks on the index records it encounters. Thus, the
        row-level locks are actually index-record locks. In addition, a
        next-key lock on an index record also affects the
        “<span class="quote">gap</span>” before that index record. That is, a next-key
        lock is an index-record lock plus a gap lock on the gap
        preceding the index record. If one session has a shared or
        exclusive lock on record <code class="literal">R</code> in an index,
        another session cannot insert a new index record in the gap
        immediately before <code class="literal">R</code> in the index order.
      </p><p>
        Suppose that an index contains the values 10, 11, 13, and 20.
        The possible next-key locks for this index cover the following
        intervals, where <code class="literal">(</code> or <code class="literal">)</code>
        denote exclusion of the interval endpoint and
        <code class="literal">[</code> or <code class="literal">]</code> denote inclusion of
        the endpoint:
      </p><pre class="programlisting">(negative infinity, 10]
(10, 11]
(11, 13]
(13, 20]
(20, positive infinity)</pre><p>
        For the last interval, the next-key lock locks the gap above the
        largest value in the index and the “<span class="quote">supremum</span>”
        pseudo-record having a value higher than any value actually in
        the index. The supremum is not a real index record, so, in
        effect, this next-key lock locks only the gap following the
        largest index value.
      </p><p>
        The preceding example shows that a gap might span a single index
        value, multiple index values, or even be empty.
      </p><p>
        Gap locking is not needed for statements that lock rows using a
        unique index to search for a unique row. (This does not include
        the case that the search condition includes only some columns of
        a multiple-column unique index; in that case, gap locking does
        occur.) For example, if the <code class="literal">id</code> column has a
        unique index, the following statement uses only an index-record
        lock for the row having <code class="literal">id</code> value 100 and it
        does not matter whether other sessions insert rows in the
        preceding gap:
      </p><pre class="programlisting">SELECT * FROM child WHERE id = 100;</pre><p>
        If <code class="literal">id</code> is not indexed or has a nonunique
        index, the statement does lock the preceding gap.
      </p><p>
        A type of gap lock called an insertion intention gap lock is set
        by <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> operations prior to row
        insertion. This lock signals the intent to insert in such a way
        that multiple transactions inserting into the same index gap
        need not wait for each other if they are not inserting at the
        same position within the gap. Suppose that there are index
        records with values of 4 and 7. Separate transactions that
        attempt to insert values of 5 and 6 each lock the gap between 4
        and 7 with insert intention locks prior to obtaining the
        exclusive lock on the inserted row, but do not block each other
        because the rows are nonconflicting.
      </p><p>
        Gap locking can be disabled explicitly. This occurs if you
        change the transaction isolation level to
        <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> or enable the
        <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
        system variable. Under these circumstances, gap locking is
        disabled for searches and index scans and is used only for
        foreign-key constraint checking and duplicate-key checking.
      </p><p>
        There are also other effects of using the
        <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
        level or enabling
        <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>:
        Record locks for nonmatching rows are released after MySQL has
        evaluated the <code class="literal">WHERE</code> condition. For
        <code class="literal">UPDATE</code> statements,
        <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> does a
        “<span class="quote">semi-consistent</span>” read, such that it returns the
        latest committed version to MySQL so that MySQL can determine
        whether the row matches the <code class="literal">WHERE</code> condition
        of the <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-next-key-locking"></a>13.3.9.5. Avoiding the Phantom Problem Using Next-Key Locking</h4></div></div></div><a class="indexterm" name="id1125397"></a><a class="indexterm" name="id1125406"></a><a class="indexterm" name="id1125419"></a><a class="indexterm" name="id1125431"></a><a class="indexterm" name="id1125443"></a><a class="indexterm" name="id1125456"></a><a class="indexterm" name="id1125468"></a><a class="indexterm" name="id1125481"></a><a class="indexterm" name="id1125493"></a><p>
        The so-called <em class="firstterm">phantom</em> problem occurs
        within a transaction when the same query produces different sets
        of rows at different times. For example, if a
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> is executed twice, but
        returns a row the second time that was not returned the first
        time, the row is a “<span class="quote">phantom</span>” row.
      </p><p>
        Suppose that there is an index on the <code class="literal">id</code>
        column of the <code class="literal">child</code> table and that you want
        to read and lock all rows from the table having an identifier
        value larger than 100, with the intention of updating some
        column in the selected rows later:
      </p><pre class="programlisting">SELECT * FROM child WHERE id &gt; 100 FOR UPDATE;</pre><p>
        The query scans the index starting from the first record where
        <code class="literal">id</code> is bigger than 100. Let the table contain
        rows having <code class="literal">id</code> values of 90 and 102. If the
        locks set on the index records in the scanned range do not lock
        out inserts made in the gaps (in this case, the gap between 90
        and 102), another session can insert a new row into the table
        with an <code class="literal">id</code> of 101. If you were to execute the
        same <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> within the same
        transaction, you would see a new row with an
        <code class="literal">id</code> of 101 (a “<span class="quote">phantom</span>”) in the
        result set returned by the query. If we regard a set of rows as
        a data item, the new phantom child would violate the isolation
        principle of transactions that a transaction should be able to
        run so that the data it has read does not change during the
        transaction.
      </p><p>
        To prevent phantoms, <code class="literal">InnoDB</code> uses an algorithm
        called <em class="firstterm">next-key locking</em> that combines
        index-row locking with gap locking. <code class="literal">InnoDB</code>
        performs row-level locking in such a way that when it searches
        or scans a table index, it sets shared or exclusive locks on the
        index records it encounters. Thus, the row-level locks are
        actually index-record locks. In addition, a next-key lock on an
        index record also affects the “<span class="quote">gap</span>” before that
        index record. That is, a next-key lock is an index-record lock
        plus a gap lock on the gap preceding the index record. If one
        session has a shared or exclusive lock on record
        <code class="literal">R</code> in an index, another session cannot insert
        a new index record in the gap immediately before
        <code class="literal">R</code> in the index order.
      </p><p>
        When <code class="literal">InnoDB</code> scans an index, it can also lock
        the gap after the last record in the index. Just that happens in
        the preceding example: To prevent any insert into the table
        where <code class="literal">id</code> would be bigger than 100, the locks
        set by <code class="literal">InnoDB</code> include a lock on the gap
        following <code class="literal">id</code> value 102.
      </p><p>
        You can use next-key locking to implement a uniqueness check in
        your application: If you read your data in share mode and do not
        see a duplicate for a row you are going to insert, then you can
        safely insert your row and know that the next-key lock set on
        the successor of your row during the read prevents anyone
        meanwhile inserting a duplicate for your row. Thus, the next-key
        locking enables you to “<span class="quote">lock</span>” the nonexistence of
        something in your table.
      </p><p>
        Gap locking can be disabled as discussed in
        <a href="storage-engines.html#innodb-record-level-locks" title="13.3.9.4. InnoDB Record, Gap, and Next-Key Locks">Section 13.3.9.4, “<code class="literal">InnoDB</code> Record, Gap, and Next-Key Locks”</a>. This may cause
        phantom problems because other sessions can insert new rows into
        the gaps when gap locking is disabled.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-locks-set"></a>13.3.9.6. Locks Set by Different SQL Statements in <code class="literal">InnoDB</code></h4></div></div></div><p>
        A locking read, an <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, or a
        <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> generally set record locks
        on every index record that is scanned in the processing of the
        SQL statement. It does not matter whether there are
        <code class="literal">WHERE</code> conditions in the statement that would
        exclude the row. <code class="literal">InnoDB</code> does not remember the
        exact <code class="literal">WHERE</code> condition, but only knows which
        index ranges were scanned. The locks are normally next-key locks
        that also block inserts into the “<span class="quote">gap</span>” immediately
        before the record. However, gap locking can be disabled
        explicitly, which causes next-key locking not to be used. For
        more information, see
        <a href="storage-engines.html#innodb-record-level-locks" title="13.3.9.4. InnoDB Record, Gap, and Next-Key Locks">Section 13.3.9.4, “<code class="literal">InnoDB</code> Record, Gap, and Next-Key Locks”</a>. The transaction
        isolation level also can affect which locks are set; see
        <a href="sql-syntax.html#set-transaction" title="12.3.6. SET TRANSACTION Syntax">Section 12.3.6, “<code class="literal">SET TRANSACTION</code> Syntax”</a>.
      </p><p>
        If a secondary index is used in a search and index record locks
        to be set are exclusive, <code class="literal">InnoDB</code> also
        retrieves the corresponding clustered index records and sets
        locks on them.
      </p><p>
        Differences between shared and exclusive locks are described in
        <a href="storage-engines.html#innodb-lock-modes" title="13.3.9.1. InnoDB Lock Modes">Section 13.3.9.1, “<code class="literal">InnoDB</code> Lock Modes”</a>.
      </p><p>
        If you have no indexes suitable for your statement and MySQL
        must scan the entire table to process the statement, every row
        of the table becomes locked, which in turn blocks all inserts by
        other users to the table. It is important to create good indexes
        so that your queries do not unnecessarily scan many rows.
      </p><p>
        For <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ... FOR
        UPDATE</code></a> or
        <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ... LOCK IN SHARE
        MODE</code></a>, locks are acquired for scanned rows, and
        expected to be released for rows that do not qualify for
        inclusion in the result set (for example, if they do not meet
        the criteria given in the <code class="literal">WHERE</code> clause).
        However, in some cases, rows might not be unlocked immediately
        because the relationship between a result row and its original
        source is lost during query execution. For example, in a
        <a href="sql-syntax.html#union" title="12.2.9.4. UNION Syntax"><code class="literal">UNION</code></a>, scanned (and locked) rows
        from a table might be inserted into a temporary table before
        evaluation whether they qualify for the result set. In this
        circumstance, the relationship of the rows in the temporary
        table to the rows in the original table is lost and the latter
        rows are not unlocked until the end of query execution.
      </p><p>
        <code class="literal">InnoDB</code> sets specific types of locks as
        follows.
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ...
            FROM</code></a> is a consistent read, reading a snapshot of
            the database and setting no locks unless the transaction
            isolation level is set to
            <a href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>. For
            <a href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a> level, the
            search sets shared next-key locks on the index records it
            encounters.
          </p></li><li><p>
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ... FROM ...
            LOCK IN SHARE MODE</code></a> sets shared next-key locks on
            all index records the search encounters.
          </p></li><li><p>
            For index records the search encounters,
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ... FROM ...
            FOR UPDATE</code></a> blocks other sessions from doing
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ... FROM ...
            LOCK IN SHARE MODE</code></a> or from reading in certain
            transaction isolation levels. Consistent reads will ignore
            any locks set on the records that exist in the read view.
          </p></li><li><p>
            <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE ... WHERE
            ...</code></a> sets an exclusive next-key lock on every
            record the search encounters.
          </p></li><li><p>
            <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE FROM ...
            WHERE ...</code></a> sets an exclusive next-key lock on every
            record the search encounters.
          </p></li><li><p>
            <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> sets an exclusive lock
            on the inserted row. This lock is an index-record lock, not
            a next-key lock (that is, there is no gap lock) and does not
            prevent other sessions from inserting into the gap before
            the inserted row.
          </p><p>
            Prior to inserting the row, a type of gap lock called an
            insertion intention gap lock is set. This lock signals the
            intent to insert in such a way that multiple transactions
            inserting into the same index gap need not wait for each
            other if they are not inserting at the same position within
            the gap. Suppose that there are index records with values of
            4 and 7. Separate transactions that attempt to insert values
            of 5 and 6 each lock the gap between 4 and 7 with insert
            intention locks prior to obtaining the exclusive lock on the
            inserted row, but do not block each other because the rows
            are nonconflicting.
          </p><p>
            If a duplicate-key error occurs, a shared lock on the
            duplicate index record is set. This use of a shared lock can
            result in deadlock should there be multiple sessions trying
            to insert the same row if another session already has an
            exclusive lock. This can occur if another session deletes
            the row. Suppose that an <code class="literal">InnoDB</code> table
            <code class="literal">t1</code> has the following structure:
          </p><pre class="programlisting">CREATE TABLE t1 (i INT, PRIMARY KEY (i)) ENGINE = InnoDB;</pre><p>
            Now suppose that three sessions perform the following
            operations in order:
          </p><p>
            Session 1:
          </p><pre class="programlisting">START TRANSACTION;
INSERT INTO t1 VALUES(1);</pre><p>
            Session 2:
          </p><pre class="programlisting">START TRANSACTION;
INSERT INTO t1 VALUES(1);</pre><p>
            Session 3:
          </p><pre class="programlisting">START TRANSACTION;
INSERT INTO t1 VALUES(1);</pre><p>
            Session 1:
          </p><pre class="programlisting">ROLLBACK;</pre><p>
            The first operation by session 1 acquires an exclusive lock
            for the row. The operations by sessions 2 and 3 both result
            in a duplicate-key error and they both request a shared lock
            for the row. When session 1 rolls back, it releases its
            exclusive lock on the row and the queued shared lock
            requests for sessions 2 and 3 are granted. At this point,
            sessions 2 and 3 deadlock: Neither can acquire an exclusive
            lock for the row because of the shared lock held by the
            other.
          </p><p>
            A similar situation occurs if the table already contains a
            row with key value 1 and three sessions perform the
            following operations in order:
          </p><p>
            Session 1:
          </p><pre class="programlisting">START TRANSACTION;
DELETE FROM t1 WHERE i = 1;</pre><p>
            Session 2:
          </p><pre class="programlisting">START TRANSACTION;
INSERT INTO t1 VALUES(1);</pre><p>
            Session 3:
          </p><pre class="programlisting">START TRANSACTION;
INSERT INTO t1 VALUES(1);</pre><p>
            Session 1:
          </p><pre class="programlisting">COMMIT;</pre><p>
            The first operation by session 1 acquires an exclusive lock
            for the row. The operations by sessions 2 and 3 both result
            in a duplicate-key error and they both request a shared lock
            for the row. When session 1 commits, it releases its
            exclusive lock on the row and the queued shared lock
            requests for sessions 2 and 3 are granted. At this point,
            sessions 2 and 3 deadlock: Neither can acquire an exclusive
            lock for the row because of the shared lock held by the
            other.
          </p></li><li><p>
            <a href="sql-syntax.html#insert-on-duplicate" title="12.2.5.3. INSERT ... ON
        DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
            ... ON DUPLICATE KEY UPDATE</code></a> differs from a simple
            <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> in that an exclusive
            next-key lock rather than a shared lock is placed on the row
            to be updated when a duplicate-key error occurs.
          </p></li><li><p>
            <a href="sql-syntax.html#replace" title="12.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a> is done like an
            <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> if there is no
            collision on a unique key. Otherwise, an exclusive next-key
            lock is placed on the row to be replaced.
          </p></li><li><p>
            <code class="literal">INSERT INTO T SELECT ... FROM S WHERE ...</code>
            sets an exclusive index record without a gap lock on each
            row inserted into <code class="literal">T</code>. If the transaction
            isolation level is <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
            COMMITTED</code></a> or
            <a href="storage-engines.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
            is enabled, and the transaction isolation level is not
            <a href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>,
            <code class="literal">InnoDB</code> does the search on
            <code class="literal">S</code> as a consistent read (no locks).
            Otherwise, <code class="literal">InnoDB</code> sets shared next-key
            locks on rows from <code class="literal">S</code>.
            <code class="literal">InnoDB</code> has to set locks in the latter
            case: In roll-forward recovery from a backup, every SQL
            statement must be executed in exactly the same way it was
            done originally.
          </p><p>
            <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE
            ... SELECT ...</code></a> performs the
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> with shared next-key
            locks or as a consistent read, as for
            <a href="sql-syntax.html#insert-select" title="12.2.5.1. INSERT ...
        SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a>.
          </p><p>
            When a <code class="literal">SELECT</code> is used in the constructs
            <code class="literal">REPLACE INTO t SELECT ... FROM s WHERE
            ...</code> or <code class="literal">UPDATE t ... WHERE col IN (SELECT
            ... FROM s ...)</code>, <code class="literal">InnoDB</code> sets
            shared next-key locks on rows from table
            <code class="literal">s</code>.
          </p></li><li><p>
            While initializing a previously specified
            <code class="literal">AUTO_INCREMENT</code> column on a table,
            <code class="literal">InnoDB</code> sets an exclusive lock on the end
            of the index associated with the
            <code class="literal">AUTO_INCREMENT</code> column. In accessing the
            auto-increment counter, <code class="literal">InnoDB</code> uses a
            specific <code class="literal">AUTO-INC</code> table lock mode where
            the lock lasts only to the end of the current SQL statement,
            not to the end of the entire transaction. Other sessions
            cannot insert into the table while the
            <code class="literal">AUTO-INC</code> table lock is held; see
            <a href="storage-engines.html#innodb-transaction-model" title="13.3.9. The InnoDB Transaction Model and Locking">Section 13.3.9, “The <code class="literal">InnoDB</code> Transaction Model and Locking”</a>.
          </p><p>
            <code class="literal">InnoDB</code> fetches the value of a previously
            initialized <code class="literal">AUTO_INCREMENT</code> column without
            setting any locks.
          </p></li><li><p>
            If a <code class="literal">FOREIGN KEY</code> constraint is defined on
            a table, any insert, update, or delete that requires the
            constraint condition to be checked sets shared record-level
            locks on the records that it looks at to check the
            constraint. <code class="literal">InnoDB</code> also sets these locks
            in the case where the constraint fails.
          </p></li><li><p>
            <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a> sets table locks,
            but it is the higher MySQL layer above the
            <code class="literal">InnoDB</code> layer that sets these locks.
            <code class="literal">InnoDB</code> is aware of table locks if
            <code class="literal">innodb_table_locks = 1</code> (the default) and
            <a href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>, and the
            MySQL layer above <code class="literal">InnoDB</code> knows about
            row-level locks.
          </p><p>
            Otherwise, <code class="literal">InnoDB</code>'s automatic deadlock
            detection cannot detect deadlocks where such table locks are
            involved. Also, because in this case the higher MySQL layer
            does not know about row-level locks, it is possible to get a
            table lock on a table where another session currently has
            row-level locks. However, this does not endanger transaction
            integrity, as discussed in
            <a href="storage-engines.html#innodb-deadlock-detection" title="13.3.9.8. Deadlock Detection and Rollback">Section 13.3.9.8, “Deadlock Detection and Rollback”</a>. See also
            <a href="storage-engines.html#innodb-restrictions" title="13.3.15. Limits on InnoDB Tables">Section 13.3.15, “Limits on <code class="literal">InnoDB</code> Tables”</a>.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-implicit-commit"></a>13.3.9.7. Implicit Transaction Commit and Rollback</h4></div></div></div><a class="indexterm" name="id1126421"></a><p>
        By default, MySQL starts the session for each new connection
        with autocommit mode enabled, so MySQL does a commit after each
        SQL statement if that statement did not return an error. If a
        statement returns an error, the commit or rollback behavior
        depends on the error. See
        <a href="storage-engines.html#innodb-error-handling" title="13.3.13. InnoDB Error Handling">Section 13.3.13, “<code class="literal">InnoDB</code> Error Handling”</a>.
      </p><p>
        If a session that has autocommit disabled ends without
        explicitly committing the final transaction, MySQL rolls back
        that transaction.
      </p><p>
        Some statements implicitly end a transaction, as if you had done
        a <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">COMMIT</code></a> before executing the
        statement. For details, see <a href="sql-syntax.html#implicit-commit" title="12.3.3. Statements That Cause an Implicit Commit">Section 12.3.3, “Statements That Cause an Implicit Commit”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-deadlock-detection"></a>13.3.9.8. Deadlock Detection and Rollback</h4></div></div></div><a class="indexterm" name="id1126474"></a><a class="indexterm" name="id1126487"></a><p>
        <code class="literal">InnoDB</code> automatically detects transaction
        deadlocks and rolls back a transaction or transactions to break
        the deadlock. <code class="literal">InnoDB</code> tries to pick small
        transactions to roll back, where the size of a transaction is
        determined by the number of rows inserted, updated, or deleted.
      </p><p>
        <code class="literal">InnoDB</code> is aware of table locks if
        <code class="literal">innodb_table_locks = 1</code> (the default) and
        <a href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>, and the MySQL
        layer above it knows about row-level locks. Otherwise,
        <code class="literal">InnoDB</code> cannot detect deadlocks where a table
        lock set by a MySQL <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
        statement or a lock set by a storage engine other than
        <code class="literal">InnoDB</code> is involved. Resolve these situations
        by setting the value of the
        <a href="storage-engines.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a> system
        variable.
      </p><p>
        When <code class="literal">InnoDB</code> performs a complete rollback of a
        transaction, all locks set by the transaction are released.
        However, if just a single SQL statement is rolled back as a
        result of an error, some of the locks set by the statement may
        be preserved. This happens because <code class="literal">InnoDB</code>
        stores row locks in a format such that it cannot know afterward
        which lock was set by which statement.
      </p><p>
        If a <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> calls a stored
        function in a transaction, and a statement within the function
        fails, that statement rolls back. Furthermore, if
        <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> is
        executed after that, the entire transaction rolls back.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-deadlocks"></a>13.3.9.9. How to Cope with Deadlocks</h4></div></div></div><p>
        Deadlocks are a classic problem in transactional databases, but
        they are not dangerous unless they are so frequent that you
        cannot run certain transactions at all. Normally, you must write
        your applications so that they are always prepared to re-issue a
        transaction if it gets rolled back because of a deadlock.
      </p><p>
        <code class="literal">InnoDB</code> uses automatic row-level locking. You
        can get deadlocks even in the case of transactions that just
        insert or delete a single row. That is because these operations
        are not really “<span class="quote">atomic</span>”; they automatically set
        locks on the (possibly several) index records of the row
        inserted or deleted.
      </p><p>
        You can cope with deadlocks and reduce the likelihood of their
        occurrence with the following techniques:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Use <a href="sql-syntax.html#show-engine" title="12.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
            INNODB STATUS</code></a> to determine the cause of the latest
            deadlock. That can help you to tune your application to
            avoid deadlocks.
          </p></li><li><p>
            Always be prepared to re-issue a transaction if it fails due
            to deadlock. Deadlocks are not dangerous. Just try again.
          </p></li><li><p>
            Commit your transactions often. Small transactions are less
            prone to collision.
          </p></li><li><p>
            If you are using locking reads
            (<a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT ... FOR
            UPDATE</code></a> or <code class="literal">SELECT ...
            LOCK IN SHARE MODE</code>), try using a lower isolation
            level such as <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
            COMMITTED</code></a>.
          </p></li><li><p>
            Access your tables and rows in a fixed order. Then
            transactions form well-defined queues and do not deadlock.
          </p></li><li><p>
            Add well-chosen indexes to your tables. Then your queries
            need to scan fewer index records and consequently set fewer
            locks. Use <a href="sql-syntax.html#explain" title="12.8.2. EXPLAIN Syntax"><code class="literal">EXPLAIN
            SELECT</code></a> to determine which indexes the MySQL server
            regards as the most appropriate for your queries.
          </p></li><li><p>
            Use less locking. If you can afford to permit a
            <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> to return data from an
            old snapshot, do not add the clause <code class="literal">FOR
            UPDATE</code> or <code class="literal">LOCK IN SHARE MODE</code> to
            it. Using the <a href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
            COMMITTED</code></a> isolation level is good here, because
            each consistent read within the same transaction reads from
            its own fresh snapshot.
          </p></li><li><p>
            If nothing else helps, serialize your transactions with
            table-level locks. The correct way to use
            <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a> with
            transactional tables, such as <code class="literal">InnoDB</code>
            tables, is to begin a transaction with <code class="literal">SET
            autocommit = 0</code> (not
            <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">START
            TRANSACTION</code></a>) followed by <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK
            TABLES</code></a>, and to not call
            <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> until you commit the transaction
            explicitly. For example, if you need to write to table
            <code class="literal">t1</code> and read from table
            <code class="literal">t2</code>, you can do this:
          </p><pre class="programlisting">SET autocommit=0;
LOCK TABLES t1 WRITE, t2 READ, ...;<em class="replaceable"><code>... do something with tables t1 and t2 here ...</code></em>
COMMIT;
UNLOCK TABLES;
</pre><p>
            Table-level locks make your transactions queue nicely and
            avoid deadlocks.
          </p></li><li><p>
            Another way to serialize transactions is to create an
            auxiliary “<span class="quote">semaphore</span>” table that contains just
            a single row. Have each transaction update that row before
            accessing other tables. In that way, all transactions happen
            in a serial fashion. Note that the <code class="literal">InnoDB</code>
            instant deadlock detection algorithm also works in this
            case, because the serializing lock is a row-level lock. With
            MySQL table-level locks, the timeout method must be used to
            resolve deadlocks.
          </p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-multi-versioning"></a>13.3.10. <code class="literal">InnoDB</code> Multi-Versioning</h3></div></div></div><a class="indexterm" name="id1126878"></a><a class="indexterm" name="id1126891"></a><p>
      <code class="literal">InnoDB</code> is a multi-versioned storage engine: it
      keeps information about old versions of changed rows, to support
      transactional features such as concurrency and rollback. This
      information is stored in the tablespace in a data structure called
      a <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_rollback_segment" target="_top">rollback segment</a>
      (after an analogous data structure in Oracle).
      <code class="literal">InnoDB</code> uses the information in the rollback
      segment to perform the undo operations needed in a transaction
      rollback. It also uses the information to build earlier versions
      of a row for a consistent read.
    </p><h4><a name="id1126926"></a>
      Internal Details of Multi-Versioning
    </h4><p>
      Internally, <code class="literal">InnoDB</code> adds three fields to each
      row stored in the database. A 6-byte <code class="literal">DB_TRX_ID</code>
      field indicates the transaction identifier for the last
      transaction that inserted or updated the row. Also, a deletion is
      treated internally as an update where a special bit in the row is
      set to mark it as deleted. Each row also contains a 7-byte
      <code class="literal">DB_ROLL_PTR</code> field called the roll pointer. The
      roll pointer points to an undo log record written to the rollback
      segment. If the row was updated, the undo log record contains the
      information necessary to rebuild the content of the row before it
      was updated. A 6-byte <code class="literal">DB_ROW_ID</code> field contains
      a row ID that increases monotonically as new rows are inserted. If
      <code class="literal">InnoDB</code> generates a clustered index
      automatically, the index contains row ID values. Otherwise, the
      <code class="literal">DB_ROW_ID</code> column does not appear in any index.
    </p><p>
      Undo logs in the rollback segment are divided into insert and
      update undo logs. Insert undo logs are needed only in transaction
      rollback and can be discarded as soon as the transaction commits.
      Update undo logs are used also in consistent reads, but they can
      be discarded only after there is no transaction present for which
      <code class="literal">InnoDB</code> has assigned a snapshot that in a
      consistent read could need the information in the update undo log
      to build an earlier version of a database row.
    </p><h4><a name="id1126989"></a>
      Guidelines for Managing Rollback Segments
    </h4><p>
      Commit your transactions regularly, including those transactions
      that issue only consistent reads. Otherwise,
      <code class="literal">InnoDB</code> cannot discard data from the update undo
      logs, and the rollback segment may grow too big, filling up your
      tablespace.
    </p><p>
      The physical size of an undo log record in the rollback segment is
      typically smaller than the corresponding inserted or updated row.
      You can use this information to calculate the space needed for
      your rollback segment.
    </p><p>
      In the <code class="literal">InnoDB</code> multi-versioning scheme, a row is
      not physically removed from the database immediately when you
      delete it with an SQL statement. <code class="literal">InnoDB</code> only
      physically removes the corresponding row and its index records
      when it discards the update undo log record written for the
      deletion. This removal operation is called a
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_purge" target="_top">purge</a>, and it is quite fast,
      usually taking the same order of time as the SQL statement that
      did the deletion.
    </p><p>
      If you insert and delete rows in smallish batches at about the
      same rate in the table, the purge thread can start to lag behind
      and the table can grow bigger and bigger because of all the
      “<span class="quote">dead</span>” rows, making everything disk-bound and very
      slow In such a case, throttle new row operations, and allocate
      more resources to the purge thread by tuning the
      <a href="storage-engines.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a> system
      variable. See <a href="storage-engines.html#innodb-parameters" title="13.3.4. InnoDB Startup Options and System Variables">Section 13.3.4, “<code class="literal">InnoDB</code> Startup Options and System Variables”</a> for more
      information.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-table-and-index"></a>13.3.11. <code class="literal">InnoDB</code> Table and Index Structures</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-index-types">13.3.11.1. Clustered and Secondary Indexes</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-physical-structure">13.3.11.2. Physical Structure of an InnoDB Index</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-insert-buffering">13.3.11.3. Insert Buffering</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-adaptive-hash">13.3.11.4. Adaptive Hash Indexes</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-physical-record">13.3.11.5. Physical Row Structure</a></span></dt></dl></div><a class="indexterm" name="id1127071"></a><a class="indexterm" name="id1127084"></a><h4><a name="id1127096"></a>
      Role of the .frm File
    </h4><p>
      MySQL stores its data dictionary information for tables in
      <code class="filename">.frm</code> files in database directories. This is
      true for all MySQL storage engines, but every
      <code class="literal">InnoDB</code> table also has its own entry in the
      <code class="literal">InnoDB</code> internal data dictionary inside the
      tablespace. When MySQL drops a table or a database, it has to
      delete one or more <code class="filename">.frm</code> files as well as the
      corresponding entries inside the <code class="literal">InnoDB</code> data
      dictionary. Consequently, you cannot move
      <code class="literal">InnoDB</code> tables between databases simply by
      moving the <code class="filename">.frm</code> files.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-index-types"></a>13.3.11.1. Clustered and Secondary Indexes</h4></div></div></div><a class="indexterm" name="id1127156"></a><a class="indexterm" name="id1127169"></a><a class="indexterm" name="id1127181"></a><a class="indexterm" name="id1127194"></a><p>
        Every <code class="literal">InnoDB</code> table has a special index called
        the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_clustered_index" target="_top">clustered index</a>
        where the data for the rows is stored. Typically, the clustered
        index is synonymous with the
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_primary_key" target="_top">primary key</a>. To get the
        best performance from queries, inserts, and other database
        operations, you must understand how InnoDB uses the clustered
        index to optimize the most common lookup and DML operations for
        each table.
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            If you define a <code class="literal">PRIMARY KEY</code> on your
            table, <code class="literal">InnoDB</code> uses it as the clustered
            index. Define a primary key for each table that you create.
            If there is no logical unique and non-null column or set of
            columns, add a new
            <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_auto_increment" target="_top">auto-increment</a>
            column, whose values are filled in automatically.
          </p></li><li><p>
            If you do not define a <code class="literal">PRIMARY KEY</code> for
            your table, MySQL locates the first
            <code class="literal">UNIQUE</code> index where all the key columns
            are <code class="literal">NOT NULL</code> and
            <code class="literal">InnoDB</code> uses it as the clustered index.
          </p></li><li><p>
            If the table has no <code class="literal">PRIMARY KEY</code> or
            suitable <code class="literal">UNIQUE</code> index,
            <code class="literal">InnoDB</code> internally generates a hidden
            clustered index on a synthetic column containing row ID
            values. The rows are ordered by the ID that
            <code class="literal">InnoDB</code> assigns to the rows in such a
            table. The row ID is a 6-byte field that increases
            monotonically as new rows are inserted. Thus, the rows
            ordered by the row ID are physically in insertion order.
          </p></li></ul></div><h5><a name="id1127328"></a>
        How the Clustered Index Speeds Up Queries
      </h5><p>
        Accessing a row through the clustered index is fast because the
        row data is on the same page where the index search leads. If a
        table is large, the clustered index architecture often saves a
        disk I/O operation when compared to storage organizations that
        store row data using a different page from the index record.
        (For example, <code class="literal">MyISAM</code> uses one file for data
        rows and another for index records.)
      </p><h5><a name="id1127345"></a>
        How Secondary Indexes Relate to the Clustered Index
      </h5><p>
        All indexes other than the clustered index are known as
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_secondary_index" target="_top">secondary indexes</a>.
        In <code class="literal">InnoDB</code>, each record in a secondary index
        contains the primary key columns for the row, as well as the
        columns specified for the secondary index.
        <code class="literal">InnoDB</code> uses this primary key value to search
        for the row in the clustered index.
      </p><p>
        If the primary key is long, the secondary indexes use more
        space, so it is advantageous to have a short primary key.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-physical-structure"></a>13.3.11.2. Physical Structure of an InnoDB Index</h4></div></div></div><a class="indexterm" name="id1127387"></a><a class="indexterm" name="id1127399"></a><a class="indexterm" name="id1127412"></a><p>
        All <code class="literal">InnoDB</code> indexes are B-trees where the
        index records are stored in the leaf pages of the tree. The
        default size of an index page is 16KB. When new records are
        inserted, <code class="literal">InnoDB</code> tries to leave 1/16 of the
        page free for future insertions and updates of the index
        records.
      </p><p>
        If index records are inserted in a sequential order (ascending
        or descending), the resulting index pages are about 15/16 full.
        If records are inserted in a random order, the pages are from
        1/2 to 15/16 full. If the fill factor of an index page drops
        below 1/2, <code class="literal">InnoDB</code> tries to contract the index
        tree to free the page.
      </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
          Changing the page size is not a supported operation and there
          is no guarantee that <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> will
          function normally with a page size other than 16KB. Problems
          compiling or running InnoDB may occur. In particular,
          <code class="literal">ROW_FORMAT=COMPRESSED</code> in the Barracuda file
          format assumes that the page size is at most 16KB and uses
          14-bit pointers.
        </p><p xmlns="">
          A version of <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> built for one
          page size cannot use data files or log files from a version
          built for a different page size.
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-insert-buffering"></a>13.3.11.3. Insert Buffering</h4></div></div></div><a class="indexterm" name="id1127494"></a><a class="indexterm" name="id1127506"></a><p>
        Database applications often insert new rows in the ascending
        order of the primary key. In this case, due to the layout of the
        clustered index in the same order as the primary key, insertions
        into an InnoDB table do not require random reads from a disk.
      </p><p>
        On the other hand, secondary indexes are usually nonunique, and
        insertions into secondary indexes happen in a relatively random
        order. In the same way, deletes and updates can affect data
        pages that are not adjacent in secondary indexes. This would
        cause a lot of random disk I/O operations without a special
        mechanism used in <code class="literal">InnoDB</code>.
      </p><p>
        When an index record is inserted, marked for deletion, or
        deleted from a nonunique secondary index,
        <code class="literal">InnoDB</code> checks whether the secondary index
        page is in the buffer pool. If that is the case,
        <code class="literal">InnoDB</code> applies the change directly to the
        index page. If the index page is not found in the buffer pool,
        <code class="literal">InnoDB</code> records the change in a special
        structure known as the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_insert_buffer" target="_top">insert
        buffer</a>. The insert buffer is kept small so that it fits
        entirely in the buffer pool, and changes can be applied very
        quickly. This process is known as
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_change_buffering" target="_top">change buffering</a>.
        (Formerly, it applied only to inserts and was called insert
        buffering. The data structure is still called the insert
        buffer.)
      </p><h5><a name="id1127573"></a>
        Disk I/O for Flushing the Insert Buffer
      </h5><p>
        Periodically, the insert buffer is merged into the secondary
        index trees in the database. Often, it is possible to merge
        several changes into the same page of the index tree, saving
        disk I/O operations. It has been measured that the insert buffer
        can speed up insertions into a table up to 15 times.
      </p><p>
        The insert buffer merging may continue to happen
        <span class="emphasis"><em>after</em></span> the transaction has been committed.
        In fact, it may continue to happen after a server shutdown and
        restart (see <a href="storage-engines.html#forcing-innodb-recovery" title="13.3.7.2. Forcing InnoDB Recovery">Section 13.3.7.2, “Forcing <code class="literal">InnoDB</code> Recovery”</a>).
      </p><p>
        Insert buffer merging may take many hours when many secondary
        indexes must be updated and many rows have been inserted. During
        this time, disk I/O will be increased, which can cause
        significant slowdown on disk-bound queries. Another significant
        background I/O operation is the purge thread (see
        <a href="storage-engines.html#innodb-multi-versioning" title="13.3.10. InnoDB Multi-Versioning">Section 13.3.10, “<code class="literal">InnoDB</code> Multi-Versioning”</a>).
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-adaptive-hash"></a>13.3.11.4. Adaptive Hash Indexes</h4></div></div></div><a class="indexterm" name="id1127616"></a><a class="indexterm" name="id1127629"></a><p>
        The feature known as the
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_adaptive_hash_index" target="_top">adaptive hash
        index</a> lets <code class="literal">InnoDB</code> perform more like an
        in-memory database on systems with appropriate combinations of
        workload and ample memory for the buffer pool, without
        sacrificing any transactional features or reliability.
      </p><p>
        If a table fits almost entirely in main memory, a hash index can
        speed up queries by enabling direct lookup of any element,
        turning the index value into a sort of pointer.
        <code class="literal">InnoDB</code> has a mechanism that monitors index
        searches. If <code class="literal">InnoDB</code> notices that queries
        could benefit from building a hash index, it does so
        automatically.
      </p><p>
        The hash index is always built based on an existing B-tree index
        on the table. <code class="literal">InnoDB</code> can build a hash index
        on a prefix of any length of the key defined for the B-tree,
        depending on the pattern of searches that
        <code class="literal">InnoDB</code> observes for the B-tree index. A hash
        index can be partial, covering only those pages of the index
        that are often accessed.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-physical-record"></a>13.3.11.5. Physical Row Structure</h4></div></div></div><a class="indexterm" name="id1127701"></a><p>
        The physical row structure for an <code class="literal">InnoDB</code>
        table depends on the row format specified when the table was
        created. <code class="literal">InnoDB</code> uses the
        <code class="literal">COMPACT</code> format by default, but the
        <code class="literal">REDUNDANT</code> format is available to retain
        compatibility with older versions of MySQL. To check the row
        format of an <code class="literal">InnoDB</code> table, use
        <a href="sql-syntax.html#show-table-status" title="12.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a>.
      </p><p>
        The compact row format decreases row storage space by about 20%
        at the cost of increasing CPU use for some operations. If your
        workload is a typical one that is limited by cache hit rates and
        disk speed, compact format is likely to be faster. If the
        workload is a rare case that is limited by CPU speed, compact
        format might be slower.
      </p><p>
        Rows in <code class="literal">InnoDB</code> tables that use
        <code class="literal">REDUNDANT</code> row format have the following
        characteristics:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Each index record contains a six-byte header. The header is
            used to link together consecutive records, and also in
            row-level locking.
          </p></li><li><p>
            Records in the clustered index contain fields for all
            user-defined columns. In addition, there is a six-byte
            transaction ID field and a seven-byte roll pointer field.
          </p></li><li><p>
            If no primary key was defined for a table, each clustered
            index record also contains a six-byte row ID field.
          </p></li><li><p>
            Each secondary index record also contains all the primary
            key fields defined for the clustered index key that are not
            in the secondary index.
          </p></li><li><p>
            A record contains a pointer to each field of the record. If
            the total length of the fields in a record is less than 128
            bytes, the pointer is one byte; otherwise, two bytes. The
            array of these pointers is called the record directory. The
            area where these pointers point is called the data part of
            the record.
          </p></li><li><p>
            Internally, <code class="literal">InnoDB</code> stores fixed-length
            character columns such as
            <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">CHAR(10)</code></a> in a fixed-length
            format. <code class="literal">InnoDB</code> does not truncate trailing
            spaces from <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> columns.
          </p></li><li><p>
            An SQL <code class="literal">NULL</code> value reserves one or two
            bytes in the record directory. Besides that, an SQL
            <code class="literal">NULL</code> value reserves zero bytes in the
            data part of the record if stored in a variable length
            column. In a fixed-length column, it reserves the fixed
            length of the column in the data part of the record.
            Reserving the fixed space for <code class="literal">NULL</code> values
            enables an update of the column from <code class="literal">NULL</code>
            to a non-<code class="literal">NULL</code> value to be done in place
            without causing fragmentation of the index page.
          </p></li></ul></div><p>
        Rows in <code class="literal">InnoDB</code> tables that use
        <code class="literal">COMPACT</code> row format have the following
        characteristics:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Each index record contains a five-byte header that may be
            preceded by a variable-length header. The header is used to
            link together consecutive records, and also in row-level
            locking.
          </p></li><li><p>
            The variable-length part of the record header contains a bit
            vector for indicating <code class="literal">NULL</code> columns. If
            the number of columns in the index that can be
            <code class="literal">NULL</code> is <em class="replaceable"><code>N</code></em>, the
            bit vector occupies
            <code class="literal">CEILING(<em class="replaceable"><code>N</code></em>/8)</code>
            bytes. (For example, if there are anywhere from 9 to 15
            columns that can be <code class="literal">NULL</code>, the bit vector
            uses two bytes.) Columns that are <code class="literal">NULL</code> do
            not occupy space other than the bit in this vector. The
            variable-length part of the header also contains the lengths
            of variable-length columns. Each length takes one or two
            bytes, depending on the maximum length of the column. If all
            columns in the index are <code class="literal">NOT NULL</code> and
            have a fixed length, the record header has no
            variable-length part.
          </p></li><li><p>
            For each non-<code class="literal">NULL</code> variable-length field,
            the record header contains the length of the column in one
            or two bytes. Two bytes will only be needed if part of the
            column is stored externally in overflow pages or the maximum
            length exceeds 255 bytes and the actual length exceeds 127
            bytes. For an externally stored column, the two-byte length
            indicates the length of the internally stored part plus the
            20-byte pointer to the externally stored part. The internal
            part is 768 bytes, so the length is 768+20. The 20-byte
            pointer stores the true length of the column.
          </p></li><li><p>
            The record header is followed by the data contents of the
            non-<code class="literal">NULL</code> columns.
          </p></li><li><p>
            Records in the clustered index contain fields for all
            user-defined columns. In addition, there is a six-byte
            transaction ID field and a seven-byte roll pointer field.
          </p></li><li><p>
            If no primary key was defined for a table, each clustered
            index record also contains a six-byte row ID field.
          </p></li><li><p>
            Each secondary index record also contains all the primary
            key fields defined for the clustered index key that are not
            in the secondary index. If any of these primary key fields
            are variable length, the record header for each secondary
            index will have a variable-length part to record their
            lengths, even if the secondary index is defined on
            fixed-length columns.
          </p></li><li><p>
            Internally, <code class="literal">InnoDB</code> stores fixed-length,
            fixed-width character columns such as
            <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">CHAR(10)</code></a> in a fixed-length
            format. <code class="literal">InnoDB</code> does not truncate trailing
            spaces from <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> columns.
          </p></li><li><p>
            Internally, <code class="literal">InnoDB</code> attempts to store
            UTF-8
            <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>
            columns in <em class="replaceable"><code>N</code></em> bytes by trimming
            trailing spaces. (With <code class="literal">REDUNDANT</code> row
            format, such columns occupy 3 ×
            <em class="replaceable"><code>N</code></em> bytes.) Reserving the minimum
            space <em class="replaceable"><code>N</code></em> in many cases enables
            column updates to be done in place without causing
            fragmentation of the index page.
          </p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-disk-management"></a>13.3.12. <code class="literal">InnoDB</code> Disk I/O and File Space Management</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-disk-io">13.3.12.1. <code class="literal">InnoDB</code> Disk I/O</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-file-space">13.3.12.2. File Space Management</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-file-defragmenting">13.3.12.3. Defragmenting a Table</a></span></dt></dl></div><p>
      The laws of physics dictate that it takes time and effort to read
      and write data. The ACID design model requires a certain amount of
      I/O that might seem redundant, but helps to ensure data
      reliability. Within these constraints, InnoDB tries to optimize
      the database work and the organization of disk files to minimize
      the amount of disk I/O. Sometimes, I/O is postponed until the
      database is not busy, or until everything needs to be brought to a
      consistent state, such as during a database restart after a crash.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-disk-io"></a>13.3.12.1. <code class="literal">InnoDB</code> Disk I/O</h4></div></div></div><a class="indexterm" name="id1128151"></a><p>
        <code class="literal">InnoDB</code> uses asynchronous disk I/O where
        possible, by creating a number of threads to handle I/O
        operations, while permitting other database operations to
        proceed while the I/O is still in progress. On Linux and Windows
        platforms, InnoDB uses the available OS and library functions to
        perform “<span class="quote">native</span>” asynchronous I/O. On other
        platforms, InnoDB still uses I/O threads, but the threads may
        actually wait for I/O requests to complete; this technique is
        known as “<span class="quote">simulated</span>” asynchronous I/O.
      </p><h5><a name="id1128184"></a>
        Read-Ahead
      </h5><p>
        If InnoDB can determine there is a high probability that data
        might be needed soon, it performs read-ahead operations to bring
        that data into the buffer pool so that it is available in
        memory. Making a few large read requests for contiguous data can
        be more efficient than making several small, spread-out
        requests. There are two read-ahead heuristics in InnoDB:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            In sequential read-ahead, if <code class="literal">InnoDB</code>
            notices that the access pattern to a segment in the
            tablespace is sequential, it posts in advance a batch of
            reads of database pages to the I/O system.
          </p></li><li><p>
            In random read-ahead, if <code class="literal">InnoDB</code> notices
            that some area in a tablespace seems to be in the process of
            being fully read into the buffer pool, it posts the
            remaining reads to the I/O system.
          </p></li></ul></div><h5><a name="id1128226"></a>
        Doublewrite Buffer
      </h5><p>
        <code class="literal">InnoDB</code> uses a novel file flush technique
        involving a structure called the
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_doublewrite_buffer" target="_top">doublewrite
        buffer</a>. It adds safety to recovery following an operating
        system crash or a power outage, and improves performance on most
        varieties of Unix by reducing the need for
        <code class="literal">fsync()</code> operations.
      </p><p>
        Before writing pages to a data file, <code class="literal">InnoDB</code>
        first writes them to a contiguous tablespace area called the
        doublewrite buffer. Only after the write and the flush to the
        doublewrite buffer has completed does <code class="literal">InnoDB</code>
        write the pages to their proper positions in the data file. If
        the operating system crashes in the middle of a page write,
        <code class="literal">InnoDB</code> can later find a good copy of the page
        from the doublewrite buffer during recovery.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-file-space"></a>13.3.12.2. File Space Management</h4></div></div></div><a class="indexterm" name="id1128288"></a><p>
        The data files that you define in the configuration file form
        the <code class="literal">InnoDB</code>
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_system_tablespace" target="_top">system tablespace</a>.
        The files are logically concatenated to form the tablespace.
        There is no striping in use. Currently, you cannot define where
        within the tablespace your tables are allocated. However, in a
        newly created tablespace, <code class="literal">InnoDB</code> allocates
        space starting from the first data file.
      </p><p>
        To avoid the issues that come with storing all tables and
        indexes inside the system tablespace, you can turn on the
        <code class="literal">innodb_file_per_table</code> configuration option,
        which stores each newly created table in a separate tablespace
        file (with extension <code class="literal">.ibd</code>). For tables stored
        this way, there is less fragmentation within the disk file, and
        when the table is truncated, the space is returned to the
        operating system rather than still being reserved by InnoDB
        within the system tablespace.
      </p><h5><a name="id1128344"></a>
        Pages, Extents, Segments, and Tablespaces
      </h5><p>
        Each tablespace consists of database pages with a default size
        of 16KB. The pages are grouped into extents of size 1MB (64
        consecutive pages). The “<span class="quote">files</span>” inside a tablespace
        are called <em class="firstterm">segments</em> in
        <code class="literal">InnoDB</code>. (These segments are different from
        the “<span class="quote">rollback segment</span>”, which actually contains
        many tablespace segments.)
      </p><p>
        When a segment grows inside the tablespace,
        <code class="literal">InnoDB</code> allocates the first 32 pages to it
        individually. After that, <code class="literal">InnoDB</code> starts to
        allocate whole extents to the segment. <code class="literal">InnoDB</code>
        can add up to 4 extents at a time to a large segment to ensure
        good sequentiality of data.
      </p><p>
        Two segments are allocated for each index in
        <code class="literal">InnoDB</code>. One is for nonleaf nodes of the
        B-tree, the other is for the leaf nodes. Keeping the leaf nodes
        contiguous on disk enables better sequential I/O operations,
        because these leaf nodes contain the actual table data.
      </p><p>
        Some pages in the tablespace contain bitmaps of other pages, and
        therefore a few extents in an <code class="literal">InnoDB</code>
        tablespace cannot be allocated to segments as a whole, but only
        as individual pages.
      </p><p>
        When you ask for available free space in the tablespace by
        issuing a <a href="sql-syntax.html#show-table-status" title="12.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a>
        statement, <code class="literal">InnoDB</code> reports the extents that
        are definitely free in the tablespace. <code class="literal">InnoDB</code>
        always reserves some extents for cleanup and other internal
        purposes; these reserved extents are not included in the free
        space.
      </p><p>
        When you delete data from a table, <code class="literal">InnoDB</code>
        contracts the corresponding B-tree indexes. Whether the freed
        space becomes available for other users depends on whether the
        pattern of deletes frees individual pages or extents to the
        tablespace. Dropping a table or deleting all rows from it is
        guaranteed to release the space to other users, but remember
        that deleted rows are physically removed only in an (automatic)
        purge operation after they are no longer needed for transaction
        rollbacks or consistent reads. (See
        <a href="storage-engines.html#innodb-multi-versioning" title="13.3.10. InnoDB Multi-Versioning">Section 13.3.10, “<code class="literal">InnoDB</code> Multi-Versioning”</a>.)
      </p><a class="indexterm" name="id1128461"></a><a class="indexterm" name="id1128473"></a><a class="indexterm" name="id1128486"></a><p>
        To see information about the tablespace, use the Tablespace
        Monitor. See <a href="storage-engines.html#innodb-monitors" title="13.3.14.2. SHOW ENGINE INNODB
        STATUS and the InnoDB Monitors">Section 13.3.14.2, “<code class="literal">SHOW ENGINE INNODB
        STATUS</code> and the <code class="literal">InnoDB</code> Monitors”</a>.
      </p><h5><a name="id1128507"></a>
        How Pages Relate to Table Rows
      </h5><p>
        The maximum row length, except for variable-length columns
        (<a href="data-types.html#binary-varbinary" title="10.4.2. The BINARY and
        VARBINARY Types"><code class="literal">VARBINARY</code></a>,
        <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a>,
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> and
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a>), is slightly less than half
        of a database page. That is, the maximum row length is about
        8000 bytes. <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">LONGBLOB</code></a> and
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">LONGTEXT</code></a> columns
        must be less than 4GB, and the total row length, including
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> and
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a> columns, must be less than
        4GB.
      </p><p>
        If a row is less than half a page long, all of it is stored
        locally within the page. If it exceeds half a page,
        variable-length columns are chosen for external off-page storage
        until the row fits within half a page. For a column chosen for
        off-page storage, <code class="literal">InnoDB</code> stores the first 768
        bytes locally in the row, and the rest externally into overflow
        pages. Each such column has its own list of overflow pages. The
        768-byte prefix is accompanied by a 20-byte value that stores
        the true length of the column and points into the overflow list
        where the rest of the value is stored.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-file-defragmenting"></a>13.3.12.3. Defragmenting a Table</h4></div></div></div><a class="indexterm" name="id1128597"></a><p>
        Random insertions into or deletions from a secondary index may
        cause the index to become fragmented. Fragmentation means that
        the physical ordering of the index pages on the disk is not
        close to the index ordering of the records on the pages, or that
        there are many unused pages in the 64-page blocks that were
        allocated to the index.
      </p><p>
        One symptom of fragmentation is that a table takes more space
        than it “<span class="quote">should</span>” take. How much that is exactly, is
        difficult to determine. All <code class="literal">InnoDB</code> data and
        indexes are stored in B-trees, and their fill factor may vary
        from 50% to 100%. Another symptom of fragmentation is that a
        table scan such as this takes more time than it
        “<span class="quote">should</span>” take:
      </p><pre class="programlisting">SELECT COUNT(*) FROM t WHERE a_non_indexed_column &lt;&gt; 12345;</pre><p>
        The preceding query requires MySQL to scan the clustered index
        rather than a secondary index. Most disks can read 10MB/s to
        50MB/s, which can be used to estimate how fast a table scan
        should be.
      </p><p>
        To speed up index scans, you can periodically perform a
        “<span class="quote">null</span>” <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
        operation, which causes MySQL to rebuild the table:
      </p><pre class="programlisting">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ENGINE=INNODB
</pre><p>
        Another way to perform a defragmentation operation is to use
        <a href="programs.html#mysqldump" title="4.5.4. mysqldump — A Database Backup Program"><span><strong class="command">mysqldump</strong></span></a> to dump the table to a text file,
        drop the table, and reload it from the dump file.
      </p><p>
        If the insertions into an index are always ascending and records
        are deleted only from the end, the <code class="literal">InnoDB</code>
        filespace management algorithm guarantees that fragmentation in
        the index does not occur.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-error-handling"></a>13.3.13. <code class="literal">InnoDB</code> Error Handling</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-error-codes">13.3.13.1. <code class="literal">InnoDB</code> Error Codes</a></span></dt><dt><span class="section"><a href="storage-engines.html#operating-system-error-codes">13.3.13.2. Operating System Error Codes</a></span></dt></dl></div><a class="indexterm" name="id1128712"></a><p>
      Error handling in <code class="literal">InnoDB</code> is not always the same
      as specified in the SQL standard. According to the standard, any
      error during an SQL statement should cause rollback of that
      statement. <code class="literal">InnoDB</code> sometimes rolls back only
      part of the statement, or the whole transaction. The following
      items describe how <code class="literal">InnoDB</code> performs error
      handling:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          If you run out of file space in the tablespace, a MySQL
          <code class="literal">Table is full</code> error occurs and
          <code class="literal">InnoDB</code> rolls back the SQL statement.
        </p></li><li><p>
          A transaction deadlock causes <code class="literal">InnoDB</code> to
          roll back the entire transaction. Retry the whole transaction
          when this happens.
        </p><p>
          A lock wait timeout causes <code class="literal">InnoDB</code> to roll
          back only the single statement that was waiting for the lock
          and encountered the timeout. (To have the entire transaction
          roll back, start the server with the
          <a href="storage-engines.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a>
          option.) Retry the statement if using the current behavior, or
          the entire transaction if using
          <a href="storage-engines.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a>.
        </p><p>
          Both deadlocks and lock wait timeouts are normal on busy
          servers and it is necessary for applications to be aware that
          they may happen and handle them by retrying. You can make them
          less likely by doing as little work as possible between the
          first change to data during a transaction and the commit, so
          the locks are held for the shortest possible time and for the
          smallest possible number of rows. Sometimes splitting work
          between different transactions may be practical and helpful.
        </p><p>
          When a transaction rollback occurs due to a deadlock or lock
          wait timeout, it cancels the effect of the statements within
          the transaction. But if the start-transaction statement was
          <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">START
          TRANSACTION</code></a> or
          <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">BEGIN</code></a>
          statement, rollback does not cancel that statement. Further
          SQL statements become part of the transaction until the
          occurrence of <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">COMMIT</code></a>,
          <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>, or
          some SQL statement that causes an implicit commit.
        </p></li><li><p>
          A duplicate-key error rolls back the SQL statement, if you
          have not specified the <code class="literal">IGNORE</code> option in
          your statement.
        </p></li><li><p>
          A <code class="literal">row too long error</code> rolls back the SQL
          statement.
        </p></li><li><p>
          Other errors are mostly detected by the MySQL layer of code
          (above the <code class="literal">InnoDB</code> storage engine level),
          and they roll back the corresponding SQL statement. Locks are
          not released in a rollback of a single SQL statement.
        </p></li></ul></div><p>
      During implicit rollbacks, as well as during the execution of an
      explicit
      <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> SQL
      statement, <a href="sql-syntax.html#show-processlist" title="12.7.5.30. SHOW PROCESSLIST Syntax"><code class="literal">SHOW PROCESSLIST</code></a>
      displays <code class="literal">Rolling back</code> in the
      <code class="literal">State</code> column for the relevant connection.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-error-codes"></a>13.3.13.1. <code class="literal">InnoDB</code> Error Codes</h4></div></div></div><a class="indexterm" name="id1128943"></a><p>
        The following is a nonexhaustive list of common
        <code class="literal">InnoDB</code>-specific errors that you may
        encounter, with information about why each occurs and how to
        resolve the problem.
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <code class="literal">1005 (ER_CANT_CREATE_TABLE)</code>
          </p><p>
            Cannot create table. If the error message refers to error
            150, table creation failed because a foreign key constraint
            was not correctly formed. If the error message refers to
            error –1, table creation probably failed because the
            table includes a column name that matched the name of an
            internal <code class="literal">InnoDB</code> table.
          </p></li><li><p>
            <code class="literal">1016 (ER_CANT_OPEN_FILE)</code>
          </p><p>
            Cannot find the <code class="literal">InnoDB</code> table from the
            <code class="literal">InnoDB</code> data files, although the
            <code class="filename">.frm</code> file for the table exists. See
            <a href="storage-engines.html#innodb-troubleshooting-datadict" title="13.3.14.4. Troubleshooting InnoDB Data Dictionary Operations">Section 13.3.14.4, “Troubleshooting <code class="literal">InnoDB</code> Data Dictionary Operations”</a>.
          </p></li><li><p>
            <code class="literal">1114 (ER_RECORD_FILE_FULL)</code>
          </p><p>
            <code class="literal">InnoDB</code> has run out of free space in the
            tablespace. Reconfigure the tablespace to add a new data
            file.
          </p></li><li><p>
            <code class="literal">1205 (ER_LOCK_WAIT_TIMEOUT)</code>
          </p><p>
            Lock wait timeout expired. Transaction was rolled back.
          </p></li><li><p>
            <code class="literal">1206 (ER_LOCK_TABLE_FULL)</code>
          </p><p>
            The total number of locks exceeds the lock table size. To
            avoid this error, increase the value of
            <a href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>.
            Within an individual application, a workaround may be to
            break a large operation into smaller pieces. For example, if
            the error occurs for a large
            <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>, perform several
            smaller <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> operations.
          </p></li><li><p>
            <code class="literal">1213 (ER_LOCK_DEADLOCK)</code>
          </p><p>
            Transaction deadlock. Rerun the transaction.
          </p></li><li><p>
            <code class="literal">1216 (ER_NO_REFERENCED_ROW)</code>
          </p><p>
            You are trying to add a row but there is no parent row, and
            a foreign key constraint fails. Add the parent row first.
          </p></li><li><p>
            <code class="literal">1217 (ER_ROW_IS_REFERENCED)</code>
          </p><p>
            You are trying to delete a parent row that has children, and
            a foreign key constraint fails. Delete the children first.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="operating-system-error-codes"></a>13.3.13.2. Operating System Error Codes</h4></div></div></div><a class="indexterm" name="id1129177"></a><p>
        To print the meaning of an operating system error number, use
        the <a href="programs.html#perror" title="4.8.1. perror — Explain Error Codes"><span><strong class="command">perror</strong></span></a> program that comes with the MySQL
        distribution.
      </p><div class="itemizedlist"><ul type="disc"><li><p><a name="operating-system-error-codes-linux"></a>
            <span class="bold"><strong>Linux System Error Codes</strong></span>
          </p><p>
            The following table provides a list of some common Linux
            system error codes. For a more complete list, see
            <a href="http://www.finalcog.com/c-error-codes-include-errno" target="_top">Linux
            source code</a>.
          </p><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Number</th><th>Macro</th><th>Description</th></tr></thead><tbody><tr><td>1</td><td><code class="literal">EPERM</code></td><td>Operation not permitted</td></tr><tr><td>2</td><td><code class="literal">ENOENT</code></td><td>No such file or directory</td></tr><tr><td>3</td><td><code class="literal">ESRCH</code></td><td>No such process</td></tr><tr><td>4</td><td><code class="literal">EINTR</code></td><td>Interrupted system call</td></tr><tr><td>5</td><td><code class="literal">EIO</code></td><td>I/O error</td></tr><tr><td>6</td><td><code class="literal">ENXIO</code></td><td>No such device or address</td></tr><tr><td>7</td><td><code class="literal">E2BIG</code></td><td>Arg list too long</td></tr><tr><td>8</td><td><code class="literal">ENOEXEC</code></td><td>Exec format error</td></tr><tr><td>9</td><td><code class="literal">EBADF</code></td><td>Bad file number</td></tr><tr><td>10</td><td><code class="literal">ECHILD</code></td><td>No child processes</td></tr><tr><td>11</td><td><code class="literal">EAGAIN</code></td><td>Try again</td></tr><tr><td>12</td><td><code class="literal">ENOMEM</code></td><td>Out of memory</td></tr><tr><td>13</td><td><code class="literal">EACCES</code></td><td>Permission denied</td></tr><tr><td>14</td><td><code class="literal">EFAULT</code></td><td>Bad address</td></tr><tr><td>15</td><td><code class="literal">ENOTBLK</code></td><td>Block device required</td></tr><tr><td>16</td><td><code class="literal">EBUSY</code></td><td>Device or resource busy</td></tr><tr><td>17</td><td><code class="literal">EEXIST</code></td><td>File exists</td></tr><tr><td>18</td><td><code class="literal">EXDEV</code></td><td>Cross-device link</td></tr><tr><td>19</td><td><code class="literal">ENODEV</code></td><td>No such device</td></tr><tr><td>20</td><td><code class="literal">ENOTDIR</code></td><td>Not a directory</td></tr><tr><td>21</td><td><code class="literal">EISDIR</code></td><td>Is a directory</td></tr><tr><td>22</td><td><code class="literal">EINVAL</code></td><td>Invalid argument</td></tr><tr><td>23</td><td><code class="literal">ENFILE</code></td><td>File table overflow</td></tr><tr><td>24</td><td><code class="literal">EMFILE</code></td><td>Too many open files</td></tr><tr><td>25</td><td><code class="literal">ENOTTY</code></td><td>Inappropriate ioctl for device</td></tr><tr><td>26</td><td><code class="literal">ETXTBSY</code></td><td>Text file busy</td></tr><tr><td>27</td><td><code class="literal">EFBIG</code></td><td>File too large</td></tr><tr><td>28</td><td><code class="literal">ENOSPC</code></td><td>No space left on device</td></tr><tr><td>29</td><td><code class="literal">ESPIPE</code></td><td>Illegal seek</td></tr><tr><td>30</td><td><code class="literal">EROFS</code></td><td>Read-only file system</td></tr><tr><td>31</td><td><code class="literal">EMLINK</code></td><td>Too many links</td></tr></tbody></table></div></li><li><p><a name="operating-system-error-codes-windows"></a>
            <span class="bold"><strong>Windows System Error Codes</strong></span>
          </p><p>
            The following table provides a list of some common Windows
            system error codes. For a complete list, see the
            <a href="http://msdn.microsoft.com/en-us/library/ms681381.aspx" target="_top">Microsoft
            Web site</a>.
          </p><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Number</th><th>Macro</th><th>Description</th></tr></thead><tbody><tr><td>1</td><td><code class="literal">ERROR_INVALID_FUNCTION</code></td><td>Incorrect function.</td></tr><tr><td>2</td><td><code class="literal">ERROR_FILE_NOT_FOUND</code></td><td>The system cannot find the file specified.</td></tr><tr><td>3</td><td><code class="literal">ERROR_PATH_NOT_FOUND</code></td><td>The system cannot find the path specified.</td></tr><tr><td>4</td><td><code class="literal">ERROR_TOO_MANY_OPEN_FILES</code></td><td>The system cannot open the file.</td></tr><tr><td>5</td><td><code class="literal">ERROR_ACCESS_DENIED</code></td><td>Access is denied.</td></tr><tr><td>6</td><td><code class="literal">ERROR_INVALID_HANDLE</code></td><td>The handle is invalid.</td></tr><tr><td>7</td><td><code class="literal">ERROR_ARENA_TRASHED</code></td><td>The storage control blocks were destroyed.</td></tr><tr><td>8</td><td><code class="literal">ERROR_NOT_ENOUGH_MEMORY</code></td><td>Not enough storage is available to process this command.</td></tr><tr><td>9</td><td><code class="literal">ERROR_INVALID_BLOCK</code></td><td>The storage control block address is invalid.</td></tr><tr><td>10</td><td><code class="literal">ERROR_BAD_ENVIRONMENT</code></td><td>The environment is incorrect.</td></tr><tr><td>11</td><td><code class="literal">ERROR_BAD_FORMAT</code></td><td>An attempt was made to load a program with an incorrect format.</td></tr><tr><td>12</td><td><code class="literal">ERROR_INVALID_ACCESS</code></td><td>The access code is invalid.</td></tr><tr><td>13</td><td><code class="literal">ERROR_INVALID_DATA</code></td><td>The data is invalid.</td></tr><tr><td>14</td><td><code class="literal">ERROR_OUTOFMEMORY</code></td><td>Not enough storage is available to complete this operation.</td></tr><tr><td>15</td><td><code class="literal">ERROR_INVALID_DRIVE</code></td><td>The system cannot find the drive specified.</td></tr><tr><td>16</td><td><code class="literal">ERROR_CURRENT_DIRECTORY</code></td><td>The directory cannot be removed.</td></tr><tr><td>17</td><td><code class="literal">ERROR_NOT_SAME_DEVICE</code></td><td>The system cannot move the file to a different disk drive.</td></tr><tr><td>18</td><td><code class="literal">ERROR_NO_MORE_FILES</code></td><td>There are no more files.</td></tr><tr><td>19</td><td><code class="literal">ERROR_WRITE_PROTECT</code></td><td>The media is write protected.</td></tr><tr><td>20</td><td><code class="literal">ERROR_BAD_UNIT</code></td><td>The system cannot find the device specified.</td></tr><tr><td>21</td><td><code class="literal">ERROR_NOT_READY</code></td><td>The device is not ready.</td></tr><tr><td>22</td><td><code class="literal">ERROR_BAD_COMMAND</code></td><td>The device does not recognize the command.</td></tr><tr><td>23</td><td><code class="literal">ERROR_CRC</code></td><td>Data error (cyclic redundancy check).</td></tr><tr><td>24</td><td><code class="literal">ERROR_BAD_LENGTH</code></td><td>The program issued a command but the command length is incorrect.</td></tr><tr><td>25</td><td><code class="literal">ERROR_SEEK</code></td><td>The drive cannot locate a specific area or track on the disk.</td></tr><tr><td>26</td><td><code class="literal">ERROR_NOT_DOS_DISK</code></td><td>The specified disk or diskette cannot be accessed.</td></tr><tr><td>27</td><td><code class="literal">ERROR_SECTOR_NOT_FOUND</code></td><td>The drive cannot find the sector requested.</td></tr><tr><td>28</td><td><code class="literal">ERROR_OUT_OF_PAPER</code></td><td>The printer is out of paper.</td></tr><tr><td>29</td><td><code class="literal">ERROR_WRITE_FAULT</code></td><td>The system cannot write to the specified device.</td></tr><tr><td>30</td><td><code class="literal">ERROR_READ_FAULT</code></td><td>The system cannot read from the specified device.</td></tr><tr><td>31</td><td><code class="literal">ERROR_GEN_FAILURE</code></td><td>A device attached to the system is not functioning.</td></tr><tr><td>32</td><td><code class="literal">ERROR_SHARING_VIOLATION</code></td><td>The process cannot access the file because it is being used by another
                    process.</td></tr><tr><td>33</td><td><code class="literal">ERROR_LOCK_VIOLATION</code></td><td>The process cannot access the file because another process has locked a
                    portion of the file.</td></tr><tr><td>34</td><td><code class="literal">ERROR_WRONG_DISK</code></td><td>The wrong diskette is in the drive. Insert %2 (Volume Serial Number: %3)
                    into drive %1.</td></tr><tr><td>36</td><td><code class="literal">ERROR_SHARING_BUFFER_EXCEEDED</code></td><td>Too many files opened for sharing.</td></tr><tr><td>38</td><td><code class="literal">ERROR_HANDLE_EOF</code></td><td>Reached the end of the file.</td></tr><tr><td>39</td><td><code class="literal">ERROR_HANDLE_DISK_FULL</code></td><td>The disk is full.</td></tr><tr><td>87</td><td><code class="literal">ERROR_INVALID_PARAMETER</code></td><td>The parameter is incorrect.</td></tr><tr><td>112</td><td><code class="literal">ERROR_DISK_FULL</code></td><td>The disk is full.</td></tr><tr><td>123</td><td><code class="literal">ERROR_INVALID_NAME</code></td><td>The file name, directory name, or volume label syntax is incorrect.</td></tr><tr><td>1450</td><td><code class="literal">ERROR_NO_SYSTEM_RESOURCES</code></td><td>Insufficient system resources exist to complete the requested service.</td></tr></tbody></table></div></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-tuning-troubleshooting"></a>13.3.14. <code class="literal">InnoDB</code> Performance Tuning and Troubleshooting</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-tuning">13.3.14.1. <code class="literal">InnoDB</code> Performance Tuning Tips</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-monitors">13.3.14.2. <code class="literal">SHOW ENGINE INNODB
        STATUS</code> and the <code class="literal">InnoDB</code> Monitors</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-troubleshooting">13.3.14.3. <code class="literal">InnoDB</code> General Troubleshooting</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-troubleshooting-datadict">13.3.14.4. Troubleshooting <code class="literal">InnoDB</code> Data Dictionary Operations</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-tuning"></a>13.3.14.1. <code class="literal">InnoDB</code> Performance Tuning Tips</h4></div></div></div><p>
        With <code class="literal">InnoDB</code> becoming the default storage
        engine in MySQL 5.5 and higher, the tips and guidelines for
        <code class="literal">InnoDB</code> tables are now part of the main
        optimization chapter. See <a href="optimization.html#optimizing-innodb" title="7.5. Optimizing for InnoDB Tables">Section 7.5, “Optimizing for <code class="literal">InnoDB</code> Tables”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-monitors"></a>13.3.14.2. <code class="literal">SHOW ENGINE INNODB
        STATUS</code> and the <code class="literal">InnoDB</code> Monitors</h4></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-standard-monitor">13.3.14.2.1. <code class="literal">InnoDB</code> Standard Monitor and Lock Monitor Output</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-tablespace-monitor">13.3.14.2.2. <code class="literal">InnoDB</code> Tablespace Monitor Output</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-table-monitor">13.3.14.2.3. <code class="literal">InnoDB</code> Table Monitor Output</a></span></dt></dl></div><a class="indexterm" name="id1130618"></a><a class="indexterm" name="id1130631"></a><a class="indexterm" name="id1130643"></a><a class="indexterm" name="id1130656"></a><a class="indexterm" name="id1130668"></a><a class="indexterm" name="id1130680"></a><p>
        <code class="literal">InnoDB</code> Monitors provide information about the
        <code class="literal">InnoDB</code> internal state. This information is
        useful for performance tuning. Each Monitor can be enabled by
        creating a table with a special name, which causes
        <code class="literal">InnoDB</code> to write Monitor output periodically.
        Also, output for the standard <code class="literal">InnoDB</code> Monitor
        is available on demand through the
        <a href="sql-syntax.html#show-engine" title="12.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> SQL statement.
      </p><p>
        There are several types of <code class="literal">InnoDB</code> Monitors:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            The standard <code class="literal">InnoDB</code> Monitor displays the
            following types of information:
          </p><div class="itemizedlist"><ul type="circle"><li><p>
                Table and record locks held by each active transaction
              </p></li><li><p>
                Lock waits of a transactions
              </p></li><li><p>
                Semaphore waits of threads
              </p></li><li><p>
                Pending file I/O requests
              </p></li><li><p>
                Buffer pool statistics
              </p></li><li><p>
                Purge and insert buffer merge activity of the main
                <code class="literal">InnoDB</code> thread
              </p></li></ul></div><p>
            For a discussion of <code class="literal">InnoDB</code> lock modes,
            see <a href="storage-engines.html#innodb-lock-modes" title="13.3.9.1. InnoDB Lock Modes">Section 13.3.9.1, “<code class="literal">InnoDB</code> Lock Modes”</a>.
          </p><p>
            To enable the standard <code class="literal">InnoDB</code> Monitor for
            periodic output, create a table named
            <code class="literal">innodb_monitor</code>. To obtain Monitor output
            on demand, use the
            <a href="sql-syntax.html#show-engine" title="12.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
            INNODB STATUS</code></a> SQL statement to fetch the output to
            your client program. If you are using the
            <a href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span><strong class="command">mysql</strong></span></a> interactive client, the output is
            more readable if you replace the usual semicolon statement
            terminator with <code class="literal">\G</code>:
          </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW ENGINE INNODB STATUS\G</code></strong>
</pre></li><li><p>
            The <code class="literal">InnoDB</code> Lock Monitor is like the
            standard Monitor but also provides extensive lock
            information. To enable this Monitor for periodic output,
            create a table named <code class="literal">innodb_lock_monitor</code>.
          </p></li><li><p>
            The <code class="literal">InnoDB</code> Tablespace Monitor prints a
            list of file segments in the shared tablespace and validates
            the tablespace allocation data structures. To enable this
            Monitor for periodic output, create a table named
            <code class="literal">innodb_tablespace_monitor</code>.
          </p></li><li><p>
            The <code class="literal">InnoDB</code> Table Monitor prints the
            contents of the <code class="literal">InnoDB</code> internal data
            dictionary. To enable this Monitor for periodic output,
            create a table named
            <code class="literal">innodb_table_monitor</code>.
          </p></li></ul></div><p>
        To enable an <code class="literal">InnoDB</code> Monitor for periodic
        output, use a <code class="literal">CREATE TABLE</code> statement to
        create the table associated with the Monitor. For example, to
        enable the standard <code class="literal">InnoDB</code> Monitor, create
        the <code class="literal">innodb_monitor</code> table:
      </p><pre class="programlisting">CREATE TABLE innodb_monitor (a INT) ENGINE=INNODB;</pre><p>
        To stop the Monitor, drop the table:
      </p><pre class="programlisting">DROP TABLE innodb_monitor;</pre><p>
        The <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> syntax is just a
        way to pass a command to the <code class="literal">InnoDB</code> engine
        through MySQL's SQL parser: The only things that matter are the
        table name <code class="literal">innodb_monitor</code> and that it be an
        <code class="literal">InnoDB</code> table. The structure of the table is
        not relevant at all for the <code class="literal">InnoDB</code> Monitor.
        If you shut down the server, the Monitor does not restart
        automatically when you restart the server. Drop the Monitor
        table and issue a new <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a> statement to start the Monitor. (This syntax may
        change in a future release.)
      </p><p>
        The <a href="server-administration.html#priv_process"><code class="literal">PROCESS</code></a> privilege is required
        to start or stop the <code class="literal">InnoDB</code> Monitor tables.
      </p><p>
        When you enable <code class="literal">InnoDB</code> Monitors for periodic
        output, <code class="literal">InnoDB</code> writes their output to the
        <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> server standard error output
        (<code class="literal">stderr</code>). In this case, no output is sent to
        clients. When switched on, <code class="literal">InnoDB</code> Monitors
        print data about every 15 seconds. Server output usually is
        directed to the error log (see <a href="server-administration.html#error-log" title="5.2.2. The Error Log">Section 5.2.2, “The Error Log”</a>).
        This data is useful in performance tuning. On Windows, start the
        server from a command prompt in a console window with the
        <a href="server-administration.html#option_mysqld_console"><code class="option">--console</code></a> option if you want to
        direct the output to the window rather than to the error log.
      </p><p>
        <code class="literal">InnoDB</code> sends diagnostic output to
        <code class="literal">stderr</code> or to files rather than to
        <code class="literal">stdout</code> or fixed-size memory buffers, to avoid
        potential buffer overflows. As a side effect, the output of
        <a href="sql-syntax.html#show-engine" title="12.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> is written to a status file in the MySQL data
        directory every fifteen seconds. The name of the file is
        <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>,
        where <em class="replaceable"><code>pid</code></em> is the server process ID.
        <code class="literal">InnoDB</code> removes the file for a normal
        shutdown. If abnormal shutdowns have occurred, instances of
        these status files may be present and must be removed manually.
        Before removing them, you might want to examine them to see
        whether they contain useful information about the cause of
        abnormal shutdowns. The
        <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>
        file is created only if the configuration option
        <a href="storage-engines.html#option_mysqld_innodb-status-file"><code class="option">innodb-status-file=1</code></a> is set.
      </p><p>
        <code class="literal">InnoDB</code> Monitors should be enabled only when
        you actually want to see Monitor information because output
        generation does result in some performance decrement. Also, if
        you enable monitor output by creating the associated table, your
        error log may become quite large if you forget to remove the
        table later.
      </p><p>
        For additional information about <code class="literal">InnoDB</code>
        monitors, see:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Mark Leith:
            <a href="http://www.markleith.co.uk/?p=25" target="_top">InnoDB Table
            and Tablespace Monitors</a>
          </p></li></ul></div><p>
        Each monitor begins with a header containing a timestamp and the
        monitor name. For example:
      </p><pre class="programlisting">================================================
090407 12:06:19 INNODB TABLESPACE MONITOR OUTPUT
================================================</pre><p>
        The header for the standard Monitor (<code class="literal">INNODB MONITOR
        OUTPUT</code>) is also used for the Lock Monitor because the
        latter produces the same output with the addition of extra lock
        information.
      </p><p>
        The following sections describe the output for each Monitor.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-standard-monitor"></a>13.3.14.2.1. <code class="literal">InnoDB</code> Standard Monitor and Lock Monitor Output</h5></div></div></div><p>
          The Lock Monitor is the same as the standard Monitor except
          that it includes additional lock information. Enabling either
          monitor for periodic output by creating the associated
          <code class="literal">InnoDB</code> table turns on the same output
          stream, but the stream includes the extra information if the
          Lock Monitor is enabled. For example, if you create the
          <code class="literal">innodb_monitor</code> and
          <code class="literal">innodb_lock_monitor</code> tables, that turns on a
          single output stream. The stream includes extra lock
          information until you disable the Lock Monitor by removing the
          <code class="literal">innodb_lock_monitor</code> table.
        </p><p>
          Example <code class="literal">InnoDB</code> Monitor output:
        </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SHOW ENGINE INNODB STATUS\G</code></strong>
*************************** 1. row ***************************
Status:
=====================================
030709 13:00:59 INNODB MONITOR OUTPUT
=====================================
Per second averages calculated from the last 18 seconds
----------
BACKGROUND THREAD
----------
srv_master_thread loops: 53 1_second, 44 sleeps, 5 10_second, 7 background,
  7 flush
srv_master_thread log flush and writes: 48
----------
SEMAPHORES
----------
OS WAIT ARRAY INFO: reservation count 413452, signal count 378357
--Thread 32782 has waited at btr0sea.c line 1477 for 0.00 seconds the
semaphore: X-lock on RW-latch at 41a28668 created in file btr0sea.c line 135
a writer (thread id 32782) has reserved it in mode wait exclusive
number of readers 1, waiters flag 1
Last time read locked in file btr0sea.c line 731
Last time write locked in file btr0sea.c line 1347
Mutex spin waits 0, rounds 0, OS waits 0
RW-shared spins 2, rounds 60, OS waits 2
RW-excl spins 0, rounds 0, OS waits 0
Spin rounds per wait: 0.00 mutex, 20.00 RW-shared, 0.00 RW-excl
------------------------
LATEST FOREIGN KEY ERROR
------------------------
030709 13:00:59 Transaction:
TRANSACTION 0 290328284, ACTIVE 0 sec, process no 3195
inserting
15 lock struct(s), heap size 2496, undo log entries 9
MySQL thread id 25, query id 4668733 localhost heikki update
insert into ibtest11a (D, B, C) values (5, 'khDk' ,'khDk')
Foreign key constraint fails for table test/ibtest11a:
,
  CONSTRAINT `0_219242` FOREIGN KEY (`A`, `D`) REFERENCES `ibtest11b` (`A`,
  `D`) ON DELETE CASCADE ON UPDATE CASCADE
Trying to add in child table, in index PRIMARY tuple:
 0: len 4; hex 80000101; asc ....;; 1: len 4; hex 80000005; asc ....;; 2:
 len 4; hex 6b68446b; asc khDk;; 3: len 6; hex 0000114e0edc; asc ...N..;; 4:
 len 7; hex 00000000c3e0a7; asc .......;; 5: len 4; hex 6b68446b; asc khDk;;
But in parent table test/ibtest11b, in index PRIMARY,
the closest match we can find is record:
RECORD: info bits 0 0: len 4; hex 8000015b; asc ...[;; 1: len 4; hex
80000005; asc ....;; 2: len 3; hex 6b6864; asc khd;; 3: len 6; hex
0000111ef3eb; asc ......;; 4: len 7; hex 800001001e0084; asc .......;; 5:
len 3; hex 6b6864; asc khd;;
------------------------
LATEST DETECTED DEADLOCK
------------------------
030709 12:59:58
*** (1) TRANSACTION:
TRANSACTION 0 290252780, ACTIVE 1 sec, process no 3185
inserting
LOCK WAIT 3 lock struct(s), heap size 320, undo log entries 146
MySQL thread id 21, query id 4553379 localhost heikki update
INSERT INTO alex1 VALUES(86, 86, 794,'aA35818','bb','c79166','d4766t',
'e187358f','g84586','h794',date_format('2001-04-03 12:54:22','%Y-%m-%d
%H:%i'),7
*** (1) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 0 page no 48310 n bits 568 table test/alex1 index
symbole trx id 0 290252780 lock mode S waiting
Record lock, heap no 324 RECORD: info bits 0 0: len 7; hex 61613335383138;
asc aa35818;; 1:
*** (2) TRANSACTION:
TRANSACTION 0 290251546, ACTIVE 2 sec, process no 3190
inserting
130 lock struct(s), heap size 11584, undo log entries 437
MySQL thread id 23, query id 4554396 localhost heikki update
REPLACE INTO alex1 VALUES(NULL, 32, NULL,'aa3572','','c3572','d6012t','',
NULL,'h396', NULL, NULL, 7.31,7.31,7.31,200)
*** (2) HOLDS THE LOCK(S):
RECORD LOCKS space id 0 page no 48310 n bits 568 table test/alex1 index
symbole trx id 0 290251546 lock_mode X locks rec but not gap
Record lock, heap no 324 RECORD: info bits 0 0: len 7; hex 61613335383138;
asc aa35818;; 1:
*** (2) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 0 page no 48310 n bits 568 table test/alex1 index
symbole trx id 0 290251546 lock_mode X locks gap before rec insert intention
waiting
Record lock, heap no 82 RECORD: info bits 0 0: len 7; hex 61613335373230;
asc aa35720;; 1:
*** WE ROLL BACK TRANSACTION (1)
------------
TRANSACTIONS
------------
Trx id counter 0 290328385
Purge done for trx's n:o &lt; 0 290315608 undo n:o &lt; 0 17
History list length 20
Total number of lock structs in row lock hash table 70
LIST OF TRANSACTIONS FOR EACH SESSION:
---TRANSACTION 0 0, not started, process no 3491
MySQL thread id 32, query id 4668737 localhost heikki
show innodb status
---TRANSACTION 0 290328384, ACTIVE 0 sec, process no 3205
38929 inserting
1 lock struct(s), heap size 320
MySQL thread id 29, query id 4668736 localhost heikki update
insert into speedc values (1519229,1, 'hgjhjgghggjgjgjgjgjggjgjgjgjgjgggjgjg
jlhhgghggggghhjhghgggggghjhghghghghghhhhghghghjhhjghjghjkghjghjghjghjfhjfh
---TRANSACTION 0 290328383, ACTIVE 0 sec, process no 3180
28684 committing
1 lock struct(s), heap size 320, undo log entries 1
MySQL thread id 19, query id 4668734 localhost heikki update
insert into speedcm values (1603393,1, 'hgjhjgghggjgjgjgjgjggjgjgjgjgjgggjgj
gjlhhgghggggghhjhghgggggghjhghghghghghhhhghghghjhhjghjghjkghjghjghjghjfhjf
---TRANSACTION 0 290328327, ACTIVE 0 sec, process no 3200
36880 starting index read
LOCK WAIT 2 lock struct(s), heap size 320
MySQL thread id 27, query id 4668644 localhost heikki Searching rows for
update
update ibtest11a set B = 'kHdkkkk' where A = 89572
------- TRX HAS BEEN WAITING 0 SEC FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 0 page no 65556 n bits 232 table test/ibtest11a index
PRIMARY trx id 0 290328327 lock_mode X waiting
Record lock, heap no 1 RECORD: info bits 0 0: len 9; hex 73757072656d756d00;
asc supremum.;;
------------------
---TRANSACTION 0 290328284, ACTIVE 0 sec, process no 3195
34831 rollback of SQL statement
ROLLING BACK 14 lock struct(s), heap size 2496, undo log entries 9
MySQL thread id 25, query id 4668733 localhost heikki update
insert into ibtest11a (D, B, C) values (5, 'khDk' ,'khDk')
---TRANSACTION 0 290327208, ACTIVE 1 sec, process no 3190
32782
58 lock struct(s), heap size 5504, undo log entries 159
MySQL thread id 23, query id 4668732 localhost heikki update
REPLACE INTO alex1 VALUES(86, 46, 538,'aa95666','bb','c95666','d9486t',
'e200498f','g86814','h538',date_format('2001-04-03 12:54:22','%Y-%m-%d
%H:%i'),
---TRANSACTION 0 290323325, ACTIVE 3 sec, process no 3185
30733 inserting
4 lock struct(s), heap size 1024, undo log entries 165
MySQL thread id 21, query id 4668735 localhost heikki update
INSERT INTO alex1 VALUES(NULL, 49, NULL,'aa42837','','c56319','d1719t','',
NULL,'h321', NULL, NULL, 7.31,7.31,7.31,200)
--------
FILE I/O
--------
I/O thread 0 state: waiting for i/o request (insert buffer thread)
I/O thread 1 state: waiting for i/o request (log thread)
I/O thread 2 state: waiting for i/o request (read thread)
I/O thread 3 state: waiting for i/o request (write thread)
Pending normal aio reads: 0, aio writes: 0,
 ibuf aio reads: 0, log i/o's: 0, sync i/o's: 0
Pending flushes (fsync) log: 0; buffer pool: 0
151671 OS file reads, 94747 OS file writes, 8750 OS fsyncs
25.44 reads/s, 18494 avg bytes/read, 17.55 writes/s, 2.33 fsyncs/s
-------------------------------------
INSERT BUFFER AND ADAPTIVE HASH INDEX
-------------------------------------
Ibuf for space 0: size 1, free list len 19, seg size 21,
85004 inserts, 85004 merged recs, 26669 merges
Hash table size 207619, used cells 14461, node heap has 16 buffer(s)
1877.67 hash searches/s, 5121.10 non-hash searches/s
---
LOG
---
Log sequence number 18 1212842764
Log flushed up to   18 1212665295
Last checkpoint at  18 1135877290
0 pending log writes, 0 pending chkp writes
4341 log i/o's done, 1.22 log i/o's/second
----------------------
BUFFER POOL AND MEMORY
----------------------
Total memory allocated 84966343; in additional pool allocated 1402624
Buffer pool size   3200
Free buffers       110
Database pages     3074
Modified db pages  2674
Pending reads 0
Pending writes: LRU 0, flush list 0, single page 0
Pages read 171380, created 51968, written 194688
28.72 reads/s, 20.72 creates/s, 47.55 writes/s
Buffer pool hit rate 999 / 1000
--------------
ROW OPERATIONS
--------------
0 queries inside InnoDB, 0 queries in queue
Main thread process no. 3004, id 7176, state: purging
Number of rows inserted 3738558, updated 127415, deleted 33707, read 755779
1586.13 inserts/s, 50.89 updates/s, 28.44 deletes/s, 107.88 reads/s
----------------------------
END OF INNODB MONITOR OUTPUT
============================
</pre><p>
          <code class="literal">InnoDB</code> Monitor output is limited to 1MB
          when produced using the
          <a href="sql-syntax.html#show-engine" title="12.7.5.16. SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> statement. This limit does not apply
          to output written to the server's error output.
        </p><p>
          Some notes on the output sections:
        </p><p>
          <span class="bold"><strong><code class="literal">BACKGROUND
          THREAD</code></strong></span>
        </p><p>
          The <code class="literal">srv_master_thread</code> lines shows work done
          by the main background thread.
        </p><p>
          <span class="bold"><strong><code class="literal">SEMAPHORES</code></strong></span>
        </p><p>
          This section reports threads waiting for a semaphore and
          statistics on how many times threads have needed a spin or a
          wait on a mutex or a rw-lock semaphore. A large number of
          threads waiting for semaphores may be a result of disk I/O, or
          contention problems inside <code class="literal">InnoDB</code>.
          Contention can be due to heavy parallelism of queries or
          problems in operating system thread scheduling. Setting the
          <a href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
          system variable smaller than the default value might help in
          such situations. The <code class="literal">Spin rounds per wait</code>
          line shows the number of spinlock rounds per OS wait for a
          mutex.
        </p><p>
          <span class="bold"><strong><code class="literal">LATEST FOREIGN KEY
          ERROR</code></strong></span>
        </p><p>
          This section provides information about the most recent
          foreign key constraint error. It is not present if no such
          error has occurred. The contents include the statement that
          failed as well as information about the constraint that failed
          and the referenced and referencing tables.
        </p><p>
          <span class="bold"><strong><code class="literal">LATEST DETECTED
          DEADLOCK</code></strong></span>
        </p><p>
          This section provides information about the most recent
          deadlock. It is not present if no deadlock has occurred. The
          contents show which transactions are involved, the statement
          each was attempting to execute, the locks they have and need,
          and which transaction <code class="literal">InnoDB</code> decided to
          roll back to break the deadlock. The lock modes reported in
          this section are explained in
          <a href="storage-engines.html#innodb-lock-modes" title="13.3.9.1. InnoDB Lock Modes">Section 13.3.9.1, “<code class="literal">InnoDB</code> Lock Modes”</a>.
        </p><p>
          <span class="bold"><strong><code class="literal">TRANSACTIONS</code></strong></span>
        </p><p>
          If this section reports lock waits, your applications might
          have lock contention. The output can also help to trace the
          reasons for transaction deadlocks.
        </p><p>
          <span class="bold"><strong><code class="literal">FILE I/O</code></strong></span>
        </p><p>
          This section provides information about threads that
          <code class="literal">InnoDB</code> uses to perform various types of
          I/O. The first few of these are dedicated to general
          <code class="literal">InnoDB</code> processing. The contents also
          display information for pending I/O operations and statistics
          for I/O performance.
        </p><p>
          The number of these threads are controlled by the
          <a href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> and
          <a href="storage-engines.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>
          parameters. See <a href="storage-engines.html#innodb-parameters" title="13.3.4. InnoDB Startup Options and System Variables">Section 13.3.4, “<code class="literal">InnoDB</code> Startup Options and System Variables”</a>.
        </p><p>
          <span class="bold"><strong><code class="literal">INSERT BUFFER AND ADAPTIVE HASH
          INDEX</code></strong></span>
        </p><p>
          This section shows the status of the <code class="literal">InnoDB</code>
          insert buffer and adaptive hash index. (See
          <a href="storage-engines.html#innodb-insert-buffering" title="13.3.11.3. Insert Buffering">Section 13.3.11.3, “Insert Buffering”</a>, and
          <a href="storage-engines.html#innodb-adaptive-hash" title="13.3.11.4. Adaptive Hash Indexes">Section 13.3.11.4, “Adaptive Hash Indexes”</a>.) The contents include
          the number of operations performed for each, plus statistics
          for hash index performance.
        </p><p>
          <span class="bold"><strong><code class="literal">LOG</code></strong></span>
        </p><p>
          This section displays information about the
          <code class="literal">InnoDB</code> log. The contents include the
          current log sequence number, how far the log has been flushed
          to disk, and the position at which <code class="literal">InnoDB</code>
          last took a checkpoint. (See
          <a href="storage-engines.html#innodb-checkpoints" title="13.3.7.3. InnoDB Checkpoints">Section 13.3.7.3, “<code class="literal">InnoDB</code> Checkpoints”</a>.) The section also
          displays information about pending writes and write
          performance statistics.
        </p><p>
          <span class="bold"><strong><code class="literal">BUFFER POOL AND
          MEMORY</code></strong></span>
        </p><p>
          This section gives you statistics on pages read and written.
          You can calculate from these numbers how many data file I/O
          operations your queries currently are doing.
        </p><p>
          For additional information about the operation of the buffer
          pool, see <a href="optimization.html#innodb-buffer-pool" title="7.9.1. The InnoDB Buffer Pool">Section 7.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
        </p><p>
          <span class="bold"><strong><code class="literal">ROW
          OPERATIONS</code></strong></span>
        </p><p>
          This section shows what the main thread is doing, including
          the number and performance rate for each type of row
          operation.
        </p><p>
          In MySQL 5.5, output from the standard Monitor
          includes additional sections compared to the output for
          previous versions. For details, see
          <a href="introduction.html#monitoring-improvements" title="1.4.3. Diagnostic and Monitoring Capabilities">Section 1.4.3, “Diagnostic and Monitoring Capabilities”</a>.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-tablespace-monitor"></a>13.3.14.2.2. <code class="literal">InnoDB</code> Tablespace Monitor Output</h5></div></div></div><p>
          The <code class="literal">InnoDB</code> Tablespace Monitor prints
          information about the file segments in the shared tablespace
          and validates the tablespace allocation data structures. If
          you use individual tablespaces by enabling
          <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>, the
          Tablespace Monitor does not describe those tablespaces.
        </p><p>
          Example <code class="literal">InnoDB</code> Tablespace Monitor output:
        </p><pre class="programlisting">================================================
090408 21:28:09 INNODB TABLESPACE MONITOR OUTPUT
================================================
FILE SPACE INFO: id 0
size 13440, free limit 3136, free extents 28
not full frag extents 2: used pages 78, full frag extents 3
first seg id not used 0 23845
SEGMENT id 0 1 space 0; page 2; res 96 used 46; full ext 0
fragm pages 32; free extents 0; not full extents 1: pages 14
SEGMENT id 0 2 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
SEGMENT id 0 3 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
...
SEGMENT id 0 15 space 0; page 2; res 160 used 160; full ext 2
fragm pages 32; free extents 0; not full extents 0: pages 0
SEGMENT id 0 488 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
SEGMENT id 0 17 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
...
SEGMENT id 0 171 space 0; page 2; res 592 used 481; full ext 7
fragm pages 16; free extents 0; not full extents 2: pages 17
SEGMENT id 0 172 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
SEGMENT id 0 173 space 0; page 2; res 96 used 44; full ext 0
fragm pages 32; free extents 0; not full extents 1: pages 12
...
SEGMENT id 0 601 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
NUMBER of file segments: 73
Validating tablespace
Validation ok
---------------------------------------
END OF INNODB TABLESPACE MONITOR OUTPUT
=======================================</pre><p>
          The Tablespace Monitor output includes information about the
          shared tablespace as a whole, followed by a list containing a
          breakdown for each segment within the tablespace.
        </p><p>
          The tablespace consists of database pages with a default size
          of 16KB. The pages are grouped into extents of size 1MB (64
          consecutive pages).
        </p><p>
          The initial part of the output that displays overall
          tablespace information has this format:
        </p><pre class="programlisting">FILE SPACE INFO: id 0
size 13440, free limit 3136, free extents 28
not full frag extents 2: used pages 78, full frag extents 3
first seg id not used 0 23845</pre><p>
          Overall tablespace information includes these values:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <code class="literal">id</code>: The tablespace ID. A value of 0
              refers to the shared tablespace.
            </p></li><li><p>
              <code class="literal">size</code>: The current tablespace size in
              pages.
            </p></li><li><p>
              <code class="literal">free limit</code>: The minimum page number for
              which the free list has not been initialized. Pages at or
              above this limit are free.
            </p></li><li><p>
              <code class="literal">free extents</code>: The number of free
              extents.
            </p></li><li><p>
              <code class="literal">not full frag extents</code>, <code class="literal">used
              pages</code>: The number of fragment extents that are
              not completely filled, and the number of pages in those
              extents that have been allocated.
            </p></li><li><p>
              <code class="literal">full frag extents</code>: The number of
              completely full fragment extents.
            </p></li><li><p>
              <code class="literal">first seg id not used</code>: The first unused
              segment ID.
            </p></li></ul></div><p>
          Individual segment information has this format:
        </p><pre class="programlisting">SEGMENT id 0 15 space 0; page 2; res 160 used 160; full ext 2
fragm pages 32; free extents 0; not full extents 0: pages 0</pre><p>
          Segment information includes these values:
        </p><p>
          <code class="literal">id</code>: The segment ID.
        </p><p>
          <code class="literal">space</code>, <code class="literal">page</code>: The
          tablespace number and page within the tablespace where the
          segment “<span class="quote">inode</span>” is located. A tablespace number
          of 0 indicates the shared tablespace.
          <code class="literal">InnoDB</code> uses inodes to keep track of
          segments in the tablespace. The other fields displayed for a
          segment (<code class="literal">id</code>, <code class="literal">res</code>, and so
          forth) are derived from information in the inode.
        </p><p>
          <code class="literal">res</code>: The number of pages allocated
          (reserved) for the segment.
        </p><p>
          <code class="literal">used</code>: The number of allocated pages in use
          by the segment.
        </p><p>
          <code class="literal">full ext</code>: The number of extents allocated
          for the segment that are completely used.
        </p><p>
          <code class="literal">fragm pages</code>: The number of initial pages
          that have been allocated to the segment.
        </p><p>
          <code class="literal">free extents</code>: The number of extents
          allocated for the segment that are completely unused.
        </p><p>
          <code class="literal">not full extents</code>: The number of extents
          allocated for the segment that are partially used.
        </p><p>
          <code class="literal">pages</code>: The number of pages used within the
          not-full extents.
        </p><p>
          When a segment grows, it starts as a single page, and
          <code class="literal">InnoDB</code> allocates the first pages for it
          individually, up to 32 pages (this is the <code class="literal">fragm
          pages</code> value). After that, <code class="literal">InnoDB</code>
          allocates complete 64-page extents. <code class="literal">InnoDB</code>
          can add up to 4 extents at a time to a large segment to ensure
          good sequentiality of data.
        </p><p>
          For the example segment shown earlier, it has 32 fragment
          pages, plus 2 full extents (64 pages each), for a total of 160
          pages used out of 160 pages allocated. The following segment
          has 32 fragment pages and one partially full extent using 14
          pages for a total of 46 pages used out of 96 pages allocated:
        </p><pre class="programlisting">SEGMENT id 0 1 space 0; page 2; res 96 used 46; full ext 0
fragm pages 32; free extents 0; not full extents 1: pages 14</pre><p>
          It is possible for a segment that has extents allocated to it
          to have a <code class="literal">fragm pages</code> value less than 32 if
          some of the individual pages have been deallocated subsequent
          to extent allocation.
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-table-monitor"></a>13.3.14.2.3. <code class="literal">InnoDB</code> Table Monitor Output</h5></div></div></div><p>
          The <code class="literal">InnoDB</code> Table Monitor prints the
          contents of the <code class="literal">InnoDB</code> internal data
          dictionary.
        </p><p>
          The output contains one section per table. The
          <code class="literal">SYS_FOREIGN</code> and
          <code class="literal">SYS_FOREIGN_COLS</code> sections are for internal
          data dictionary tables that maintain information about foreign
          keys. There are also sections for the Table Monitor table and
          each user-created <code class="literal">InnoDB</code> table. Suppose
          that the following two tables have been created in the
          <code class="literal">test</code> database:
        </p><pre class="programlisting">CREATE TABLE parent
(
  par_id    INT NOT NULL,
  fname      CHAR(20),
  lname      CHAR(20),
  PRIMARY KEY (par_id),
  UNIQUE INDEX (lname, fname)
) ENGINE = INNODB;

CREATE TABLE child
(
  par_id      INT NOT NULL,
  child_id    INT NOT NULL,
  name        VARCHAR(40),
  birth       DATE,
  weight      DECIMAL(10,2),
  misc_info   VARCHAR(255),
  last_update TIMESTAMP,
  PRIMARY KEY (par_id, child_id),
  INDEX (name),
  FOREIGN KEY (par_id) REFERENCES parent (par_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE
) ENGINE = INNODB;</pre><p>
          Then the Table Monitor output will look something like this
          (reformatted slightly):
        </p><pre class="programlisting">===========================================
090420 12:09:32 INNODB TABLE MONITOR OUTPUT
===========================================
--------------------------------------
TABLE: name SYS_FOREIGN, id 0 11, columns 7, indexes 3, appr.rows 1
  COLUMNS: ID: DATA_VARCHAR DATA_ENGLISH len 0;
           FOR_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           REF_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           N_COLS: DATA_INT len 4;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name ID_IND, id 0 11, fields 1/6, uniq 1, type 3
   root page 46, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  ID DB_TRX_ID DB_ROLL_PTR FOR_NAME REF_NAME N_COLS
  INDEX: name FOR_IND, id 0 12, fields 1/2, uniq 2, type 0
   root page 47, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  FOR_NAME ID
  INDEX: name REF_IND, id 0 13, fields 1/2, uniq 2, type 0
   root page 48, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  REF_NAME ID
--------------------------------------
TABLE: name SYS_FOREIGN_COLS, id 0 12, columns 7, indexes 1, appr.rows 1
  COLUMNS: ID: DATA_VARCHAR DATA_ENGLISH len 0;
           POS: DATA_INT len 4;
           FOR_COL_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           REF_COL_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name ID_IND, id 0 14, fields 2/6, uniq 2, type 3
   root page 49, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  ID POS DB_TRX_ID DB_ROLL_PTR FOR_COL_NAME REF_COL_NAME
--------------------------------------
TABLE: name test/child, id 0 14, columns 10, indexes 2, appr.rows 201
  COLUMNS: par_id: DATA_INT DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           child_id: DATA_INT DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           name: DATA_VARCHAR prtype 524303 len 40;
           birth: DATA_INT DATA_BINARY_TYPE len 3;
           weight: DATA_FIXBINARY DATA_BINARY_TYPE len 5;
           misc_info: DATA_VARCHAR prtype 524303 len 255;
           last_update: DATA_INT DATA_UNSIGNED DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name PRIMARY, id 0 17, fields 2/9, uniq 2, type 3
   root page 52, appr.key vals 201, leaf pages 5, size pages 6
   FIELDS:  par_id child_id DB_TRX_ID DB_ROLL_PTR name birth weight misc_info last_update
  INDEX: name name, id 0 18, fields 1/3, uniq 3, type 0
   root page 53, appr.key vals 210, leaf pages 1, size pages 1
   FIELDS:  name par_id child_id
  FOREIGN KEY CONSTRAINT test/child_ibfk_1: test/child ( par_id )
             REFERENCES test/parent ( par_id )
--------------------------------------
TABLE: name test/innodb_table_monitor, id 0 15, columns 4, indexes 1, appr.rows 0
  COLUMNS: i: DATA_INT DATA_BINARY_TYPE len 4;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name GEN_CLUST_INDEX, id 0 19, fields 0/4, uniq 1, type 1
   root page 193, appr.key vals 0, leaf pages 1, size pages 1
   FIELDS:  DB_ROW_ID DB_TRX_ID DB_ROLL_PTR i
--------------------------------------
TABLE: name test/parent, id 0 13, columns 6, indexes 2, appr.rows 299
  COLUMNS: par_id: DATA_INT DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           fname: DATA_CHAR prtype 524542 len 20;
           lname: DATA_CHAR prtype 524542 len 20;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name PRIMARY, id 0 15, fields 1/5, uniq 1, type 3
   root page 50, appr.key vals 299, leaf pages 2, size pages 3
   FIELDS:  par_id DB_TRX_ID DB_ROLL_PTR fname lname
  INDEX: name lname, id 0 16, fields 2/3, uniq 2, type 2
   root page 51, appr.key vals 300, leaf pages 1, size pages 1
   FIELDS:  lname fname par_id
  FOREIGN KEY CONSTRAINT test/child_ibfk_1: test/child ( par_id )
             REFERENCES test/parent ( par_id )
-----------------------------------
END OF INNODB TABLE MONITOR OUTPUT
==================================</pre><p>
          For each table, Table Monitor output contains a section that
          displays general information about the table and specific
          information about its columns, indexes, and foreign keys.
        </p><p>
          The general information for each table includes the table name
          (in
          <code class="literal"><em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>tbl_name</code></em></code>
          format except for internal tables), its ID, the number of
          columns and indexes, and an approximate row count.
        </p><p>
          The <code class="literal">COLUMNS</code> part of a table section lists
          each column in the table. Information for each column
          indicates its name and data type characteristics. Some
          internal columns are added by <code class="literal">InnoDB</code>, such
          as <code class="literal">DB_ROW_ID</code> (row ID),
          <code class="literal">DB_TRX_ID</code> (transaction ID), and
          <code class="literal">DB_ROLL_PTR</code> (a pointer to the rollback/undo
          data).
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <code class="literal">DATA_<em class="replaceable"><code>xxx</code></em></code>:
              These symbols indicate the data type. There may be
              multiple
              <code class="literal">DATA_<em class="replaceable"><code>xxx</code></em></code>
              symbols for a given column.
            </p></li><li><p>
              <code class="literal">prtype</code>: The column's
              “<span class="quote">precise</span>” type. This field includes
              information such as the column data type, character set
              code, nullability, signedness, and whether it is a binary
              string. This field is described in the
              <code class="filename">innobase/include/data0type.h</code> source
              file.
            </p></li><li><p>
              <code class="literal">len</code>: The column length in bytes.
            </p></li></ul></div><p>
          Each <code class="literal">INDEX</code> part of the table section
          provides the name and characteristics of one table index:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <code class="literal">name</code>: The index name. If the name is
              <code class="literal">PRIMARY</code>, the index is a primary key. If
              the name is <code class="literal">GEN_CLUST_INDEX</code>, the index
              is the clustered index that is created automatically if
              the table definition doesn't include a primary key or
              non-<code class="literal">NULL</code> unique index. See
              <a href="storage-engines.html#innodb-index-types" title="13.3.11.1. Clustered and Secondary Indexes">Section 13.3.11.1, “Clustered and Secondary Indexes”</a>.
            </p></li><li><p>
              <code class="literal">id</code>: The index ID.
            </p></li><li><p>
              <code class="literal">fields</code>: The number of fields in the
              index, as a value in
              <code class="literal"><em class="replaceable"><code>m</code></em>/<em class="replaceable"><code>n</code></em></code>
              format:
            </p><div class="itemizedlist"><ul type="circle"><li><p>
                  <em class="replaceable"><code>m</code></em> is the number of
                  user-defined columns; that is, the number of columns
                  you would see in the index definition in a
                  <code class="literal">CREATE TABLE</code> statement.
                </p></li><li><p>
                  <em class="replaceable"><code>n</code></em> is the total number of
                  index columns, including those added internally. For
                  the clustered index, the total includes the other
                  columns in the table definition, plus any columns
                  added internally. For a secondary index, the total
                  includes the columns from the primary key that are not
                  part of the secondary index.
                </p></li></ul></div></li><li><p>
              <code class="literal">uniq</code>: The number of leading fields that
              are enough to determine index values uniquely.
            </p></li><li><p>
              <code class="literal">type</code>: The index type. This is a bit
              field. For example, 1 indicates a clustered index and 2
              indicates a unique index, so a clustered index (which
              always contains unique values), will have a
              <code class="literal">type</code> value of 3. An index with a
              <code class="literal">type</code> value of 0 is neither clustered
              nor unique. The flag values are defined in the
              <code class="filename">innobase/include/dict0mem.h</code> source
              file.
            </p></li><li><p>
              <code class="literal">root page</code>: The index root page number.
            </p></li><li><p>
              <code class="literal">appr. key vals</code>: The approximate index
              cardinality.
            </p></li><li><p>
              <code class="literal">leaf pages</code>: The approximate number of
              leaf pages in the index.
            </p></li><li><p>
              <code class="literal">size pages</code>: The approximate total
              number of pages in the index.
            </p></li><li><p>
              <code class="literal">FIELDS</code>: The names of the fields in the
              index. For a clustered index that was generated
              automatically, the field list begins with the internal
              <code class="literal">DB_ROW_ID</code> (row ID) field.
              <code class="literal">DB_TRX_ID</code> and
              <code class="literal">DB_ROLL_PTR</code> are always added internally
              to the clustered index, following the fields that comprise
              the primary key. For a secondary index, the final fields
              are those from the primary key that are not part of the
              secondary index.
            </p></li></ul></div><p>
          The end of the table section lists the <code class="literal">FOREIGN
          KEY</code> definitions that apply to the table. This
          information appears whether the table is a referencing or
          referenced table.
        </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-troubleshooting"></a>13.3.14.3. <code class="literal">InnoDB</code> General Troubleshooting</h4></div></div></div><a class="indexterm" name="id1132673"></a><p>
        The following general guidelines apply to troubleshooting
        <code class="literal">InnoDB</code> problems:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            When an operation fails or you suspect a bug, look at the
            MySQL server error log (see <a href="server-administration.html#error-log" title="5.2.2. The Error Log">Section 5.2.2, “The Error Log”</a>).
          </p></li><li><p>
            Issues relating to the <code class="literal">InnoDB</code> data
            dictionary include failed <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
            TABLE</code></a> statements (orphaned table files), inability
            to open <code class="filename">.InnoDB</code> files, and
            <span class="errortext">system cannot find the path specified</span>
            errors. For information about these sorts of problems and
            errors, see
            <a href="storage-engines.html#innodb-troubleshooting-datadict" title="13.3.14.4. Troubleshooting InnoDB Data Dictionary Operations">Section 13.3.14.4, “Troubleshooting <code class="literal">InnoDB</code> Data Dictionary Operations”</a>.
          </p></li><li><p>
            When troubleshooting, it is usually best to run the MySQL
            server from the command prompt, rather than through
            <a href="programs.html#mysqld-safe" title="4.3.2. mysqld_safe — MySQL Server Startup Script"><span><strong class="command">mysqld_safe</strong></span></a> or as a Windows service. You
            can then see what <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> prints to the
            console, and so have a better grasp of what is going on. On
            Windows, start <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> with the
            <a href="server-administration.html#option_mysqld_console"><code class="option">--console</code></a> option to direct
            the output to the console window.
          </p></li><li><p>
            <a class="indexterm" name="id1132788"></a>

            <a class="indexterm" name="id1132800"></a>

            Use the <code class="literal">InnoDB</code> Monitors to obtain
            information about a problem (see
            <a href="storage-engines.html#innodb-monitors" title="13.3.14.2. SHOW ENGINE INNODB
        STATUS and the InnoDB Monitors">Section 13.3.14.2, “<code class="literal">SHOW ENGINE INNODB
        STATUS</code> and the <code class="literal">InnoDB</code> Monitors”</a>). If the problem is
            performance-related, or your server appears to be hung, you
            should use the standard Monitor to print information about
            the internal state of <code class="literal">InnoDB</code>. If the
            problem is with locks, use the Lock Monitor. If the problem
            is in creation of tables or other data dictionary
            operations, use the Table Monitor to print the contents of
            the <code class="literal">InnoDB</code> internal data dictionary. To
            see tablespace information use the Tablespace Monitor.
          </p></li><li><p>
            If you suspect that a table is corrupt, run
            <a href="sql-syntax.html#check-table" title="12.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> on that table.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-troubleshooting-datadict"></a>13.3.14.4. Troubleshooting <code class="literal">InnoDB</code> Data Dictionary Operations</h4></div></div></div><a class="indexterm" name="id1132873"></a><p>
        Information about table definitions is stored both in the
        <code class="literal">.frm</code> files, and in the InnoDB
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_data_dictionary" target="_top">data dictionary</a>. If
        you move <code class="filename">.frm</code> files around, or if the
        server crashes in the middle of a data dictionary operation,
        these sources of information can become inconsistent.
      </p><h5><a name="id1132912"></a>
        Problem with CREATE TABLE
      </h5><p>
        A symptom of an out-of-sync data dictionary is that a
        <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement fails. If
        this occurs, look in the server's error log. If the log says
        that the table already exists inside the
        <code class="literal">InnoDB</code> internal data dictionary, you have an
        orphaned table inside the <code class="literal">InnoDB</code> tablespace
        files that has no corresponding <code class="filename">.frm</code> file.
        The error message looks like this:
      </p><pre class="programlisting">InnoDB: Error: table test/parent already exists in InnoDB internal
InnoDB: data dictionary. Have you deleted the .frm file
InnoDB: and not used DROP TABLE? Have you used DROP DATABASE
InnoDB: for InnoDB tables in MySQL version &lt;= 3.23.43?
InnoDB: See the Restrictions section of the InnoDB manual.
InnoDB: You can drop the orphaned table inside InnoDB by
InnoDB: creating an InnoDB table with the same name in another
InnoDB: database and moving the .frm file to the current database.
InnoDB: Then MySQL thinks the table exists, and DROP TABLE will
InnoDB: succeed.</pre><p>
        You can drop the orphaned table by following the instructions
        given in the error message. If you are still unable to use
        <a href="sql-syntax.html#drop-table" title="12.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> successfully, the
        problem may be due to name completion in the
        <a href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span><strong class="command">mysql</strong></span></a> client. To work around this problem,
        start the <a href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span><strong class="command">mysql</strong></span></a> client with the
        <a href="programs.html#option_mysql_auto-rehash"><code class="option">--skip-auto-rehash</code></a>
        option and try <a href="sql-syntax.html#drop-table" title="12.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> again.
        (With name completion on, <a href="programs.html#mysql" title="4.5.1. mysql — The MySQL Command-Line Tool"><span><strong class="command">mysql</strong></span></a> tries to
        construct a list of table names, which fails when a problem such
        as just described exists.)
      </p><h5><a name="id1133016"></a>
        Problem Opening Table
      </h5><p>
        Another symptom of an out-of-sync data dictionary is that MySQL
        prints an error that it cannot open a
        <code class="filename">.InnoDB</code> file:
      </p><pre class="programlisting">ERROR 1016: Can't open file: 'child2.InnoDB'. (errno: 1)</pre><p>
        In the error log you can find a message like this:
      </p><pre class="programlisting">InnoDB: Cannot find table test/child2 from the internal data dictionary
InnoDB: of InnoDB though the .frm file for the table exists. Maybe you
InnoDB: have deleted and recreated InnoDB data files but have forgotten
InnoDB: to delete the corresponding .frm files of InnoDB tables?</pre><p>
        This means that there is an orphaned <code class="filename">.frm</code>
        file without a corresponding table inside
        <code class="literal">InnoDB</code>. You can drop the orphaned
        <code class="filename">.frm</code> file by deleting it manually.
      </p><a class="indexterm" name="id1133070"></a><a class="indexterm" name="id1133082"></a><a class="indexterm" name="id1133095"></a><h5><a name="id1133107"></a>
        Problem with Temporary Table
      </h5><p>
        If MySQL crashes in the middle of an <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> operation, you may end up with an orphaned
        temporary table inside the <code class="literal">InnoDB</code> tablespace.
        Using the Table Monitor, you can see listed a table with a name
        that begins with <code class="filename">#sql-</code>. You can perform SQL
        statements on tables whose name contains the character
        “<span class="quote"><code class="literal">#</code></span>” if you enclose the name
        within backticks. Thus, you can drop such an orphaned table like
        any other orphaned table using the method described earlier. To
        copy or rename a file in the Unix shell, you need to put the
        file name in double quotation marks if the file name contains
        “<span class="quote"><code class="literal">#</code></span>”.
      </p><h5><a name="id1133152"></a>
        Problem with Missing Tablespace
      </h5><p>
        With <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        enabled, the following message might occur if the
        <code class="literal">.frm</code> or <code class="literal">.ibd</code> files (or
        both) are missing:
      </p><pre class="programlisting">InnoDB: in InnoDB data dictionary has tablespace id <em class="replaceable"><code>N</code></em>,
InnoDB: but tablespace with that id or name does not exist. Have
InnoDB: you deleted or moved .ibd files?
InnoDB: This may also be a table created with CREATE TEMPORARY TABLE
InnoDB: whose .ibd and .frm files MySQL automatically removed, but the
InnoDB: table still exists in the InnoDB internal data dictionary.
</pre><p>
        If this occurs, try the following procedure to resolve the
        problem:
      </p><div class="orderedlist"><ol type="1"><li><p>
            Create a matching <code class="filename">.frm</code> file in some
            other database directory and copy it to the database
            directory where the orphan table is located.
          </p></li><li><p>
            Issue <a href="sql-syntax.html#drop-table" title="12.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> for the
            original table. That should successfully drop the table and
            <code class="literal">InnoDB</code> should print a warning to the
            error log that the <code class="filename">.ibd</code> file was
            missing.
          </p></li></ol></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-restrictions"></a>13.3.15. Limits on <code class="literal">InnoDB</code> Tables</h3></div></div></div><a class="indexterm" name="id1133260"></a><div xmlns="http://www.w3.org/1999/xhtml" class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Warning</div><p xmlns="">
        Do <span class="emphasis"><em>not</em></span> convert MySQL system tables in the
        <code class="literal">mysql</code> database from <code class="literal">MyISAM</code>
        to <code class="literal">InnoDB</code> tables! This is an unsupported
        operation. If you do this, MySQL does not restart until you
        restore the old system tables from a backup or re-generate them
        with the <a href="programs.html#mysql-install-db" title="4.4.3. mysql_install_db — Initialize MySQL Data Directory"><span><strong class="command">mysql_install_db</strong></span></a> script.
      </p></div><div xmlns="http://www.w3.org/1999/xhtml" class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Warning</div><p xmlns="">
        <a class="indexterm" name="id1133313"></a>

        <a class="indexterm" name="id1133325"></a>

        It is not a good idea to configure <code class="literal">InnoDB</code> to
        use data files or log files on NFS volumes. Otherwise, the files
        might be locked by other processes and become unavailable for
        use by MySQL.
      </p></div><h4><a name="id1133348"></a>
      Maximums and Minimums
    </h4><div class="itemizedlist"><ul type="disc"><li><p>
          A table can contain a maximum of 1000 columns.
        </p></li><li><p>
          By default, an index key for a single-column index can be up
          to 767 bytes. The same length limit applies to any index key
          prefix. See <a href="sql-syntax.html#create-index" title="12.1.13. CREATE INDEX Syntax">Section 12.1.13, “<code class="literal">CREATE INDEX</code> Syntax”</a>. For example, you
          might hit this limit with a
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_column_prefix" target="_top">column prefix</a> index
          of more than 255 characters on a <code class="literal">TEXT</code> or
          <code class="literal">VARCHAR</code> column, assuming a UTF-8 character
          set and the maximum of 3 bytes for each character. When the
          <a href="storage-engines.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a>
          configuration option is enabled, this length limit is raised
          to 3072 bytes, for <code class="literal">InnoDB</code> tables that use
          the
          <code class="literal"><a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_dynamic_row_format" target="_top">DYNAMIC</a></code>
          and
          <code class="literal"><a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_compressed_row_format" target="_top">COMPRESSED</a></code>
          row formats.
        </p><p>
          When you attempt to specify an index prefix length longer than
          allowed, the length is silently reduced to the maximum length.
          This configuration option changes the error handling for some
          combinations of row format and prefix length longer than the
          maximum allowed. See
          <a href="storage-engines.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a> for
          details.
        </p></li><li><p>
          The <code class="literal">InnoDB</code> internal maximum key length is
          3500 bytes, but MySQL itself restricts this to 3072 bytes.
          This limit applies to the length of the combined index key in
          a multi-column index.
        </p></li><li><p>
          The maximum row length, except for variable-length columns
          (<a href="data-types.html#binary-varbinary" title="10.4.2. The BINARY and
        VARBINARY Types"><code class="literal">VARBINARY</code></a>,
          <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a>,
          <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> and
          <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a>), is slightly less than
          half of a database page. That is, the maximum row length is
          about 8000 bytes. <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">LONGBLOB</code></a> and
          <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">LONGTEXT</code></a>
          columns must be less than 4GB, and the total row length,
          including <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> and
          <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a> columns, must be less than
          4GB.
        </p><p>
          If a row is less than half a page long, all of it is stored
          locally within the page. If it exceeds half a page,
          variable-length columns are chosen for external off-page
          storage until the row fits within half a page, as described in
          <a href="storage-engines.html#innodb-file-space" title="13.3.12.2. File Space Management">Section 13.3.12.2, “File Space Management”</a>.
        </p></li><li><p>
          Although <code class="literal">InnoDB</code> supports row sizes larger
          than 65,535 bytes internally, MySQL inself imposes a row-size
          limit of 65,535 for the combined size of all columns:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t (a VARCHAR(8000), b VARCHAR(10000),</code></strong>
    -&gt; <strong class="userinput"><code>c VARCHAR(10000), d VARCHAR(10000), e VARCHAR(10000),</code></strong>
    -&gt; <strong class="userinput"><code>f VARCHAR(10000), g VARCHAR(10000)) ENGINE=InnoDB;</code></strong>
ERROR 1118 (42000): Row size too large. The maximum row size for the
used table type, not counting BLOBs, is 65535. You have to change some
columns to TEXT or BLOBs
</pre><p>
          See <a href="restrictions.html#column-count-limit" title="E.10.4. Table Column-Count and Row-Size Limits">Section E.10.4, “Table Column-Count and Row-Size Limits”</a>.
        </p></li><li><p>
          On some older operating systems, files must be less than 2GB.
          This is not a limitation of <code class="literal">InnoDB</code> itself,
          but if you require a large tablespace, you will need to
          configure it using several smaller data files rather than one
          or a file large data files.
        </p></li><li><p>
          The combined size of the <code class="literal">InnoDB</code> log files
          must be less than 4GB.
        </p></li><li><p>
          The minimum tablespace size is 10MB. The maximum tablespace
          size is four billion database pages (64TB). This is also the
          maximum size for a table.
        </p></li><li><p>
          <a class="indexterm" name="id1133619"></a>

          <a class="indexterm" name="id1133631"></a>

          The default database page size in <code class="literal">InnoDB</code> is
          16KB.
        </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
            Changing the page size is not a supported operation and
            there is no guarantee that
            <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> will function normally
            with a page size other than 16KB. Problems compiling or
            running InnoDB may occur. In particular,
            <code class="literal">ROW_FORMAT=COMPRESSED</code> in the Barracuda
            file format assumes that the page size is at most 16KB and
            uses 14-bit pointers.
          </p><p xmlns="">
            A version of <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> built for
            one page size cannot use data files or log files from a
            version built for a different page size. This limitation
            could affect restore or downgrade operations using data from
            MySQL 5.6, which does support page sizes other than 16KB.
          </p></div></li></ul></div><h4><a name="id1133689"></a>
      Index Types
    </h4><div class="itemizedlist"><ul type="disc"><li><p>
          <code class="literal">InnoDB</code> tables do not support
          <code class="literal">FULLTEXT</code> indexes.
        </p></li><li><p>
          <code class="literal">InnoDB</code> tables support spatial data types,
          but not indexes on them.
        </p></li></ul></div><h4><a name="id1133728"></a>
      Restrictions on InnoDB Tables
    </h4><div class="itemizedlist"><ul type="disc"><li><p>
          <a href="sql-syntax.html#analyze-table" title="12.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> determines index
          cardinality (as displayed in the
          <code class="literal">Cardinality</code> column of
          <a href="sql-syntax.html#show-index" title="12.7.5.23. SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a> output) by doing
          eight random dives to each of the index trees and updating
          index cardinality estimates accordingly. Because these are
          only estimates, repeated runs of <a href="sql-syntax.html#analyze-table" title="12.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a> may produce different numbers. This makes
          <a href="sql-syntax.html#analyze-table" title="12.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> fast on
          <code class="literal">InnoDB</code> tables but not 100% accurate because
          it does not take all rows into account.
        </p><p>
          You can change the number of random dives by modifying the
          <a href="storage-engines.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a>
          system variable. For more information, see
          <a href="storage-engines.html#innodb-other-changes" title="13.4.8. Changes for Flexibility, Ease of Use and Reliability">Section 13.4.8, “Changes for Flexibility, Ease of Use and Reliability”</a>.
        </p><p>
          MySQL uses index cardinality estimates only in join
          optimization. If some join is not optimized in the right way,
          you can try using <a href="sql-syntax.html#analyze-table" title="12.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a>. In the few cases that
          <a href="sql-syntax.html#analyze-table" title="12.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> does not produce
          values good enough for your particular tables, you can use
          <code class="literal">FORCE INDEX</code> with your queries to force the
          use of a particular index, or set the
          <a href="server-administration.html#sysvar_max_seeks_for_key"><code class="literal">max_seeks_for_key</code></a> system
          variable to ensure that MySQL prefers index lookups over table
          scans. See <a href="server-administration.html#server-system-variables" title="5.1.3. Server System Variables">Section 5.1.3, “Server System Variables”</a>, and
          <a href="error-handling.html#optimizer-issues" title="C.5.6. Optimizer-Related Issues">Section C.5.6, “Optimizer-Related Issues”</a>.
        </p></li><li><p>
          <a href="sql-syntax.html#show-table-status" title="12.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> does not give
          accurate statistics on <code class="literal">InnoDB</code> tables,
          except for the physical size reserved by the table. The row
          count is only a rough estimate used in SQL optimization.
        </p></li><li><p>
          <code class="literal">InnoDB</code> does not keep an internal count of
          rows in a table because concurrent transactions might
          “<span class="quote">see</span>” different numbers of rows at the same time.
          To process a <code class="literal">SELECT COUNT(*) FROM t</code>
          statement, <code class="literal">InnoDB</code> scans an index of the
          table, which takes some time if the index is not entirely in
          the buffer pool. If your table does not change often, using
          the MySQL query cache is a good solution. To get a fast count,
          you have to use a counter table you create yourself and let
          your application update it according to the inserts and
          deletes it does. If an approximate row count is sufficient,
          <a href="sql-syntax.html#show-table-status" title="12.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> can be used.
          See <a href="storage-engines.html#innodb-tuning" title="13.3.14.1. InnoDB Performance Tuning Tips">Section 13.3.14.1, “<code class="literal">InnoDB</code> Performance Tuning Tips”</a>.
        </p></li><li><p>
          On Windows, <code class="literal">InnoDB</code> always stores database
          and table names internally in lowercase. To move databases in
          a binary format from Unix to Windows or from Windows to Unix,
          create all databases and tables using lowercase names.
        </p></li><li><p>
          For an <code class="literal">AUTO_INCREMENT</code> column, you must
          always define an index for the table, and that index must
          contain just the <code class="literal">AUTO_INCREMENT</code> column. In
          <code class="literal">MyISAM</code> tables, the
          <code class="literal">AUTO_INCREMENT</code> column may be part of a
          multiple-column index.
        </p></li><li><p>
          While initializing a previously specified
          <code class="literal">AUTO_INCREMENT</code> column on a table,
          <code class="literal">InnoDB</code> sets an exclusive lock on the end of
          the index associated with the
          <code class="literal">AUTO_INCREMENT</code> column. While accessing the
          auto-increment counter, <code class="literal">InnoDB</code> uses a
          specific <code class="literal">AUTO-INC</code> table lock mode where the
          lock lasts only to the end of the current SQL statement, not
          to the end of the entire transaction. Other clients cannot
          insert into the table while the <code class="literal">AUTO-INC</code>
          table lock is held. See
          <a href="storage-engines.html#innodb-auto-increment-handling" title="13.3.5.3. AUTO_INCREMENT Handling in InnoDB">Section 13.3.5.3, “<code class="literal">AUTO_INCREMENT</code> Handling in <code class="literal">InnoDB</code>”</a>.
        </p></li><li><p>
          When you restart the MySQL server, <code class="literal">InnoDB</code>
          may reuse an old value that was generated for an
          <code class="literal">AUTO_INCREMENT</code> column but never stored
          (that is, a value that was generated during an old transaction
          that was rolled back).
        </p></li><li><p>
          When an <code class="literal">AUTO_INCREMENT</code> integer column runs
          out of values, a subsequent <code class="literal">INSERT</code>
          operation returns a duplicate-key error. This is general MySQL
          behavior, similar to how <code class="literal">MyISAM</code> works.
        </p></li><li><p>
          <code class="literal">DELETE FROM
          <em class="replaceable"><code>tbl_name</code></em></code> does not
          regenerate the table but instead deletes all rows, one by one.
        </p></li><li><p>
          Under some conditions, <code class="literal">TRUNCATE
          <em class="replaceable"><code>tbl_name</code></em></code> for an
          <code class="literal">InnoDB</code> table is mapped to <code class="literal">DELETE
          FROM <em class="replaceable"><code>tbl_name</code></em></code>. See
          <a href="sql-syntax.html#truncate-table" title="12.1.33. TRUNCATE TABLE Syntax">Section 12.1.33, “<code class="literal">TRUNCATE TABLE</code> Syntax”</a>.
        </p></li><li><p>
          Currently, cascaded foreign key actions do not activate
          triggers.
        </p></li><li><p>
          You cannot create a table with a column name that matches the
          name of an internal InnoDB column (including
          <code class="literal">DB_ROW_ID</code>, <code class="literal">DB_TRX_ID</code>,
          <code class="literal">DB_ROLL_PTR</code>, and
          <code class="literal">DB_MIX_ID</code>). The server reports error 1005
          and refers to error –1 in the error message. This
          restriction applies only to use of the names in uppercase.
        </p></li></ul></div><h4><a name="id1134148"></a>
      Locking and Transactions
    </h4><div class="itemizedlist"><ul type="disc"><li><p>
          <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a> acquires two locks
          on each table if <code class="literal">innodb_table_locks=1</code> (the
          default). In addition to a table lock on the MySQL layer, it
          also acquires an <code class="literal">InnoDB</code> table lock.
          Versions of MySQL before 4.1.2 did not acquire
          <code class="literal">InnoDB</code> table locks; the old behavior can be
          selected by setting <code class="literal">innodb_table_locks=0</code>.
          If no <code class="literal">InnoDB</code> table lock is acquired,
          <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a> completes even if
          some records of the tables are being locked by other
          transactions.
        </p><p>
          As of MySQL 5.5.3,
          <a href="storage-engines.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks=0</code></a> has no
          effect for tables locked explicitly with
          <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a>. It still has an effect for tables locked for
          read or write by
          <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a> implicitly (for example, through triggers) or
          by <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES
          ... READ</code></a>.
        </p></li><li><p>
          All <code class="literal">InnoDB</code> locks held by a transaction are
          released when the transaction is committed or aborted. Thus,
          it does not make much sense to invoke
          <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a> on
          <code class="literal">InnoDB</code> tables in
          <a href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit=1</code></a> mode because the
          acquired <code class="literal">InnoDB</code> table locks would be
          released immediately.
        </p></li><li><p>
          You cannot lock additional tables in the middle of a
          transaction because <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
          performs an implicit <a href="sql-syntax.html#commit" title="12.3.1. START TRANSACTION,
      COMMIT, and
      ROLLBACK Syntax"><code class="literal">COMMIT</code></a> and
          <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">UNLOCK
          TABLES</code></a>.
        </p></li><li><p>
          The limit of 1023 concurrent data-modifying transactions has
          been raised in MySQL 5.5 and above. The limit is now 128 *
          1023 concurrent transactions that generate undo records. You
          can remove any workarounds that require changing the proper
          structure of your transactions, such as committing more
          frequently.
        </p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="innodb-5-5"></a>13.4. New Features of InnoDB 1.1</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-introduction">13.4.1. Introduction to InnoDB 1.1</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-create-index">13.4.2. Fast Index Creation in the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-compression">13.4.3. InnoDB Data Compression</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-file-format">13.4.4. InnoDB File-Format Management</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-row-format">13.4.5. How InnoDB Stores Variable-Length Columns</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-information-schema">13.4.6. InnoDB <code class="literal">INFORMATION_SCHEMA</code> tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance">13.4.7. InnoDB Performance and Scalability Enhancements</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes">13.4.8. Changes for Flexibility, Ease of Use and Reliability</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-installation">13.4.9. Installing the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-upgrading">13.4.10. Upgrading the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-downgrading">13.4.11. Downgrading the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-changes">13.4.12. InnoDB Storage Engine Change History</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-contrib">13.4.13. Third-Party Software</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-parameter-changes">13.4.14. List of Parameters Changed in InnoDB 1.1 and InnoDB Plugin 1.0</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-introduction"></a>13.4.1. Introduction to InnoDB 1.1</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-introduction-features">13.4.1.1. Features of the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-introduction-obtaining">13.4.1.2. Obtaining and Installing the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-introduction-version">13.4.1.3. Viewing the InnoDB Storage Engine Version Number</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-introduction-restrictions">13.4.1.4. Compatibility Considerations for Downgrade and Backup</a></span></dt></dl></div><p>
    InnoDB 1.1 combines the familiar reliability and performance of the
    InnoDB storage engine, with new performance and usability
    enhancements. InnoDB 1.1 includes all the features that were part of
    the InnoDB Plugin for MySQL 5.1, plus new features specific to MySQL
    5.5 and higher.
  </p><p>
    Beginning with MySQL version 5.5, InnoDB is the default storage
    engine, rather than MyISAM, to promote greater data reliability and
    reducing the chance of corruption.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-introduction-features"></a>13.4.1.1. Features of the InnoDB Storage Engine</h4></div></div></div><a class="indexterm" name="id1134399"></a><a class="indexterm" name="id1134411"></a><p>
      The InnoDB Storage Engine for MySQL contains several important new
      features:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          <a href="storage-engines.html#innodb-create-index" title="13.4.2. Fast Index Creation in the InnoDB Storage Engine">Fast index creation: add
          or drop indexes without copying the data</a>
        </p></li><li><p>
          <a href="storage-engines.html#innodb-compression" title="13.4.3. InnoDB Data Compression">Data compression: shrink
          tables, to significantly reduce storage and i/o</a>
        </p></li><li><p>
          <a href="storage-engines.html#innodb-row-format" title="13.4.5. How InnoDB Stores Variable-Length Columns">New row format: fully
          off-page storage of long <code class="literal">BLOB</code>,
          <code class="literal">TEXT</code>, and <code class="literal">VARCHAR</code>
          columns</a>
        </p></li><li><p>
          <a href="storage-engines.html#innodb-file-format" title="13.4.4. InnoDB File-Format Management">File format management:
          protects upward and downward compatibility</a>
        </p></li><li><p>
          <a href="storage-engines.html#innodb-information-schema" title="13.4.6. InnoDB INFORMATION_SCHEMA tables"><code class="literal">INFORMATION_SCHEMA</code>
          tables: information about compression and locking</a>
        </p></li><li><p>
          <a href="storage-engines.html#innodb-performance" title="13.4.7. InnoDB Performance and Scalability Enhancements">Performance and scalability
          enhancements</a>
        </p></li><li><p>
          <a href="storage-engines.html#innodb-other-changes" title="13.4.8. Changes for Flexibility, Ease of Use and Reliability">Other changes for
          flexibility, ease of use and reliability</a>
        </p></li></ul></div><h5><a name="id1134542"></a>
      Upward and Downward Compatibility
    </h5><p>
      Note that the ability to use data compression and the new row
      format require the use of a new InnoDB file format called
      Barracuda. The previous file format, used by the built-in InnoDB in MySQL 5.1 and earlier, is now
      called Antelope and does not support these features, but does
      support the other features introduced with the InnoDB storage engine.
    </p><p>
      The InnoDB storage engine is upward compatible from standard InnoDB as
      built in to, and distributed with, MySQL. Existing databases can
      be used with the InnoDB Storage Engine for MySQL. The new parameter
      <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> can help
      protect upward and downward compatibility between InnoDB versions
      and database files, allowing users to enable or disable use of new
      features that can only be used with certain versions of InnoDB.
    </p><p>
      InnoDB since version 5.0.21 has a safety feature that prevents it
      from opening tables that are in an unknown format. However, the
      system tablespace may contain references to new-format tables that
      confuse the built-in InnoDB in MySQL 5.1 and earlier. These references are cleared in a
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_slow_shutdown" target="_top">slow shutdown</a>.
    </p><p>
      With previous versions of InnoDB, no error would be returned until
      you try to access a table that is in a format “<span class="quote">too
      new</span>” for the software. To provide early feedback, InnoDB
      1.1 checks the system tablespace before startup to ensure that the
      file format used in the database is supported by the storage
      engine. See
      <a href="storage-engines.html#innodb-file-format-compatibility-checking" title="13.4.4.2.1. Compatibility Check When InnoDB Is Started">Section 13.4.4.2.1, “Compatibility Check When InnoDB Is Started”</a>
      for the details.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-introduction-obtaining"></a>13.4.1.2. Obtaining and Installing the InnoDB Storage Engine</h4></div></div></div><a class="indexterm" name="id1134603"></a><a class="indexterm" name="id1134615"></a><p>
      Starting with MySQL 5.4.2, you do not need to do anything special
      to get or install the most up-to-date InnoDB storage engine. From
      that version forward, the InnoDB storage engine in the server is
      what was formerly known as the InnoDB Plugin. Earlier versions of
      MySQL required some extra build and configuration steps to get the
      Plugin-specific features such as fast index creation and table
      compression.
    </p><p>
      Report any bugs in the InnoDB storage engine using the
      <a href="http://support.oracle.com" target="_top">My Oracle Support
      site</a>. For general discussions about
      InnoDB Storage Engine for MySQL, see
      <a href="http://forums.mysql.com/list.php?22" target="_top">http://forums.mysql.com/list.php?22</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-introduction-version"></a>13.4.1.3. Viewing the InnoDB Storage Engine Version Number</h4></div></div></div><p>
      InnoDB storage engine releases are numbered with version numbers
      independent of MySQL release numbers. The initial release of the
      InnoDB storage engine is version 1.0, and it is designed to work with
      MySQL 5.1. Version 1.1 of the InnoDB storage engine is for MySQL 5.5 and
      up.
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          The first component of the InnoDB storage engine version number
          designates a major release level.
        </p></li><li><p>
          The second component corresponds to the MySQL release. The
          digit 0 corresponds to MySQL 5.1. The digit 1 corresponds to
          MySQL 5.5.
        </p></li><li><p>
          The third component indicates the specific release of the
          InnoDB storage engine (at a given major release level and for a
          specific MySQL release); only bug fixes and minor functional
          changes are introduced at this level.
        </p></li></ul></div><p>
      Once you have installed the InnoDB storage engine, you can check its
      version number in three ways:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          In the error log, it is printed during startup
        </p></li><li><p>
          <code class="code">SELECT * FROM information_schema.plugins;</code>
        </p></li><li><p>
          <code class="code">SELECT @@innodb_version;</code>
        </p></li></ul></div><p>
      The InnoDB storage engine writes its version number to the error log,
      which can be helpful in diagnosis of errors:
    </p><pre class="screen">091105 12:28:06 InnoDB Plugin 1.0.5 started; log sequence number 46509</pre><p>
      Note that the <code class="literal">PLUGIN_VERSION</code> column in the
      table <code class="literal">INFORMATION_SCHEMA.PLUGINS</code> does not
      display the third component of the version number, only the first
      and second components, as in 1.0.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-introduction-restrictions"></a>13.4.1.4. Compatibility Considerations for Downgrade and Backup</h4></div></div></div><a class="indexterm" name="id1134764"></a><p>
      <span class="strong"><strong> Because InnoDB 1.1 supports the
      “<span class="quote">Barracuda</span>” file format, with new on-disk data
      structures within both the database and log files, pay special
      attention to file format compatibility with respect to the
      following scenarios: </strong></span>
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          Downgrading from MySQL 5.5 to the MySQL 5.1 or earlier
          (without the InnoDB Plugin enabled), or otherwise using
          earlier versions of MySQL with database files created by MySQL
          5.5 and higher.
        </p></li><li><p>
          Using <code class="literal">mysqldump</code>.
        </p></li><li><p>
          Using MySQL replication.
        </p></li><li><p>
          Using MySQL Enterprise Backup or InnoDB Hot Backup.
        </p></li></ul></div><p>
      <span class="strong"><strong>WARNING:</strong></span> Once you create any
      tables with the Barracuda file format, take care to avoid crashes
      and corruptions when using those files with an earlier version of
      MySQL. It is <span class="strong"><strong>strongly</strong></span>
      recommended that you use a “<span class="quote">slow shutdown</span>”
      (<code class="literal">SET GLOBAL innodb_fast_shutdown=0</code>) when
      stopping the MySQL server before downgrading to MySQL 5.1 or
      earlier. This ensures that the log files and other system
      information do not cause consistency issues or startup problems
      when using a prior version of MySQL.
    </p><p>
      <span class="strong"><strong>WARNING:</strong></span> If you dump a database
      containing compressed tables with <code class="literal">mysqldump</code>,
      the dump file may contain <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
      TABLE</code></a> statements that attempt to create compressed
      tables, or those using <code class="literal">ROW_FORMAT=DYNAMIC</code> in
      the new database. Therefore, be sure the new database is running
      the InnoDB storage engine, with the proper settings for
      <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> and
      <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>, if you
      want to have the tables re-created as they exist in the original
      database. Typically, when the <code class="literal">mysqldump</code> file is
      loaded, MySQL and InnoDB ignore <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
      TABLE</code></a> options they do not recognize, and the table(s)
      are created in a format used by the running server.
    </p><p>
      <span class="strong"><strong>WARNING:</strong></span> If you use MySQL
      replication, ensure all slaves are configured with the
      InnoDB storage engine, with the same settings for
      <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> and
      <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>. If you do
      not do so, and you create tables that require the new Barracuda
      file format, replication errors may occur. If a slave MySQL server
      is running an older version of MySQL, it ignores the
      <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> options to create a
      compressed table or one with
      <code class="literal">ROW_FORMAT=DYNAMIC</code>, and creates the table
      uncompressed, with <code class="literal">ROW_FORMAT=COMPACT</code>.
    </p><p>
      <span class="strong"><strong>WARNING:</strong></span> Version 3.0 of
      InnoDB Hot Backup does not support the new Barracuda file format. Using
      InnoDB Hot Backup Version 3 to backup databases in this format causes
      unpredictable behavior. MySQL Enterprise Backup, the successor product to
      InnoDB Hot Backup, does support tables with the Barracuda file format.
      You can also back up such databases with
      <code class="literal">mysqldump</code>.
    </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-create-index"></a>13.4.2. Fast Index Creation in the InnoDB Storage Engine</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-create-index-overview">13.4.2.1. Overview of Fast Index Creation</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-create-index-examples">13.4.2.2. Examples of Fast Index Creation</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-create-index-implementation">13.4.2.3. Implementation Details of Fast Index Creation</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-create-index-concurrency">13.4.2.4. Concurrency Considerations for Fast Index Creation</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-create-index-recovery">13.4.2.5. How Crash Recovery Works with Fast Index Creation</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-create-index-limitations">13.4.2.6. Limitations of Fast Index Creation</a></span></dt></dl></div><p>
    In MySQL 5.5 and higher, or in MySQL 5.1 with the InnoDB Plugin,
    creating and dropping <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_secondary_index" target="_top">secondary
    indexes</a> does not copy the contents of the entire table,
    making this operation much more efficient than with prior releases.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-create-index-overview"></a>13.4.2.1. Overview of Fast Index Creation</h4></div></div></div><a class="indexterm" name="id1135031"></a><a class="indexterm" name="id1135044"></a><a class="indexterm" name="id1135058"></a><p>
      With MySQL 5.5 and higher, or MySQL 5.1 with the InnoDB Plugin,
      creating and dropping
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_secondary_index" target="_top">secondary indexes</a> for
      InnoDB tables is much faster than before. Historically, adding or
      dropping an index on a table with existing data could be very
      slow. The <a href="sql-syntax.html#create-index" title="12.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> and
      <a href="sql-syntax.html#drop-index" title="12.1.24. DROP INDEX Syntax"><code class="literal">DROP INDEX</code></a> statements worked by
      creating a new, empty table defined with the requested set of
      indexes, then copying the existing rows to the new table
      one-by-one, updating the indexes as the rows are inserted. After
      all rows from the original table were copied, the old table was
      dropped and the copy was renamed with the name of the original
      table.
    </p><p>
      The performance speedup for fast index creation applies to
      secondary indexes, not to the primary key index. The rows of an
      InnoDB table are stored in a
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_clustered_index" target="_top">clustered index</a>
      organized based on the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_primary_key" target="_top">primary
      key</a>, forming what some database systems call an
      “<span class="quote">index-organized table</span>”. Because the table structure
      is so closely tied to the primary key, redefining the primary key
      still requires copying the data.
    </p><p>
      This new mechanism also means that you can generally speed the
      overall process of creating and loading an indexed table by
      creating the table with only the clustered index, and adding the
      secondary indexes after the data is loaded.
    </p><p>
      Although no syntax changes are required in the
      <a href="sql-syntax.html#create-index" title="12.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> or
      <a href="sql-syntax.html#drop-index" title="12.1.24. DROP INDEX Syntax"><code class="literal">DROP INDEX</code></a> commands, some factors
      affect the performance, space usage, and semantics of this
      operation (see <a href="storage-engines.html#innodb-create-index-limitations" title="13.4.2.6. Limitations of Fast Index Creation">Section 13.4.2.6, “Limitations of Fast Index Creation”</a>).
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-create-index-examples"></a>13.4.2.2. Examples of Fast Index Creation</h4></div></div></div><a class="indexterm" name="id1135161"></a><p>
      It is possible to create multiple indexes on a table with one
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. This is
      relatively efficient, because the clustered index of the table
      needs to be scanned only once (although the data is sorted
      separately for each new index). For example:
    </p><pre class="programlisting">CREATE TABLE T1(A INT PRIMARY KEY, B INT, C CHAR(1)) ENGINE=InnoDB;
INSERT INTO T1 VALUES (1,2,'a'), (2,3,'b'), (3,2,'c'), (4,3,'d'), (5,2,'e');
COMMIT;
ALTER TABLE T1 ADD INDEX (B), ADD UNIQUE INDEX (C);</pre><p>
      The above statements create table <code class="literal">T1</code> with the
      clustered index (primary key) on column <code class="literal">A</code>,
      insert several rows, and then build two new indexes on columns
      <code class="literal">B</code> and <code class="literal">C</code>. If there were many
      rows inserted into <code class="literal">T1</code> before the
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement, this
      approach is much more efficient than creating all the secondary
      indexes before loading the data.
    </p><p>
      You can also create the indexes one at a time, but then the
      clustered index of the table is scanned (as well as sorted) once
      for each <a href="sql-syntax.html#create-index" title="12.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statement.
      Thus, the following statements are not as efficient as the
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement above, even
      though neither requires recreating the clustered index for table
      <code class="literal">T1</code>.
    </p><pre class="programlisting">CREATE INDEX B ON T1 (B);
CREATE UNIQUE INDEX C ON T1 (C);</pre><p>
      Dropping InnoDB secondary indexes also does not require any
      copying of table data. You can equally quickly drop multiple
      indexes with a single <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement or multiple <a href="sql-syntax.html#drop-index" title="12.1.24. DROP INDEX Syntax"><code class="literal">DROP INDEX</code></a>
      statements:
    </p><pre class="programlisting">ALTER TABLE T1 DROP INDEX B, DROP INDEX C;</pre><p>
      or:
    </p><pre class="programlisting">DROP INDEX B ON T1;
DROP INDEX C ON T1;</pre><p>
      Restructuring the clustered index in InnoDB always requires
      copying the data in the table. For example, if you create a table
      without a primary key, InnoDB chooses one for you, which may be
      the first <code class="literal">UNIQUE</code> key defined on <code class="literal">NOT
      NULL</code> columns, or a system-generated key. Defining a
      <code class="literal">PRIMARY KEY</code> later causes the data to be copied,
      as in the following example:
    </p><pre class="programlisting">CREATE TABLE T2 (A INT, B INT) ENGINE=InnoDB;
INSERT INTO T2 VALUES (NULL, 1);
ALTER TABLE T2 ADD PRIMARY KEY (B);</pre><p>
      When you create a <code class="literal">UNIQUE</code> or <code class="literal">PRIMARY
      KEY</code> index, InnoDB must do some extra work. For
      <code class="literal">UNIQUE</code> indexes, InnoDB checks that the table
      contains no duplicate values for the key. For a <code class="literal">PRIMARY
      KEY</code> index, InnoDB also checks that none of the
      <code class="literal">PRIMARY KEY</code> columns contains a
      <code class="literal">NULL</code>. It is best to define the primary key when
      you create a table, so you need not rebuild the table later.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-create-index-implementation"></a>13.4.2.3. Implementation Details of Fast Index Creation</h4></div></div></div><a class="indexterm" name="id1135382"></a><a class="indexterm" name="id1135395"></a><a class="indexterm" name="id1135407"></a><p>
      InnoDB has two types of indexes: the clustered index and secondary
      indexes. Since the clustered index contains the data values in its
      B-tree nodes, adding or dropping a clustered index does involve
      copying the data, and creating a new copy of the table. A
      secondary index, however, contains only the index key and the
      value of the primary key. This type of index can be created or
      dropped without copying the data in the clustered index. Because
      each secondary index contains copies of the primary key values
      (used to access the clustered index when needed), when you change
      the definition of the primary key, all secondary indexes are
      recreated as well.
    </p><p>
      Dropping a secondary index is simple. Only the internal InnoDB
      system tables and the MySQL data dictionary tables are updated to
      reflect the fact that the index no longer exists. InnoDB returns
      the storage used for the index to the tablespace that contained
      it, so that new indexes or additional table rows can use the
      space.
    </p><p>
      To add a secondary index to an existing table, InnoDB scans the
      table, and sorts the rows using memory buffers and temporary files
      in order by the values of the secondary index key columns. The
      B-tree is then built in key-value order, which is more efficient
      than inserting rows into an index in random order. Because the
      B-tree nodes are split when they fill, building the index in this
      way results in a higher fill-factor for the index, making it more
      efficient for subsequent access.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-create-index-concurrency"></a>13.4.2.4. Concurrency Considerations for Fast Index Creation</h4></div></div></div><a class="indexterm" name="id1135453"></a><p>
      While an InnoDB secondary index is being created or dropped, the
      table is locked in shared mode. Any writes to the table are
      blocked, but the data in the table can be read. When you alter the
      clustered index of a table, the table is locked in exclusive mode,
      because the data must be copied. Thus, during the creation of a
      new clustered index, all operations on the table are blocked.
    </p><p>
      A <a href="sql-syntax.html#create-index" title="12.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> or
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement for an InnoDB
      table always waits for currently executing transactions that are
      accessing the table to commit or roll back.
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements that
      redefine an InnoDB primary key wait for all
      <code class="literal">SELECT</code> statements that access the table to
      complete, or their containing transactions to commit. No
      transactions whose execution spans the creation of the index can
      be accessing the table, because the original table is dropped when
      the clustered index is restructured.
    </p><p>
      Once a <a href="sql-syntax.html#create-index" title="12.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> or
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement that creates
      an InnoDB secondary index begins executing, queries can access the
      table for read access, but cannot update the table. If an
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement is changing
      the clustered index for an InnoDB table, all queries wait until
      the operation completes.
    </p><p>
      A newly-created InnoDB secondary index contains only the committed
      data in the table at the time the <a href="sql-syntax.html#create-index" title="12.1.13. CREATE INDEX Syntax"><code class="literal">CREATE
      INDEX</code></a> or <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement begins to execute. It does not contain any uncommitted
      values, old versions of values, or values marked for deletion but
      not yet removed from the old index.
    </p><p>
      Because a newly-created index contains only information about data
      current at the time the index was created, queries that need to
      see data that was deleted or changed before the index was created
      cannot use the index. The only queries that could be affected by
      this limitation are those executing in transactions that began
      before the creation of the index was begun. For such queries,
      unpredictable results could occur. Newer queries can use the
      index.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-create-index-recovery"></a>13.4.2.5. How Crash Recovery Works with Fast Index Creation</h4></div></div></div><a class="indexterm" name="id1135570"></a><p>
      Although no data is lost if the server crashes while an
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement is executing,
      the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_crash_recovery" target="_top">crash recovery</a>
      process is different for
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_clustered_index" target="_top">clustered indexes</a> and
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_secondary_index" target="_top">secondary indexes</a>.
    </p><p>
      If the server crashes while creating an InnoDB secondary index,
      upon recovery, MySQL drops any partially created indexes. You must
      re-run the <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> or
      <a href="sql-syntax.html#create-index" title="12.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statement.
    </p><p>
      When a crash occurs during the creation of an InnoDB clustered
      index, recovery is more complicated, because the data in the table
      must be copied to an entirely new clustered index. Remember that
      all InnoDB tables are stored as clustered indexes. In the
      following discussion, we use the word table and clustered index
      interchangeably.
    </p><p>
      MySQL creates the new clustered index by copying the existing data
      from the original InnoDB table to a temporary table that has the
      desired index structure. Once the data is completely copied to
      this temporary table, the original table is renamed with a
      different temporary table name. The temporary table comprising the
      new clustered index is renamed with the name of the original
      table, and the original table is dropped from the database.
    </p><p>
      If a system crash occurs while creating a new clustered index, no
      data is lost, but you must complete the recovery process using the
      temporary tables that exist during the process. Since it is rare
      to re-create a clustered index or re-define primary keys on large
      tables, or to encounter a system crash during this operation, this
      manual does not provide information on recovering from this
      scenario. Instead, please see the InnoDB web site:
      <a href="http://www.innodb.com/support/tips" target="_top">http://www.innodb.com/support/tips</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-create-index-limitations"></a>13.4.2.6. Limitations of Fast Index Creation</h4></div></div></div><a class="indexterm" name="id1135672"></a><a class="indexterm" name="id1135684"></a><a class="indexterm" name="id1135701"></a><p>
      Take the following considerations into account when creating or
      dropping InnoDB indexes:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          During index creation, files are written to the temporary
          directory (<code class="literal">$TMPDIR</code> on Unix,
          <code class="literal">%TEMP%</code> on Windows, or the value of the
          <a href="server-administration.html#sysvar_tmpdir"><code class="literal">--tmpdir</code></a> configuration
          variable). Each temporary file is large enough to hold one
          column that makes up the new index, and each one is removed as
          soon as it is merged into the final index.
        </p></li><li><p>
          The table is copied, rather than using Fast Index Creation
          when you create an index on a <code class="literal">TEMPORARY
          TABLE</code>. This has been reported as
          <a href="http://bugs.mysql.com/bug.php?id=39833" target="_top">MySQL
          Bug #39833</a>.
        </p></li><li><p>
          To avoid consistency issues between the InnoDB data dictionary
          and the MySQL data dictionary, the table is copied, rather
          than using Fast Index Creation when you use the <code class="literal">ALTER
          TABLE ... RENAME COLUMN</code> syntax.
        </p></li><li><p>
          The statement <code class="literal">ALTER IGNORE TABLE
          <em class="replaceable"><code>t</code></em> ADD UNIQUE INDEX</code> does
          not delete duplicate rows. This has been reported as
          <a href="http://bugs.mysql.com/bug.php?id=40344" target="_top">MySQL
          Bug #40344</a>. The <code class="literal">IGNORE</code> keyword is
          ignored. If any duplicate rows exist, the operation fails with
          the following error message:
        </p><pre class="programlisting">ERROR 23000: Duplicate entry '<em class="replaceable"><code>347</code></em>' for key '<em class="replaceable"><code>pl</code></em>'</pre></li><li><p>
          As noted above, a newly-created index contains only
          information about data current at the time the index was
          created. Therefore, you should not run queries in a
          transaction that might use a secondary index that did not
          exist at the beginning of the transaction. There is no way for
          InnoDB to access “<span class="quote">old</span>” data that is consistent
          with the rest of the data read by the transaction. See the
          discussion of locking in
          <a href="storage-engines.html#innodb-create-index-concurrency" title="13.4.2.4. Concurrency Considerations for Fast Index Creation">Section 13.4.2.4, “Concurrency Considerations for Fast Index Creation”</a>.
        </p><p>
          Prior to InnoDB storage engine 1.0.4, unexpected results could occur
          if a query attempts to use an index created after the start of
          the transaction containing the query. If an old transaction
          attempts to access a “<span class="quote">too new</span>” index,
          InnoDB storage engine 1.0.4 and later reports an error:
        </p><pre class="programlisting">ERROR HY000: Table definition has changed, please retry transaction</pre><p>
          As the error message suggests, committing (or rolling back)
          the transaction, and restarting it, cures the problem.
        </p></li><li><p>
          InnoDB storage engine 1.0.2 introduces some improvements in error
          handling when users attempt to drop indexes. See section
          <a href="storage-engines.html#innodb-other-changes-drop-index" title="13.4.8.6. Better Error Handling when Dropping Indexes">Section 13.4.8.6, “Better Error Handling when Dropping Indexes”</a> for details.
        </p></li><li><p>
          MySQL 5.5 does not support efficient creation or dropping of
          <code class="literal">FOREIGN KEY</code> constraints. Therefore, if you
          use <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to add or
          remove a <code class="literal">REFERENCES</code> constraint, the child
          table is copied, rather than using Fast Index Creation.
        </p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-compression"></a>13.4.3. InnoDB Data Compression</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-compression-background">13.4.3.1. Overview of Table Compression</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-compression-usage">13.4.3.2. Enabling Compression for a Table</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-compression-tuning">13.4.3.3. Tuning InnoDB Compression</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-compression-internals">13.4.3.4. How Compression Works in InnoDB</a></span></dt></dl></div><p>
    By setting InnoDB configuration options, you can create tables where
    the data is stored in compressed form. The compression means less
    data is transferred between disk and memory, and takes up less space
    in memory. The benefits are amplified for tables with secondary
    indexes, because index data is compressed also.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-compression-background"></a>13.4.3.1. Overview of Table Compression</h4></div></div></div><a class="indexterm" name="id1135953"></a><p>
      Because processors and cache memories have increased in speed more
      than disk storage devices, many workloads are I/O-bound. Data
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_compression" target="_top">compression</a> enables
      smaller database size, reduced I/O, and improved throughput, at
      the small cost of increased CPU utilization. Compression is
      especially valuable for read-intensive applications, on systems
      with enough RAM to keep frequently-used data in memory.
    </p><p>
      An InnoDB table created with
      <code class="literal">ROW_FORMAT=COMPRESSED</code> can use a smaller page
      size on disk than the usual 16KB default. Smaller pages require
      less I/O to read from and write to disk, which is especially
      valuable for <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_ssd" target="_top">SSD</a> devices.
    </p><p>
      The page size is specified through the
      <code class="literal">KEY_BLOCK_SIZE</code> parameter. The different page
      size means the table must be in its own <code class="literal">.ibd</code>
      file rather than the system tablespace, which requires enabling
      the <code class="literal">innodb_file_per_table</code> option. The level of
      compression is the same regardless of the
      <code class="literal">KEY_BLOCK_SIZE</code> value. As you specify smaller
      values for <code class="literal">KEY_BLOCK_SIZE</code>, you get the I/O
      benefits of increasingly smaller pages. But if you specify a value
      that is too small, there is additional overhead to reorganize the
      pages when data values cannot be compressed enough to fit multiple
      rows in each page. There is a hard limit on how small
      <code class="literal">KEY_BLOCK_SIZE</code> can be for a table, based on the
      lengths of the key columns for each of its indexes. Specify a
      value that is too small, and the <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
      TABLE</code></a> or <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement fails.
    </p><p>
      In the buffer pool, the compressed data is held in small pages,
      with a page size based on the <code class="literal">KEY_BLOCK_SIZE</code>
      value. For extracting or updating the column values, InnoDB also
      creates a 16KB page in the buffer pool with the uncompressed data.
      Within the buffer pool, any updates to the uncompressed page are
      also re-written back to the equivalent compressed page. You might
      need to size your buffer pool to accommodate the additional data
      of both compressed and uncompressed pages, although the
      uncompressed pages are
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_eviction" target="_top">evicted</a> from the buffer pool
      when space is needed, and then uncompressed again on the next
      access.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-compression-usage"></a>13.4.3.2. Enabling Compression for a Table</h4></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-compression-enabling">13.4.3.2.1. Configuration Parameters for Compression</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-compression-syntax-warnings">13.4.3.2.2. SQL Compression Syntax Warnings and Errors</a></span></dt></dl></div><a class="indexterm" name="id1136085"></a><a class="indexterm" name="id1136098"></a><a class="indexterm" name="id1136107"></a><a class="indexterm" name="id1136119"></a><a class="indexterm" name="id1136132"></a><a class="indexterm" name="id1136144"></a><a class="indexterm" name="id1136153"></a><p>
      The default uncompressed size of InnoDB data pages is 16KB. You
      can use the attributes <code class="literal">ROW_FORMAT=COMPRESSED</code>,
      <code class="literal">KEY_BLOCK_SIZE</code>, or both in the
      <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements to enable
      table compression. Depending on the combination of option values,
      InnoDB uses a page size of 1KB, 2KB, 4KB, 8KB, or 16KB for the
      <code class="literal">.ibd</code> file of the table. (The actual compression
      algorithm is not affected by the <code class="literal">KEY_BLOCK_SIZE</code>
      value.)
    </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
        Compression is applicable to tables, not to individual rows,
        despite the option name <code class="literal">ROW_FORMAT</code>.
      </p></div><p>
      To create a compressed table, you might use a statement like this:
    </p><pre class="programlisting">CREATE TABLE <em class="replaceable"><code>name</code></em>
 (column1 INT PRIMARY KEY) 
 ENGINE=InnoDB
 ROW_FORMAT=COMPRESSED 
 KEY_BLOCK_SIZE=<em class="replaceable"><code>4</code></em>;
</pre><p>
      If you specify <code class="literal">ROW_FORMAT=COMPRESSED</code> but not
      <code class="literal">KEY_BLOCK_SIZE</code>, the default compressed page
      size of 8KB is used. If <code class="literal">KEY_BLOCK_SIZE</code> is
      specified, you can omit the attribute
      <code class="literal">ROW_FORMAT=COMPRESSED</code>.
    </p><p>
      Setting <code class="literal">KEY_BLOCK_SIZE=16</code> typically does not
      result in much compression, since the normal InnoDB page size is
      16KB. This setting may still be useful for tables with many long
      <code class="literal">BLOB</code>, <code class="literal">VARCHAR</code> or
      <code class="literal">TEXT</code> columns, because such values often do
      compress well, and might therefore require fewer
      “<span class="quote">overflow</span>” pages as described in
      <a href="storage-engines.html#innodb-compression-internals-storage-blobs">Section 13.4.3.4, “
      Compressing BLOB, VARCHAR and TEXT Columns
    ”</a>.
    </p><p>
      All indexes of a table (including the clustered index) are
      compressed using the same page size, as specified in the
      <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. Table
      attributes such as <code class="literal">ROW_FORMAT</code> and
      <code class="literal">KEY_BLOCK_SIZE</code> are not part of the
      <a href="sql-syntax.html#create-index" title="12.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> syntax, and are
      ignored if they are specified (although you see them in the output
      of the <code class="literal">SHOW CREATE TABLE</code> statement).
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-compression-enabling"></a>13.4.3.2.1. Configuration Parameters for Compression</h5></div></div></div><p>
        Compressed tables are stored in a format that previous versions
        of InnoDB cannot process. To preserve downward compatibility of
        database files, compression can be specified only when the
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_barracuda" target="_top">Barracuda</a> data file format
        is enabled using the configuration parameter
        <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>.
      </p><p>
        Table compression is also not available for the InnoDB system
        tablespace. The system tablespace (space 0, the
        <code class="literal">ibdata*</code> files) may contain user data, but it
        also contains internal InnoDB system information, and therefore
        is never compressed. Thus, compression applies only to tables
        (and indexes) stored in their own tablespaces.
      </p><p>
        To use compression, enable the
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_file_per_table" target="_top">file-per-table</a>
        mode using the configuration parameter
        <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> and
        enable the Barracuda disk file format using the parameter
        <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>. If
        necessary, you can set these parameters in the MySQL option file
        <code class="literal">my.cnf</code> or <code class="literal">my.ini</code>, or with
        the <code class="literal">SET</code> statement without shutting down the
        MySQL server.
      </p><p>
        Specifying <code class="literal">ROW_FORMAT=COMPRESSED</code> or
        <code class="literal">KEY_BLOCK_SIZE</code> in <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a> or <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
        statements produces these warnings if the Barracuda file format
        is not enabled. You can view them with the <code class="literal">SHOW
        WARNINGS</code> statement.
      </p><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Level</th><th>Code</th><th>Message</th></tr></thead><tbody><tr><td>Warning</td><td>1478</td><td><code class="literal">InnoDB: KEY_BLOCK_SIZE requires
                innodb_file_per_table.</code></td></tr><tr><td>Warning</td><td>1478</td><td><code class="literal">InnoDB: KEY_BLOCK_SIZE requires innodb_file_format=1</code></td></tr><tr><td>Warning</td><td>1478</td><td><code class="literal">InnoDB: ignoring
                KEY_BLOCK_SIZE=<em class="replaceable"><code>4</code></em>.</code></td></tr><tr><td>Warning</td><td>1478</td><td><code class="literal">InnoDB: ROW_FORMAT=COMPRESSED requires
                innodb_file_per_table.</code></td></tr><tr><td>Warning</td><td>1478</td><td><code class="literal">InnoDB: assuming ROW_FORMAT=COMPACT.</code></td></tr></tbody></table></div><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
          These messages are only warnings, not errors, and the table is
          created as if the options were not specified. When InnoDB
          “<span class="quote">strict mode</span>” (see
          <a href="storage-engines.html#innodb-other-changes-strict-mode" title="13.4.8.4. InnoDB Strict Mode">Section 13.4.8.4, “InnoDB Strict Mode”</a>) is
          enabled, InnoDB generates an error, not a warning, for these
          cases. In strict mode, the table is not created if the current
          configuration does not permit using compressed tables.
        </p></div><p>
        The “<span class="quote">non-strict</span>” behavior is intended to permit you
        to import a <code class="literal">mysqldump</code> file into a database
        that does not support compressed tables, even if the source
        database contained compressed tables. In that case, MySQL
        creates the table in <code class="literal">ROW_FORMAT=COMPACT</code>
        instead of preventing the operation.
      </p><p>
        When you import the dump file into a new database, if you want
        to have the tables re-created as they exist in the original
        database, ensure the server is running the InnoDB storage engine with
        the proper settings for the configuration parameters
        <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> and
        <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>,
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-compression-syntax-warnings"></a>13.4.3.2.2. SQL Compression Syntax Warnings and Errors</h5></div></div></div><p>
        The attribute <code class="literal">KEY_BLOCK_SIZE</code> is permitted
        only when <code class="literal">ROW_FORMAT</code> is specified as
        <code class="literal">COMPRESSED</code> or is omitted. Specifying a
        <code class="literal">KEY_BLOCK_SIZE</code> with any other
        <code class="literal">ROW_FORMAT</code> generates a warning that you can
        view with <code class="literal">SHOW WARNINGS</code>. However, the table
        is non-compressed; the specified
        <code class="literal">KEY_BLOCK_SIZE</code> is ignored).
      </p><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Level</th><th>Code</th><th>Message</th></tr></thead><tbody><tr><td>Warning</td><td>1478</td><td><code class="literal"> InnoDB: ignoring KEY_BLOCK_SIZE=<em class="replaceable"><code>n</code></em>
                unless ROW_FORMAT=COMPRESSED. </code></td></tr></tbody></table></div><p>
        If you are running in InnoDB strict mode, the combination of a
        <code class="literal">KEY_BLOCK_SIZE</code> with any
        <code class="literal">ROW_FORMAT</code> other than
        <code class="literal">COMPRESSED</code> generates an error, not a warning,
        and the table is not created.
      </p><p>
        <a href="storage-engines.html#innodb-compression-create-and-alter-options-table" title="Table 13.4. Meaning of CREATE TABLE and
          ALTER TABLE options">Table 13.4, “Meaning of <code class="literal">CREATE TABLE</code> and
          <code class="literal">ALTER TABLE</code> options”</a>
        summarizes how the various options on
        <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
        <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> are handled.
      </p><div class="table"><a name="innodb-compression-create-and-alter-options-table"></a><p class="title"><b>Table 13.4. Meaning of <code class="literal">CREATE TABLE</code> and
          <code class="literal">ALTER TABLE</code> options</b></p><table summary="Meaning of CREATE TABLE and
          ALTER TABLE options" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Option</th><th>Usage</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">ROW_FORMAT=​REDUNDANT</code></td><td>Storage format used prior to MySQL 5.0.3</td><td>Less efficient than <code class="literal">ROW_FORMAT=COMPACT</code>; for backward
                compatibility</td></tr><tr><td><code class="literal">ROW_FORMAT=​COMPACT</code></td><td>Default storage format since MySQL 5.0.3</td><td>Stores a prefix of 768 bytes of long column values in the clustered
                index page, with the remaining bytes stored in an
                overflow page</td></tr><tr><td><code class="literal">ROW_FORMAT=​DYNAMIC</code></td><td>Available only with
                <code class="literal">innodb_file​_format=Barracuda</code></td><td>Store values within the clustered index page if they fit; if not, stores
                only a 20-byte pointer to an overflow page (no prefix)</td></tr><tr><td><code class="literal">ROW_FORMAT=​COMPRESSED</code></td><td>Available only with
                <code class="literal">innodb_file​_format=Barracuda</code></td><td>Compresses the table and indexes using zlib to default compressed page
                size of 8K bytes; implies
                <code class="literal">ROW_FORMAT=DYNAMIC</code></td></tr><tr><td><code class="literal">KEY_BLOCK_​SIZE=<em class="replaceable"><code>n</code></em></code></td><td>Available only with
                <code class="literal">innodb_file​_format=Barracuda</code></td><td>Specifies compressed page size of 1, 2, 4, 8 or 16K bytes; implies
                <code class="literal">ROW_FORMAT=DYNAMIC</code> and
                <code class="literal">ROW_FORMAT=COMPRESSED</code></td></tr></tbody></table></div><p>
        <a href="storage-engines.html#innodb-compression-create-and-alter-errors-table" title="Table 13.5. CREATE/ALTER TABLE Warnings and Errors when InnoDB
          Strict Mode is OFF">Table 13.5, “<code class="literal">CREATE/ALTER TABLE</code> Warnings and Errors when InnoDB
          Strict Mode is OFF”</a>
        summarizes error conditions that occur with certain combinations
        of configuration parameters and options on the
        <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements, and how
        the options appear in the output of <code class="literal">SHOW TABLE
        STATUS</code>.
      </p><p>
        When InnoDB strict mode is <code class="literal">OFF</code>, InnoDB
        creates or alters the table, but may ignore certain settings, as
        shown below. You can see the warning messages in the MySQL error
        log. When InnoDB strict mode is <code class="literal">ON</code>, these
        specified combinations of options generate errors, and the table
        is not created or altered. You can see the full description of
        the error condition with <code class="literal">SHOW ERRORS</code>. For
        example:
</p><pre class="screen">mysql&gt; <strong class="userinput"><code>CREATE TABLE x (id INT PRIMARY KEY, c INT)
</code></strong>
-&gt; <strong class="userinput"><code>ENGINE=INNODB KEY_BLOCK_SIZE=33333;
</code></strong>
ERROR 1005 (HY000): Can't create table 'test.x' (errno: 1478)

mysql&gt; <strong class="userinput"><code>SHOW ERRORS;</code></strong>
+-------+------+-------------------------------------------+ 
| Level | Code | Message                                   | 
+-------+------+-------------------------------------------+ 
| Error | 1478 | InnoDB: invalid KEY_BLOCK_SIZE=33333.     | 
| Error | 1005 | Can't create table 'test.x' (errno: 1478) | 
+-------+------+-------------------------------------------+ 
2 rows in set (0.00 sec)
</pre><p>
      </p><div class="table"><a name="innodb-compression-create-and-alter-errors-table"></a><p class="title"><b>Table 13.5. <code class="literal">CREATE/ALTER TABLE</code> Warnings and Errors when InnoDB
          Strict Mode is OFF</b></p><table summary="CREATE/ALTER TABLE Warnings and Errors when InnoDB
          Strict Mode is OFF" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Syntax</th><th>Warning or Error Condition</th><th>Resulting <code class="literal">ROW_FORMAT</code>, as shown in <code class="literal">SHOW TABLE
                STATUS</code></th></tr></thead><tbody><tr><td><code class="literal">ROW_FORMAT=REDUNDANT</code></td><td>None</td><td><code class="literal">REDUNDANT</code></td></tr><tr><td><code class="literal">ROW_FORMAT=COMPACT</code></td><td>None</td><td><code class="literal">COMPACT</code></td></tr><tr><td><code class="literal">ROW_FORMAT=COMPRESSED</code> or
                <code class="literal">ROW_FORMAT=DYNAMIC</code> or
                <code class="literal">KEY_BLOCK_SIZE</code> is specified</td><td>Ignored unless both
                <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a><code class="literal">=Barracuda</code>
                and
                <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
                are enabled</td><td><code class="literal">COMPACT</code></td></tr><tr><td>Invalid <code class="literal">KEY_BLOCK_SIZE</code> is specified (not 1, 2, 4, 8
                or 16)</td><td><code class="literal">KEY_BLOCK_SIZE</code> is ignored</td><td>the requested one, or <code class="literal">COMPACT</code> by default</td></tr><tr><td><code class="literal">ROW_FORMAT=COMPRESSED</code> and valid
                <code class="literal">KEY_BLOCK_SIZE</code> are specified</td><td>None; <code class="literal">KEY_BLOCK_SIZE</code> specified is used, not the 8K
                default</td><td><code class="literal">COMPRESSED</code></td></tr><tr><td><code class="literal">KEY_BLOCK_SIZE</code> is specified with
                <code class="literal">REDUNDANT</code>, <code class="literal">COMPACT</code>
                or <code class="literal">DYNAMIC</code> row format</td><td><code class="literal">KEY_BLOCK_SIZE</code> is ignored</td><td><code class="literal">REDUNDANT</code>, <code class="literal">COMPACT</code> or
                <code class="literal">DYNAMIC</code></td></tr><tr><td><code class="literal">ROW_FORMAT</code> is not one of
                <code class="literal">REDUNDANT</code>,
                <code class="literal">COMPACT</code>, <code class="literal">DYNAMIC</code>
                or <code class="literal">COMPRESSED</code></td><td>Ignored if recognized by the MySQL parser. Otherwise, an error is
                issued.</td><td><code class="literal">COMPACT</code> or N/A</td></tr></tbody></table></div><p>
        When InnoDB strict mode is ON
        (<code class="literal">innodb_strict_mode=1</code>), the InnoDB storage engine
        rejects invalid <code class="literal">ROW_FORMAT</code> or
        <code class="literal">KEY_BLOCK_SIZE</code> parameters. For compatibility
        with earlier versions of InnoDB, strict mode is not enabled by
        default; instead, InnoDB issues warnings (not errors) for
        ignored invalid parameters.
      </p><p>
        Note that it is not possible to see the chosen
        <code class="literal">KEY_BLOCK_SIZE</code> using <code class="literal">SHOW TABLE
        STATUS</code>. The statement <code class="literal">SHOW CREATE
        TABLE</code> displays the <code class="literal">KEY_BLOCK_SIZE</code>
        (even if it was ignored by InnoDB). The real compressed page
        size inside InnoDB cannot be displayed by MySQL.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-compression-tuning"></a>13.4.3.3. Tuning InnoDB Compression</h4></div></div></div><a class="indexterm" name="id1137500"></a><p>
      Most often, the internal optimizations in InnoDB described in
      <a href="storage-engines.html#innodb-compression-internals-storage">Section 13.4.3.4, “
      InnoDB Data Storage and Compression
    ”</a> ensure that
      the system runs well with compressed data. However, because the
      efficiency of compression depends on the nature of your data,
      there are some factors you should consider to get best
      performance. You need to choose which tables to compress, and what
      compressed page size to use. You might also adjust the size of the
      buffer pool based on run-time performance characteristics, such as
      the amount of time the system spends compressing and uncompressing
      data.
    </p><h5><a name="innodb-compression-tuning-when"></a>
      When to Use Compression
    </h5><p>
      In general, compression works best on tables that include a
      reasonable number of character string columns and where the data
      is read far more often than it is written. Because there are no
      guaranteed ways to predict whether or not compression benefits a
      particular situation, always test with a specific
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_workload" target="_top">workload</a> and data set running
      on a representative configuration. Consider the following factors
      when deciding which tables to compress.
    </p><h5><a name="innodb-compression-tuning-when-data"></a>
      Data Characteristics and Compression
    </h5><a class="indexterm" name="id1137552"></a><p>
      A key determinant of the efficiency of compression in reducing the
      size of data files is the nature of the data itself. Recall that
      compression works by identifying repeated strings of bytes in a
      block of data. Completely randomized data is the worst case.
      Typical data often has repeated values, and so compresses
      effectively. Character strings often compress well, whether
      defined in <code class="literal">CHAR</code>, <code class="literal">VARCHAR</code>,
      <code class="literal">TEXT</code> or <code class="literal">BLOB</code> columns. On the
      other hand, tables containing mostly binary data (integers or
      floating point numbers) or data that is previously compressed (for
      example <span class="acronym">JPEG</span> or <span class="acronym">PNG</span> images)
      may not generally compress well, significantly or at all.
    </p><p>
      You choose whether to turn on compression for each InnoDB tables.
      A table and all of its indexes use the same (compressed) page
      size. It might be that the primary key (clustered) index, which
      contains the data for all columns of a table, compresses more
      effectively than the secondary indexes. For those cases where
      there are long rows, the use of compression might result in long
      column values being stored “<span class="quote">off-page</span>”, as discussed
      in <a href="storage-engines.html#innodb-row-format-dynamic" title="13.4.5.3. Barracuda File Format: DYNAMIC and
      COMPRESSED Row Formats">Section 13.4.5.3, “Barracuda File Format: <code class="literal">DYNAMIC</code> and
      <code class="literal">COMPRESSED</code> Row Formats”</a>. Those overflow
      pages may compress well. Given these considerations, for many
      applications, some tables compress more effectively than others,
      and you might find that your workload performs best only with a
      subset of tables compressed.
    </p><p>
      Experimenting is the only way to determine whether or not to
      compress a particular table. InnoDB compresses data in 16K chunks
      corresponding to the uncompressed page size, and in addition to
      user data, the page format includes some internal system data that
      is not compressed. Compression utilities compress an entire stream
      of data, and so may find more repeated strings across the entire
      input stream than InnoDB would find in a table compressed in 16K
      chunks. But you can get a sense of how compression efficiency by
      using a utility that implements LZ77 compression (such as
      <code class="literal">gzip</code> or WinZip) on your data file.
    </p><p>
      Another way to test compression on a specific table is to copy
      some data from your uncompressed table to a similar, compressed
      table (having all the same indexes) and look at the size of the
      resulting file. When you do so (if nothing else using compression
      is running), you can examine the ratio of successful compression
      operations to overall compression operations. (In the
      <code class="literal">INNODB_CMP</code> table, compare
      <code class="literal">COMPRESS_OPS</code> to
      <code class="literal">COMPRESS_OPS_OK</code>. See
      <a href="storage-engines.html#innodb-information-schema-innodb_cmp" title="13.4.6.1.1. INNODB_CMP and INNODB_CMP_RESET"><code class="literal">INNODB_CMP</code></a>
      for more information.) If a high percentage of compression
      operations complete successfully, the table might be a good
      candidate for compression.
    </p><h5><a name="innodb-compression-application"></a>
      Compression and Application and Schema Design
    </h5><a class="indexterm" name="id1137682"></a><p>
      Decide whether to compress data in your application or in the
      InnoDB table. It is usually not sensible to store data that is
      compressed by an application in an InnoDB compressed table.
      Further compression is extremely unlikely, and the attempt to
      compress just wastes CPU cycles.
    </p><h5><a name="innodb-compression-in-database"></a>
      Compressing in the Database
    </h5><p>
      The InnoDB table compression is automatic and applies to all
      columns and index values. The columns can still be tested with
      operators such as <code class="literal">LIKE</code>, and sort operations can
      still use indexes even when the index values are compressed.
      Because indexes are often a significant fraction of the total size
      of a database, compression could result in significant savings in
      storage, I/O or processor time. The compression and decompression
      operations happen on the database server, which likely is a
      powerful system that is sized to handle the expected load.
    </p><h5><a name="innodb-compression-in-application"></a>
      Compressing in the Application
    </h5><p>
      If you compress data such as text in your application, before it
      is inserted into the database, You might save overhead for data
      that does not compress well by compressing some columns and not
      others. This approach uses CPU cycles for compression and
      uncompression on the client machine rather than the database
      server, which might be appropriate for a distributed application
      with many clients, or where the client machine has spare CPU
      cycles.
    </p><h5><a name="innodb-compression-hybrid"></a>
      Hybrid Approach
    </h5><p>
      Of course, it is possible to combine these approaches. For some
      applications, it may be appropriate to use some compressed tables
      and some uncompressed tables. It may be best to externally
      compress some data (and store it in uncompressed InnoDB tables)
      and allow InnoDB to compress (some of) the other tables in the
      application. As always, up-front design and real-life testing are
      valuable in reaching the right decision.
    </p><h5><a name="innodb-compression-tuning-when-workload"></a>
      Workload Characteristics and Compression
    </h5><a class="indexterm" name="id1137754"></a><p>
      In addition to choosing which tables to compress (and the page
      size), the workload is another key determinant of performance. If
      the application is dominated by reads, rather than updates, fewer
      pages need to be reorganized and recompressed after the index page
      runs out of room for the per-page “<span class="quote">modification log</span>”
      that InnoDB maintains for compressed data. If the updates
      predominantly change non-indexed columns or those containing
      <code class="literal">BLOB</code>s or large strings that happen to be stored
      “<span class="quote">off-page</span>”, the overhead of compression may be
      acceptable. If the only changes to a table are
      <code class="literal">INSERT</code>s that use a monotonically increasing
      primary key, and there are few secondary indexes, there is little
      need to reorganize and recompress index pages. Since InnoDB can
      “<span class="quote">delete-mark</span>” and delete rows on compressed pages
      “<span class="quote">in place</span>” by modifying uncompressed data,
      <code class="literal">DELETE</code> operations on a table are relatively
      efficient.
    </p><p>
      For some environments, the time it takes to load data can be as
      important as run-time retrieval. Especially in data warehouse
      environments, many tables may be read-only or read-mostly. In
      those cases, it might or might not be acceptable to pay the price
      of compression in terms of increased load time, unless the
      resulting savings in fewer disk reads or in storage cost is
      significant.
    </p><p>
      Fundamentally, compression works best when the CPU time is
      available for compressing and uncompressing data. Thus, if your
      workload is I/O bound, rather than CPU-bound, you might find that
      compression can improve overall performance. When you test your
      application performance with different compression configurations,
      test on a platform similar to the planned configuration of the
      production system.
    </p><h5><a name="innodb-compression-tuning-when-config"></a>
      Configuration Characteristics and Compression
    </h5><a class="indexterm" name="id1137833"></a><p>
      Reading and writing database pages from and to disk is the slowest
      aspect of system performance. Compression attempts to reduce I/O
      by using CPU time to compress and uncompress data, and is most
      effective when I/O is a relatively scarce resource compared to
      processor cycles.
    </p><p>
      This is often especially the case when running in a multi-user
      environment with fast, multi-core CPUs. When a page of a
      compressed table is in memory, InnoDB often uses an additional 16K
      in the buffer pool for an uncompressed copy of the page. The
      adaptive LRU algorithm in the InnoDB storage engine attempts to balance
      the use of memory between compressed and uncompressed pages to
      take into account whether the workload is running in an I/O-bound
      or CPU-bound manner. Still, a configuration with more memory
      dedicated to the InnoDB buffer pool tends to run better when using
      compressed tables than a configuration where memory is highly
      constrained.
    </p><h5><a name="innodb-compression-tuning-when-size"></a>
      Choosing the Compressed Page Size
    </h5><a class="indexterm" name="id1137867"></a><a class="indexterm" name="id1137880"></a><a class="indexterm" name="id1137892"></a><a class="indexterm" name="id1137904"></a><p>
      The optimal setting of the compressed page size depends on the
      type and distribution of data that the table and its indexes
      contain. The compressed page size should always be bigger than the
      maximum record size, or operations may fail as noted in
      <a href="storage-engines.html#innodb-compression-internals-storage-btree">Section 13.4.3.4, “
      Compression of B-Tree Pages
    ”</a>.
    </p><p>
      Setting the compressed page size too large wastes some space, but
      the pages do not have to be compressed as often. If the compressed
      page size is set too small, inserts or updates may require
      time-consuming recompression, and the B-tree nodes may have to be
      split more frequently, leading to bigger data files and less
      efficient indexing.
    </p><p>
      Typically, you set the compressed page size to 8K or 4K bytes.
      Given that the maximum InnoDB record size is around 8K,
      <code class="literal">KEY_BLOCK_SIZE=8</code> is usually a safe choice.
    </p><h5><a name="innodb-compression-tuning-monitoring"></a>
      Monitoring Compression at Runtime
    </h5><a class="indexterm" name="id1137947"></a><p>
      Overall application performance, CPU and I/O utilization and the
      size of disk files are good indicators of how effective
      compression is for your application.
    </p><p>
      To dig deeper into performance considerations for compressed
      tables, you can monitor compression performance at run time. using
      the Information Schema tables described in
      <a href="storage-engines.html#innodb-information-schema-examples-compression" title="Example 13.1. Using the Compression Information Schema Tables">Example 13.1, “Using the Compression Information Schema Tables”</a>.
      These tables reflect the internal use of memory and the rates of
      compression used overall.
    </p><p>
      The <code class="literal">INNODB_CMP</code> tables report information about
      compression activity for each compressed page size
      (<code class="literal">KEY_BLOCK_SIZE</code>) in use. The information in
      these tables is system-wide, and includes summary data across all
      compressed tables in your database. You can use this data to help
      decide whether or not to compress a table by examining these
      tables when no other compressed tables are being accessed.
    </p><p>
      The key statistics to consider are the number of, and amount of
      time spent performing, compression and uncompression operations.
      Since InnoDB must split B-tree nodes when they are too full to
      contain the compressed data following a modification, compare the
      number of “<span class="quote">successful</span>” compression operations with
      the number of such operations overall. Based on the information in
      the <code class="literal">INNODB_CMP</code> tables and overall application
      performance and hardware resource utilization, you might make
      changes in your hardware configuration, adjust the size of the
      InnoDB buffer pool, choose a different page size, or select a
      different set of tables to compress.
    </p><p>
      If the amount of CPU time required for compressing and
      uncompressing is high, changing to faster CPUs, or those with more
      cores, can help improve performance with the same data,
      application workload and set of compressed tables. Increasing the
      size of the InnoDB buffer pool might also help performance, so
      that more uncompressed pages can stay in memory, reducing the need
      to uncompress pages that exist in memory only in compressed form.
    </p><p>
      A large number of compression operations overall (compared to the
      number of <code class="literal">INSERT</code>, <code class="literal">UPDATE</code> and
      <code class="literal">DELETE</code> operations in your application and the
      size of the database) could indicate that some of your compressed
      tables are being updated too heavily for effective compression. If
      so, choose a larger page size, or be more selective about which
      tables you compress.
    </p><p>
      If the number of “<span class="quote">successful</span>” compression operations
      (<code class="literal">COMPRESS_OPS_OK</code>) is a high percentage of the
      total number of compression operations
      (<code class="literal">COMPRESS_OPS</code>), then the system is likely
      performing well. If the ratio is low, then InnoDB is reorganizing,
      recompressing, and splitting B-tree nodes more often than is
      desirable. In this case, avoid compressing some tables, or
      increase <code class="literal">KEY_BLOCK_SIZE</code> for some of the
      compressed tables. You might turn off compression for tables that
      cause the number of “<span class="quote">compression failures</span>” in your
      application to be more than 1% or 2% of the total. (Such a failure
      ratio might be acceptable during a temporary operation such as a
      data load).
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-compression-internals"></a>13.4.3.4. How Compression Works in InnoDB</h4></div></div></div><a class="indexterm" name="id1138087"></a><p>
      This section describes some internal implementation details about
      compression in InnoDB. The information presented here may be
      helpful in tuning for performance, but is not necessary to know
      for basic use of compression.
    </p><h5><a name="innodb-compression-internals-algorithms"></a>
      Compression Algorithms
    </h5><a class="indexterm" name="id1138111"></a><p>
      Some operating systems implement compression at the file system
      level. Files are typically divided into fixed-size blocks that are
      compressed into variable-size blocks, which easily leads into
      fragmentation. Every time something inside a block is modified,
      the whole block is recompressed before it is written to disk.
      These properties make this compression technique unsuitable for
      use in an update-intensive database system.
    </p><p>
      InnoDB implements compression with the help of the well-known
      <a href="http://www.zlib.net/" target="_top">zlib library</a>, which
      implements the LZ77 compression algorithm. This compression
      algorithm is mature, robust, and efficient in both CPU utilization
      and in reduction of data size. The algorithm is
      “<span class="quote">lossless</span>”, so that the original uncompressed data
      can always be reconstructed from the compressed form. LZ77
      compression works by finding sequences of data that are repeated
      within the data to be compressed. The patterns of values in your
      data determine how well it compresses, but typical user data often
      compresses by 50% or more.
    </p><p>
      Unlike compression performed by an application, or compression
      features of some other database management systems, InnoDB
      compression applies both to user data and to indexes. In many
      cases, indexes can constitute 40-50% or more of the total database
      size, so this difference is significant. When compression is
      working well for a data set, the size of the InnoDB data files
      (the <code class="literal">.idb</code> files) is 25% to 50% of the
      uncompressed size or possibly smaller. Depending on the workload,
      this smaller database can in turn lead to a reduction in I/O, and
      an increase in throughput, at a modest cost in terms of increased
      CPU utilization.
    </p><h5><a name="innodb-compression-internals-storage"></a>
      InnoDB Data Storage and Compression
    </h5><a class="indexterm" name="id1138170"></a><p>
      All user data in InnoDB is stored in pages comprising a B-tree
      index (the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_clustered_index" target="_top">clustered
      index</a>). In some other database systems, this type of index
      is called an “<span class="quote">index-organized table</span>”. Each row in the
      index node contains the values of the (user-specified or
      system-generated) primary key and all the other columns of the
      table.
    </p><p>
      Secondary indexes in InnoDB are also B-trees, containing pairs of
      values: the index key and a pointer to a row in the clustered
      index. The pointer is in fact the value of the primary key of the
      table, which is used to access the clustered index if columns
      other than the index key and primary key are required. Secondary
      index records must always fit on a single B-tree page.
    </p><p>
      The compression of B-tree nodes (of both clustered and secondary
      indexes) is handled differently from compression of overflow pages
      used to store long <code class="literal">VARCHAR</code>,
      <code class="literal">BLOB</code>, or <code class="literal">TEXT</code> columns, as
      explained in the following sections.
    </p><h5><a name="innodb-compression-internals-storage-btree"></a>
      Compression of B-Tree Pages
    </h5><a class="indexterm" name="id1138234"></a><p>
      Because they are frequently updated, B-tree pages require special
      treatment. It is important to minimize the number of times B-tree
      nodes are split, as well as to minimize the need to uncompress and
      recompress their content.
    </p><p>
      One technique InnoDB uses is to maintain some system information
      in the B-tree node in uncompressed form, thus facilitating certain
      in-place updates. For example, this allows rows to be
      delete-marked and deleted without any compression operation.
    </p><p>
      In addition, InnoDB attempts to avoid unnecessary uncompression
      and recompression of index pages when they are changed. Within
      each B-tree page, the system keeps an uncompressed
      “<span class="quote">modification log</span>” to record changes made to the
      page. Updates and inserts of small records may be written to this
      modification log without requiring the entire page to be
      completely reconstructed.
    </p><p>
      When the space for the modification log runs out, InnoDB
      uncompresses the page, applies the changes and recompresses the
      page. If recompression fails, the B-tree nodes are split and the
      process is repeated until the update or insert succeeds.
    </p><p>
      Generally, InnoDB requires that each B-tree page can accommodate
      at least two records. For compressed tables, this requirement has
      been relaxed. Leaf pages of B-tree nodes (whether of the primary
      key or secondary indexes) only need to accommodate one record, but
      that record must fit in uncompressed form, in the per-page
      modification log. Starting with InnoDB storage engine version 1.0.2, and
      if InnoDB strict mode is <code class="literal">ON</code>, the
      InnoDB storage engine checks the maximum row size during
      <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a href="sql-syntax.html#create-index" title="12.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>. If the row does not
      fit, the following error message is issued: <code class="literal">ERROR HY000:
      Too big row</code>.
    </p><p>
      If you create a table when InnoDB strict mode is OFF, and a
      subsequent <code class="literal">INSERT</code> or <code class="literal">UPDATE</code>
      statement attempts to create an index entry that does not fit in
      the size of the compressed page, the operation fails with
      <code class="literal">ERROR 42000: Row size too large</code>. (This error
      message does not name the index for which the record is too large,
      or mention the length of the index record or the maximum record
      size on that particular index page.) To solve this problem,
      rebuild the table with <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      and select a larger compressed page size
      (<code class="literal">KEY_BLOCK_SIZE</code>), shorten any column prefix
      indexes, or disable compression entirely with
      <code class="literal">ROW_FORMAT=DYNAMIC</code> or
      <code class="literal">ROW_FORMAT=COMPACT</code>.
    </p><h5><a name="innodb-compression-internals-storage-blobs"></a>
      Compressing BLOB, VARCHAR and TEXT Columns
    </h5><a class="indexterm" name="id1138365"></a><a class="indexterm" name="id1138378"></a><a class="indexterm" name="id1138390"></a><a class="indexterm" name="id1138402"></a><p>
      In a clustered index, <code class="literal">BLOB</code>,
      <code class="literal">VARCHAR</code> and <code class="literal">TEXT</code> columns
      that are not part of the primary key may be stored on separately
      allocated (“<span class="quote">overflow</span>”) pages. We call these
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_off_page_column" target="_top">off-page columns</a> whose
      values are stored on singly-linked lists of overflow pages.
    </p><p>
      For tables created in <code class="literal">ROW_FORMAT=DYNAMIC</code> or
      <code class="literal">ROW_FORMAT=COMPRESSED</code>, the values of
      <code class="literal">BLOB</code>, <code class="literal">TEXT</code> or
      <code class="literal">VARCHAR</code> columns may be stored fully off-page,
      depending on their length and the length of the entire row. For
      columns that are stored off-page, the clustered index record only
      contains 20-byte pointers to the overflow pages, one per column.
      Whether any columns are stored off-page depends on the page size
      and the total size of the row. When the row is too long to fit
      entirely within the page of the clustered index, InnoDB chooses
      the longest columns for off-page storage until the row fits on the
      clustered index page. As noted above, if a row does not fit by
      itself on a compressed page, an error occurs.
    </p><p>
      Tables created in previous versions of InnoDB use the Antelope
      file format, which supports only
      <code class="literal">ROW_FORMAT=REDUNDANT</code> and
      <code class="literal">ROW_FORMAT=COMPACT</code>. In these formats, InnoDB
      stores the first 768 bytes of <code class="literal">BLOB</code>,
      <code class="literal">VARCHAR</code> and <code class="literal">TEXT</code> columns in
      the clustered index record along with the primary key. The
      768-byte prefix is followed by a 20-byte pointer to the overflow
      pages that contain the rest of the column value.
    </p><p>
      When a table is in <code class="literal">COMPRESSED</code> format, all data
      written to overflow pages is compressed “<span class="quote">as is</span>”; that
      is, InnoDB applies the zlib compression algorithm to the entire
      data item. Other than the data, compressed overflow pages contain
      an uncompressed header and trailer comprising a page checksum and
      a link to the next overflow page, among other things. Therefore,
      very significant storage savings can be obtained for longer
      <code class="literal">BLOB</code>, <code class="literal">TEXT</code> or
      <code class="literal">VARCHAR</code> columns if the data is highly
      compressible, as is often the case with text data (but not
      previously compressed images).
    </p><p>
      The overflow pages are of the same size as other pages. A row
      containing ten columns stored off-page occupies ten overflow
      pages, even if the total length of the columns is only 8K bytes.
      In an uncompressed table, ten uncompressed overflow pages occupy
      160K bytes. In a compressed table with an 8K page size, they
      occupy only 80K bytes. Thus, it is often more efficient to use
      compressed table format for tables with long column values.
    </p><p>
      Using a 16K compressed page size can reduce storage and I/O costs
      for <code class="literal">BLOB</code>, <code class="literal">VARCHAR</code> or
      <code class="literal">TEXT</code> columns, because such data often compress
      well, and might therefore require fewer “<span class="quote">overflow</span>”
      pages, even though the B-tree nodes themselves take as many pages
      as in the uncompressed form.
    </p><h5><a name="innodb-compression-internals-pool"></a>
      Compression and the InnoDB Buffer Pool
    </h5><a class="indexterm" name="id1138599"></a><p>
      In a compressed InnoDB table, every compressed page (whether 1K,
      2K, 4K or 8K) corresponds to an uncompressed page of 16K bytes. To
      access the data in a page, InnoDB reads the compressed page from
      disk if it is not already in the buffer pool, then uncompresses
      the page to its original 16K byte form. This section describes how
      InnoDB manages the buffer pool with respect to pages of compressed
      tables.
    </p><p>
      To minimize I/O and to reduce the need to uncompress a page, at
      times the buffer pool contains both the compressed and
      uncompressed form of a database page. To make room for other
      required database pages, InnoDB may “<span class="quote">evict</span>” from the
      buffer pool an uncompressed page, while leaving the compressed
      page in memory. Or, if a page has not been accessed in a while,
      the compressed form of the page may be written to disk, to free
      space for other data. Thus, at any given time, the buffer pool may
      contain both the compressed and uncompressed forms of the page, or
      only the compressed form of the page, or neither.
    </p><p>
      InnoDB keeps track of which pages to keep in memory and which to
      evict using a least-recently-used (LRU) list, so that
      “<span class="quote">hot</span>” or frequently accessed data tends to stay in
      memory. When compressed tables are accessed, InnoDB uses an
      adaptive LRU algorithm to achieve an appropriate balance of
      compressed and uncompressed pages in memory. This adaptive
      algorithm is sensitive to whether the system is running in an
      I/O-bound or CPU-bound manner. The goal is to avoid spending too
      much processing time uncompressing pages when the CPU is busy, and
      to avoid doing excess I/O when the CPU has spare cycles that can
      be used for uncompressing compressed pages (that may already be in
      memory). When the system is I/O-bound, the algorithm prefers to
      evict the uncompressed copy of a page rather than both copies, to
      make more room for other disk pages to become memory resident.
      When the system is CPU-bound, InnoDB prefers to evict both the
      compressed and uncompressed page, so that more memory can be used
      for “<span class="quote">hot</span>” pages and reducing the need to uncompress
      data in memory only in compressed form.
    </p><h5><a name="innodb-compression-internals-log"></a>
      Compression and the InnoDB Log Files
    </h5><a class="indexterm" name="id1138661"></a><p>
      Before a compressed page is written to a database file, InnoDB
      writes a copy of the page to the redo log (if it has been
      recompressed since the last time it was written to the database).
      This is done to ensure that redo logs will always be usable, even
      if a future version of InnoDB uses a slightly different
      compression algorithm. Therefore, some increase in the size of log
      files, or a need for more frequent checkpoints, can be expected
      when using compression. The amount of increase in the log file
      size or checkpoint frequency depends on the number of times
      compressed pages are modified in a way that requires
      reorganization and recompression.
    </p><p>
      Note that the redo log file format (and the database file format)
      are different from previous releases when using compression. The
      MySQL Enterprise Backup product does support this latest Barracuda file format for
      compressed InnoDB tables. The older InnoDB Hot Backup product can only
      back up tables using the file format Antelope, and thus does not
      support InnoDB tables that use compression.
    </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-file-format"></a>13.4.4. InnoDB File-Format Management</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-file-format-enabling">13.4.4.1. Enabling File Formats</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-file-format-compatibility">13.4.4.2. Verifying File Format Compatibility</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-file-format-identifying">13.4.4.3. Identifying the File Format in Use</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-file-format-downgrading">13.4.4.4. Downgrading the File Format</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-file-format-future">13.4.4.5. Future InnoDB File Formats</a></span></dt></dl></div><a class="indexterm" name="id1138719"></a><a class="indexterm" name="id1138728"></a><a class="indexterm" name="id1138737"></a><a class="indexterm" name="id1138746"></a><p>
    As InnoDB evolves, new on-disk data structures are sometimes
    required to support new features. Features such as compressed tables
    (see <a href="storage-engines.html#innodb-compression" title="13.4.3. InnoDB Data Compression">Section 13.4.3, “InnoDB Data Compression”</a>), and long variable-length
    columns stored off-page (see <a href="storage-engines.html#innodb-row-format" title="13.4.5. How InnoDB Stores Variable-Length Columns">Section 13.4.5, “How InnoDB Stores Variable-Length Columns”</a>)
    require data file formats that are not compatible with prior
    versions of InnoDB. These features both require use of the new
    <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_barracuda" target="_top">Barracuda</a> file format.
  </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
      All other new features are compatible with the original
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_antelope" target="_top">Antelope</a> file format and do
      not require the Barracuda file format.
    </p></div><p>
    This section discusses how to specify the file format for new InnoDB
    tables, compatibility of different file formats between MySQL
    releases,
  </p><p><a name="innodb-file-format-named"></a><b>Named File Formats. </b>
      InnoDB 1.1 has the idea of a named file format and a configuration
      parameter to enable the use of features that require use of that
      format. The new file format is the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_barracuda" target="_top">Barracuda</a> format, and the
      original InnoDB file format is called
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_antelope" target="_top">Antelope</a>. Compressed tables
      and the new row format that stores long columns
      “<span class="quote">off-page</span>” require the use of the Barracuda file
      format or newer. Future versions of InnoDB may introduce a series
      of file formats,
      <a href="storage-engines.html#innodb-file-format-future" title="13.4.4.5. Future InnoDB File Formats">identified with the
      names of animals</a>, in ascending alphabetic order.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-file-format-enabling"></a>13.4.4.1. Enabling File Formats</h4></div></div></div><p>
      The configuration parameter
      <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> controls
      whether such statements as <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
      TABLE</code></a> and <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      can be used to create tables that depend on support for the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_barracuda" target="_top">Barracuda</a> file format.
    </p><p>
      Although Oracle recommends using the Barracuda format for new
      tables where practical, in MySQL 5.5 the default file format is
      still <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_antelope" target="_top">Antelope</a>, for maximum
      compatibility with replication configurations containing different
      MySQL releases.
    </p><p>
      The file format is a dynamic, global parameter that can be
      specified in the MySQL option file (<code class="literal">my.cnf</code> or
      <code class="literal">my.ini</code>) or changed with the <code class="literal">SET
      GLOBAL</code> command.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-file-format-compatibility"></a>13.4.4.2. Verifying File Format Compatibility</h4></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-file-format-compatibility-checking">13.4.4.2.1. Compatibility Check When InnoDB Is Started</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-file-format-compatibility-checking-table-access">13.4.4.2.2. Compatibility Check When a Table Is Opened</a></span></dt></dl></div><a class="indexterm" name="id1138917"></a><p>
      InnoDB 1.1 incorporates several checks to guard against the
      possible crashes and data corruptions that might occur if you run
      an older release of the MySQL server on InnoDB data files using a
      newer file format. These checks take place when the server is
      started, and when you first access a table. This section describes
      these checks, how you can control them, and error and warning
      conditions that might arise.
    </p><h5><a name="id1138937"></a>
      Backward Compatibility
    </h5><p>
      Considerations of backward compatibility only apply when using a
      recent version of InnoDB (the InnoDB Plugin, or MySQL 5.5 and
      higher with InnoDB 1.1) alongside an older one (MySQL 5.1 or
      earlier, with the built-in InnoDB rather than the InnoDB Plugin).
      To minimize the chance of compatibility issues, you can
      standardize on the InnoDB Plugin for all your MySQL 5.1 and
      earlier database servers.
    </p><p>
      In general, a newer version of InnoDB may create a table or index
      that cannot safely be read or written with a prior version of
      InnoDB without risk of crashes, hangs, wrong results or
      corruptions. InnoDB 1.1 includes a mechanism to guard against
      these conditions, and to help preserve compatibility among
      database files and versions of InnoDB. This mechanism lets you
      take advantage of some new features of an InnoDB release (such as
      performance improvements and bug fixes), and still preserve the
      option of using your database with a prior version of InnoDB, by
      preventing accidental use of new features that create
      downward-incompatible disk files.
    </p><p>
      If a version of InnoDB supports a particular file format (whether
      or not that format is the default), you can query and update any
      table that requires that format or an earlier format. Only the
      creation of new tables using new features is limited based on the
      particular file format enabled. Conversely, if a tablespace
      contains a table or index that uses a file format that is not
      supported by the currently running software, it cannot be accessed
      at all, even for read access.
    </p><p>
      The only way to “<span class="quote">downgrade</span>” an InnoDB tablespace to
      an earlier file format is to copy the data to a new table, in a
      tablespace that uses the earlier format. This can be done with the
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement, as described
      in <a href="storage-engines.html#innodb-file-format-downgrading" title="13.4.4.4. Downgrading the File Format">Section 13.4.4.4, “Downgrading the File Format”</a>.
    </p><p>
      The easiest way to determine the file format of an existing InnoDB
      tablespace is to examine the properties of the table it contains,
      using the <code class="literal">SHOW TABLE STATUS</code> command or querying
      the table <code class="literal">INFORMATION_SCHEMA.TABLES</code>. If the
      <code class="literal">Row_format</code> of the table is reported as
      <code class="literal">'Compressed'</code> or <code class="literal">'Dynamic'</code>,
      the tablespace containing the table uses the Barracuda format.
      Otherwise, it uses the prior InnoDB file format, Antelope.
    </p><h5><a name="id1139022"></a>
      Internal Details
    </h5><p>
      Every InnoDB per-table tablespace (represented by a
      <code class="literal">*.ibd</code> file) file is labeled with a file format
      identifier. The system tablespace (represented by the
      <code class="literal">ibdata</code> files) is tagged with the
      “<span class="quote">highest</span>” file format in use in a group of InnoDB
      database files, and this tag is checked when the files are opened.
    </p><p>
      Creating a compressed table, or a table with
      <code class="literal">ROW_FORMAT=DYNAMIC</code>, updates the file header for
      the corresponding <code class="literal">.ibd</code> file and the table type
      in the InnoDB data dictionary with the identifier for the
      Barracuda file format. From that point forward, the table cannot
      be used with a version of InnoDB that does not support this new
      file format. To protect against anomalous behavior, InnoDB version
      5.0.21 and later performs a compatibility check when the table is
      opened. (In many cases, the <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> statement recreates a table and thus changes its
      properties. The special case of adding or dropping indexes without
      rebuilding the table is described in
      <a href="storage-engines.html#innodb-create-index" title="13.4.2. Fast Index Creation in the InnoDB Storage Engine">Section 13.4.2, “Fast Index Creation in the InnoDB Storage Engine”</a>.)
    </p><h5><a name="id1139082"></a>
      Definition of ib-file set
    </h5><p>
      To avoid confusion, for the purposes of this discussion we define
      the term “<span class="quote">ib-file set</span>” to mean the set of operating
      system files that InnoDB manages as a unit. The ib-file set
      includes the following files:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          The system tablespace (one or more <code class="literal">ibdata</code>
          files) that contain internal system information (including
          internal catalogs and undo information) and may include user
          data and indexes.
        </p></li><li><p>
          Zero or more single-table tablespaces (also called “<span class="quote">file
          per table</span>” files, named <code class="literal">*.ibd</code>
          files).
        </p></li><li><p>
          InnoDB log files; usually two, <code class="literal">ib_logfile0</code>
          and <code class="literal">ib_logfile1</code>. Used for crash recovery
          and in backups.
        </p></li></ul></div><p>
      An “<span class="quote">ib-file set</span>” does not include the corresponding
      <code class="literal">.frm</code> files that contain metadata about InnoDB
      tables. The <code class="literal">.frm</code> files are created and managed
      by MySQL, and can sometimes get out of sync with the internal
      metadata in InnoDB.
    </p><p>
      Multiple tables, even from more than one database, can be stored
      in a single “<span class="quote">ib-file set</span>”. (In MySQL, a
      “<span class="quote">database</span>” is a logical collection of tables, what
      other systems refer to as a “<span class="quote">schema</span>” or
      “<span class="quote">catalog</span>”.)
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-file-format-compatibility-checking"></a>13.4.4.2.1. Compatibility Check When InnoDB Is Started</h5></div></div></div><a class="indexterm" name="id1139198"></a><a class="indexterm" name="id1139207"></a><p>
        To prevent possible crashes or data corruptions when InnoDB
        opens an ib-file set, it checks that it can fully support the
        file formats in use within the ib-file set. If the system is
        restarted following a crash, or a “<span class="quote">fast shutdown</span>”
        (i.e., <a href="storage-engines.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> is
        greater than zero), there may be on-disk data structures (such
        as redo or undo entries, or doublewrite pages) that are in a
        “<span class="quote">too-new</span>” format for the current software. During
        the recovery process, serious damage can be done to your data
        files if these data structures are accessed. The startup check
        of the file format occurs before any recovery process begins,
        thereby preventing consistency issues with the new tables or
        startup problems for the MySQL server.
      </p><p>
        Beginning with version InnoDB 1.0.1, the system tablespace
        records an identifier or tag for the “<span class="quote">highest</span>” file
        format used by any table in any of the tablespaces that is part
        of the ib-file set. Checks against this file format tag are
        controlled by the configuration parameter
        <a href="storage-engines.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a>,
        which is <code class="literal">ON</code> by default.
      </p><p>
        If the file format tag in the system tablespace is newer or
        higher than the highest version supported by the particular
        currently executing software and if
        <a href="storage-engines.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> is
        <code class="literal">ON</code>, the following error is issued when the
        server is started:
      </p><pre class="programlisting">InnoDB: Error: the system tablespace is in a
file format that this version doesn't support</pre><p>
        You can also set
        <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> to a
        file format name. Doing so prevents InnoDB from starting if the
        current software does not support the file format specified. It
        also sets the “<span class="quote">high water mark</span>” to the value you
        specify. The ability to set
        <a href="storage-engines.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a>
        will be useful (with future releases of InnoDB) if you manually
        “<span class="quote">downgrade</span>” all of the tables in an ib-file set (as
        described in <a href="storage-engines.html#innodb-downgrading" title="13.4.11. Downgrading the InnoDB Storage Engine">Section 13.4.11, “Downgrading the InnoDB Storage Engine”</a>). You can then
        rely on the file format check at startup if you subsequently use
        an older version of InnoDB to access the ib-file set.
      </p><p>
        In some limited circumstances, you might want to start the
        server and use an ib-file set that is in a “<span class="quote">too
        new</span>” format (one that is not supported by the software
        you are using). If you set the configuration parameter
        <a href="storage-engines.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> to
        <code class="literal">OFF</code>, InnoDB opens the database, but issues
        this warning message in the error log:
      </p><pre class="programlisting">InnoDB: Warning: the system tablespace is in a
file format that this version doesn't support</pre><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
          This is a very dangerous setting, as it permits the recovery
          process to run, possibly corrupting your database if the
          previous shutdown was a crash or “<span class="quote">fast shutdown</span>”.
          You should only set
          <a href="storage-engines.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a>
          to <code class="literal">OFF</code> if you are sure that the previous
          shutdown was done with
          <code class="literal">innodb_fast_shutdown=0</code>, so that essentially
          no recovery process occurs. In a future release, this
          parameter setting may be renamed from <code class="literal">OFF</code>
          to <code class="literal">UNSAFE</code>. (However, until there are newer
          releases of InnoDB that support additional file formats, even
          disabling the startup checking is in fact
          “<span class="quote">safe</span>”.)
        </p></div><p>
        The parameter
        <a href="storage-engines.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a>
        affects only what happens when a database is opened, not
        subsequently. Conversely, the parameter
        <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> (which
        enables a specific format) only determines whether or not a new
        table can be created in the enabled format and has no effect on
        whether or not a database can be opened.
      </p><p>
        The file format tag is a “<span class="quote">high water mark</span>”, and as
        such it is increased after the server is started, if a table in
        a “<span class="quote">higher</span>” format is created or an existing table
        is accessed for read or write (assuming its format is
        supported). If you access an existing table in a format higher
        than the format the running software supports, the system
        tablespace tag is not updated, but table-level compatibility
        checking applies (and an error is issued), as described in
        <a href="storage-engines.html#innodb-file-format-compatibility-checking-table-access" title="13.4.4.2.2. Compatibility Check When a Table Is Opened">Section 13.4.4.2.2, “Compatibility Check When a Table Is Opened”</a>.
        Any time the high water mark is updated, the value of
        <a href="storage-engines.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> is
        updated as well, so the command <code class="literal">SELECT
        @@innodb_file_format_check;</code> displays the name of the
        newest file format known to be used by tables in the currently
        open ib-file set and supported by the currently executing
        software.
      </p><p>
        To best illustrate this behavior, consider the scenario
        described in
        <a href="storage-engines.html#innodb-file-format-compatibility-table" title="Table 13.6. InnoDB Data File Compatibility and Related InnoDB Parameters">Table 13.6, “InnoDB Data File Compatibility and Related InnoDB Parameters”</a>.
        Imagine that some future version of InnoDB supports the Cheetah
        format and that an ib-file set has been used with that version.
      </p><div class="table"><a name="innodb-file-format-compatibility-table"></a><p class="title"><b>Table 13.6. InnoDB Data File Compatibility and Related InnoDB Parameters</b></p><table summary="InnoDB Data File Compatibility and Related InnoDB Parameters" border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th>innodb file format check</th><th>innodb file format</th><th>Highest file format used in ib-file set</th><th>Highest file format supported by InnoDB</th><th>Result</th></tr></thead><tbody><tr><td><code class="literal">OFF</code></td><td><code class="literal">Antelope</code> or <code class="literal">Barracuda</code></td><td><code class="literal">Barracuda</code></td><td><code class="literal">Barracuda</code></td><td>Database can be opened; tables can be created which require Antelope or
                Barracuda file format</td></tr><tr><td><code class="literal">OFF</code></td><td><code class="literal">Antelope</code> or <code class="literal">Barracuda</code></td><td><code class="literal">Cheetah</code></td><td><code class="literal">Barracuda</code></td><td>Database can be opened with a warning, since the database contains files
                in a “<span class="quote">too new</span>” format; tables can be
                created in Antelope or Barracuda file format; tables in
                Cheetah format cannot be accessed</td></tr><tr><td><code class="literal">OFF</code></td><td><code class="literal">Cheetah</code></td><td><code class="literal">Barracuda</code></td><td><code class="literal">Barracuda</code></td><td>Database cannot be opened;
                <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>
                cannot be set to Cheetah</td></tr><tr><td><code class="literal">ON</code></td><td><code class="literal">Antelope</code> or <code class="literal">Barracuda</code></td><td><code class="literal">Barracuda</code></td><td><code class="literal">Barracuda</code></td><td>Database can be opened; tables can be created in Antelope or Barracuda
                file format</td></tr><tr><td><code class="literal">ON</code></td><td><code class="literal">Antelope</code> or <code class="literal">Barracuda</code></td><td><code class="literal">Cheetah</code></td><td><code class="literal">Barracuda</code></td><td>Database cannot be opened, since the database contains files in a
                “<span class="quote">too new</span>” format (Cheetah)</td></tr><tr><td><code class="literal">ON</code></td><td><code class="literal">Cheetah</code></td><td><code class="literal">Barracuda</code></td><td><code class="literal">Barracuda</code></td><td>Database cannot be opened;
                <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>
                cannot be set to Cheetah</td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-file-format-compatibility-checking-table-access"></a>13.4.4.2.2. Compatibility Check When a Table Is Opened</h5></div></div></div><p>
        When a table is first accessed, InnoDB (including some releases
        prior to InnoDB 1.0) checks that the file format of the
        tablespace in which the table is stored is fully supported. This
        check prevents crashes or corruptions that would otherwise occur
        when tables using a “<span class="quote">too new</span>” data structure are
        encountered.
      </p><p>
        All tables using any file format supported by a release can be
        read or written (assuming the user has sufficient privileges).
        The setting of the system configuration parameter
        <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> can prevent
        creating a new table that uses specific file formats, even if
        they are supported by a given release. Such a setting might be
        used to preserve backward compatibility, but it does not prevent
        accessing any table that uses any supported format.
      </p><p>
        As noted in <a href="storage-engines.html#innodb-file-format-named" title="Named File Formats">Named File Formats</a>, versions
        of MySQL older than 5.0.21 cannot reliably use database files
        created by newer versions if a new file format was used when a
        table was created. To prevent various error conditions or
        corruptions, InnoDB checks file format compatibility when it
        opens a file (for example, upon first access to a table). If the
        currently running version of InnoDB does not support the file
        format identified by the table type in the InnoDB data
        dictionary, MySQL reports the following error:
      </p><pre class="programlisting">ERROR 1146 (42S02): Table '<em class="replaceable"><code>test</code></em>.<em class="replaceable"><code>t1</code></em>' doesn't exist
</pre><p>
        InnoDB also writes a message to the error log:
      </p><pre class="programlisting">InnoDB: table <em class="replaceable"><code>test</code></em>/<em class="replaceable"><code>t1</code></em>: unknown table type <em class="replaceable"><code>33</code></em>
</pre><p>
        The table type should be equal to the tablespace flags, which
        contains the file format version as discussed in
        <a href="storage-engines.html#innodb-file-format-identifying" title="13.4.4.3. Identifying the File Format in Use">Section 13.4.4.3, “Identifying the File Format in Use”</a>.
      </p><p>
        Versions of InnoDB prior to MySQL 4.1 did not include table
        format identifiers in the database files, and versions prior to
        MySQL 5.0.21 did not include a table format compatibility check.
        Therefore, there is no way to ensure proper operations if a
        table in a “<span class="quote">too new</span>” format is used with versions
        of InnoDB prior to 5.0.21.
      </p><p>
        The file format management capability in InnoDB 1.0 and higher
        (tablespace tagging and run-time checks) allows InnoDB to verify
        as soon as possible that the running version of software can
        properly process the tables existing in the database.
      </p><p>
        If you permit InnoDB to open a database containing files in a
        format it does not support (by setting the parameter
        <a href="storage-engines.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> to
        <code class="literal">OFF</code>), the table-level checking described in
        this section still applies.
      </p><p>
        Users are <span class="emphasis"><em>strongly</em></span> urged not to use
        database files that contain Barracuda file format tables with
        releases of InnoDB older than the MySQL 5.1 with the InnoDB
        Plugin. It is possible to “<span class="quote">downgrade</span>” such tables
        to the Antelope format with the procedure described in
        <a href="storage-engines.html#innodb-file-format-downgrading" title="13.4.4.4. Downgrading the File Format">Section 13.4.4.4, “Downgrading the File Format”</a>.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-file-format-identifying"></a>13.4.4.3. Identifying the File Format in Use</h4></div></div></div><a class="indexterm" name="id1139945"></a><a class="indexterm" name="id1139958"></a><p>
      After you enable a given
      <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>, this
      change applies only to newly created tables rather than existing
      ones. If you do create a new table, the tablespace containing the
      table is tagged with the “<span class="quote">earliest</span>” or
      “<span class="quote">simplest</span>” file format that is required for the
      table's features. For example, if you enable file format
      Barracuda, and create a new table that is not compressed and does
      not use <code class="literal">ROW_FORMAT=DYNAMIC</code>, the new tablespace
      that contains the table is tagged as using file format Antelope.
    </p><p>
      It is easy to identify the file format used by a given tablespace
      or table. The table uses the Barracuda format if the
      <code class="literal">Row_format</code> reported by <code class="literal">SHOW CREATE
      TABLE</code> or <code class="literal">INFORMATION_SCHEMA.TABLES</code> is
      one of <code class="literal">'Compressed'</code> or
      <code class="literal">'Dynamic'</code>. (The <code class="literal">Row_format</code>
      is a separate column; ignore the contents of the
      <code class="literal">Create_options</code> column, which may contain the
      string <code class="literal">ROW_FORMAT</code>.) If the table in a
      tablespace uses neither of those features, the file uses the
      format supported by prior releases of InnoDB, now called file
      format Antelope. Then, the <code class="literal">Row_format</code> is one of
      <code class="literal">'Redundant'</code> or <code class="literal">'Compact'</code>.
    </p><h5><a name="id1140071"></a>
      Internal Details
    </h5><p>
      The file format identifier is written as part of the tablespace
      flags (a 32-bit number) in the <code class="literal">*.ibd</code> file in
      the 4 bytes starting at position 54 of the file, most significant
      byte first. (The first byte of the file is byte zero.) On some
      systems, you can display these bytes in hexadecimal with the
      command <code class="literal">od -t x1 -j 54 -N 4
      <em class="replaceable"><code>tablename</code></em>.ibd</code>. If all bytes
      are zero, the tablespace uses the Antelope file format (which is
      the format used by the standard InnoDB storage engine up to
      version 5.1). Otherwise, the least significant bit should be set
      in the tablespace flags, and the file format identifier is written
      in the bits 5 through 11. (Divide the tablespace flags by 32 and
      take the remainder after dividing the integer part of the result
      by 128.)
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-file-format-downgrading"></a>13.4.4.4. Downgrading the File Format</h4></div></div></div><a class="indexterm" name="id1140109"></a><p>
      Each InnoDB tablespace file (with a name matching
      <code class="literal">*.ibd</code>) is tagged with the file format used to
      create its table and indexes. The way to downgrade the tablespace
      is to re-create the table and its indexes. The easiest way to
      recreate a table and its indexes is to use the command:
    </p><pre class="programlisting">ALTER TABLE <em class="replaceable"><code>t</code></em> ROW_FORMAT=<em class="replaceable"><code>COMPACT</code></em>;
</pre><p>
      on each table that you want to downgrade. The
      <code class="literal">COMPACT</code> row format uses the file format
      Antelope. It was introduced in MySQL 5.0.3.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-file-format-future"></a>13.4.4.5. Future InnoDB File Formats</h4></div></div></div><p>
      The file format used by the standard built-in InnoDB in MySQL 5.1
      is the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_antelope" target="_top">Antelope</a> format. The
      file format introduced with InnoDB Plugin 1.0 is the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_barracuda" target="_top">Barracuda</a> format. Although
      no new features have been announced that would require additional
      new file formats, the InnoDB file format mechanism allows for
      future enhancements.
    </p><p>
      For the sake of completeness, these are the file format names that
      might be used for future file formats: Antelope, Barracuda,
      Cheetah, Dragon, Elk, Fox, Gazelle, Hornet, Impala, Jaguar,
      Kangaroo, Leopard, Moose, Nautilus, Ocelot, Porpoise, Quail,
      Rabbit, Shark, Tiger, Urchin, Viper, Whale, Xenops, Yak and Zebra.
      These file formats correspond to the internal identifiers 0..25.
    </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-row-format"></a>13.4.5. How InnoDB Stores Variable-Length Columns</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-row-format-overview">13.4.5.1. Overview of InnoDB Row Storage</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-row-format-specification">13.4.5.2. Specifying the Row Format for a Table</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-row-format-dynamic">13.4.5.3. Barracuda File Format: <code class="literal">DYNAMIC</code> and
      <code class="literal">COMPRESSED</code> Row Formats</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-row-format-antelope">13.4.5.4. Antelope File Format: <code class="literal">COMPACT</code> and
      <code class="literal">REDUNDANT</code> Row Formats</a></span></dt></dl></div><p>
    This section discusses how certain InnoDB features, such as table
    <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_compression" target="_top">compression</a> and off-page
    storage of long columns, are controlled by the
    <code class="literal">ROW_FORMAT</code> clause of the <code class="literal">CREATE
    TABLE</code> statement. It discusses considerations for choosing
    the right row format and compatibility of row formats between MySQL
    releases.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-row-format-overview"></a>13.4.5.1. Overview of InnoDB Row Storage</h4></div></div></div><p>
      The storage for rows and associated columns affects performance
      for queries and DML operations. As more rows fit into a single
      disk page, queries and index lookups can work faster, less cache
      memory is required in the InnoDB buffer pool, and less I/O is
      required to write out updated values for the numeric and short
      string columns.
    </p><p>
      All data in InnoDB is stored in database pages that make up a
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_b_tree" target="_top">B-tree index</a> (the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_clustered_index" target="_top">clustered index</a>
      organized according to the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_primary_key" target="_top">primary key</a> columns).
      Table data and indexes both use this type of structure. The nodes
      of the index data structure contain the values of all the columns
      in that row (for the clustered index) or the index columns and the
      primary key columns (for secondary indexes).
    </p><p>
      Variable-length columns are an exception to this rule. Columns
      such as <code class="literal">BLOB</code> and <code class="literal">VARCHAR</code>
      that are too long to fit on a B-tree page are stored on separately
      allocated disk pages called
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_overflow_page" target="_top">overflow pages</a>. We call
      such columns <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_off_page_column" target="_top">off-page
      column</a>. The values of these columns are stored on
      singly-linked lists of overflow pages, and each such column has
      its own list of one or more overflow pages. In some cases, all or
      a prefix of the long column value is stored in the B-tree, to
      avoid wasting storage and eliminating the need to read a separate
      page.
    </p><p>
      The <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_barracuda" target="_top">Barracuda</a> file format
      provides a new option (<code class="literal">KEY_BLOCK_SIZE</code>) to
      control how much column data is stored in the clustered index, and
      how much is placed on overflow pages.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-row-format-specification"></a>13.4.5.2. Specifying the Row Format for a Table</h4></div></div></div><a class="indexterm" name="id1140344"></a><a class="indexterm" name="id1140356"></a><p>
      You specify the row format for a table with the
      <code class="literal">ROW_FORMAT</code> clause of the
      <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-row-format-dynamic"></a>13.4.5.3. Barracuda File Format: <code class="literal">DYNAMIC</code> and
      <code class="literal">COMPRESSED</code> Row Formats</h4></div></div></div><a class="indexterm" name="id1140413"></a><a class="indexterm" name="id1140426"></a><p>
      When <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> is set to
      Barracuda and a table is created with
      <code class="literal">ROW_FORMAT=DYNAMIC</code> or
      <code class="literal">ROW_FORMAT=COMPRESSED</code>, long column values are
      stored fully off-page, and the clustered index record contains
      only a 20-byte pointer to the overflow page.
    </p><p>
      Whether any columns are stored off-page depends on the page size
      and the total size of the row. When the row is too long, InnoDB
      chooses the longest columns for off-page storage until the
      clustered index record fits on the B-tree page.
    </p><p>
      The <code class="literal">DYNAMIC</code> row format maintains the efficiency
      of storing the entire row in the index node if it fits (as do the
      <code class="literal">COMPACT</code> and <code class="literal">REDUNDANT</code>
      formats), but this new format avoids the problem of filling B-tree
      nodes with a large number of data bytes of long columns. The
      <code class="literal">DYNAMIC</code> format is based on the idea that if a
      portion of a long data value is stored off-page, it is usually
      most efficient to store all of the value off-page. With
      <code class="literal">DYNAMIC</code> format, shorter columns are likely to
      remain in the B-tree node, minimizing the number of overflow pages
      needed for any given row.
    </p><p>
      The <code class="literal">COMPRESSED</code> row format uses similar internal
      details for off-page storage as the <code class="literal">DYNAMIC</code> row
      format, with additional storage and performance considerations
      from the table and index data being compressed and using smaller
      page sizes. For full details about the
      <code class="literal">COMPRESSED</code> row format, see
      <a href="storage-engines.html#innodb-compression" title="13.4.3. InnoDB Data Compression">Section 13.4.3, “InnoDB Data Compression”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-row-format-antelope"></a>13.4.5.4. Antelope File Format: <code class="literal">COMPACT</code> and
      <code class="literal">REDUNDANT</code> Row Formats</h4></div></div></div><a class="indexterm" name="id1140555"></a><a class="indexterm" name="id1140567"></a><p>
      Early versions of InnoDB used an unnamed file format (now called
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_antelope" target="_top">Antelope</a>) for database files.
      With that format, tables were defined with
      <code class="literal">ROW_FORMAT=COMPACT</code> (or
      <code class="literal">ROW_FORMAT=REDUNDANT</code>) and InnoDB stored up to
      the first 768 bytes of variable-length columns (such as
      <code class="literal">BLOB</code> and <code class="literal">VARCHAR</code>) in the
      index record within the B-tree node, with the remainder stored on
      the overflow pages.
    </p><p>
      To preserve compatibility with those prior versions, tables
      created with the newest InnoDB use the prefix format, unless one
      of <code class="literal">ROW_FORMAT=DYNAMIC</code> or
      <code class="literal">ROW_FORMAT=COMPRESSED</code> is specified (or implied)
      on the <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement.
    </p><p>
      With the Antelope file format, if the value of a column is 768
      bytes or less, no overflow page is needed, and some savings in I/O
      may result, since the value is in the B-tree node. This works well
      for relatively short <code class="literal">BLOB</code>s, but may cause
      B-tree nodes to fill with data rather than key values, reducing
      their efficiency. Tables with many <code class="literal">BLOB</code> columns
      could cause B-tree nodes to become too full of data, and contain
      too few rows, making the entire index less efficient than if the
      rows were shorter or if the column values were stored off-page.
    </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-information-schema"></a>13.4.6. InnoDB <code class="literal">INFORMATION_SCHEMA</code> tables</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-information-schema-compression-tables">13.4.6.1. Information Schema Tables about Compression</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-information-schema-transactions">13.4.6.2. Information Schema Tables about Transactions</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-information-schema-notes">13.4.6.3. Special Locking Considerations for InnoDB
      <code class="literal">INFORMATION_SCHEMA</code> Tables</a></span></dt></dl></div><a class="indexterm" name="id1140695"></a><a class="indexterm" name="id1140704"></a><a class="indexterm" name="id1140717"></a><p>
    The
    <a href="information-schema.html" title="Chapter 19. INFORMATION_SCHEMA Tables"><code class="literal">INFORMATION_SCHEMA</code></a>
    is a MySQL feature that helps you monitor server activity to
    diagnose capacity and performance issues. Several InnoDB-related
    <code class="literal">INFORMATION_SCHEMA</code> tables
    (<a href="storage-engines.html#innodb-information-schema-innodb_cmp" title="13.4.6.1.1. INNODB_CMP and INNODB_CMP_RESET"><code class="literal">INNODB_CMP</code></a>,
    <a href="storage-engines.html#innodb-information-schema-innodb_cmp" title="13.4.6.1.1. INNODB_CMP and INNODB_CMP_RESET"><code class="literal">INNODB_CMP_RESET</code></a>,
    <a href="storage-engines.html#innodb-information-schema-innodb_cmpmem" title="13.4.6.1.2. INNODB_CMPMEM and
        INNODB_CMPMEM_RESET"><code class="literal">INNODB_CMPMEM</code></a>,
    <a href="storage-engines.html#innodb-information-schema-innodb_cmpmem" title="13.4.6.1.2. INNODB_CMPMEM and
        INNODB_CMPMEM_RESET"><code class="literal">INNODB_CMPMEM_RESET</code></a>,
    <a href="storage-engines.html#innodb-information-schema-innodb_trx" title="13.4.6.2.1. INNODB_TRX"><code class="literal">INNODB_TRX</code></a>,
    <a href="storage-engines.html#innodb-information-schema-innodb_locks" title="13.4.6.2.2. INNODB_LOCKS"><code class="literal">INNODB_LOCKS</code></a>
    and
    <a href="storage-engines.html#innodb-information-schema-innodb_lock_waits" title="13.4.6.2.3. INNODB_LOCK_WAITS"><code class="literal">INNODB_LOCK_WAITS</code></a>)
    contain live information about compressed InnoDB tables, the
    compressed InnoDB buffer pool, all transactions currently executing
    inside InnoDB, the locks that transactions hold and those that are
    blocking transactions waiting for access to a resource (a table or
    row).
  </p><p>
    The Information Schema tables are themselves plugins to the MySQL
    server, and must be activated by <code class="literal">INSTALL</code>
    statements. If they are installed, but the InnoDB storage engine
    plugin is not installed, these tables appear to be empty.
  </p><p>
    This section describes the InnoDB-related Information Schema tables
    and shows some examples of their use.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-information-schema-compression-tables"></a>13.4.6.1. Information Schema Tables about Compression</h4></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-information-schema-innodb_cmp">13.4.6.1.1. <code class="literal">INNODB_CMP</code> and <code class="literal">INNODB_CMP_RESET</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-information-schema-innodb_cmpmem">13.4.6.1.2. <code class="literal">INNODB_CMPMEM</code> and
        <code class="literal">INNODB_CMPMEM_RESET</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-information-schema-examples-compression-sect">13.4.6.1.3. Using the Compression Information Schema Tables</a></span></dt></dl></div><a class="indexterm" name="id1140842"></a><p>
      Two new pairs of Information Schema tables provided by the
      InnoDB storage engine can give you some insight into how well
      compression is working overall. One pair of tables contains
      information about the number of compression operations and the
      amount of time spent performing compression. Another pair of
      tables contains information on the way memory is allocated for
      compression.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-information-schema-innodb_cmp"></a>13.4.6.1.1. <code class="literal">INNODB_CMP</code> and <code class="literal">INNODB_CMP_RESET</code></h5></div></div></div><a class="indexterm" name="id1140878"></a><a class="indexterm" name="id1140891"></a><p>
        The tables
        <a href="storage-engines.html#innodb-information-schema-innodb_cmp" title="13.4.6.1.1. INNODB_CMP and INNODB_CMP_RESET"><code class="literal">INNODB_CMP</code></a>
        and
        <a href="storage-engines.html#innodb-information-schema-innodb_cmp" title="13.4.6.1.1. INNODB_CMP and INNODB_CMP_RESET"><code class="literal">INNODB_CMP_RESET</code></a>
        contain status information on the operations related to
        compressed tables, which are covered in
        <a href="storage-engines.html#innodb-compression" title="13.4.3. InnoDB Data Compression">Section 13.4.3, “InnoDB Data Compression”</a>. The compressed page size
        is in the column <code class="literal">PAGE_SIZE</code>.
      </p><p>
        These two tables have identical contents, but reading from
        <a href="storage-engines.html#innodb-information-schema-innodb_cmp" title="13.4.6.1.1. INNODB_CMP and INNODB_CMP_RESET"><code class="literal">INNODB_CMP_RESET</code></a>
        resets the statistics on compression and uncompression
        operations. For example, if you archive the output of
        <a href="storage-engines.html#innodb-information-schema-innodb_cmp" title="13.4.6.1.1. INNODB_CMP and INNODB_CMP_RESET"><code class="literal">INNODB_CMP_RESET</code></a>
        every 60 minutes, you see the statistics for each hourly period.
        If you monitor the output of
        <a href="storage-engines.html#innodb-information-schema-innodb_cmp" title="13.4.6.1.1. INNODB_CMP and INNODB_CMP_RESET"><code class="literal">INNODB_CMP</code></a>
        (making sure never to read <code class="literal">INNODB_CMP_RESET</code>),
        you see the cumulated statistics since InnoDB was started.
      </p><p>
        For the table definition, see
        <a href="information-schema.html#innodb-information-schema-innodb_cmp_columns_table" title="Table 19.1. Columns of INNODB_CMP and
    INNODB_CMP_RESET">Table 19.1, “Columns of <code class="literal">INNODB_CMP</code> and
    <code class="literal">INNODB_CMP_RESET</code>”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-information-schema-innodb_cmpmem"></a>13.4.6.1.2. <code class="literal">INNODB_CMPMEM</code> and
        <code class="literal">INNODB_CMPMEM_RESET</code></h5></div></div></div><a class="indexterm" name="id1141006"></a><a class="indexterm" name="id1141018"></a><p>
        The tables
        <a href="storage-engines.html#innodb-information-schema-innodb_cmpmem" title="13.4.6.1.2. INNODB_CMPMEM and
        INNODB_CMPMEM_RESET"><code class="literal">INNODB_CMPMEM</code></a>
        and
        <a href="storage-engines.html#innodb-information-schema-innodb_cmpmem" title="13.4.6.1.2. INNODB_CMPMEM and
        INNODB_CMPMEM_RESET"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        contain status information on the compressed pages that reside
        in the buffer pool. Please consult
        <a href="storage-engines.html#innodb-compression" title="13.4.3. InnoDB Data Compression">Section 13.4.3, “InnoDB Data Compression”</a> for further information on
        compressed tables and the use of the buffer pool. The tables
        <a href="storage-engines.html#innodb-information-schema-innodb_cmp" title="13.4.6.1.1. INNODB_CMP and INNODB_CMP_RESET"><code class="literal">INNODB_CMP</code></a>
        and
        <a href="storage-engines.html#innodb-information-schema-innodb_cmp" title="13.4.6.1.1. INNODB_CMP and INNODB_CMP_RESET"><code class="literal">INNODB_CMP_RESET</code></a>
        should provide more useful statistics on compression.
      </p><h6><a name="id1141079"></a>
        Internal Details
      </h6><p>
        The InnoDB storage engine uses a so-called “<span class="quote">buddy
        allocator</span>” system to manage memory allocated to pages of
        various sizes, from 1KB to 16KB. Each row of the two tables
        described here corresponds to a single page size.
      </p><p>
        These two tables have identical contents, but reading from
        <a href="storage-engines.html#innodb-information-schema-innodb_cmpmem" title="13.4.6.1.2. INNODB_CMPMEM and
        INNODB_CMPMEM_RESET"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        resets the statistics on relocation operations. For example, if
        every 60 minutes you archived the output of
        <a href="storage-engines.html#innodb-information-schema-innodb_cmpmem" title="13.4.6.1.2. INNODB_CMPMEM and
        INNODB_CMPMEM_RESET"><code class="literal">INNODB_CMPMEM_RESET</code></a>,
        it would show the hourly statistics. If you never read
        <a href="storage-engines.html#innodb-information-schema-innodb_cmpmem" title="13.4.6.1.2. INNODB_CMPMEM and
        INNODB_CMPMEM_RESET"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        and monitored the output of
        <a href="storage-engines.html#innodb-information-schema-innodb_cmpmem" title="13.4.6.1.2. INNODB_CMPMEM and
        INNODB_CMPMEM_RESET"><code class="literal">INNODB_CMPMEM</code></a>
        instead, it would show the cumulated statistics since InnoDB was
        started.
      </p><p>
        For the table definition, see
        <a href="information-schema.html#innodb-information-schema-innodb_cmpmem_columns_table" title="Table 19.2. Columns of INNODB_CMPMEM and INNODB_CMPMEM_RESET">Table 19.2, “Columns of INNODB_CMPMEM and INNODB_CMPMEM_RESET”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-information-schema-examples-compression-sect"></a>13.4.6.1.3. Using the Compression Information Schema Tables</h5></div></div></div><div class="example"><a name="innodb-information-schema-examples-compression"></a><p class="title"><b>Example 13.1. Using the Compression Information Schema Tables</b></p><p>
          The following is sample output from a database that contains
          compressed tables (see <a href="storage-engines.html#innodb-compression" title="13.4.3. InnoDB Data Compression">Section 13.4.3, “InnoDB Data Compression”</a>,
          <a href="storage-engines.html#innodb-information-schema-innodb_cmp" title="13.4.6.1.1. INNODB_CMP and INNODB_CMP_RESET"><code class="literal">INNODB_CMP</code></a>,
          and
          <a href="storage-engines.html#innodb-information-schema-innodb_cmpmem" title="13.4.6.1.2. INNODB_CMPMEM and
        INNODB_CMPMEM_RESET"><code class="literal">INNODB_CMPMEM</code></a>).
        </p><p>
          The following table shows the contents of
          <code class="literal">INFORMATION_SCHEMA.INNODB_CMP</code> under light
          load. The only compressed page size that the buffer pool
          contains is 8K. Compressing or uncompressing pages has
          consumed less than a second since the time the statistics were
          reset, because the columns <code class="literal">COMPRESS_TIME</code>
          and <code class="literal">UNCOMPRESS_TIME</code> are zero.
        </p><div class="informaltable"><a name="innodb-information-schema-sample-innodb_cmp"></a><table border="1"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th>page size</th><th>compress ops</th><th>compress ops ok</th><th>compress time</th><th>uncompress ops</th><th>uncompress time</th></tr></thead><tbody><tr><td>1024</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>2048</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>4096</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>8192</td><td>1048</td><td>921</td><td>0</td><td>61</td><td>0</td></tr><tr><td>16384</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr></tbody></table></div><p>
          According to
          <a href="storage-engines.html#innodb-information-schema-innodb_cmpmem" title="13.4.6.1.2. INNODB_CMPMEM and
        INNODB_CMPMEM_RESET"><code class="literal">INNODB_CMPMEM</code></a>,
          there are 6169 compressed 8KB pages in the buffer pool.
        </p><p>
          The following table shows the contents of
          <code class="literal">INFORMATION_SCHEMA.INNODB_CMPMEM</code> under
          light load. We can see that some memory is unusable due to
          fragmentation of the InnoDB memory allocator for compressed
          pages: <code class="literal">SUM(PAGE_SIZE*PAGES_FREE)=6784</code>. This
          is because small memory allocation requests are fulfilled by
          splitting bigger blocks, starting from the 16K blocks that are
          allocated from the main buffer pool, using the buddy
          allocation system. The fragmentation is this low, because some
          allocated blocks have been relocated (copied) to form bigger
          adjacent free blocks. This copying of
          <code class="literal">SUM(PAGE_SIZE*RELOCATION_OPS)</code> bytes has
          consumed less than a second
          <code class="literal">(SUM(RELOCATION_TIME)=0)</code>.
        </p><div class="informaltable"><a name="innodb-information-schema-sample-innodb_cmpmem"></a><table border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th>page size</th><th>pages used</th><th>pages free</th><th>relocation ops</th><th>relocation time</th></tr></thead><tbody><tr><td>1024</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>2048</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>4096</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td>8192</td><td>6169</td><td>0</td><td>5</td><td>0</td></tr><tr><td>16384</td><td>0</td><td>0</td><td>0</td><td>0</td></tr></tbody></table></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-information-schema-transactions"></a>13.4.6.2. Information Schema Tables about Transactions</h4></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-information-schema-innodb_trx">13.4.6.2.1. <code class="literal">INNODB_TRX</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-information-schema-innodb_locks">13.4.6.2.2. <code class="literal">INNODB_LOCKS</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-information-schema-innodb_lock_waits">13.4.6.2.3. <code class="literal">INNODB_LOCK_WAITS</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-information-schema-examples">13.4.6.2.4. Using the Transaction Information Schema Tables</a></span></dt></dl></div><a class="indexterm" name="id1141632"></a><p>
      Three InnoDB-related Information Schema tables make it easy to
      monitor transactions and diagnose possible locking problems. The
      three tables are
      <a href="storage-engines.html#innodb-information-schema-innodb_trx" title="13.4.6.2.1. INNODB_TRX"><code class="literal">INNODB_TRX</code></a>,
      <a href="storage-engines.html#innodb-information-schema-innodb_locks" title="13.4.6.2.2. INNODB_LOCKS"><code class="literal">INNODB_LOCKS</code></a>
      and
      <a href="storage-engines.html#innodb-information-schema-innodb_lock_waits" title="13.4.6.2.3. INNODB_LOCK_WAITS"><code class="literal">INNODB_LOCK_WAITS</code></a>.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-information-schema-innodb_trx"></a>13.4.6.2.1. <code class="literal">INNODB_TRX</code></h5></div></div></div><a class="indexterm" name="id1141689"></a><p>
        Contains information about every transaction currently executing
        inside InnoDB, including whether the transaction is waiting for
        a lock, when the transaction started, and the particular SQL
        statement the transaction is executing.
      </p><p>
        For the table definition, see
        <a href="information-schema.html#innodb-information-schema-innodb_trx_columns_table" title="Table 19.3. INNODB_TRX Columns">Table 19.3, “<code class="literal">INNODB_TRX</code> Columns”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-information-schema-innodb_locks"></a>13.4.6.2.2. <code class="literal">INNODB_LOCKS</code></h5></div></div></div><a class="indexterm" name="id1141728"></a><p>
        Each transaction in InnoDB that is waiting for another
        transaction to release a lock
        (<code class="literal">INNODB_TRX.TRX_STATE='LOCK WAIT'</code>) is blocked
        by exactly one “<span class="quote">blocking lock request</span>”. That
        blocking lock request is for a row or table lock held by another
        transaction in an incompatible mode. The waiting or blocked
        transaction cannot proceed until the other transaction commits
        or rolls back, thereby releasing the requested lock. For every
        blocked transaction,
        <a href="storage-engines.html#innodb-information-schema-innodb_locks" title="13.4.6.2.2. INNODB_LOCKS"><code class="literal">INNODB_LOCKS</code></a>
        contains one row that describes each lock the transaction has
        requested, and for which it is waiting.
        <a href="storage-engines.html#innodb-information-schema-innodb_locks" title="13.4.6.2.2. INNODB_LOCKS"><code class="literal">INNODB_LOCKS</code></a>
        also contains one row for each lock that is blocking another
        transaction, whatever the state of the transaction that holds
        the lock (<code class="literal">'RUNNING'</code>, <code class="literal">'LOCK
        WAIT'</code>, <code class="literal">'ROLLING BACK'</code> or
        <code class="literal">'COMMITTING'</code>). The lock that is blocking a
        transaction is always held in a mode (read vs. write, shared vs.
        exclusive) incompatible with the mode of requested lock.
      </p><p>
        For the table definition, see
        <a href="information-schema.html#innodb-information-schema-innodb_locks_columns_table" title="Table 19.4. INNODB_LOCKS Columns">Table 19.4, “<code class="literal">INNODB_LOCKS</code> Columns”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-information-schema-innodb_lock_waits"></a>13.4.6.2.3. <code class="literal">INNODB_LOCK_WAITS</code></h5></div></div></div><a class="indexterm" name="id1141825"></a><p>
        Using this table, you can tell which transactions are waiting
        for a given lock, or for which lock a given transaction is
        waiting. This table contains one or more rows for each
        <span class="emphasis"><em>blocked</em></span> transaction, indicating the lock it
        has requested and the lock(s) that is (are) blocking that
        request. The <code class="literal">REQUESTED_LOCK_ID</code> refers to the
        lock that a transaction is requesting, and the
        <code class="literal">BLOCKING_LOCK_ID</code> refers to the lock (held by
        another transaction) that is preventing the first transaction
        from proceeding. For any given blocked transaction, all rows in
        <a href="storage-engines.html#innodb-information-schema-innodb_lock_waits" title="13.4.6.2.3. INNODB_LOCK_WAITS"><code class="literal">INNODB_LOCK_WAITS</code></a>
        have the same value for <code class="literal">REQUESTED_LOCK_ID</code> and
        different values for <code class="literal">BLOCKING_LOCK_ID</code>.
      </p><p>
        For the table definition, see
        <a href="information-schema.html#innodb-information-schema-innodb_lock_waits_columns_table" title="Table 19.5. INNODB_LOCK_WAITS Columns">Table 19.5, “<code class="literal">INNODB_LOCK_WAITS</code> Columns”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-information-schema-examples"></a>13.4.6.2.4. Using the Transaction Information Schema Tables</h5></div></div></div><div class="example"><a name="innodb-information-schema-examples-simple-blocking"></a><p class="title"><b>Example 13.2. Identifying Blocking Transactions</b></p><p>
          It is sometimes helpful to be able to identify which
          transaction is blocking another. You can use the Information
          Schema tables to find out which transaction is waiting for
          another, and which resource is being requested.
        </p><p>
          Suppose you have the following scenario, with three users
          running concurrently. Each user (or session) corresponds to a
          MySQL thread, and executes one transaction after another.
          Consider the state of the system when these users have issued
          the following commands, but none has yet committed its
          transaction:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <code class="literal"> User A: </code>
            </p><pre class="programlisting">BEGIN;
SELECT a FROM t FOR UPDATE;
SELECT SLEEP(100);</pre></li><li><p>
              <code class="literal"> User B: </code>
            </p><pre class="programlisting">SELECT b FROM t FOR UPDATE;</pre></li><li><p>
              <code class="literal"> User C: </code>
            </p><pre class="programlisting">SELECT c FROM t FOR UPDATE;</pre></li></ul></div><p>
          In this scenario, you may use this query to see who is waiting
          for whom:
        </p><pre class="programlisting">SELECT r.trx_id waiting_trx_id,  
       r.trx_mysql_thread_id waiting_thread,
       r.trx_query waiting_query,
       b.trx_id blocking_trx_id, 
       b.trx_mysql_thread_id blocking_thread,
       b.trx_query blocking_query
   FROM       information_schema.innodb_lock_waits w
   INNER JOIN information_schema.innodb_trx b  ON  
    b.trx_id = w.blocking_trx_id
  INNER JOIN information_schema.innodb_trx r  ON  
    r.trx_id = w.requesting_trx_id;</pre><div class="informaltable"><table border="1"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th>waiting trx id</th><th>waiting thread</th><th>waiting query</th><th>blocking trx id</th><th>blocking thread</th><th>blocking query</th></tr></thead><tbody><tr><td><code class="literal">A4</code></td><td><code class="literal">6</code></td><td><code class="literal">SELECT b FROM t FOR UPDATE</code></td><td><code class="literal">A3</code></td><td><code class="literal">5</code></td><td><code class="literal">SELECT SLEEP(100)</code></td></tr><tr><td><code class="literal">A5</code></td><td><code class="literal">7</code></td><td><code class="literal">SELECT c FROM t FOR UPDATE</code></td><td><code class="literal">A3</code></td><td><code class="literal">5</code></td><td><code class="literal">SELECT SLEEP(100)</code></td></tr><tr><td><code class="literal">A5</code></td><td><code class="literal">7</code></td><td><code class="literal">SELECT c FROM t FOR UPDATE</code></td><td><code class="literal">A4</code></td><td><code class="literal">6</code></td><td><code class="literal">SELECT b FROM t FOR UPDATE</code></td></tr></tbody></table></div><p>
          In the above result, you can identify users by the
          “<span class="quote">waiting query</span>” or “<span class="quote">blocking query</span>”.
          As you can see:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              User B (trx id <code class="literal">'A4'</code>, thread
              <code class="literal">6</code>) and User C (trx id
              <code class="literal">'A5'</code>, thread <code class="literal">7</code>) are
              both waiting for User A (trx id <code class="literal">'A3'</code>,
              thread <code class="literal">5</code>).
            </p></li><li><p>
              User C is waiting for User B as well as User A.
            </p></li></ul></div><p>
          You can see the underlying data in the tables
          <a href="storage-engines.html#innodb-information-schema-examples-simple-blocking-trx"><code class="literal">INNODB_TRX</code></a>,
          <a href="storage-engines.html#innodb-information-schema-examples-simple-blocking-locks"><code class="literal">INNODB_LOCKS</code></a>,
          and
          <a href="storage-engines.html#innodb-information-schema-examples-simple-blocking-waits"><code class="literal">INNODB_LOCK_WAITS</code></a>.
        </p><p>
          The following table shows some sample Contents of
          INFORMATION_SCHEMA.INNODB_TRX.
        </p><div class="informaltable"><a name="innodb-information-schema-examples-simple-blocking-trx"></a><table border="1"><colgroup><col><col><col><col><col><col><col><col></colgroup><thead><tr><th>trx id</th><th>trx state</th><th>trx started</th><th>trx requested lock id</th><th>trx wait started</th><th>trx weight</th><th>trx mysql thread id</th><th>trx query</th></tr></thead><tbody><tr><td><code class="literal">A3</code></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 16:44:54</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">2</code></td><td><code class="literal">5</code></td><td><code class="literal">SELECT SLEEP(100)</code></td></tr><tr><td><code class="literal">A4</code></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 16:45:09</code></td><td><code class="literal">A4:1:3:2</code></td><td><code class="literal">2008-01-15 16:45:09</code></td><td><code class="literal">2</code></td><td><code class="literal">6</code></td><td><code class="literal">SELECT b FROM t FOR UPDATE</code></td></tr><tr><td><code class="literal">A5</code></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 16:45:14</code></td><td><code class="literal">A5:1:3:2</code></td><td><code class="literal">2008-01-15 16:45:14</code></td><td><code class="literal">2</code></td><td><code class="literal">7</code></td><td><code class="literal">SELECT c FROM t FOR UPDATE</code></td></tr></tbody></table></div><p>
          The following table shows some sample contents of
          <code class="literal">INFORMATION_SCHEMA.INNODB_LOCKS</code>.
        </p><div class="informaltable"><a name="innodb-information-schema-examples-simple-blocking-locks"></a><table border="1"><colgroup><col><col><col><col><col><col><col><col><col><col></colgroup><thead><tr><th>lock id</th><th>lock trx id</th><th>lock mode</th><th>lock type</th><th>lock table</th><th>lock index</th><th>lock space</th><th>lock page</th><th>lock rec</th><th>lock data</th></tr></thead><tbody><tr><td><code class="literal">A3:1:3:2</code></td><td><code class="literal">A3</code></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`.`t`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">1</code></td><td><code class="literal">3</code></td><td><code class="literal">2</code></td><td><code class="literal">0x0200</code></td></tr><tr><td><code class="literal">A4:1:3:2</code></td><td><code class="literal">A4</code></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`.`t`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">1</code></td><td><code class="literal">3</code></td><td><code class="literal">2</code></td><td><code class="literal">0x0200</code></td></tr><tr><td><code class="literal">A5:1:3:2</code></td><td><code class="literal">A5</code></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`.`t`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">1</code></td><td><code class="literal">3</code></td><td><code class="literal">2</code></td><td><code class="literal">0x0200</code></td></tr></tbody></table></div><p>
          The following table shows some sample contents of
          <code class="literal">INFORMATION_SCHEMA.INNODB_LOCK_WAITS</code>.
        </p><div class="informaltable"><a name="innodb-information-schema-examples-simple-blocking-waits"></a><table border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>requesting trx id</th><th>requested lock id</th><th>blocking trx id</th><th>blocking lock id</th></tr></thead><tbody><tr><td><code class="literal">A4</code></td><td><code class="literal">A4:1:3:2</code></td><td><code class="literal">A3</code></td><td><code class="literal">A3:1:3:2</code></td></tr><tr><td><code class="literal">A5</code></td><td><code class="literal">A5:1:3:2</code></td><td><code class="literal">A3</code></td><td><code class="literal">A3:1:3:2</code></td></tr><tr><td><code class="literal">A5</code></td><td><code class="literal">A5:1:3:2</code></td><td><code class="literal">A4</code></td><td><code class="literal">A4:1:3:2</code></td></tr></tbody></table></div></div><div class="example"><a name="innodb-information-schema-sample-locks"></a><p class="title"><b>Example 13.3. More Complex Example of Transaction Data in Information Schema Tables</b></p><p>
          Sometimes you would like to correlate the internal InnoDB
          locking information with session-level information maintained
          by MySQL. For example, you might like to know, for a given
          InnoDB transaction ID, the corresponding MySQL session ID and
          name of the user that may be holding a lock, and thus blocking
          another transaction.
        </p><p>
          The following output from the
          <code class="literal">INFORMATION_SCHEMA</code> tables is taken from a
          somewhat loaded system.
        </p><p>
          As can be seen in the following tables, there are several
          transactions running.
        </p><p>
          The following <code class="literal">INNODB_LOCKS</code> and
          <code class="literal">INNODB_LOCK_WAITS</code> tables shows that:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              Transaction
              <span class="color0"><code class="literal">77F</code></span>
              (executing an <code class="literal">INSERT</code>) is waiting for
              transactions
              <span class="color1"><code class="literal">77E</code></span>,
              <span class="color2"><code class="literal">77D</code></span>
              and
              <span class="color3"><code class="literal">77B</code></span>
              to commit.
            </p></li><li><p>
              Transaction
              <span class="color1"><code class="literal">77E</code></span>
              (executing an INSERT) is waiting for transactions
              <span class="color2"><code class="literal">77D</code></span>
              and
              <span class="color3"><code class="literal">77B</code></span>
              to commit.
            </p></li><li><p>
              Transaction
              <span class="color2"><code class="literal">77D</code></span>
              (executing an INSERT) is waiting for transaction
              <span class="color3"><code class="literal">77B</code></span>
              to commit.
            </p></li><li><p>
              Transaction
              <span class="color3"><code class="literal">77B</code></span>
              (executing an INSERT) is waiting for transaction
              <span class="color4"><code class="literal">77A</code></span>
              to commit.
            </p></li><li><p>
              Transaction
              <span class="color4"><code class="literal">77A</code></span>
              is running, currently executing <code class="literal">SELECT</code>.
            </p></li><li><p>
              Transaction
              <span class="color5"><code class="literal">E56</code></span>
              (executing an <code class="literal">INSERT</code>) is waiting for
              transaction
              <span class="color6"><code class="literal">E55</code></span>
              to commit.
            </p></li><li><p>
              Transaction
              <span class="color6"><code class="literal">E55</code></span>
              (executing an <code class="literal">INSERT</code>) is waiting for
              transaction
              <span class="color7"><code class="literal">19C</code></span>
              to commit.
            </p></li><li><p>
              Transaction
              <span class="color7"><code class="literal">19C</code></span>
              is running, currently executing an
              <code class="literal">INSERT</code>.
            </p></li></ul></div><p>
          Note that there may be an inconsistency between queries shown
          in the two tables <code class="literal">INNODB_TRX.TRX_QUERY</code> and
          <code class="literal">PROCESSLIST.INFO</code>. The current transaction
          ID for a thread, and the query being executed in that
          transaction, may be different in these two tables for any
          given thread. See
          <a href="storage-engines.html#innodb-information-schema-note_inconsistency" title="13.4.6.3.3. Possible Inconsistency with PROCESSLIST">Section 13.4.6.3.3, “Possible Inconsistency with <code class="literal">PROCESSLIST</code>”</a>
          for an explanation.
        </p><p>
          The following table shows the contents of
          <code class="literal">INFORMATION_SCHEMA.PROCESSLIST</code> in a loaded
          system.
        </p><div class="informaltable"><a name="innodb-information-schema-sample-processlist"></a><table border="1"><colgroup><col><col><col><col><col><col><col><col></colgroup><thead><tr><th>ID</th><th>USER</th><th>HOST</th><th>DB</th><th>COMMAND</th><th>TIME</th><th>STATE</th><th>INFO</th></tr></thead><tbody><tr><td><code class="literal">384</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">10</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td><code class="literal">257</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">3</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td><code class="literal">130</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">0</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td><code class="literal">61</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">1</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td><code class="literal">8</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">1</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td><code class="literal">4</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">0</code></td><td><code class="literal">preparing</code></td><td><code class="literal">SELECT * FROM processlist</code></td></tr><tr><td><code class="literal">2</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Sleep</code></td><td><code class="literal">566</code></td><td><code class="literal"></code></td><td><code class="literal">NULL</code></td></tr></tbody></table></div><p>
          The following table shows the contents of
          <code class="literal">INFORMATION_SCHEMA.INNODB_TRX</code> in a loaded
          system.
        </p><div class="informaltable"><a name="innodb-information-schema-sample-innodb_trx"></a><table border="1"><colgroup><col><col><col><col><col><col><col><col></colgroup><thead><tr><th>trx id</th><th>trx state</th><th>trx started</th><th>trx requested lock id</th><th>trx wait started</th><th>trx weight</th><th>trx mysql thread id</th><th>trx query</th></tr></thead><tbody><tr><td><span class="color0"><code class="literal">77F</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">1</code></td><td><code class="literal">876</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td><span class="color1"><code class="literal">77E</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color1"><code class="literal">77E</code></span>:806</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">1</code></td><td><code class="literal">875</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td><span class="color2"><code class="literal">77D</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color2"><code class="literal">77D</code></span>:806</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">1</code></td><td><code class="literal">874</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td><span class="color3"><code class="literal">77B</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color3"><code class="literal">77B</code></span>:733​:12:1</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">4</code></td><td><code class="literal">873</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td><span class="color4"><code class="literal">77A</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">4</code></td><td><code class="literal">872</code></td><td><code class="literal">select b, c from t09 where …</code></td></tr><tr><td><span class="color5"><code class="literal">E56</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:06</code></td><td><span class="color5"><code class="literal">E56</code></span>:743​:6:2</td><td><code class="literal">2008-01-15 13:10:06</code></td><td><code class="literal">5</code></td><td><code class="literal">384</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td><span class="color6"><code class="literal">E55</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:06</code></td><td><span class="color6"><code class="literal">E55</code></span>:743​:38:2</td><td><code class="literal">2008-01-15 13:10:13</code></td><td><code class="literal">965</code></td><td><code class="literal">257</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td><span class="color7"><code class="literal">19C</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:09:10</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">2900</code></td><td><code class="literal">130</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td><span class="color8"><code class="literal">E15</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:08:59</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">5395</code></td><td><code class="literal">61</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td><span class="color9"><code class="literal">51D</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:08:47</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">9807</code></td><td><code class="literal">8</code></td><td><code class="literal">insert into t2 values …</code></td></tr></tbody></table></div><p>
          The following table shows the contents of
          <code class="literal">INFORMATION_SCHEMA.INNODB_LOCK_WAITS</code> in a
          loaded system
        </p><div class="informaltable"><a name="innodb-information-schema-sample-innodb_lock_waits"></a><table border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>requesting trx id</th><th>requested lock id</th><th>blocking trx id</th><th>blocking lock id</th></tr></thead><tbody><tr><td><span class="color0"><code class="literal">77F</code></span></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color1"><code class="literal">77E</code></span></td><td><span class="color1"><code class="literal">77E</code></span>:806</td></tr><tr><td><span class="color0"><code class="literal">77F</code></span></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color2"><code class="literal">77D</code></span></td><td><span class="color2"><code class="literal">77D</code></span>:806</td></tr><tr><td><span class="color0"><code class="literal">77F</code></span></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:806</td></tr><tr><td><span class="color1"><code class="literal">77E</code></span></td><td><span class="color1"><code class="literal">77E</code></span>:806</td><td><span class="color2"><code class="literal">77D</code></span></td><td><span class="color2"><code class="literal">77D</code></span>:806</td></tr><tr><td><span class="color1"><code class="literal">77E</code></span></td><td><span class="color1"><code class="literal">77E</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:806</td></tr><tr><td><span class="color2"><code class="literal">77D</code></span></td><td><span class="color2"><code class="literal">77D</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:806</td></tr><tr><td><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:733:12:1</td><td><span class="color4"><code class="literal">77A</code></span></td><td><span class="color4"><code class="literal">77A</code></span>:733:12:1</td></tr><tr><td><span class="color5"><code class="literal">E56</code></span></td><td><span class="color5"><code class="literal">E56</code></span>:743:6:2</td><td><span class="color6"><code class="literal">E55</code></span></td><td><span class="color6"><code class="literal">E55</code></span>:743:6:2</td></tr><tr><td><span class="color6"><code class="literal">E55</code></span></td><td><span class="color6"><code class="literal">E55</code></span>:743:38:2</td><td><span class="color7"><code class="literal">19C</code></span></td><td><span class="color7"><code class="literal">19C</code></span>:743:38:2</td></tr></tbody></table></div><p>
          The following table shows the contents of
          <code class="literal">INFORMATION_SCHEMA.INNODB_LOCKS</code> in a loaded
          system.
        </p><div class="informaltable"><a name="innodb-information-schema-sample-innodb_locks"></a><table border="1"><colgroup><col><col><col><col><col><col><col><col><col><col></colgroup><thead><tr><th>lock id</th><th>lock trx id</th><th>lock mode</th><th>lock type</th><th>lock table</th><th>lock index</th><th>lock space</th><th>lock page</th><th>lock rec</th><th>lock data</th></tr></thead><tbody><tr><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color0"><code class="literal">77F</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td><span class="color1"><code class="literal">77E</code></span>:806</td><td><span class="color1"><code class="literal">77E</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td><span class="color2"><code class="literal">77D</code></span>:806</td><td><span class="color2"><code class="literal">77D</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td><span class="color3"><code class="literal">77B</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td><span class="color3"><code class="literal">77B</code></span>:733​:12:1</td><td><span class="color3"><code class="literal">77B</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">733</code></td><td><code class="literal">12</code></td><td><code class="literal">1</code></td><td><code class="literal">supremum pseudo-record</code></td></tr><tr><td><span class="color4"><code class="literal">77A</code></span>:733​:12:1</td><td><span class="color4"><code class="literal">77A</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">733</code></td><td><code class="literal">12</code></td><td><code class="literal">1</code></td><td><code class="literal">supremum pseudo-record</code></td></tr><tr><td><span class="color5"><code class="literal">E56</code></span>:743​:6:2</td><td><span class="color5"><code class="literal">E56</code></span></td><td><code class="literal">S</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">6</code></td><td><code class="literal">2</code></td><td><code class="literal">0, 0</code></td></tr><tr><td><span class="color6"><code class="literal">E55</code></span>:743​:6:2</td><td><span class="color6"><code class="literal">E55</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">6</code></td><td><code class="literal">2</code></td><td><code class="literal">0, 0</code></td></tr><tr><td><span class="color6"><code class="literal">E55</code></span>:743​:38:2</td><td><span class="color6"><code class="literal">E55</code></span></td><td><code class="literal">S</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">38</code></td><td><code class="literal">2</code></td><td><code class="literal">1922, 1922</code></td></tr><tr><td><span class="color7"><code class="literal">19C</code></span>:743​:38:2</td><td><span class="color7"><code class="literal">19C</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">38</code></td><td><code class="literal">2</code></td><td><code class="literal">1922, 1922</code></td></tr></tbody></table></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-information-schema-notes"></a>13.4.6.3. Special Locking Considerations for InnoDB
      <code class="literal">INFORMATION_SCHEMA</code> Tables</h4></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-information-schema-understanding_innodb_locking">13.4.6.3.1. Understanding InnoDB Locking</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-information-schema-rapidly_changing_internal_data">13.4.6.3.2. Granularity of <code class="literal">INFORMATION_SCHEMA</code> Data</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-information-schema-note_inconsistency">13.4.6.3.3. Possible Inconsistency with <code class="literal">PROCESSLIST</code></a></span></dt></dl></div><a class="indexterm" name="id1146033"></a><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-information-schema-understanding_innodb_locking"></a>13.4.6.3.1. Understanding InnoDB Locking</h5></div></div></div><p>
        When a transaction updates a row in a table, or locks it with
        <code class="literal">SELECT FOR UPDATE</code>, InnoDB establishes a list
        or queue of locks on that row. Similarly, InnoDB maintains a
        list of locks on a table for table-level locks transactions
        hold. If a second transaction wants to update a row or lock a
        table already locked by a prior transaction in an incompatible
        mode, InnoDB adds a lock request for the row to the
        corresponding queue. For a lock to be acquired by a transaction,
        all incompatible lock requests previously entered into the lock
        queue for that row or table must be removed (the transactions
        holding or requesting those locks either commit or roll back).
      </p><p>
        A transaction may have any number of lock requests for different
        rows or tables. At any given time, a transaction may be
        requesting a lock that is held by another transaction, in which
        case it is blocked by that other transaction. The requesting
        transaction must wait for the transaction that holds the
        blocking lock to commit or rollback. If a transaction is not
        waiting for a a lock, it is in the <code class="literal">'RUNNING'</code>
        state. If a transaction is waiting for a lock, it is in the
        <code class="literal">'LOCK WAIT'</code> state.
      </p><p>
        The table
        <a href="storage-engines.html#innodb-information-schema-innodb_locks" title="13.4.6.2.2. INNODB_LOCKS"><code class="literal">INNODB_LOCKS</code></a>
        holds one or more row for each <code class="literal">'LOCK WAIT'</code>
        transaction, indicating the lock request(s) that is (are)
        preventing its progress. This table also contains one row
        describing each lock in a queue of locks pending for a given row
        or table. The table
        <a href="storage-engines.html#innodb-information-schema-innodb_lock_waits" title="13.4.6.2.3. INNODB_LOCK_WAITS"><code class="literal">INNODB_LOCK_WAITS</code></a>
        shows which locks already held by a transaction are blocking
        locks requested by other transactions.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-information-schema-rapidly_changing_internal_data"></a>13.4.6.3.2. Granularity of <code class="literal">INFORMATION_SCHEMA</code> Data</h5></div></div></div><p>
        The data exposed by the transaction and locking tables represent
        a glimpse into fast-changing data. This is not like other (user)
        tables, where the data only changes when application-initiated
        updates occur. The underlying data is internal system-managed
        data, and can change very quickly.
      </p><p>
        For performance reasons, and to minimize the chance of
        misleading <code class="literal">JOIN</code>s between the
        <code class="literal">INFORMATION_SCHEMA</code> tables, InnoDB collects
        the required transaction and locking information into an
        intermediate buffer whenever a <code class="literal">SELECT</code> on any
        of the tables is issued. This buffer is refreshed only if more
        than 0.1 seconds has elapsed since the last time the buffer was
        read. The data needed to fill the three tables is fetched
        atomically and consistently and is saved in this global internal
        buffer, forming a point-in-time “<span class="quote">snapshot</span>”. If
        multiple table accesses occur within 0.1 seconds (as they almost
        certainly do when MySQL processes a join among these tables),
        then the same snapshot is used to satisfy the query.
      </p><p>
        A correct result is returned when you <code class="literal">JOIN</code>
        any of these tables together in a single query, because the data
        for the three tables comes from the same snapshot. Because the
        buffer is not refreshed with every query of any of these tables,
        if you issue separate queries against these tables within a
        tenth of a second, the results are the same from query to query.
        On the other hand, two separate queries of the same or different
        tables issued more than a tenth of a second apart may see
        different results, since the data come from different snapshots.
      </p><p>
        Because InnoDB must temporarily stall while the transaction and
        locking data is collected, too frequent queries of these tables
        can negatively impact performance as seen by other users.
      </p><p>
        As these tables contain sensitive information (at least
        <code class="literal">INNODB_LOCKS.LOCK_DATA</code> and
        <code class="literal">INNODB_TRX.TRX_QUERY</code>), for security reasons,
        only the users with the <code class="literal">PROCESS</code> privilege are
        allowed to <code class="literal">SELECT</code> from them.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-information-schema-note_inconsistency"></a>13.4.6.3.3. Possible Inconsistency with <code class="literal">PROCESSLIST</code></h5></div></div></div><a class="indexterm" name="id1146240"></a><p>
        As just described, while the transaction and locking data is
        correct and consistent when these
        <code class="literal">INFORMATION_SCHEMA</code> tables are populated, the
        underlying data changes so fast that similar glimpses at other,
        similarly fast-changing data, may not be in sync. Thus, you
        should be careful in comparing the data in the InnoDB
        transaction and locking tables with that in the
        <a href="information-schema.html#processlist-table" title="19.15. The INFORMATION_SCHEMA PROCESSLIST Table">MySQL table
        <code class="literal">PROCESSLIST</code></a>. The data from the
        <code class="literal">PROCESSLIST</code> table does not come from the same
        snapshot as the data about locking and transactions. Even if you
        issue a single <code class="literal">SELECT</code>
        (<code class="literal">JOIN</code>ing
        <a href="storage-engines.html#innodb-information-schema-innodb_trx" title="13.4.6.2.1. INNODB_TRX"><code class="literal">INNODB_TRX</code></a>
        and <code class="literal">PROCESSLIST</code>, for example), the content of
        those tables is generally not consistent.
        <a href="storage-engines.html#innodb-information-schema-innodb_trx" title="13.4.6.2.1. INNODB_TRX"><code class="literal">INNODB_TRX</code></a>
        may reference rows that are not present in
        <code class="literal">PROCESSLIST</code> or the currently executing SQL
        query of a transaction, shown in
        <code class="literal">INNODB_TRX.TRX_QUERY</code> may be different from
        the one in <code class="literal">PROCESSLIST.INFO</code>. The query in
        <a href="storage-engines.html#innodb-information-schema-innodb_trx" title="13.4.6.2.1. INNODB_TRX"><code class="literal">INNODB_TRX</code></a>
        is always consistent with the rest of
        <a href="storage-engines.html#innodb-information-schema-innodb_trx" title="13.4.6.2.1. INNODB_TRX"><code class="literal">INNODB_TRX</code></a>,
        <a href="storage-engines.html#innodb-information-schema-innodb_locks" title="13.4.6.2.2. INNODB_LOCKS"><code class="literal">INNODB_LOCKS</code></a>
        and
        <a href="storage-engines.html#innodb-information-schema-innodb_lock_waits" title="13.4.6.2.3. INNODB_LOCK_WAITS"><code class="literal">INNODB_LOCK_WAITS</code></a>
        when the data comes from the same snapshot.
      </p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-performance"></a>13.4.7. InnoDB Performance and Scalability Enhancements</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-performance-overview">13.4.7.1. Overview of InnoDB Performance</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-latching">13.4.7.2. Faster Locking for Improved Scalability</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-use_sys_malloc">13.4.7.3. Using Operating System Memory Allocators</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-change_buffering">13.4.7.4. Controlling InnoDB Change Buffering</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-adaptive_hash_index">13.4.7.5. Controlling Adaptive Hash Indexing</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-thread_concurrency">13.4.7.6. Changes Regarding Thread Concurrency</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-read_ahead">13.4.7.7. Changes in the Read-Ahead Algorithm</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-multiple_io_threads">13.4.7.8. Multiple Background I/O Threads</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-aio-linux">13.4.7.9. Asynchronous I/O on Linux</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-group_commit">13.4.7.10. Group Commit</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-thread_io_rate">13.4.7.11. Controlling the Master Thread I/O Rate</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-adaptive_flushing">13.4.7.12. Controlling the Flushing Rate of Dirty Pages</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-pause_instruction">13.4.7.13. Using the PAUSE Instruction in InnoDB Spin Loops</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-spin_lock_polling">13.4.7.14. Control of Spin Lock Polling</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-midpoint_insertion">13.4.7.15. Making Buffer Pool Scan Resistant</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-recovery">13.4.7.16. Improvements to Crash Recovery Performance</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-performance-schema">13.4.7.17. Integration with MySQL PERFORMANCE_SCHEMA</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-multiple-buffer-pools">13.4.7.18. Improvements to Performance from Multiple Buffer Pools</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-multiple-rollback-segments">13.4.7.19. Better Scalability with Multiple Rollback Segments</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-improved-purge-scheduling">13.4.7.20. Better Scalability with Improved Purge Scheduling</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-improved-log-sys-mutex">13.4.7.21. Improved Log Sys Mutex</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-separate-flush-list-mutex">13.4.7.22. Separate Flush List Mutex</a></span></dt></dl></div><p>
    This section discusses recent InnoDB enhancements to performance and
    scalability, covering the performance features in InnoDB 1.1 with
    MySQL 5.5, and the features in the InnoDB Plugin for MySQL 5.1. This
    information is useful to any DBA or developer who is concerned with
    performance and scalability. Although some of the enhancements do
    not require any action on your part, knowing this information can
    still help you diagnose performance issues more quickly and
    modernize systems and applications that rely on older, inefficient
    behavior.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-overview"></a>13.4.7.1. Overview of InnoDB Performance</h4></div></div></div><p>
      InnoDB has always been highly efficient, and includes several
      unique architectural elements to assure high performance and
      scalability. The latest InnoDB storage engine includes new
      features that take advantage of advances in operating systems and
      hardware platforms, such as multi-core processors and improved
      memory allocation systems. In addition, new configuration options
      let you better control some InnoDB internal subsystems to achieve
      the best performance with your workload.
    </p><p>
      Starting with MySQL 5.5 and InnoDB 1.1, the built-in InnoDB
      storage engine within MySQL is upgraded to the full feature set
      and performance of the former InnoDB Plugin. This change makes
      these performance and scalability enhancements available to a much
      wider audience than before, and eliminates the separate
      installation step of the InnoDB Plugin. After learning about the
      InnoDB performance features in this section, continue with
      <a href="optimization.html" title="Chapter 7. Optimization">Chapter 7, <i>Optimization</i></a> to learn the best practices for
      overall MySQL performance, and <a href="optimization.html#optimizing-innodb" title="7.5. Optimizing for InnoDB Tables">Section 7.5, “Optimizing for <code class="literal">InnoDB</code> Tables”</a>
      in particular for InnoDB tips and guidelines.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-latching"></a>13.4.7.2. Faster Locking for Improved Scalability</h4></div></div></div><p>
      In MySQL and InnoDB, multiple threads of execution access shared
      data structures. InnoDB synchronizes these accesses with its own
      implementation of <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_mutex" target="_top">mutexes</a> and
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_rw_lock" target="_top">read/write locks</a>. InnoDB has
      historically protected the internal state of a read/write lock
      with an InnoDB mutex. On Unix and Linux platforms, the internal
      state of an InnoDB mutex is protected by a
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_pthreads" target="_top">Pthreads</a> mutex, as in
      IEEE Std 1003.1c (POSIX.1c).
    </p><p>
      On many platforms, there is a more efficient way to implement
      mutexes and read/write locks.
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_atomic" target="_top">Atomic</a> operations can often be
      used to synchronize the actions of multiple threads more
      efficiently than Pthreads. Each operation to acquire or release a
      lock can be done in fewer CPU instructions, and thus result in
      less wasted time when threads are contending for access to shared
      data structures. This in turn means greater scalability on
      multi-core platforms.
    </p><p>
      InnoDB implements mutexes and read/write locks with the
      <a href="http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Atomic-Builtins.html" target="_top">built-in
      functions provided by the GNU Compiler Collection (GCC) for atomic
      memory access</a> instead of using the Pthreads approach
      previously used. More specifically, an InnoDB that is compiled
      with GCC version 4.1.2 or later uses the atomic builtins instead
      of a <code class="literal">pthread_mutex_t</code> to implement InnoDB
      mutexes and read/write locks.
    </p><p>
      On 32-bit Microsoft Windows, InnoDB has implemented mutexes (but
      not read/write locks) with hand-written assembler instructions.
      Beginning with Microsoft Windows 2000, functions for
      <a href="http://msdn.microsoft.com/en-us/library/ms684122(VS.85).aspx" target="_top">Interlocked
      Variable Access</a> are available that are similar to the
      built-in functions provided by GCC. On Windows 2000 and higher,
      InnoDB makes use of the Interlocked functions. Unlike the old
      hand-written assembler code, the new implementation supports
      read/write locks and 64-bit platforms.
    </p><p>
      Solaris 10 introduced library functions for
      <a href="http://docs.sun.com/app/docs/doc/816-5168/atomic-ops-3c" target="_top">atomic
      operations</a>, and InnoDB uses these functions by default.
      When MySQL is compiled on Solaris 10 with a compiler that does not
      support the
      <a href="http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Atomic-Builtins.html" target="_top">built-in
      functions provided by the GNU Compiler Collection (GCC) for atomic
      memory access</a>, InnoDB uses the library functions.
    </p><p>
      This change improves the scalability of InnoDB on multi-core
      systems. This feature is enabled out-of-the-box on the platforms
      where it is supported. You do not have to set any parameter or
      option to take advantage of the improved performance. On platforms
      where the GCC, Windows, or Solaris functions for atomic memory
      access are not available, InnoDB uses the traditional Pthreads
      method of implementing mutexes and read/write locks.
    </p><p>
      When MySQL starts, InnoDB writes a message to the log file
      indicating whether atomic memory access is used for mutexes, for
      mutexes and read/write locks, or neither. If suitable tools are
      used to build InnoDB and the target CPU supports the atomic
      operations required, InnoDB uses the built-in functions for
      mutexing. If, in addition, the compare-and-swap operation can be
      used on thread identifiers (<code class="literal">pthread_t</code>), then
      InnoDB uses the instructions for read-write locks as well.
    </p><p>
      Note: If you are building from source, ensure that the build
      process properly takes advantage of your platform capabilities.
      
    </p><p>
      For more information about the performance implications of
      locking, see <a href="optimization.html#locking-issues" title="7.10. Optimizing Locking Operations">Section 7.10, “Optimizing Locking Operations”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-use_sys_malloc"></a>13.4.7.3. Using Operating System Memory Allocators</h4></div></div></div><a class="indexterm" name="id1146615"></a><a class="indexterm" name="id1146624"></a><a class="indexterm" name="id1146636"></a><a class="indexterm" name="id1146649"></a><a class="indexterm" name="id1146661"></a><a class="indexterm" name="id1146674"></a><p>
      When InnoDB was developed, the memory allocators supplied with
      operating systems and run-time libraries were often lacking in
      performance and scalability. At that time, there were no memory
      allocator libraries tuned for multi-core CPUs. Therefore, InnoDB
      implemented its own memory allocator in the <code class="literal">mem</code>
      subsystem. This allocator is guarded by a single mutex, which may
      become a <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_bottleneck" target="_top">bottleneck</a>. InnoDB
      also implements a wrapper interface around the system allocator
      (<code class="literal">malloc</code> and <code class="literal">free</code>) that is
      likewise guarded by a single mutex.
    </p><p>
      Today, as multi-core systems have become more widely available,
      and as operating systems have matured, significant improvements
      have been made in the memory allocators provided with operating
      systems. New memory allocators perform better and are more
      scalable than they were in the past. The leading high-performance
      memory allocators include <code class="literal">Hoard</code>,
      <code class="literal">libumem</code>, <code class="literal">mtmalloc</code>,
      <code class="literal">ptmalloc</code>, <code class="literal">tbbmalloc</code>, and
      <code class="literal">TCMalloc</code>. Most workloads, especially those
      where memory is frequently allocated and released (such as
      multi-table joins), benefit from using a more highly tuned memory
      allocator as opposed to the internal, InnoDB-specific memory
      allocator.
    </p><p>
      You can control whether InnoDB uses its own memory allocator or an
      allocator of the operating system, by setting the value of the
      system configuration parameter
      <a href="storage-engines.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> in the
      MySQL option file (<code class="literal">my.cnf</code> or
      <code class="literal">my.ini</code>). If set to <code class="literal">ON</code> or
      <code class="literal">1</code> (the default), InnoDB uses the
      <code class="literal">malloc</code> and <code class="literal">free</code> functions of
      the underlying system rather than manage memory pools itself. This
      parameter is not dynamic, and takes effect only when the system is
      started. To continue to use the InnoDB memory allocator, set
      <a href="storage-engines.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> to
      <code class="literal">0</code>.
    </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
        When the InnoDB memory allocator is disabled, InnoDB ignores the
        value of the parameter
        <a href="storage-engines.html#sysvar_innodb_additional_mem_pool_size"><code class="literal">innodb_additional_mem_pool_size</code></a>.
        The InnoDB memory allocator uses an additional memory pool for
        satisfying allocation requests without having to fall back to
        the system memory allocator. When the InnoDB memory allocator is
        disabled, all such allocation requests are fulfilled by the
        system memory allocator.
      </p><p xmlns="">
        On Unix-like systems that use dynamic linking, replacing the
        memory allocator may be as easy as making the environment
        variable <code class="literal">LD_PRELOAD</code> or
        <code class="literal">LD_LIBRARY_PATH</code> point to the dynamic library
        that implements the allocator. On other systems, some relinking
        may be necessary. Please refer to the documentation of the
        memory allocator library of your choice.
      </p><p xmlns="">
        Since InnoDB cannot track all memory use when the system memory
        allocator is used
        (<a href="storage-engines.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> is
        <code class="literal">ON</code>), the section “<span class="quote">BUFFER POOL AND
        MEMORY</span>” in the output of the <code class="literal">SHOW ENGINE INNODB
        STATUS</code> command only includes the buffer pool
        statistics in the “<span class="quote">Total memory allocated</span>”. Any
        memory allocated using the <code class="literal">mem</code> subsystem or
        using <code class="literal">ut_malloc</code> is excluded.
      </p></div><p>
      For more information about the performance implications of InnoDB
      memory usage, see <a href="optimization.html#buffering-caching" title="7.9. Buffering and Caching">Section 7.9, “Buffering and Caching”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-change_buffering"></a>13.4.7.4. Controlling InnoDB Change Buffering</h4></div></div></div><a class="indexterm" name="id1146926"></a><a class="indexterm" name="id1146935"></a><a class="indexterm" name="id1146947"></a><a class="indexterm" name="id1146959"></a><p>
      When <code class="literal">INSERT</code>, <code class="literal">UPDATE</code>, and
      <code class="literal">DELETE</code> operations are done to a table, often
      the values of indexed columns (particularly the values of
      secondary keys) are not in sorted order, requiring substantial I/O
      to bring secondary indexes up to date. InnoDB has an
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_insert_buffer" target="_top">insert buffer</a> that
      caches changes to secondary index entries when the relevant
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_page" target="_top">page</a> is not in the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_buffer_pool" target="_top">buffer pool</a>, thus
      avoiding I/O operations by not reading in the page from the disk.
      The buffered changes are merged when the page is loaded to the
      buffer pool, and the updated page is later flushed to disk using
      the normal mechanism. The InnoDB main thread merges buffered
      changes when the server is nearly idle, and during a
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_slow_shutdown" target="_top">slow shutdown</a>.
    </p><p>
      Because it can result in fewer disk reads and writes, this feature
      is most valuable for workloads that are I/O-bound, for example
      applications with a high volume of DML operations such as bulk
      inserts.
    </p><p>
      However, the insert buffer occupies a part of the buffer pool,
      reducing the memory available to cache data pages. If the working
      set almost fits in the buffer pool, or if your tables have
      relatively few secondary indexes, it may be useful to disable
      insert buffering. If the working set entirely fits in the buffer
      pool, insert buffering does not impose any extra overhead, because
      it only applies to pages that are not in the buffer pool.
    </p><p>
      You can control the extent to which InnoDB performs insert
      buffering with the system configuration parameter
      <a href="storage-engines.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>. You can
      turn on and off buffering for inserts, delete operations (when
      index records are initially marked for deletion) and purge
      operations (when index records are physically deleted). An update
      operation is represented as a combination of an insert and a
      delete. In MySQL 5.5 and higher, the default value is changed from
      <code class="literal">inserts</code> to <code class="literal">all</code>.
    </p><p>
      The allowed values of
      <a href="storage-engines.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>
      are:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          <span class="bold"><strong><code class="literal">all</code></strong></span>
        </p><p>
          The default value: buffer inserts, delete-marking operations,
          and purges.
        </p></li><li><p>
          <span class="bold"><strong><code class="literal">none</code></strong></span>
        </p><p>
          Do not buffer any operations.
        </p></li><li><p>
          <span class="bold"><strong><code class="literal">inserts</code></strong></span>
        </p><p>
          Buffer insert operations.
        </p></li><li><p>
          <span class="bold"><strong><code class="literal">deletes</code></strong></span>
        </p><p>
          Buffer delete-marking operations.
        </p></li><li><p>
          <span class="bold"><strong><code class="literal">changes</code></strong></span>
        </p><p>
          Buffer both inserts and delete-marking.
        </p></li><li><p>
          <span class="bold"><strong><code class="literal">purges</code></strong></span>
        </p><p>
          Buffer the physical deletion operations that happen in the
          background.
        </p></li></ul></div><p>
      You can set the value of this parameter in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      it dynamically with the <code class="literal">SET GLOBAL</code> command,
      which requires the <code class="literal">SUPER</code> privilege. Changing
      the setting affects the buffering of new operations; the merging
      of already buffered entries is not affected.
    </p><p>
      For more information about speeding up <code class="literal">INSERT</code>,
      <code class="literal">UPDATE</code>, and <code class="literal">DELETE</code>
      statements, see <a href="optimization.html#non-select-optimization" title="7.2.2. Optimizing DML Statements">Section 7.2.2, “Optimizing DML Statements”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-adaptive_hash_index"></a>13.4.7.5. Controlling Adaptive Hash Indexing</h4></div></div></div><a class="indexterm" name="id1147258"></a><a class="indexterm" name="id1147267"></a><a class="indexterm" name="id1147276"></a><p>
      If a table fits almost entirely in main memory, the fastest way to
      perform queries on it is to use
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_hash_index" target="_top">hash indexes</a> rather
      than <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_b_tree" target="_top">B-tree</a> lookups. MySQL
      monitors searches on each index defined for an InnoDB table. If it
      notices that certain index values are being accessed frequently,
      it automatically builds an in-memory hash table for that index.
      Based on the observed pattern of searches, it builds a hash index
      using a prefix of the index key. The prefix of the key can be any
      length, and it may be that only some of the values in the B-tree
      appear in the hash index. Hash indexes are built on demand for
      those pages of the index that are often accessed.
    </p><p>
      This <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_adaptive_hash_index" target="_top">adaptive hash
      index</a> mechanism allows InnoDB to take advantage of large
      amounts of memory, something typically done only by database
      systems specifically designed for databases that reside entirely
      in memory. Normally, the automatic building and use of adaptive
      hash indexes improves performance. However, sometimes, the
      read/write lock that guards access to the adaptive hash index may
      become a source of contention under heavy workloads, such as
      multiple concurrent joins.
    </p><p>
      You can monitor the use of the adaptive hash index and the
      contention for its use in the “<span class="quote">SEMAPHORES</span>” section of
      the output of the <code class="literal">SHOW ENGINE INNODB STATUS</code>
      command. If you see many threads waiting on an RW-latch created in
      <code class="literal">btr0sea.c</code>, then it might be useful to disable
      adaptive hash indexing.
    </p><p>
      The configuration parameter
      <a href="storage-engines.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a>
      can be set to disable or enable the adaptive hash index. See
      <a href="storage-engines.html#innodb-other-changes-innodb_adaptive_hash_index" title="13.4.8.2.4. Dynamically Changing innodb_adaptive_hash_index">Section 13.4.8.2.4, “Dynamically Changing <code class="literal">innodb_adaptive_hash_index</code>”</a>
      for details.
    </p><p>
      For more information about the performance characteristics of hash
      indexes, see <a href="optimization.html#index-btree-hash" title="7.3.8. Comparison of B-Tree and Hash Indexes">Section 7.3.8, “Comparison of B-Tree and Hash Indexes”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-thread_concurrency"></a>13.4.7.6. Changes Regarding Thread Concurrency</h4></div></div></div><a class="indexterm" name="id1147387"></a><a class="indexterm" name="id1147396"></a><a class="indexterm" name="id1147406"></a><a class="indexterm" name="id1147415"></a><a class="indexterm" name="id1147427"></a><p>
      InnoDB uses operating system
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_thread" target="_top">threads</a> to process requests
      from user transactions. (Transactions may issue many requests to
      InnoDB before they commit or roll back.) On modern operating
      systems and servers with multi-core processors, where context
      switching is efficient, most workloads run well without any limit
      on the number of concurrent threads. Scalability improvements in
      MySQL 5.5 and up reduce the need to limit the number of
      concurrently executing threads inside InnoDB.
    </p><p>
      In situations where it is helpful to minimize context switching
      between threads, InnoDB can use a number of techniques to limit
      the number of concurrently executing operating system threads (and
      thus the number of requests that are processed at any one time).
      When InnoDB receives a new request from a user session, if the
      number of threads concurrently executing is at a pre-defined
      limit, the new request sleeps for a short time before it tries
      again. A request that cannot be rescheduled after the sleep is put
      in a first-in/first-out queue and eventually is processed. Threads
      waiting for locks are not counted in the number of concurrently
      executing threads.
    </p><p>
      You can limit the number of concurrent threads by setting the
      configuration parameter
      <a href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>.
      Once the number of executing threads reaches this limit,
      additional threads sleep for a number of microseconds, set by the
      configuration parameter
      <a href="storage-engines.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a>,
      before being placed into the queue.
    </p><p>
      The default value for
      <a href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
      and the implied default limit on the number of concurrent threads
      has been changed in various releases of MySQL and InnoDB.
      Currently, the default value of
      <a href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is
      <code class="literal">0</code>, so that by default there is no limit on the
      number of concurrently executing threads, as shown in
      <a href="storage-engines.html#innodb-thread-concurrency-table" title="Table 13.7. Changes to innodb_thread_concurrency">Table 13.7, “Changes to <code class="literal">innodb_thread_concurrency</code>”</a>.
    </p><div class="table"><a name="innodb-thread-concurrency-table"></a><p class="title"><b>Table 13.7. Changes to <code class="literal">innodb_thread_concurrency</code></b></p><table summary="Changes to innodb_thread_concurrency" border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th>InnoDB Version</th><th>MySQL Version</th><th>Default value</th><th>Default limit of concurrent threads</th><th>Value to allow unlimited threads</th></tr></thead><tbody><tr><td>Built-in</td><td>Earlier than 5.1.11</td><td>20</td><td>No limit</td><td>20 or higher</td></tr><tr><td>Built-in</td><td>5.1.11 and newer</td><td>8</td><td>8</td><td>0</td></tr><tr><td>InnoDB before 1.0.3</td><td>(corresponding to Plugin)</td><td>8</td><td>8</td><td>0</td></tr><tr><td>InnoDB 1.0.3 and newer</td><td>(corresponding to Plugin)</td><td>0</td><td>No limit</td><td>0</td></tr></tbody></table></div><p>
      Note that InnoDB causes threads to sleep only when the number of
      concurrent threads is limited. When there is no limit on the
      number of threads, all contend equally to be scheduled. That is,
      if <a href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is
      <code class="literal">0</code>, the value of
      <a href="storage-engines.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a> is
      ignored.
    </p><p>
      When there is a limit on the number of threads, InnoDB reduces
      context switching overhead by permitting multiple requests made
      during the execution of a single SQL statement to enter InnoDB
      without observing the limit set by
      <a href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>.
      Since an SQL statement (such as a join) may comprise multiple row
      operations within InnoDB, InnoDB assigns “<span class="quote">tickets</span>”
      that allow a thread to be scheduled repeatedly with minimal
      overhead.
    </p><p>
      When a new SQL statement starts, a thread has no tickets, and it
      must observe
      <a href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>.
      Once the thread is entitled to enter InnoDB, it is assigned a
      number of tickets that it can use for subsequently entering
      InnoDB. If the tickets run out,
      <a href="storage-engines.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
      is observed again and further tickets are assigned. The number of
      tickets to assign is specified by the global option
      <a href="storage-engines.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a>,
      which is 500 by default. A thread that is waiting for a lock is
      given one ticket once the lock becomes available.
    </p><p>
      The correct values of these variables depend on your environment
      and workload. Try a range of different values to determine what
      value works for your applications. Before limiting the number of
      concurrently executing threads, review configuration options that
      may improve the performance of InnoDB on multi-core and
      multi-processor computers, such as
      <a href="storage-engines.html#innodb-performance-use_sys_malloc" title="13.4.7.3. Using Operating System Memory Allocators">innodb_use_sys_malloc</a>
      and
      <a href="storage-engines.html#innodb-performance-adaptive_hash_index" title="13.4.7.5. Controlling Adaptive Hash Indexing">innodb_adaptive_hash_index</a>.
    </p><p>
      For general performance information about MySQL thread handling,
      see <a href="optimization.html#connection-threads" title="7.11.5.1. How MySQL Uses Threads for Client Connections">Section 7.11.5.1, “How MySQL Uses Threads for Client Connections”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-read_ahead"></a>13.4.7.7. Changes in the Read-Ahead Algorithm</h4></div></div></div><a class="indexterm" name="id1147782"></a><a class="indexterm" name="id1147791"></a><a class="indexterm" name="id1147803"></a><a class="indexterm" name="id1147816"></a><p>
      A <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_read_ahead" target="_top">read-ahead</a> request is an
      I/O request to prefetch multiple pages in the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_buffer_pool" target="_top">buffer pool</a>
      asynchronously, in anticipation that these pages will be needed
      soon. InnoDB uses or has used two read-ahead algorithms to improve
      I/O performance:
    </p><p>
      <span class="strong"><strong>Linear</strong></span> read-ahead is based on
      the access pattern of the pages in the buffer pool, not just their
      number. You can control when InnoDB performs a read-ahead
      operation by adjusting the number of sequential page accesses
      required to trigger an asynchronous read request, using the
      configuration parameter
      <a href="storage-engines.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>.
      Before this parameter was added, InnoDB would only calculate
      whether to issue an asynchronous prefetch request for the entire
      next extent when it read in the last page of the current extent.
    </p><p>
      <span class="strong"><strong>Random</strong></span> read-ahead is a former
      technique that has now been removed as of MySQL 5.5. If a certain
      number of pages from the same extent (64 consecutive pages) were
      found in the buffer pool, InnoDB asynchronously issued a request
      to prefetch the remaining pages of the extent. Random read-ahead
      added unnecessary complexity to the InnoDB code and often resulted
      in performance degradation rather than improvement. This feature
      is no longer part of InnoDB, and users should generally see
      equivalent or improved performance.
    </p><p>
      If the number of pages read from an extent of 64 pages is greater
      or equal to
      <a href="storage-engines.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>,
      InnoDB initiates an asynchronous read-ahead operation of the
      entire following extent. Thus, this parameter controls how
      sensitive InnoDB is to the pattern of page accesses within an
      extent in deciding whether to read the following extent
      asynchronously. The higher the value, the more strict the access
      pattern check. For example, if you set the value to 48, InnoDB
      triggers a linear read-ahead request only when 48 pages in the
      current extent have been accessed sequentially. If the value is 8,
      InnoDB would trigger an asynchronous read-ahead even if as few as
      8 pages in the extent were accessed sequentially.
    </p><p>
      The new configuration parameter
      <a href="storage-engines.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>
      can be set to any value from 0-64. The default value is 56,
      meaning that an asynchronous read-ahead is performed only when 56
      of the 64 pages in the extent are accessed sequentially. You can
      set the value of this parameter in the MySQL option file (my.cnf
      or my.ini), or change it dynamically with the <code class="literal">SET
      GLOBAL</code> command, which requires the
      <code class="literal">SUPER</code> privilege.
    </p><p>
      The <code class="literal">SHOW ENGINE INNODB STATUS</code> command displays
      statistics to help you evaluate the effectiveness of the
      read-ahead algorithm. See
      <a href="storage-engines.html#innodb-other-changes-readahead-counters" title="13.4.8.8. More Read-Ahead Statistics">Section 13.4.8.8, “More Read-Ahead Statistics”</a> for more
      information.
    </p><p>
      For more information about I/O performance, see
      <a href="optimization.html#optimizing-innodb-diskio" title="7.5.7. Optimizing InnoDB Disk I/O">Section 7.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a> and
      <a href="optimization.html#disk-issues" title="7.11.3. Optimizing Disk I/O">Section 7.11.3, “Optimizing Disk I/O”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-multiple_io_threads"></a>13.4.7.8. Multiple Background I/O Threads</h4></div></div></div><a class="indexterm" name="id1147967"></a><a class="indexterm" name="id1147976"></a><a class="indexterm" name="id1147989"></a><a class="indexterm" name="id1147998"></a><a class="indexterm" name="id1148010"></a><a class="indexterm" name="id1148019"></a><a class="indexterm" name="id1148031"></a><a class="indexterm" name="id1148044"></a><p>
      InnoDB uses background <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_thread" target="_top">threads</a>
      to service various types of I/O requests. You can configure the
      number of background threads that service read and write I/O on
      data pages, using the configuration parameters
      <a href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> and
      <a href="storage-engines.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>. These
      parameters signify the number of background threads used for read
      and write requests respectively. They are effective on all
      supported platforms. You can set the value of these parameters in
      the MySQL option file (<code class="literal">my.cnf</code> or
      <code class="literal">my.ini</code>); you cannot change them dynamically.
      The default value for these parameters is <code class="literal">4</code> and
      the permissible values range from <code class="literal">1-64</code>.
    </p><p>
      These parameters replace
      <a href="http://dev.mysql.com/doc/refman/5.1/en/innodb-parameters.html#sysvar_innodb_file_io_threads" target="_top"><code class="literal">innodb_file_io_threads</code></a> from
      earlier versions of MySQL. If you try to set a value for this
      obsolete parameter, a warning is written to the log file and the
      value is ignored. This parameter only applied to Windows
      platforms. (On non-Windows platforms, there was only one thread
      each for read and write.)
    </p><p>
      The purpose of this change is to make InnoDB more scalable on high
      end systems. Each background thread can handle up to 256 pending
      I/O requests. A major source of background I/O is
      the<a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_read_ahead" target="_top">read-ahead</a>
      requests. InnoDB tries to balance the load of incoming requests in
      such way that most of the background threads share work equally.
      InnoDB also attempts to allocate read requests from the same
      extent to the same thread to increase the chances of coalescing
      the requests together. If you have a high end I/O subsystem and
      you see more than 64 ×
      <a href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> pending
      read requests in <code class="literal">SHOW ENGINE INNODB STATUS</code>, you
      might gain by increasing the value of
      <a href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a>.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a href="optimization.html#optimizing-innodb-diskio" title="7.5.7. Optimizing InnoDB Disk I/O">Section 7.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-aio-linux"></a>13.4.7.9. Asynchronous I/O on Linux</h4></div></div></div><a class="indexterm" name="id1148179"></a><p>
      Starting in InnoDB 1.1 with MySQL 5.5, the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_asynchronous_io" target="_top">asynchronous I/O</a>
      capability that InnoDB has had on Windows systems is now available
      on Linux systems. (Other Unix-like systems continue to use
      synchronous I/O calls.) This feature improves the scalability of
      heavily I/O-bound systems, which typically show many pending
      reads/writes in the output of the command <code class="literal">SHOW ENGINE
      INNODB STATUS\G</code>.
    </p><p>
      Running with a large number of <code class="literal">InnoDB</code> I/O
      threads, and especially running multiple such instances on the
      same server machine, can exceed capacity limits on Linux systems.
      In this case, you can fix the error:
</p><pre class="programlisting">EAGAIN: The specified maxevents exceeds the user's limit of available events. </pre><p>
      by writing a higher limit to
      <code class="literal">/proc/sys/fs/aio-max-nr</code>.
    </p><p>
      In general, if a problem with the asynchronous I/O subsystem in
      the OS prevents InnoDB from starting, set the option
      <a href="storage-engines.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio=0</code></a> in the
      configuration file. This new configuration option applies to Linux
      systems only, and cannot be changed once the server is running.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a href="optimization.html#optimizing-innodb-diskio" title="7.5.7. Optimizing InnoDB Disk I/O">Section 7.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-group_commit"></a>13.4.7.10. Group Commit</h4></div></div></div><a class="indexterm" name="id1148262"></a><p>
      InnoDB, like any other
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_acid" target="_top">ACID</a>-compliant database engine,
      flushes the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_redo_log" target="_top">redo log</a> of a
      transaction before it is committed. Historically, InnoDB used
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_group_commit" target="_top">group commit</a>
      functionality to group multiple such flush requests together to
      avoid one flush for each commit. With group commit, InnoDB issues
      a single write to the log file to perform the commit action for
      multiple user transactions that commit at about the same time,
      significantly improving throughput.
    </p><p>
      Group commit in InnoDB worked until MySQL 4.x, and works once
      again with MySQL 5.1 with the InnoDB Plugin, and MySQL 5.5 and
      higher. The introduction of support for the distributed
      transactions and Two Phase Commit (2PC) in MySQL 5.0 interfered
      with the InnoDB group commit functionality. This issue is now
      resolved.
    </p><p>
      The group commit functionality inside InnoDB works with the Two
      Phase Commit protocol in MySQL. Re-enabling of the group commit
      functionality fully ensures that the ordering of commit in the
      MySQL binlog and the InnoDB logfile is the same as it was before.
      It means it is <span class="strong"><strong>totally safe to use MySQL Enterprise Backup
      with InnoDB 1.0.4</strong></span> (that is, the InnoDB Plugin with
      MySQL 5.1) and above. When the binlog is enabled, you typically
      also set the configuration option
      <code class="literal">sync_binlog=0</code>, because group commit for the
      binary log is only supported if it is set to 0.
    </p><p>
      Group commit is transparent; you do not need to do anything to
      take advantage of this significant performance improvement.
    </p><p>
      For more information about performance of
      <code class="literal">COMMIT</code> and other transactional operations, see
      <a href="optimization.html#optimizing-innodb-transaction-management" title="7.5.2. Optimizing InnoDB Transaction Management">Section 7.5.2, “Optimizing <code class="literal">InnoDB</code> Transaction Management”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-thread_io_rate"></a>13.4.7.11. Controlling the Master Thread I/O Rate</h4></div></div></div><a class="indexterm" name="id1148352"></a><a class="indexterm" name="id1148361"></a><a class="indexterm" name="id1148373"></a><p>
      The <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_master_thread" target="_top">master thread</a> in
      InnoDB is a thread that performs various tasks in the background.
      Most of these tasks are I/O related, such as flushing dirty pages
      from the buffer pool or writing changes from the insert buffer to
      the appropriate secondary indexes. The master thread attempts to
      perform these tasks in a way that does not adversely affect the
      normal working of the server. It tries to estimate the free I/O
      bandwidth available and tune its activities to take advantage of
      this free capacity. Historically, InnoDB has used a hard coded
      value of 100 IOPs (input/output operations per second) as the
      total I/O capacity of the server.
    </p><p>
      The parameter
      <a href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
      indicates the overall I/O capacity available to InnoDB. This
      parameter should be set to approximately the number of I/O
      operations that the system can perform per second. The value
      depends on your system configuration. When
      <a href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> is set,
      the master threads estimates the I/O bandwidth available for
      background tasks based on the set value. Setting the value to
      <code class="literal">100</code> reverts to the old behavior.
    </p><p>
      You can set the value of
      <a href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> to any
      number 100 or greater. The default value is
      <code class="literal">200</code>, reflecting that the performance of typical
      modern I/O devices is higher than in the early days of MySQL.
      Typically, values around the previous default of 100 are
      appropriate for consumer-level storage devices, such as hard
      drives up to 7200 RPMs. Faster hard drives, RAID configurations,
      and SSDs benefit from higher values.
    </p><p>
      You can set the value of this parameter in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      it dynamically with the <code class="literal">SET GLOBAL</code> command,
      which requires the <code class="literal">SUPER</code> privilege.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a href="optimization.html#optimizing-innodb-diskio" title="7.5.7. Optimizing InnoDB Disk I/O">Section 7.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-adaptive_flushing"></a>13.4.7.12. Controlling the Flushing Rate of Dirty Pages</h4></div></div></div><a class="indexterm" name="id1148503"></a><a class="indexterm" name="id1148512"></a><a class="indexterm" name="id1148525"></a><a class="indexterm" name="id1148534"></a><a class="indexterm" name="id1148546"></a><p>
      InnoDB performs certain tasks in the background, including
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_flush" target="_top">flushing</a> of
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_dirty_page" target="_top">dirty pages</a> (those
      pages that have been changed but are not yet written to the
      database files) from the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_buffer_pool" target="_top">buffer pool</a>, a task
      performed by the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_master_thread" target="_top">master
      thread</a>. Currently, InnoDB aggressively flushes buffer pool
      pages if the percentage of dirty pages in the buffer pool exceeds
      <a href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>.
    </p><p>
      InnoDB uses a new algorithm to estimate the required rate of
      flushing, based on the speed of redo log generation and the
      current rate of flushing. The intent is to smooth overall
      performance by ensuring that buffer flush activity keeps up with
      the need to keep the buffer pool “<span class="quote">clean</span>”.
      Automatically adjusting the rate of flushing can help to avoid
      steep dips in throughput, when excessive buffer pool flushing
      limits the I/O capacity available for ordinary read and write
      activity.
    </p><p>
      InnoDB uses its log files in a circular fashion. Before reusing a
      portion of a log file, InnoDB flushes to disk all dirty buffer
      pool pages whose redo entries are contained in that portion of the
      log file, a process known as a
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_sharp_checkpoint" target="_top">sharp checkpoint</a>. If
      a workload is write-intensive, it generates a lot of redo
      information, all written to the log file. If all available space
      in the log files is used up, a sharp checkpoint occurs, causing a
      temporary reduction in throughput. This situation can happen even
      though <a href="storage-engines.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
      is not reached.
    </p><p>
      InnoDB uses a heuristic-based algorithm to avoid such a scenario,
      by measuring the number of dirty pages in the buffer pool and the
      rate at which redo is being generated. Based on these numbers,
      InnoDB decides how many dirty pages to flush from the buffer pool
      each second. This self-adapting algorithm is able to deal with
      sudden changes in the workload.
    </p><p>
      Internal benchmarking has also shown that this algorithm not only
      maintains throughput over time, but can also improve overall
      throughput significantly.
    </p><p>
      Because adaptive flushing is a new feature that can significantly
      affect the I/O pattern of a workload, a new configuration
      parameter lets you turn off this feature. The default value of the
      boolean parameter
      <a href="storage-engines.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a> is
      <code class="literal">TRUE</code>, enabling the new algorithm. You can set
      the value of this parameter in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      it dynamically with the <code class="literal">SET GLOBAL</code> command,
      which requires the <code class="literal">SUPER</code> privilege.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a href="optimization.html#optimizing-innodb-diskio" title="7.5.7. Optimizing InnoDB Disk I/O">Section 7.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-pause_instruction"></a>13.4.7.13. Using the PAUSE Instruction in InnoDB Spin Loops</h4></div></div></div><p>
      Synchronization inside InnoDB frequently involves the use of
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_spin" target="_top">spin</a> loops: while waiting,
      InnoDB executes a tight loop of instructions repeatedly to avoid
      having the InnoDB <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_process" target="_top">process</a> and
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_thread" target="_top">threads</a> be rescheduled by the
      operating system. If the spin loops are executed too quickly,
      system resources are wasted, imposing a performance penalty on
      transaction throughput. Most modern processors implement the
      <code class="literal">PAUSE</code> instruction for use in spin loops, so the
      processor can be more efficient.
    </p><p>
      InnoDB uses a <code class="literal">PAUSE</code> instruction in its spin
      loops on all platforms where such an instruction is available.
      This technique increases overall performance with CPU-bound
      workloads, and has the added benefit of minimizing power
      consumption during the execution of the spin loops.
    </p><p>
      You do not have to do anything to take advantage of this
      performance improvement.
    </p><p>
      For performance considerations for InnoDB locking operations, see
      <a href="optimization.html#locking-issues" title="7.10. Optimizing Locking Operations">Section 7.10, “Optimizing Locking Operations”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-spin_lock_polling"></a>13.4.7.14. Control of Spin Lock Polling</h4></div></div></div><a class="indexterm" name="id1148774"></a><a class="indexterm" name="id1148782"></a><p>
      Many InnoDB <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_mutex" target="_top">mutexes</a> and
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_rw_lock" target="_top">rw-locks</a> are reserved for a
      short time. On a multi-core system, it can be more efficient for a
      thread to continuously check if it can acquire a mutex or rw-lock
      for a while before sleeping. If the mutex or rw-lock becomes
      available during this polling period, the thread can continue
      immediately, in the same time slice. However, too-frequent polling
      by multiple threads of a shared object can cause “<span class="quote">cache ping
      pong</span>”, different processors invalidating portions of each
      others' cache. InnoDB minimizes this issue by waiting a random
      time between subsequent polls. The delay is implemented as a busy
      loop.
    </p><p>
      You can control the maximum delay between testing a mutex or
      rw-lock using the parameter
      <a href="storage-engines.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a>. The
      duration of the delay loop depends on the C compiler and the
      target processor. (In the 100MHz Pentium era, the unit of delay
      was one microsecond.) On a system where all processor cores share
      a fast cache memory, you might reduce the maximum delay or disable
      the busy loop altogether by setting
      <code class="literal">innodb_spin_wait_delay=0</code>. On a system with
      multiple processor chips, the effect of cache invalidation can be
      more significant and you might increase the maximum delay.
    </p><p>
      The default value of
      <a href="storage-engines.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a> is
      <code class="literal">6</code>. The spin wait delay is a dynamic global
      parameter that you can specify in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      at runtime with the command <code class="literal">SET GLOBAL
      innodb_spin_wait_delay=<em class="replaceable"><code>delay</code></em></code>,
      where <code class="literal"><em class="replaceable"><code>delay</code></em></code> is the
      desired maximum delay. Changing the setting requires the
      <code class="literal">SUPER</code> privilege.
    </p><p>
      For performance considerations for InnoDB locking operations, see
      <a href="optimization.html#locking-issues" title="7.10. Optimizing Locking Operations">Section 7.10, “Optimizing Locking Operations”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-midpoint_insertion"></a>13.4.7.15. Making Buffer Pool Scan Resistant</h4></div></div></div><a class="indexterm" name="id1148911"></a><a class="indexterm" name="id1148920"></a><a class="indexterm" name="id1148929"></a><a class="indexterm" name="id1148938"></a><a class="indexterm" name="id1148947"></a><a class="indexterm" name="id1148956"></a><p>
      Rather than using a strictly <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_lru" target="_top">LRU</a>
      algorithm, InnoDB uses a technique to minimize the amount of data
      that is brought into the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_buffer_pool" target="_top">buffer
      pool</a> and never accessed again. The goal is to make sure
      that frequently accessed (“<span class="quote">hot</span>”) pages remain in the
      buffer pool, even as
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_read_ahead" target="_top">read-ahead</a> and
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_full_table_scan" target="_top">full table scans</a>
      bring in new blocks that might or might not be accessed afterward.
    </p><p>
      Newly read blocks are inserted into the middle of the list
      representing the buffer pool. of the LRU list. All newly read
      pages are inserted at a location that by default is
      <code class="literal">3/8</code> from the tail of the LRU list. The pages
      are moved to the front of the list (the most-recently used end)
      when they are accessed in the buffer pool for the first time. Thus
      pages that are never accessed never make it to the front portion
      of the LRU list, and “<span class="quote">age out</span>” sooner than with a
      strict LRU approach. This arrangement divides the LRU list into
      two segments, where the pages downstream of the insertion point
      are considered “<span class="quote">old</span>” and are desirable victims for
      LRU eviction.
    </p><p>
      For an explanation of the inner workings of the InnoDB buffer pool
      and the specifics of its LRU replacement algorithm, see
      <a href="optimization.html#innodb-buffer-pool" title="7.9.1. The InnoDB Buffer Pool">Section 7.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
    </p><p>
      You can control the insertion point in the LRU list, and choose
      whether InnoDB applies the same optimization to blocks brought
      into the buffer pool by table or index scans. The configuration
      parameter
      <a href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
      controls the percentage of “<span class="quote">old</span>” blocks in the LRU
      list. The default value of
      <a href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> is
      <code class="literal">37</code>, corresponding to the original fixed ratio
      of 3/8. The value range is <code class="literal">5</code> (new pages in the
      buffer pool age out very quickly) to <code class="literal">95</code> (only
      5% of the buffer pool is reserved for hot pages, making the
      algorithm close to the familiar LRU strategy).
    </p><p>
      The optimization that keeps the buffer pool from being churned by
      read-ahead can avoid similar problems due to table or index scans.
      In these scans, a data page is typically accessed a few times in
      quick succession and is never touched again. The configuration
      parameter <a href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
      specifies the time window (in milliseconds) after the first access
      to a page during which it can be accessed without being moved to
      the front (most-recently used end) of the LRU list. The default
      value of <a href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
      is <code class="literal">0</code>, corresponding to the original behavior of
      moving a page to the most-recently used end of the buffer pool
      list when it is first accessed in the buffer pool. Increasing this
      value makes more and more blocks likely to age out faster from the
      buffer pool.
    </p><p>
      Both the new parameters
      <a href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> and
      <a href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a> are
      dynamic, global and can be specified in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or
      changed at runtime with the <code class="literal">SET GLOBAL</code> command.
      Changing the setting requires the <code class="literal">SUPER</code>
      privilege.
    </p><p>
      To help you gauge the effect of setting these parameters, the
      <code class="literal">SHOW ENGINE INNODB STATUS</code> command reports
      additional statistics. The <code class="literal">BUFFER POOL AND
      MEMORY</code> section now looks like:
    </p><pre class="programlisting">Total memory allocated 1107296256; in additional pool allocated 0
Dictionary memory allocated 80360
Buffer pool size   65535
Free buffers       0
Database pages     63920
Old database pages 23600
Modified db pages  34969
Pending reads 32
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 414946, not young 2930673
1274.75 youngs/s, 16521.90 non-youngs/s
Pages read 486005, created 3178, written 160585
2132.37 reads/s, 3.40 creates/s, 323.74 writes/s
Buffer pool hit rate 950 / 1000, young-making rate 30 / 1000 not 392 / 1000
Pages read ahead 1510.10/s, evicted without access 0.00/s
LRU len: 63920, unzip_LRU len: 0
I/O sum[43690]:cur[221], unzip sum[0]:cur[0]</pre><div class="itemizedlist"><ul type="disc"><li><p>
          <code class="literal">Old database pages</code> is the number of pages
          in the “<span class="quote">old</span>” segment of the LRU list.
        </p></li><li><p>
          <code class="literal">Pages made young</code> and <code class="literal">not
          young</code> is the total number of “<span class="quote">old</span>”
          pages that have been made young or not respectively.
        </p></li><li><p>
          <code class="literal">youngs/s</code> and <code class="literal">non-young/s</code>
          is the rate at which page accesses to the “<span class="quote">old</span>”
          pages have resulted in making such pages young or otherwise
          respectively since the last invocation of the command.
        </p></li><li><p>
          <code class="literal">young-making rate</code> and
          <code class="literal">not</code> provides the same rate but in terms of
          overall buffer pool accesses instead of accesses just to the
          “<span class="quote">old</span>” pages.
        </p></li></ul></div><p>
      Because the effects of these parameters can vary widely based on
      your hardware configuration, your data, and the details of your
      workload, always benchmark to verify the effectiveness before
      changing these settings in any performance-critical or production
      environment.
    </p><p>
      In mixed workloads where most of the activity is OLTP type with
      periodic batch reporting queries which result in large scans,
      setting the value of
      <a href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
      during the batch runs can help keep the working set of the normal
      workload in the buffer pool.
    </p><p>
      When scanning large tables that cannot fit entirely in the buffer
      pool, setting
      <a href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> to a
      small value keeps the data that is only read once from consuming a
      significant portion of the buffer pool. For example, setting
      <code class="literal">innodb_old_blocks_pct=5</code> restricts this data
      that is only read once to 5% of the buffer pool.
    </p><p>
      When scanning small tables that do fit into memory, there is less
      overhead for moving pages around within the buffer pool, so you
      can leave <a href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
      at its default value, or even higher, such as
      <code class="literal">innodb_old_blocks_pct=50</code>.
    </p><p>
      The effect of the
      <a href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
      parameter is harder to predict than the
      <a href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
      parameter, is relatively small, and varies more with the workload.
      To arrive at an optimal value, conduct your own benchmarks if the
      performance improvement from adjusting
      <a href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> is
      not sufficient.
    </p><p>
      For more information about the InnoDB buffer pool, see
      <a href="optimization.html#innodb-buffer-pool" title="7.9.1. The InnoDB Buffer Pool">Section 7.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-recovery"></a>13.4.7.16. Improvements to Crash Recovery Performance</h4></div></div></div><p>
      A number of optimizations speed up certain steps of the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_crash_recovery" target="_top">recovery</a> that happens
      on the next startup after a crash. In particular, scanning the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_redo_log" target="_top">redo log</a> and applying the
      redo log are faster than in MySQL 5.1 and earlier, due to improved
      algorithms for memory management. You do not need to take any
      actions to take advantage of this performance enhancement. If you
      kept the size of your redo log files artificially low because
      recovery took a long time, you can consider increasing the file
      size.
    </p><p>
      For more information about InnoDB recovery, see
      <a href="storage-engines.html#innodb-recovery" title="13.3.7.1. The InnoDB Recovery Process">Section 13.3.7.1, “The <code class="literal">InnoDB</code> Recovery Process”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-performance-schema"></a>13.4.7.17. Integration with MySQL PERFORMANCE_SCHEMA</h4></div></div></div><a class="indexterm" name="id1149402"></a><p>
      Starting with InnoDB 1.1 with MySQL 5.5, you can profile certain
      internal InnoDB operations using the MySQL
      <a href="performance-schema.html" title="Chapter 20. MySQL Performance Schema">Performance Schema
      feature</a>. This type of tuning is primarily for expert users,
      those who push the limits of MySQL performance, read the MySQL
      source code, and evaluate optimization strategies to overcome
      performance bottlenecks. DBAs can also use this feature for
      capacity planning, to see whether their typical workload
      encounters any performance bottlenecks with a particular
      combination of CPU, RAM, and disk storage; and if so, to judge
      whether performance can be improved by increasing the capacity of
      some part of the system.
    </p><p>
      To use this feature to examine InnoDB performance:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          You must be running MySQL 5.5 or higher. You must build the
          database server from source, enabling the Performance Schema
          feature by building with the
          <code class="literal">--with-perfschema</code> option. Since the
          Performance Schema feature introduces some performance
          overhead, you should use it on a test or development system
          rather than on a production system.
        </p></li><li><p>
          You must be running InnoDB 1.1 or higher.
        </p></li><li><p>
          You must be generally familiar with how to use the
          <a href="performance-schema.html" title="Chapter 20. MySQL Performance Schema">Performance Schema
          feature</a>, for example to query tables in the
          <code class="literal">performance_schema</code> database.
        </p></li><li><p>
          Examine the following kinds of InnoDB objects by querying the
          appropriate <code class="literal">performance_schema</code> tables. The
          items associated with InnoDB all contain the substring
          <code class="literal">innodb</code> in the <code class="literal">NAME</code>
          column.
        </p><p>
          For the definitions of the <code class="literal">*_instances</code>
          tables, see
          <a href="performance-schema.html#performance-schema-instance-tables" title="20.7.2. Performance Schema Instance Tables">Section 20.7.2, “Performance Schema Instance Tables”</a>. For the
          definitions of the <code class="literal">*_summary_*</code> tables, see
          <a href="performance-schema.html#performance-schema-summary-tables" title="20.7.4. Performance Schema Summary Tables">Section 20.7.4, “Performance Schema Summary Tables”</a>. For the
          definition of the <code class="literal">thread</code> table, see
          <a href="performance-schema.html#performance-schema-miscellaneous-tables" title="20.7.5. Performance Schema Miscellaneous Tables">Section 20.7.5, “Performance Schema Miscellaneous Tables”</a>. For
          the definition of the <code class="literal">*_current_*</code> and
          <code class="literal">*_history_*</code> tables, see
          <a href="performance-schema.html#performance-schema-waits-tables" title="20.7.3. Performance Schema Wait Event Tables">Section 20.7.3, “Performance Schema Wait Event Tables”</a>.
        </p><div class="itemizedlist"><ul type="circle"><li><p>
              <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_mutex" target="_top">Mutexes</a> in the
              <code class="literal">mutex_instances</code> table. (Mutexes and
              RW-locks related to the <code class="literal">InnoDB</code> buffer
              pool are not included in this coverage; the same applies
              to the output of the <code class="literal">SHOW ENGINE INNODB
              MUTEX</code> command.)
            </p></li><li><p>
              <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_rw_lock" target="_top">RW-locks</a> in the
              <code class="literal">rwlock_instances</code> table.
            </p></li><li><p>
              RW-locks in the <code class="literal">rwlock_instances</code> table.
            </p></li><li><p>
              File I/O operations in the
              <code class="literal">file_instances</code>,
              <code class="literal">file_summary_by_event_name</code>, and
              <code class="literal">file_summary_by_instance</code> tables.
            </p></li><li><p>
              <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_thread" target="_top">Threads</a> in the
              <code class="literal">PROCESSLIST</code> table.
            </p></li></ul></div></li><li><p>
          During performance testing, examine the performance data in
          the <code class="literal">events_waits_current</code> and
          <code class="literal">events_waits_history_long</code> tables. If you
          are interested especially in InnoDB-related objects, use the
          clause <code class="literal">where name like "%innodb%"</code> to see
          just those entries; otherwise, examine the performance
          statistics for the overall MySQL server.
        </p></li><li><p>
          You must be running MySQL 5.5, with the Performance Schema
          enabled by building with the
          <code class="literal">--with-perfschema</code> build option.
        </p></li></ul></div><p>
      For more information about the MySQL Performance Schema, see
      <a href="performance-schema.html" title="Chapter 20. MySQL Performance Schema">Chapter 20, <i>MySQL Performance Schema</i></a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-multiple-buffer-pools"></a>13.4.7.18. Improvements to Performance from Multiple Buffer Pools</h4></div></div></div><a class="indexterm" name="id1149724"></a><p>
      This performance enhancement is primarily useful for people with a
      large <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_buffer_pool" target="_top">buffer pool</a> size,
      typically in the multi-gigabyte range. To take advantage of this
      speedup, you must set the new
      <a href="storage-engines.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
      configuration option, and you might also adjust the
      <a href="storage-engines.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> value.
    </p><p>
      When the InnoDB buffer pool is large, many data requests can be
      satisfied by retrieving from memory. You might encounter
      bottlenecks from multiple threads trying to access the buffer pool
      at once. Starting in InnoDB 1.1 and MySQL 5.5, you can enable
      multiple buffer pools to minimize this contention. Each page that
      is stored in or read from the buffer pool is assigned to one of
      the buffer pools randomly, using a hashing function. Each buffer
      pool manages its own free lists, flush lists, LRUs, and all other
      data structures connected to a buffer pool, and is protected by
      its own buffer pool mutex.
    </p><p>
      To enable this feature, set the
      <code class="literal">innodb_buffer_pool_instances</code> configuration
      option to a value greater than 1 (the default) up to 64 (the
      maximum). This option only takes effect when you set the
      <code class="literal">innodb_buffer_pool_size</code> to a size of 1 gigabyte
      or more. The total size you specify is divided up among all the
      buffer pools. We recommend specifying a combination of
      <code class="literal">innodb_buffer_pool_instances</code> and
      <code class="literal">innodb_buffer_pool_size</code> so that each buffer
      pool instance is at least 1 gigabyte.
    </p><p>
      For more information about the InnoDB buffer pool, see
      <a href="optimization.html#innodb-buffer-pool" title="7.9.1. The InnoDB Buffer Pool">Section 7.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-multiple-rollback-segments"></a>13.4.7.19. Better Scalability with Multiple Rollback Segments</h4></div></div></div><a class="indexterm" name="id1149817"></a><p>
      Starting in InnoDB 1.1 with MySQL 5.5, the limit on concurrent
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_transaction" target="_top">transactions</a> is greatly
      expanded, removing a bottleneck with the InnoDB
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_rollback_segment" target="_top">rollback segment</a> that
      affected high-capacity systems. The limit applies to concurrent
      transactions that change any data; read-only transactions do not
      count against that maximum.
    </p><p>
      The single rollback segment is now divided into 128 segments, each
      of which can support up to 1023 transactions that perform writes,
      for a total of approximately 128K concurrent transactions. The
      original transaction limit was 1023.
    </p><p>
      Each transaction is assigned to one of the rollback segments, and
      remains tied to that rollback segment for the duration. This
      enhancement improves both scalability (higher number of concurrent
      transactions) and performance (less contention when different
      transactions access the rollback segments).
    </p><p>
      To take advantage of this feature, you do not need to create any
      new database or tables, or reconfigure anything. You must do a
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_slow_shutdown" target="_top">slow shutdown</a> before
      upgrading from MySQL 5.1 or earlier, or some time afterward.
      InnoDB makes the required changes inside the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_system_tablespace" target="_top">system tablespace</a>
      automatically, the first time you restart after performing a slow
      shutdown.
    </p><p>
      For more information about performance of InnoDB under high
      transactional load, see
      <a href="optimization.html#optimizing-innodb-transaction-management" title="7.5.2. Optimizing InnoDB Transaction Management">Section 7.5.2, “Optimizing <code class="literal">InnoDB</code> Transaction Management”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-improved-purge-scheduling"></a>13.4.7.20. Better Scalability with Improved Purge Scheduling</h4></div></div></div><a class="indexterm" name="id1149894"></a><p>
      Starting in InnoDB 1.1 with MySQL 5.5, the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_purge" target="_top">purge</a> operations (a type of
      garbage collection) that InnoDB performs automatically can be done
      in a separate thread, rather than as part of the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_master_thread" target="_top">master thread</a>. This
      change improves scalability, because the main database operations
      run independently from maintenance work happening in the
      background.
    </p><p>
      To enable this feature, set the configuration option
      <code class="literal">innodb_purge_threads=1</code>, as opposed to the
      default of 0, which combines the purge operation into the master
      thread.
    </p><p>
      You might not notice a significant speedup, because the purge
      thread might encounter new types of contention; the single purge
      thread really lays the groundwork for further tuning and possibly
      multiple purge threads in the future. There is another new
      configuration option, <code class="literal">innodb_purge_batch_size</code>
      with a default of 20 and maximum of 5000. This option is mainly
      intended for experimentation and tuning of purge operations, and
      should not be interesting to typical users.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a href="optimization.html#optimizing-innodb-diskio" title="7.5.7. Optimizing InnoDB Disk I/O">Section 7.5.7, “Optimizing <code class="literal">InnoDB</code> Disk I/O”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-improved-log-sys-mutex"></a>13.4.7.21. Improved Log Sys Mutex</h4></div></div></div><a class="indexterm" name="id1149964"></a><a class="indexterm" name="id1149973"></a><p>
      This is another performance improvement that comes for free, with
      no user action or configuration needed. The details here are
      intended for performance experts who delve into the InnoDB source
      code, or interpret reports with keywords such as
      “<span class="quote">mutex</span>” and “<span class="quote">log_sys</span>”.
    </p><p>
      The <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_mutex" target="_top">mutex</a> known as the log sys
      mutex has historically done double duty, controlling access to
      internal data structures related to log records and the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_lsn" target="_top">LSN</a>, as well as pages in the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_buffer_pool" target="_top">buffer pool</a> that are
      changed when a
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_mini_transaction" target="_top">mini-transaction</a> is
      committed. Starting in InnoDB 1.1 with MySQL 5.5, these two kinds
      of operations are protected by separate mutexes, with a new
      <code class="literal">log_buf</code> mutex controlling writes to buffer pool
      pages due to mini-transactions.
    </p><p>
      For performance considerations for InnoDB locking operations, see
      <a href="optimization.html#locking-issues" title="7.10. Optimizing Locking Operations">Section 7.10, “Optimizing Locking Operations”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-separate-flush-list-mutex"></a>13.4.7.22. Separate Flush List Mutex</h4></div></div></div><a class="indexterm" name="id1150050"></a><p>
      Starting with InnoDB 1.1 with MySQL 5.5, concurrent access to the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_buffer_pool" target="_top">buffer pool</a> is faster.
      Operations involving the <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_flush_list" target="_top">flush
      list</a>, a data structure related to the buffer pool, are now
      controlled by a separate <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_mutex" target="_top">mutex</a>
      and do not block access to the buffer pool. You do not need to
      configure anything to take advantage of this speedup; it is fully
      automatic.
    </p><p>
      For more information about the InnoDB buffer pool, see
      <a href="optimization.html#innodb-buffer-pool" title="7.9.1. The InnoDB Buffer Pool">Section 7.9.1, “The <code class="literal">InnoDB</code> Buffer Pool”</a>.
    </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-other-changes"></a>13.4.8. Changes for Flexibility, Ease of Use and Reliability</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-file-formats">13.4.8.1. The Barracuda File Format</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-dynamic-parameters">13.4.8.2. Dynamic Control of System Configuration Parameters</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-truncate">13.4.8.3. <code class="literal">TRUNCATE TABLE</code> Reclaims Space</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-strict-mode">13.4.8.4. InnoDB Strict Mode</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-statistics-estimation">13.4.8.5. Controlling Optimizer Statistics Estimation</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-drop-index">13.4.8.6. Better Error Handling when Dropping Indexes</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-show-mutex">13.4.8.7. More Compact Output of <code class="literal">SHOW ENGINE INNODB MUTEX</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-readahead-counters">13.4.8.8. More Read-Ahead Statistics</a></span></dt></dl></div><p>
    This chapter describes several recently added InnoDB features that
    offer new flexibility and improve ease of use, reliability and
    performance. The <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_barracuda" target="_top">Barracuda</a>
    file format improves efficiency for storing large variable-length
    columns, and enables table compression. Configuration options that
    once were unchangeable after startup, are now flexible and can be
    changed dynamically. Some improvements are automatic, such as faster
    and more efficient <code class="literal">TRUNCATE TABLE</code>. Others allow
    you the flexibility to control InnoDB behavior; for example, you can
    control whether certain problems cause errors or just warnings. And
    informational messages and error reporting continue to be made more
    user-friendly.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-other-changes-file-formats"></a>13.4.8.1. The Barracuda File Format</h4></div></div></div><a class="indexterm" name="id1150152"></a><a class="indexterm" name="id1150165"></a><a class="indexterm" name="id1150177"></a><p>
      InnoDB has started using named file formats to improve
      compatibility in upgrade and downgrade situations, or
      heterogeneous systems running different levels of MySQL. Many
      important InnoDB features, such as table compression and the
      <code class="literal">DYNAMIC</code> row format for more efficient BLOB
      storage, require creating tables in the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_barracuda" target="_top">Barracuda</a> file format.
      The original file format, which previously didn't have a name, is
      known now as <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_antelope" target="_top">Antelope</a>.
    </p><p>
      To create new tables that take advantage of the Barracuda
      features, enable that file format using the configuration
      parameter <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>. The
      value of this parameter determines whether a newly created table
      or index can use compression or the new <code class="literal">DYNAMIC</code>
      row format.
    </p><p>
      To preclude the use of new features that would make your database
      inaccessible to the built-in InnoDB in MySQL 5.1 and prior
      releases, omit <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>
      or set it to Antelope.
    </p><p>
      You can set the value of
      <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> on the
      command line when you start <code class="literal">mysqld</code>, or in the
      option file <code class="literal">my.cnf</code> (Unix operating systems) or
      <code class="literal">my.ini</code> (Windows). You can also change it
      dynamically with the <code class="literal">SET GLOBAL</code> statement.
    </p><p>
      For more information about managing file formats, see
      <a href="storage-engines.html#innodb-file-format" title="13.4.4. InnoDB File-Format Management">Section 13.4.4, “InnoDB File-Format Management”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-other-changes-dynamic-parameters"></a>13.4.8.2. Dynamic Control of System Configuration Parameters</h4></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-innodb_file_per_table">13.4.8.2.1. Dynamically Changing <code class="literal">innodb_file_per_table</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-innodb_stats_on_metadata">13.4.8.2.2. Dynamically Changing <code class="literal">innodb_stats_on_metadata</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-innodb_lock_wait_timeout">13.4.8.2.3. Dynamically Changing <code class="literal">innodb_lock_wait_timeout</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-other-changes-innodb_adaptive_hash_index">13.4.8.2.4. Dynamically Changing <code class="literal">innodb_adaptive_hash_index</code></a></span></dt></dl></div><p>
      In MySQL 5.5 and higher, you can change certain system
      configuration parameters without shutting down and restarting the
      server, as was necessary in MySQL 5.1 and lower. This increases
      uptime, and makes it easier to test and prototype new SQL and
      application code. The following sections explain these parameters.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-other-changes-innodb_file_per_table"></a>13.4.8.2.1. Dynamically Changing <code class="literal">innodb_file_per_table</code></h5></div></div></div><a class="indexterm" name="id1150319"></a><a class="indexterm" name="id1150331"></a><p>
        Since MySQL version 4.1, InnoDB has provided two alternatives
        for how tables are stored on disk. You can create a new table
        and its indexes in the shared
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_system_tablespace" target="_top">system
        tablespace</a>, physically stored in the
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_ibdata_file" target="_top">ibdata files</a>. Or, you
        can store a new table and its indexes in a separate tablespace
        (a <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_ibd_file" target="_top">.ibd file</a>). The storage
        layout for each InnoDB table is determined by the the
        configuration parameter
        <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> at
        the time the table is created.
      </p><p>
        In MySQL 5.5 and higher, the configuration parameter
        <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
        dynamic, and can be set <code class="literal">ON</code> or
        <code class="literal">OFF</code> using the <code class="literal">SET GLOBAL</code>.
        Previously, the only way to set this parameter was in the MySQL
        option file (<code class="literal">my.cnf</code> or
        <code class="literal">my.ini</code>), and changing it required shutting
        down and restarting the server.
      </p><p>
        The default setting is <code class="literal">OFF</code>, so new tables and
        indexes are created in the system tablespace. Dynamically
        changing the value of this parameter requires the
        <code class="literal">SUPER</code> privilege and immediately affects the
        operation of all connections.
      </p><p>
        Tables created when
        <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
        enabled can use the
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_barracuda" target="_top">Barracuda</a> file format, and
        <code class="literal">TRUNCATE</code> returns the disk space for those
        tables to the operating system. The Barracuda file format in
        turn enables features such as table compression and the
        <code class="literal">DYNAMIC</code> row format. Tables created when
        <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is off
        cannot use these features. To take advantage of those features
        for an existing table, you can turn on the file-per-table
        setting and run <code class="literal">ALTER TABLE
        <em class="replaceable"><code>t</code></em> ENGINE=INNODB</code> for that
        table.
      </p><p>
        When you redefine the primary key for an InnoDB table, the table
        is re-created using the current settings for
        <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> and
        <a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>. This
        behavior does not apply when adding or dropping InnoDB secondary
        indexes, as explained in <a href="storage-engines.html#innodb-create-index" title="13.4.2. Fast Index Creation in the InnoDB Storage Engine">Section 13.4.2, “Fast Index Creation in the InnoDB Storage Engine”</a>.
        When a secondary index is created without rebuilding the table,
        the index is stored in the same file as the table data,
        regardless of the current
        <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> setting.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-other-changes-innodb_stats_on_metadata"></a>13.4.8.2.2. Dynamically Changing <code class="literal">innodb_stats_on_metadata</code></h5></div></div></div><a class="indexterm" name="id1150529"></a><a class="indexterm" name="id1150541"></a><p>
        In MySQL 5.5 and higher, you can change the setting of
        <a href="storage-engines.html#sysvar_innodb_stats_on_metadata"><code class="literal">innodb_stats_on_metadata</code></a>
        dynamically at runtime, to control whether or not InnoDB
        performs statistics gathering when metadata statements are
        executed. To change the setting, issue the statement
        <code class="literal">SET GLOBAL
        innodb_stats_on_metadata=<em class="replaceable"><code>mode</code></em></code>,
        where <code class="literal"><em class="replaceable"><code>mode</code></em></code> is
        either <code class="literal">ON</code> or <code class="literal">OFF</code> (or
        <code class="literal">1</code> or <code class="literal">0</code>). Changing this
        setting requires the <code class="literal">SUPER</code> privilege and
        immediately affects the operation of all connections.
      </p><p>
        This setting is related to the feature described in
        <a href="storage-engines.html#innodb-other-changes-statistics-estimation" title="13.4.8.5. Controlling Optimizer Statistics Estimation">Section 13.4.8.5, “Controlling Optimizer Statistics Estimation”</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-other-changes-innodb_lock_wait_timeout"></a>13.4.8.2.3. Dynamically Changing <code class="literal">innodb_lock_wait_timeout</code></h5></div></div></div><a class="indexterm" name="id1150631"></a><a class="indexterm" name="id1150644"></a><p>
        The length of time a transaction waits for a resource, before
        giving up and rolling back the statement, is determined by the
        value of the configuration parameter
        <a href="storage-engines.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>.
        (In MySQL 5.0.12 and earlier, the entire transaction was rolled
        back, not just the statement.) Your application can try the
        statement again (usually after waiting for a while), or roll
        back the entire transaction and restart.
      </p><p>
        The error returned when the timeout period is exceeded is:
      </p><pre class="programlisting">ERROR HY000: Lock wait timeout exceeded; try restarting transaction</pre><p>
        In MySQL 5.5 and higher, the configuration parameter
        <a href="storage-engines.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a> can be
        set at runtime with the <code class="literal">SET GLOBAL</code> or
        <code class="literal">SET SESSION</code> statement. Changing the
        <code class="literal">GLOBAL</code> setting requires the
        <code class="literal">SUPER</code> privilege and affects the operation of
        all clients that subsequently connect. Any client can change the
        <code class="literal">SESSION</code> setting for
        <a href="storage-engines.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>, which
        affects only that client.
      </p><p>
        In MySQL 5.1 and earlier, the only way to set this parameter was
        in the MySQL option file (<code class="literal">my.cnf</code> or
        <code class="literal">my.ini</code>), and changing it required shutting
        down and restarting the server.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="innodb-other-changes-innodb_adaptive_hash_index"></a>13.4.8.2.4. Dynamically Changing <code class="literal">innodb_adaptive_hash_index</code></h5></div></div></div><a class="indexterm" name="id1150758"></a><a class="indexterm" name="id1150771"></a><p>
        As described in
        <a href="storage-engines.html#innodb-performance-adaptive_hash_index" title="13.4.7.5. Controlling Adaptive Hash Indexing">Section 13.4.7.5, “Controlling Adaptive Hash Indexing”</a>,
        it may be desirable, depending on your workload, to dynamically
        enable or disable the
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_adaptive_hash_index" target="_top">adaptive hash
        indexing</a> scheme InnoDB uses to improve query performance.
      </p><p>
        The start-up option
        <a href="storage-engines.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a>
        allows the adaptive hash index to be disabled. It is enabled by
        default. You can modify this parameter through the <code class="literal">SET
        GLOBAL</code> statement, without restarting the server.
        Changing the setting requires the <code class="literal">SUPER</code>
        privilege.
      </p><p>
        Disabling the adaptive hash index empties the hash table
        immediately. Normal operations can continue while the hash table
        is emptied, and executing queries that were using the hash table
        access the index B-trees directly instead. When the adaptive
        hash index is re-enabled, the hash table is populated again
        during normal operation.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-other-changes-truncate"></a>13.4.8.3. <code class="literal">TRUNCATE TABLE</code> Reclaims Space</h4></div></div></div><a class="indexterm" name="id1150842"></a><a class="indexterm" name="id1150851"></a><p>
      When you <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_truncate" target="_top">truncate</a> a table
      that is stored in a
      <code class="literal"><a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_ibd_file" target="_top">.ibd</a></code> file
      of its own (because
      <a href="storage-engines.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> was enabled
      when the table was created), and if the table is not referenced in
      a <code class="literal">FOREIGN KEY</code> constraint, the table is dropped
      and re-created in a new <code class="literal">.ibd</code> file. This
      operation is much faster than deleting the rows one by one. The
      operating system can reuse the disk space, in contrast to tables
      within the InnoDB <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_system_tablespace" target="_top">system
      tablespace</a>, where only InnoDB can use the space after they
      are truncated. <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_physical_backup" target="_top">Physical
      backups</a> can also be smaller, without big blocks of unused
      space in the middle of the system tablespace.
    </p><p>
      Previous versions of InnoDB would re-use the existing
      <code class="literal">.ibd</code> file, thus releasing the space only to
      InnoDB for storage management, but not to the operating system.
      Note that when the table is truncated, the count of rows affected
      by the <code class="literal">TRUNCATE TABLE</code> statement is an arbitrary
      number.
    </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
        If there is a referential constraint between two columns in the
        same table, that table can still be truncated using this fast
        technique.
      </p><p xmlns="">
        If there are referential constraints between the table being
        truncated and other tables, the truncate operation fails. This
        is a change to the previous behavior, which would transform the
        <code class="literal">TRUNCATE</code> operation to a
        <code class="literal">DELETE</code> operation that removed all the rows
        and triggered <code class="literal">ON DELETE</code> operations on
        <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_child_table" target="_top">child tables</a>.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-other-changes-strict-mode"></a>13.4.8.4. InnoDB Strict Mode</h4></div></div></div><a class="indexterm" name="id1150989"></a><a class="indexterm" name="id1150998"></a><a class="indexterm" name="id1151007"></a><a class="indexterm" name="id1151019"></a><p>
      To guard against ignored typos and syntax errors in SQL, or other
      unintended consequences of various combinations of operational
      modes and SQL statements, InnoDB provides a
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_strict_mode" target="_top">strict mode</a> of
      operations. In this mode, InnoDB raises error conditions in
      certain cases, rather than issuing a warning and processing the
      specified statement (perhaps with unintended behavior). This is
      analogous to <code class="literal">sql_mode</code> in MySQL, which controls
      what SQL syntax MySQL accepts, and determines whether it silently
      ignores errors, or validates input syntax and data values. Since
      strict mode is relatively new, some statements that execute
      without errors with earlier versions of MySQL might generate
      errors unless you disable strict mode.
    </p><p>
      The setting of InnoDB strict mode affects the handling of syntax
      errors on the <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>,
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> and
      <a href="sql-syntax.html#create-index" title="12.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statements. The
      strict mode also enables a record size check, so that an
      <code class="literal">INSERT</code> or <code class="literal">UPDATE</code> never fails
      due to the record being too large for the selected page size.
    </p><p>
      We recommend running in strict mode when using the
      <code class="literal">ROW_FORMAT</code> and
      <code class="literal">KEY_BLOCK_SIZE</code> clauses on
      <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>,
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, and
      <a href="sql-syntax.html#create-index" title="12.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statements. Without
      strict mode, InnoDB ignores conflicting clauses and creates the
      table or index, with only a warning in the message log. The
      resulting table might have different behavior than you intended,
      such as having no compression when you tried to create a
      compressed table. When InnoDB strict mode is on, such problems
      generate an immediate error and the table or index is not created,
      avoiding a troubleshooting session later.
    </p><p>
      InnoDB strict mode is set with the configuration parameter
      <a href="storage-engines.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a>, which can be
      specified as <code class="literal">on</code> or <code class="literal">off</code>. You
      can set the value on the command line when you start
      <code class="literal">mysqld</code>, or in the configuration file
      <code class="literal">my.cnf</code> or <code class="literal">my.ini</code>. You can
      also enable or disable InnoDB strict mode at run time with the
      statement <code class="literal">SET [GLOBAL|SESSION]
      innodb_strict_mode=<em class="replaceable"><code>mode</code></em></code>,
      where <code class="literal"><em class="replaceable"><code>mode</code></em></code> is either
      <code class="literal">ON</code> or <code class="literal">OFF</code>. Changing the
      <code class="literal">GLOBAL</code> setting requires the
      <code class="literal">SUPER</code> privilege and affects the operation of
      all clients that subsequently connect. Any client can change the
      <code class="literal">SESSION</code> setting for
      <a href="storage-engines.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a>, and the
      setting affects only that client.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-other-changes-statistics-estimation"></a>13.4.8.5. Controlling Optimizer Statistics Estimation</h4></div></div></div><a class="indexterm" name="id1151238"></a><a class="indexterm" name="id1151247"></a><a class="indexterm" name="id1151256"></a><a class="indexterm" name="id1151268"></a><p>
      The MySQL query optimizer uses estimated statistics about key
      distributions to choose the indexes for an execution plan, based
      on the relative
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_selectivity" target="_top">selectivity</a> of the index.
      Certain operations cause InnoDB to sample random pages from each
      index on a table to estimate the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_cardinality" target="_top">cardinality</a> of the index.
      (This technique is known as
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_random_dive" target="_top">random dives</a>.) These
      operations include the <a href="sql-syntax.html#analyze-table" title="12.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE
      TABLE</code></a> statement, the <a href="sql-syntax.html#show-table-status" title="12.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE
      STATUS</code></a> statement, and accessing the table for the first
      time after a restart.
    </p><p>
      To give you control over the quality of the statistics estimate
      (and thus better information for the query optimizer), you can now
      change the number of sampled pages using the parameter
      <a href="storage-engines.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a>.
      Previously, the number of sampled pages was always 8, which could
      be insufficient to produce an accurate estimate, leading to poor
      index choices by the query optimizer. This technique is especially
      important for large tables and tables used in
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_join" target="_top">joins</a>. Unnecessary
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_full_table_scan" target="_top">full table scans</a> for
      such tables can be a substantial performance issue.
    </p><p>
      You can set the global parameter
      <a href="storage-engines.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a>, at
      run time. The default value for this parameter is 8, preserving
      the same behavior as in past releases.
    </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
        The value of
        <a xmlns="" href="storage-engines.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a>
        affects the index sampling for <span xmlns="" class="emphasis"><em>all</em></span> tables
        and indexes. There are the following potentially significant
        impacts when you change the index sample size:
        </p><div xmlns="" class="itemizedlist"><ul type="disc"><li><p>
              Small values like 1 or 2 can result in very inaccurate
              estimates of cardinality.
            </p></li><li><p>
              Increasing the
              <a href="storage-engines.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a>
              value might require more disk reads. Values much larger
              than 8 (say, 100), can cause a big slowdown in the time it
              takes to open a table or execute <code class="literal">SHOW TABLE
              STATUS</code>.
            </p></li><li><p>
              The optimizer might choose very different query plans
              based on different estimates of index selectivity.
            </p></li></ul></div><p xmlns="">
      </p></div><p>
      To disable the cardinality estimation for metadata statements such
      as <code class="literal">SHOW TABLE STATUS</code>, execute the statement
      <code class="literal">SET GLOBAL innodb_stats_on_metadata=OFF</code> (or
      <code class="literal">0</code>). The ability to set this option dynamically
      is also relatively new.
    </p><p>
      All InnoDB tables are opened, and the statistics are re-estimated
      for all associated indexes, when the <code class="literal">mysql</code>
      client starts if the auto-rehash setting is set on (the default).
      To improve the start up time of the <code class="literal">mysql</code>
      client, you can turn auto-rehash off. The auto-rehash feature
      enables automatic name completion of database, table, and column
      names for interactive users.
    </p><p>
      Whatever value of
      <a href="storage-engines.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a> works
      best for a system, set the option and leave it at that value.
      Choose a value that results in reasonably accurate estimates for
      all tables in your database without requiring excessive I/O.
      Because the statistics are automatically recalculated at various
      times other than on execution of <a href="sql-syntax.html#analyze-table" title="12.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE
      TABLE</code></a>, it does not make sense to increase the index
      sample size, run <a href="sql-syntax.html#analyze-table" title="12.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>,
      then decrease sample size again. The more accurate statistics
      calculated by <code class="literal">ANALYZE</code> running with a high value
      of <a href="storage-engines.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a> can
      be wiped away later.
    </p><p>
      Although it is not possible to specify the sample size on a
      per-table basis, smaller tables generally require fewer index
      samples than larger tables do. If your database has many large
      tables, consider using a higher value for
      <a href="storage-engines.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a> than if
      you have mostly smaller tables.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-other-changes-drop-index"></a>13.4.8.6. Better Error Handling when Dropping Indexes</h4></div></div></div><p>
      For optimal performance with DML statements, InnoDB requires an
      index to exist on <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_foreign_key" target="_top">foreign
      key</a> columns, so that <code class="literal">UPDATE</code> and
      <code class="literal">DELETE</code> operations on a
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_parent_table" target="_top">parent table</a> can easily
      check whether corresponding rows exist in the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_child_table" target="_top">child table</a>. MySQL creates
      or drops such indexes automatically when needed, as a side-effect
      of <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>,
      <a href="sql-syntax.html#create-index" title="12.1.13. CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>, and
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements.
    </p><p>
      When you drop an index, InnoDB checks whether the index is not
      used for checking a foreign key constraint. It is still OK to drop
      the index if there is another index that can be used to enforce
      the same constraint. InnoDB prevents you from dropping the last
      index that can enforce a particular referential constraint.
    </p><p>
      The message that reports this error condition is:
    </p><pre class="programlisting">ERROR 1553 (HY000): Cannot drop index '<em class="replaceable"><code>fooIdx</code></em>':
needed in a foreign key constraint
</pre><p>
      This message is friendlier than the earlier message it replaces:
    </p><pre class="programlisting">ERROR 1025 (HY000): Error on rename of '<em class="replaceable"><code>./db2/#sql-18eb_3</code></em>'
to '<em class="replaceable"><code>./db2/foo</code></em>'(errno: 150)
</pre><p>
      A similar change in error reporting applies to an attempt to drop
      the primary key index. For tables without an explicit
      <code class="literal">PRIMARY KEY</code>, InnoDB creates an implicit
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_clustered_index" target="_top">clustered index</a> using
      the first columns of the table that are declared
      <code class="literal">UNIQUE</code> and <code class="literal">NOT NULL</code>. When
      you drop such an index, InnoDB automatically copies the table and
      rebuilds the index using a different <code class="literal">UNIQUE NOT
      NULL</code> group of columns or a system-generated key. Since
      this operation changes the primary key, it uses the slow method of
      copying the table and re-creating the index, rather than the Fast
      Index Creation technique from
      <a href="storage-engines.html#innodb-create-index-implementation" title="13.4.2.3. Implementation Details of Fast Index Creation">Section 13.4.2.3, “Implementation Details of Fast Index Creation”</a>.
    </p><p>
      Previously, an attempt to drop an implicit clustered index (the
      first <code class="literal">UNIQUE NOT NULL</code> index) failed if the
      table did not contain a <code class="literal">PRIMARY KEY</code>:
    </p><pre class="programlisting">ERROR 42000: This table type requires a primary key</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-other-changes-show-mutex"></a>13.4.8.7. More Compact Output of <code class="literal">SHOW ENGINE INNODB MUTEX</code></h4></div></div></div><a class="indexterm" name="id1151696"></a><p>
      The statement <code class="literal">SHOW ENGINE INNODB MUTEX</code> displays
      information about InnoDB <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_mutex" target="_top">mutexes</a>
      and <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_rw_lock" target="_top">rw-locks</a>. Although this
      information is useful for tuning on multi-core systems, the amount
      of output can be overwhelming on systems with a big
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_buffer_pool" target="_top">buffer pool</a>. There is one
      mutex and one rw-lock in each 16K buffer pool block, and there are
      65,536 blocks per gigabyte. It is unlikely that a single block
      mutex or rw-lock from the buffer pool could become a performance
      bottleneck.
    </p><p>
      <code class="literal">SHOW ENGINE INNODB MUTEX</code> now skips the mutexes
      and rw-locks of buffer pool blocks. It also does not list any
      mutexes or rw-locks that have never been waited on
      (<code class="literal">os_waits=0</code>). Thus, <code class="literal">SHOW ENGINE INNODB
      MUTEX</code> only displays information about mutexes and
      rw-locks outside of the buffer pool that have caused at least one
      OS-level <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_wait" target="_top">wait</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-other-changes-readahead-counters"></a>13.4.8.8. More Read-Ahead Statistics</h4></div></div></div><a class="indexterm" name="id1151780"></a><p>
      As described in <a href="storage-engines.html#innodb-performance-read_ahead" title="13.4.7.7. Changes in the Read-Ahead Algorithm">Section 13.4.7.7, “Changes in the Read-Ahead Algorithm”</a>, a
      read-ahead request is an asynchronous I/O request issued in
      anticipation that a page will be used in the near future. Knowing
      how many pages are read through this read-ahead mechanism, and how
      many of them are evicted from the buffer pool without ever being
      accessed, can be useful to help fine-tune the parameter
      <a href="storage-engines.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>.
    </p><p>
      <code class="literal">SHOW ENGINE INNODB STATUS</code> output displays the
      global status variables
      <code class="literal">Innodb_buffer_pool_read_ahead</code> and
      <code class="literal">Innodb_buffer_pool_read_ahead_evicted</code>. These
      variables indicate the number of pages brought into the
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_buffer_pool" target="_top">buffer pool</a> by read-ahead
      requests, and the number of such pages
      <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_eviction" target="_top">evicted</a> from the buffer pool
      without ever being accessed respectively. These counters provide
      global values since the last server restart.
    </p><p>
      <code class="literal">SHOW ENGINE INNODB INNODB STATUS</code> also shows the
      rate at which the read-ahead pages are read in and the rate at
      which such pages are evicted without being accessed. The
      per-second averages are based on the statistics collected since
      the last invocation of <code class="literal">SHOW ENGINE INNODB INNODB
      STATUS</code> and are displayed in the <code class="literal">BUFFER POOL AND
      MEMORY</code> section of the output.
    </p><p>
      Since the InnoDB read-ahead mechanism has been simplified to
      remove random read-ahead, the status variables
      <code class="literal">Innodb_buffer_pool_read_ahead_rnd</code> and
      <code class="literal">Innodb_buffer_pool_read_ahead_seq</code> are no longer
      part of the <code class="literal">SHOW ENGINE INNODB STATUS</code> output.
    </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-installation"></a>13.4.9. Installing the InnoDB Storage Engine</h3></div></div></div><p>
    When you use the InnoDB storage engine 1.1 and above, with MySQL 5.5 and
    above, you do not need to do anything special to install: everything
    comes configured as part of the MySQL source and binary
    distributions. This is a change from earlier releases of the InnoDB
    Plugin, where you were required to match up MySQL and InnoDB version
    numbers and update your build and configuration processes.
  </p><p>
    The InnoDB storage engine is included in the MySQL distribution, starting
    from MySQL 5.1.38. From MySQL 5.1.46 and up, this is the only
    download location for the InnoDB storage engine; it is not available from
    the InnoDB web site.
  </p><p>
    If you used any scripts or configuration files with the earlier
    InnoDB storage engine from the InnoDB web site, be aware that the filename
    of the shared library as supplied by MySQL is
    <code class="literal">ha_innodb_plugin.so</code> or
    <code class="literal">ha_innodb_plugin.dll</code>, as opposed to
    <code class="literal">ha_innodb.so</code> or <code class="literal">ha_innodb.dll</code>
    in the older Plugin downloaded from the InnoDB web site. You might
    need to change the applicable file names in your startup or
    configuration scripts.
  </p><p>
    Because the InnoDB storage engine has now replaced the built-in InnoDB,
    you no longer need to specify options like
    <code class="literal">--ignore-builtin-innodb</code> and
    <code class="literal">--plugin-load</code> during startup.
  </p><p>
    To take best advantage of current InnoDB features, we recommend
    specifying the following options in your configuration file:
  </p><pre class="programlisting">innodb_file_per_table=1
innodb_file_format=barracuda
innodb_strict_mode=1</pre><p>
    For information about these new features, see
    <a href="storage-engines.html#innodb-other-changes-innodb_file_per_table" title="13.4.8.2.1. Dynamically Changing innodb_file_per_table">Section 13.4.8.2.1, “Dynamically Changing <code class="literal">innodb_file_per_table</code>”</a>,
    <a href="storage-engines.html#innodb-file-format" title="13.4.4. InnoDB File-Format Management">Section 13.4.4, “InnoDB File-Format Management”</a>, and
    <a href="storage-engines.html#innodb-other-changes-strict-mode" title="13.4.8.4. InnoDB Strict Mode">Section 13.4.8.4, “InnoDB Strict Mode”</a>. You might need
    to continue to use the previous values for these parameters in some
    replication and similar configurations involving both new and older
    versions of MySQL.
  </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-upgrading"></a>13.4.10. Upgrading the InnoDB Storage Engine</h3></div></div></div><p>
    Prior to MySQL 5.5, some upgrade scenarios involved upgrading the
    separate instance of InnoDB known as the InnoDB Plugin. In MySQL 5.5
    and higher, the features of the InnoDB Plugin have been folded back
    into built-in InnoDB, so the upgrade procedure for InnoDB is the
    same as the one for the MySQL server. For details, see
    <a href="installing.html#upgrading" title="2.11.1. Upgrading MySQL">Section 2.11.1, “Upgrading MySQL”</a>.
  </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-downgrading"></a>13.4.11. Downgrading the InnoDB Storage Engine</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-downgrading-overview">13.4.11.1. Overview</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-downgrading-overview"></a>13.4.11.1. Overview</h4></div></div></div><a class="indexterm" name="id1152085"></a><a class="indexterm" name="id1152094"></a><a class="indexterm" name="id1152107"></a><p>
      Prior to MySQL 5.5, some downgrade scenarios involved switching
      the separate instance of InnoDB known as the InnoDB Plugin back to
      the built-in InnoDB storage engine. In MySQL 5.5 and higher, the
      features of the InnoDB Plugin have been folded back into built-in
      InnoDB, so the downgrade procedure for InnoDB is the same as the
      one for the MySQL server. For details, see
      <a href="installing.html#downgrading" title="2.11.2. Downgrading MySQL">Section 2.11.2, “Downgrading MySQL”</a>.
    </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-changes"></a>13.4.12. InnoDB Storage Engine Change History</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-changes-1x">13.4.12.1. Changes in InnoDB Storage Engine 1.x</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-changes-11">13.4.12.2. Changes in InnoDB Storage Engine 1.1 (April 13, 2010)</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-changes-10x">13.4.12.3. Changes in InnoDB Plugin 1.0.x</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-changes-1x"></a>13.4.12.1. Changes in InnoDB Storage Engine 1.x</h4></div></div></div><p>
      Since InnoDB 1.1 is tightly integrated with MySQL 5.5, for changes
      after the initial InnoDB 1.1 release, see the MySQL 5.5 Reference
      Manual, <a href="news.html#news-5-5-x" title="D.1. Changes in Release 5.5.x (Production)">Section D.1, “Changes in Release 5.5.x (Production)”</a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-changes-11"></a>13.4.12.2. Changes in InnoDB Storage Engine 1.1 (April 13, 2010)</h4></div></div></div><p>
      For an overview of the changes, see
      <a href="http://dev.mysql.com/tech-resources/articles/introduction-to-mysql-55.html" target="_top">this
      introduction article for MySQL 5.5 with InnoDB 1.1</a>. The
      following is a condensed version of the change log.
    </p><p>
      Fix for bug
      <a href="http://bugs.mysql.com/bug.php?id=52580" target="_top">#52580</a>:
      Crash in ha_innobase::open on executing INSERT with concurrent
      ALTER TABLE.
    </p><p>
      Change in MySQL bug
      <a href="http://bugs.mysql.com/bug.php?id=51557" target="_top">#51557</a>
      releases the mutex LOCK_open before ha_innobase::open(), causing
      racing condition for index translation table creation. Fix it by
      adding dict_sys mutex for the operation.
    </p><p>
      Add support for multiple buffer pools.
    </p><p>
      Fix Bug
      <a href="http://bugs.mysql.com/bug.php?id=26590" target="_top">#26590</a>:
      MySQL does not allow more than 1023 open transactions. Create
      additional rollback segments on startup. Reduce the upper limit of
      total rollback segments from 256 to 128. This is because we can't
      use the sign bit. It has not caused problems in the past because
      we only created one segment. InnoDB has always had the capability
      to use the additional rollback segments, therefore this patch is
      backward compatible. The only requirement to maintain backward
      compatibility has been to ensure that the additional segments are
      created after the double write buffer. This is to avoid breaking
      assumptions in the existing code.
    </p><p>
      Implement Performance Schema in InnoDB. Objects in four different
      modules in InnoDB have been performance instrumented, these
      modules are: mutexes, rwlocks, file I/O, and threads We mostly
      preserved the existing APIs, but APIs would point to instrumented
      function wrappers if performance schema is defined. There are 4
      different defines that controls the instrumentation of each
      module. The feature is off by default, and will be compiled in
      with special build option, and requre configure option to turn it
      on when server boots.
    </p><p>
      Implement the buf_pool_watch for DeleteBuffering in the page hash
      table. This serves two purposes. It allows multiple watches to be
      set at the same time (by multiple purge threads) and it removes a
      race condition when the read of a block completes about the time
      the buffer pool watch is being set.
    </p><p>
      Introduce a new mutex to protect flush_list. Redesign mtr_commit()
      in a way that log_sys mutex is not held while all mtr_memos are
      popped and is released just after the modified blocks are inserted
      into the flush_list. This should reduce contention on log_sys
      mutex.
    </p><p>
      Implement the global variable
      <a href="storage-engines.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>, with the
      following values:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <code class="literal">none</code>: buffer nothing
          </p></li><li><p>
            <code class="literal">inserts</code>: buffer inserts (like InnoDB so
            far)
          </p></li><li><p>
            <code class="literal">deletes</code>: buffer delete-marks
          </p></li><li><p>
            <code class="literal">changes</code>: buffer inserts and delete-marks
          </p></li><li><p>
            <code class="literal">purges</code>: buffer delete-marks and deletes
          </p></li><li><p>
            <code class="literal">all</code>: buffer all operations (insert,
            delete-mark, delete)
          </p></li></ul></div><p>
      The default is <code class="literal">all</code>. All values except
      <code class="literal">none</code> and <code class="literal">inserts</code> will make
      InnoDB write new-format records to the insert buffer, even for
      inserts.
    </p><p>
      Provide support for native AIO on Linux.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-changes-10x"></a>13.4.12.3. Changes in InnoDB Plugin 1.0.x</h4></div></div></div><p>
      The InnoDB 1.0.x releases that accompany MySQL 5.1 have their own
      change history. Changes up to InnoDB 1.0.8 are listed at
      <a href="http://dev.mysql.com/doc/innodb-plugin/1.0/en/innodb-changes.html" target="_top">http://dev.mysql.com/doc/innodb-plugin/1.0/en/innodb-changes.html</a>.
      Changes from InnoDB 1.0.9 and up are listed in
      <a href="http://dev.mysql.com/doc/refman/5.1/en/news-5-1-x.html#news-5-1-x" target="_top">Changes in Release 5.1.x (Production)</a>, incorporated into the main MySQL
      change log.
    </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-contrib"></a>13.4.13. Third-Party Software</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-contrib-google">13.4.13.1. Performance Patches from Google</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-contrib-percona">13.4.13.2. Multiple Background I/O Threads Patch from Percona</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-contrib-sun_microsystems">13.4.13.3. Performance Patches from Sun Microsystems</a></span></dt></dl></div><p>
    Oracle acknowledges that certain Third Party and Open Source
    software has been used to develop or is incorporated in the InnoDB
    storage engine. This appendix includes required third-party license
    information.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-contrib-google"></a>13.4.13.1. Performance Patches from Google</h4></div></div></div><p>
      Oracle gratefully acknowledges the following contributions from
      Google, Inc. to improve InnoDB performance:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          Replacing InnoDB's use of Pthreads mutexes with calls to GCC
          atomic builtins, as discussed in
          <a href="storage-engines.html#innodb-performance-latching" title="13.4.7.2. Faster Locking for Improved Scalability">Section 13.4.7.2, “Faster Locking for Improved Scalability”</a>. This change
          means that InnoDB mutex and and rw-lock operations take less
          CPU time, and improves throughput on those platforms where the
          atomic operations are available.
        </p></li><li><p>
          Controlling master thread <code class="literal">I/O</code> rate, as
          discussed in
          <a href="storage-engines.html#innodb-performance-thread_io_rate" title="13.4.7.11. Controlling the Master Thread I/O Rate">Section 13.4.7.11, “Controlling the Master Thread I/O Rate”</a>. The
          master thread in InnoDB is a thread that performs various
          tasks in the background. Historically, InnoDB has used a hard
          coded value as the total <code class="literal">I/O</code> capacity of
          the server. With this change, user can control the number of
          <code class="literal">I/O</code> operations that can be performed per
          second based on their own workload.
        </p></li></ul></div><p>
      Changes from the Google contributions were incorporated in the
      following source code files: <code class="literal">btr0cur.c</code>,
      <code class="literal">btr0sea.c</code>, <code class="literal">buf0buf.c</code>,
      <code class="literal">buf0buf.ic</code>, <code class="literal">ha_innodb.cc</code>,
      <code class="literal">log0log.c</code>, <code class="literal">log0log.h</code>,
      <code class="literal">os0sync.h</code>, <code class="literal">row0sel.c</code>,
      <code class="literal">srv0srv.c</code>, <code class="literal">srv0srv.h</code>,
      <code class="literal">srv0start.c</code>, <code class="literal">sync0arr.c</code>,
      <code class="literal">sync0rw.c</code>, <code class="literal">sync0rw.h</code>,
      <code class="literal">sync0rw.ic</code>, <code class="literal">sync0sync.c</code>,
      <code class="literal">sync0sync.h</code>, <code class="literal">sync0sync.ic</code>,
      and <code class="literal">univ.i</code>.
    </p><p>
      These contributions are incorporated subject to the conditions
      contained in the file <code class="literal">COPYING.Google</code>, which are
      reproduced here.
    </p><pre class="programlisting">Copyright (c) 2008, 2009, Google Inc.
All rights reserved.
Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:
    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above
      copyright notice, this list of conditions and the following
      disclaimer in the documentation and/or other materials
      provided with the distribution.
    * Neither the name of the Google Inc. nor the names of its
      contributors may be used to endorse or promote products
      derived from this software without specific prior written
      permission.
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS“<span class="quote">AS IS</span>” AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-contrib-percona"></a>13.4.13.2. Multiple Background I/O Threads Patch from Percona</h4></div></div></div><p>
      Oracle gratefully acknowledges the contribution of Percona, Inc.
      to improve InnoDB performance by implementing configurable
      background threads, as discussed in
      <a href="storage-engines.html#innodb-performance-multiple_io_threads" title="13.4.7.8. Multiple Background I/O Threads">Section 13.4.7.8, “Multiple Background I/O Threads”</a>. InnoDB
      uses background threads to service various types of I/O requests.
      The change provides another way to make InnoDB more scalable on
      high end systems.
    </p><p>
      Changes from the Percona, Inc. contribution were incorporated in
      the following source code files: <code class="literal">ha_innodb.cc</code>,
      <code class="literal">os0file.c</code>, <code class="literal">os0file.h</code>,
      <code class="literal">srv0srv.c</code>, <code class="literal">srv0srv.h</code>, and
      <code class="literal">srv0start.c</code>.
    </p><p>
      This contribution is incorporated subject to the conditions
      contained in the file <code class="literal">COPYING.Percona</code>, which
      are reproduced here.
    </p><pre class="programlisting">Copyright (c) 2008, 2009, Percona Inc.
All rights reserved.
Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:
    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above
      copyright notice, this list of conditions and the following
      disclaimer in the documentation and/or other materials
      provided with the distribution.
    * Neither the name of the Percona Inc. nor the names of its
      contributors may be used to endorse or promote products
      derived from this software without specific prior written
      permission.
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS“<span class="quote">AS IS</span>” AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-contrib-sun_microsystems"></a>13.4.13.3. Performance Patches from Sun Microsystems</h4></div></div></div><p>
      Oracle gratefully acknowledges the following contributions from
      Sun Microsystems, Inc. to improve InnoDB performance:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          Introducing the PAUSE instruction inside spin loops, as
          discussed in
          <a href="storage-engines.html#innodb-performance-pause_instruction" title="13.4.7.13. Using the PAUSE Instruction in InnoDB Spin Loops">Section 13.4.7.13, “Using the PAUSE Instruction in InnoDB Spin Loops”</a>. This
          change increases performance in high concurrency, CPU-bound
          workloads.
        </p></li><li><p>
          Enabling inlining of functions and prefetch with Sun Studio.
        </p></li></ul></div><p>
      Changes from the Sun Microsystems, Inc. contribution were
      incorporated in the following source code files:
      <code class="literal">univ.i</code>, <code class="literal">ut0ut.c</code>, and
      <code class="literal">ut0ut.h</code>.
    </p><p>
      This contribution is incorporated subject to the conditions
      contained in the file <code class="literal">COPYING.Sun_Microsystems</code>,
      which are reproduced here.
    </p><pre class="programlisting">Copyright (c) 2009, Sun Microsystems, Inc.
All rights reserved.
Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:
    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above
      copyright notice, this list of conditions and the following
      disclaimer in the documentation and/or other materials
      provided with the distribution.
    * Neither the name of Sun Microsystems, Inc. nor the names of its
      contributors may be used to endorse or promote products
      derived from this software without specific prior written
      permission.
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS“<span class="quote">AS IS</span>” AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="innodb-parameter-changes"></a>13.4.14. List of Parameters Changed in InnoDB 1.1 and InnoDB Plugin 1.0</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#innodb-parameters-new">13.4.14.1. New Parameters</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-parameters-deprecated">13.4.14.2. Deprecated Parameters</a></span></dt><dt><span class="section"><a href="storage-engines.html#innodb-parameters-new-defaults">13.4.14.3. Parameters with New Defaults</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-parameters-new"></a>13.4.14.1. New Parameters</h4></div></div></div><a class="indexterm" name="id1152875"></a><p>
      Throughout the course of development, InnoDB 1.1 and its
      predecessor the InnoDB Plugin introduced new configuration
      parameters. The following table summarizes those parameters:
    </p><div class="table"><a name="innodb-new-parameter-summary-table"></a><p class="title"><b>Table 13.8. InnoDB 1.1 New Parameter Summary</b></p><table summary="InnoDB 1.1 New Parameter Summary" border="1"><colgroup><col><col><col><col><col><col><col></colgroup><thead><tr><th>Name</th><th>Cmd-Line</th><th>Option File</th><th>System Var</th><th>Scope</th><th>Dynamic</th><th>Default</th></tr></thead><tbody><tr><td><code class="literal">innodb_adaptive_flushing</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">YES</code></td><td><code class="literal">TRUE</code></td></tr><tr><td><code class="literal">innodb_buffer_pool_instances</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">YES</code></td><td><code class="literal">TRUE</code></td></tr><tr><td><code class="literal">innodb_change_buffering</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">YES</code></td><td><code class="literal">inserts</code></td></tr><tr><td><code class="literal">innodb_file_format</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">YES</code></td><td><code class="literal">Antelope</code></td></tr><tr><td><code class="literal">innodb_file_format_check</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">NO</code></td><td><code class="literal">1</code></td></tr><tr><td><code class="literal">innodb_file_format_max</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">YES</code></td><td><code class="literal">Antelope</code> for a new database;
              <code class="literal">Barracuda</code> if any tables using that file
              format exist in the database</td></tr><tr><td><code class="literal">innodb_io_capacity</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">YES</code></td><td><code class="literal">200</code></td></tr><tr><td><code class="literal">innodb_old_blocks_pct</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">YES</code></td><td><code class="literal">37</code></td></tr><tr><td><code class="literal">innodb_old_blocks_time</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">YES</code></td><td><code class="literal">0</code></td></tr><tr><td><code class="literal">innodb_purge_batch_size</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">YES</code></td><td><code class="literal">0</code></td></tr><tr><td><code class="literal">innodb_purge_threads</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">YES</code></td><td><code class="literal">0</code></td></tr><tr><td><code class="literal">innodb_read_ahead_threshold</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">YES</code></td><td><code class="literal">56</code></td></tr><tr><td><code class="literal">innodb_read_io_threads</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">NO</code></td><td><code class="literal">4</code></td></tr><tr><td><code class="literal">innodb_spin_wait_delay</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">YES</code></td><td><code class="literal">6</code></td></tr><tr><td><code class="literal">innodb_stats_sample_pages</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">YES</code></td><td><code class="literal">8</code></td></tr><tr><td><code class="literal">innodb_strict_mode</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL|SESSION</code></td><td><code class="literal">YES</code></td><td><code class="literal">FALSE</code></td></tr><tr><td><code class="literal">innodb_use_native_aio</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">NO</code></td><td><code class="literal">TRUE</code></td></tr><tr><td><code class="literal">innodb_use_sys_malloc</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">NO</code></td><td><code class="literal">TRUE</code></td></tr><tr><td><code class="literal">innodb_write_io_threads</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">YES</code></td><td><code class="literal">GLOBAL</code></td><td><code class="literal">NO</code></td><td><code class="literal">4</code></td></tr></tbody></table></div><div class="itemizedlist"><ul type="disc"><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a></strong></span>
        </p><p>
          Whether InnoDB uses a new algorithm to estimate the required
          rate of flushing. The default value is
          <code class="literal">TRUE</code>. This parameter was added in
          InnoDB storage engine 1.0.4. See
          <a href="storage-engines.html#innodb-performance-adaptive_flushing" title="13.4.7.12. Controlling the Flushing Rate of Dirty Pages">Section 13.4.7.12, “Controlling the Flushing Rate of Dirty Pages”</a> for
          more information.
        </p></li><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a></strong></span>
        </p><p>
          Whether InnoDB performs insert buffering. The default value is
          <code class="literal">"inserts"</code> (buffer insert operations). This
          parameter was added in InnoDB storage engine 1.0.3. See
          <a href="storage-engines.html#innodb-performance-change_buffering" title="13.4.7.4. Controlling InnoDB Change Buffering">Section 13.4.7.4, “Controlling InnoDB Change Buffering”</a> for more
          information.
        </p></li><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a></strong></span>
        </p><p>
          The default file format for new InnoDB tables. The default is
          Antelope. To enable support for table compression, change it
          to Barracuda. This parameter was added in InnoDB storage engine
          1.0.1. See <a href="storage-engines.html#innodb-file-format-enabling" title="13.4.4.1. Enabling File Formats">Section 13.4.4.1, “Enabling File Formats”</a> for
          more information.
        </p></li><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a></strong></span>
          and
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a></strong></span>
        </p><p>
          Controls whether InnoDB performs file format compatibility
          checking when opening a database. The default value is
          <code class="literal">innodb-file-format-check=1</code>, with
          <a href="storage-engines.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a> set to
          the highest format that is used in the database (either
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_barracuda" target="_top">Barracuda</a> or
          <a href="http://dev.mysql.com/doc/refman/5.5/en/glossary.html#glos_antelope" target="_top">Antelope</a>). See
          <a href="storage-engines.html#innodb-file-format-compatibility-checking" title="13.4.4.2.1. Compatibility Check When InnoDB Is Started">Section 13.4.4.2.1, “Compatibility Check When InnoDB Is Started”</a>
          for more information.
        </p></li><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a></strong></span>
        </p><p>
          The number of <code class="literal">I/O</code> operations that can be
          performed per second. The allowable value range is any number
          100 or greater, and the default value is
          <code class="literal">200</code>. This parameter was added in
          InnoDB storage engine 1.0.4. To reproduce the earlier behavior, use
          a value of 100. See
          <a href="storage-engines.html#innodb-performance-thread_io_rate" title="13.4.7.11. Controlling the Master Thread I/O Rate">Section 13.4.7.11, “Controlling the Master Thread I/O Rate”</a> for more
          information.
        </p></li><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a></strong></span>
        </p><p>
          Controls the desired percentage of “<span class="quote">old</span>” blocks
          in the LRU list of the buffer pool. The default value is
          <code class="literal">37</code> and the allowable value range is
          <code class="literal">5 to 95</code>. This parameter was added in
          InnoDB storage engine 1.0.5. See
          <a href="storage-engines.html#innodb-performance-midpoint_insertion" title="13.4.7.15. Making Buffer Pool Scan Resistant">Section 13.4.7.15, “Making Buffer Pool Scan Resistant”</a> for
          more information.
        </p></li><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a></strong></span>
        </p><p>
          The time in milliseconds since the first access to a block
          during which it can be accessed again without being made
          “<span class="quote">young</span>”. The default value is
          <code class="literal">0</code> which means that blocks are moved to the
          “<span class="quote">young</span>” end of the LRU list at the first access.
          This parameter was added in InnoDB storage engine 1.0.5. See
          <a href="storage-engines.html#innodb-performance-midpoint_insertion" title="13.4.7.15. Making Buffer Pool Scan Resistant">Section 13.4.7.15, “Making Buffer Pool Scan Resistant”</a> for
          more information.
        </p></li><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a></strong></span>
        </p><p>
          Control the sensitivity of the linear read ahead. The
          allowable value range is <code class="literal">0</code> to
          <code class="literal">64</code> and the default value is
          <code class="literal">56</code>. This parameter was added in
          InnoDB storage engine 1.0.4. See
          <a href="storage-engines.html#innodb-performance-read_ahead" title="13.4.7.7. Changes in the Read-Ahead Algorithm">Section 13.4.7.7, “Changes in the Read-Ahead Algorithm”</a> for more
          information.
        </p></li><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a></strong></span>
        </p><p>
          The number of background <code class="literal">I/O</code> threads used
          for reads. The allowable value range is <code class="literal">1</code>
          to <code class="literal">64</code> and the default value is
          <code class="literal">4</code>. This parameter was added in
          InnoDB storage engine 1.0.4. See
          <a href="storage-engines.html#innodb-performance-multiple_io_threads" title="13.4.7.8. Multiple Background I/O Threads">Section 13.4.7.8, “Multiple Background I/O Threads”</a> for
          more information.
        </p></li><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a></strong></span>
        </p><p>
          Maximum delay between polling for a spin lock. The allowable
          value range is <code class="literal">0</code> (meaning unlimited) or
          positive integers and the default value is
          <code class="literal">6</code>. This parameter was added in
          InnoDB storage engine 1.0.4. See
          <a href="storage-engines.html#innodb-performance-spin_lock_polling" title="13.4.7.14. Control of Spin Lock Polling">Section 13.4.7.14, “Control of Spin Lock Polling”</a> for
          more information.
        </p></li><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a></strong></span>
        </p><p>
          The number of index pages to sample when calculating
          statistics. The allowable value range is
          <code class="literal">1-unlimited</code> and the default value is
          <code class="literal">8</code>. This parameter was added in
          InnoDB storage engine 1.0.2. See
          <a href="storage-engines.html#innodb-other-changes-statistics-estimation" title="13.4.8.5. Controlling Optimizer Statistics Estimation">Section 13.4.8.5, “Controlling Optimizer Statistics Estimation”</a>
          for more information.
        </p></li><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a></strong></span>
        </p><p>
          Whether InnoDB raises error conditions in certain cases,
          rather than issuing a warning. This parameter was added in
          InnoDB storage engine 1.0.2. See
          <a href="storage-engines.html#innodb-other-changes-strict-mode" title="13.4.8.4. InnoDB Strict Mode">Section 13.4.8.4, “InnoDB Strict Mode”</a> for more
          information.
        </p></li><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a></strong></span>
        </p><p>
          Whether InnoDB uses its own memory allocator or an allocator
          of the operating system. The default value is
          <code class="literal">ON</code> (use an allocator of the underlying
          system). This parameter was added in InnoDB storage engine 1.0.3.
          See <a href="storage-engines.html#innodb-performance-use_sys_malloc" title="13.4.7.3. Using Operating System Memory Allocators">Section 13.4.7.3, “Using Operating System Memory Allocators”</a> for
          more information.
        </p></li><li><p>
          <span class="bold"><strong><a href="storage-engines.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a></strong></span>
        </p><p>
          The number of background <code class="literal">I/O</code> threads used
          for writes. The allowable value range is <code class="literal">1</code>
          to <code class="literal">64</code> and the default value is
          <code class="literal">4</code>. This parameter was added in
          InnoDB storage engine 1.0.4. See
          <a href="storage-engines.html#innodb-performance-multiple_io_threads" title="13.4.7.8. Multiple Background I/O Threads">Section 13.4.7.8, “Multiple Background I/O Threads”</a> for
          more information.
        </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-parameters-deprecated"></a>13.4.14.2. Deprecated Parameters</h4></div></div></div><a class="indexterm" name="id1154503"></a><p>
      Beginning in InnoDB storage engine 1.0.4, the following configuration
      parameter has been removed:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          <span class="bold"><strong><a href="http://dev.mysql.com/doc/refman/5.1/en/innodb-parameters.html#sysvar_innodb_file_io_threads" target="_top"><code class="literal">innodb_file_io_threads</code></a></strong></span>
        </p><p>
          This parameter has been replaced by two new parameters
          <a href="storage-engines.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> and
          <a href="storage-engines.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>. See
          <a href="storage-engines.html#innodb-performance-multiple_io_threads" title="13.4.7.8. Multiple Background I/O Threads">Section 13.4.7.8, “Multiple Background I/O Threads”</a> for
          more information.
        </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="innodb-parameters-new-defaults"></a>13.4.14.3. Parameters with New Defaults</h4></div></div></div><a class="indexterm" name="id1154572"></a><a class="indexterm" name="id1154581"></a><a class="indexterm" name="id1154594"></a><a class="indexterm" name="id1154606"></a><a class="indexterm" name="id1154619"></a><a class="indexterm" name="id1154632"></a><a class="indexterm" name="id1154644"></a><a class="indexterm" name="id1154657"></a><a class="indexterm" name="id1154669"></a><p>
      For better out-of-the-box performance, the following InnoDB
      configuration parameters have new default values since MySQL 5.1:
    </p><div class="table"><a name="innodb-parameters-new-defaults-table"></a><p class="title"><b>Table 13.9. InnoDB Parameters with New Defaults</b></p><table summary="InnoDB Parameters with New Defaults" border="1"><colgroup><col align="left"><col align="right"><col align="right"></colgroup><thead><tr><th align="left">Name</th><th align="right">Old Default</th><th align="right">New Default</th></tr></thead><tbody><tr><td align="left"><code class="literal">innodb_additional_mem_pool_size</code></td><td align="right"><code class="literal">1MB</code></td><td align="right"><code class="literal">8MB</code></td></tr><tr><td align="left"><code class="literal">innodb_buffer_pool_size</code></td><td align="right"><code class="literal">8MB</code></td><td align="right"><code class="literal">128MB</code></td></tr><tr><td align="left"><code class="literal">innodb_change_buffering</code></td><td align="right"><code class="literal">inserts</code></td><td align="right"><code class="literal">all</code></td></tr><tr><td align="left"><code class="literal">innodb_file_format_check</code></td><td align="right"><code class="literal">ON</code></td><td align="right"><code class="literal">1</code></td></tr><tr><td align="left"><code class="literal">innodb_log_buffer_size</code></td><td align="right"><code class="literal">1MB</code></td><td align="right"><code class="literal">8MB</code></td></tr><tr><td align="left"><code class="literal">innodb_max_dirty_pages_pct</code></td><td align="right"><code class="literal">90</code></td><td align="right"><code class="literal">75</code></td></tr><tr><td align="left"><code class="literal">innodb_sync_spin_loops</code></td><td align="right"><code class="literal">20</code></td><td align="right"><code class="literal">30</code></td></tr><tr><td align="left"><code class="literal">innodb_thread_concurrency</code></td><td align="right"><code class="literal">8</code></td><td align="right"><code class="literal">0</code></td></tr></tbody></table></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="myisam-storage-engine"></a>13.5. The <code class="literal">MyISAM</code> Storage Engine</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#myisam-start">13.5.1. <code class="literal">MyISAM</code> Startup Options</a></span></dt><dt><span class="section"><a href="storage-engines.html#key-space">13.5.2. Space Needed for Keys</a></span></dt><dt><span class="section"><a href="storage-engines.html#myisam-table-formats">13.5.3. <code class="literal">MyISAM</code> Table Storage Formats</a></span></dt><dt><span class="section"><a href="storage-engines.html#myisam-table-problems">13.5.4. <code class="literal">MyISAM</code> Table Problems</a></span></dt></dl></div><a class="indexterm" name="id1154983"></a><a class="indexterm" name="id1154992"></a><p>
    Before MySQL 5.5.5, <code class="literal">MyISAM</code> is the default storage
    engine. (The default was changed to <code class="literal">InnoDB</code> in
    MySQL 5.5.5.) <code class="literal">MyISAM</code> is based on the older (and
    no longer available) <code class="literal">ISAM</code> storage engine but has
    many useful extensions.
  </p><div class="table"><a name="id1155033"></a><p class="title"><b>Table 13.10. <code class="literal">MyISAM</code> Storage Engine
    Features</b></p><table summary="MyISAM Storage Engine
    Features" border="1"><colgroup><col><col><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Storage limits</strong></span></td><td>256TB</td><td><span class="bold"><strong>Transactions</strong></span></td><td>No</td><td><span class="bold"><strong>Locking granularity</strong></span></td><td>Table</td></tr><tr><td><span class="bold"><strong>MVCC</strong></span></td><td>No</td><td><span class="bold"><strong>Geospatial data type support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Geospatial indexing support</strong></span></td><td>Yes</td></tr><tr><td><span class="bold"><strong>B-tree indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>Hash indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Full-text search indexes</strong></span></td><td>Yes</td></tr><tr><td><span class="bold"><strong>Clustered indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Data caches</strong></span></td><td>No</td><td><span class="bold"><strong>Index caches</strong></span></td><td>Yes</td></tr><tr><td><span class="bold"><strong>Compressed data</strong></span></td><td>Yes<sup>[<a name="id1155213" href="#ftn.id1155213">a</a>]</sup></td><td><span class="bold"><strong>Encrypted data<sup>[<a name="id1155224" href="#ftn.id1155224">b</a>]</sup></strong></span></td><td>Yes</td><td><span class="bold"><strong>Cluster database support</strong></span></td><td>No</td></tr><tr><td><span class="bold"><strong>Replication support<sup>[<a name="id1155249" href="#ftn.id1155249">c</a>]</sup></strong></span></td><td>Yes</td><td><span class="bold"><strong>Foreign key support</strong></span></td><td>No</td><td><span class="bold"><strong>Backup / point-in-time recovery<sup>[<a name="id1155273" href="#ftn.id1155273">d</a>]</sup></strong></span></td><td>Yes</td></tr><tr><td><span class="bold"><strong>Query cache support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Update statistics for data dictionary</strong></span></td><td>Yes</td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr></tbody><tbody class="footnotes"><tr><td colspan="6"><div class="footnote"><p><sup>[<a name="ftn.id1155213" href="#id1155213">a</a>] </sup>Compressed MyISAM tables are supported only when using the compressed row format. Tables using the compressed row format with MyISAM are read only.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1155224" href="#id1155224">b</a>] </sup>Implemented in the server (via encryption functions), rather than in the storage engine.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1155249" href="#id1155249">c</a>] </sup>Implemented in the server, rather than in the storage product.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1155273" href="#id1155273">d</a>] </sup>Implemented in the server, rather than in the storage product.</p></div></td></tr></tbody></table></div><p>
    Each <code class="literal">MyISAM</code> table is stored on disk in three
    files. The files have names that begin with the table name and have
    an extension to indicate the file type. An <code class="filename">.frm</code>
    file stores the table format. The data file has an
    <code class="filename">.MYD</code> (<code class="literal">MYData</code>) extension. The
    index file has an <code class="filename">.MYI</code>
    (<code class="literal">MYIndex</code>) extension.
  </p><p>
    To specify explicitly that you want a <code class="literal">MyISAM</code>
    table, indicate that with an <code class="literal">ENGINE</code> table option:
  </p><pre class="programlisting">CREATE TABLE t (i INT) ENGINE = MYISAM;</pre><p>
    As of MySQL 5.5.5, it is normally necessary to use
    <code class="literal">ENGINE</code> to specify the <code class="literal">MyISAM</code>
    storage engine because <code class="literal">InnoDB</code> is the default
    engine. Before 5.5.5, this is unnecessary because
    <code class="literal">MyISAM</code> is the default engine unless the default
    has been changed. To ensure that <code class="literal">MyISAM</code> is used
    in situations where the default might have been changed, include the
    <code class="literal">ENGINE</code> option explicitly.
  </p><p>
    You can check or repair <code class="literal">MyISAM</code> tables with the
    <a href="programs.html#mysqlcheck" title="4.5.3. mysqlcheck — A Table Maintenance Program"><span><strong class="command">mysqlcheck</strong></span></a> client or <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a>
    utility. You can also compress <code class="literal">MyISAM</code> tables with
    <a href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span><strong class="command">myisampack</strong></span></a> to take up much less space. See
    <a href="programs.html#mysqlcheck" title="4.5.3. mysqlcheck — A Table Maintenance Program">Section 4.5.3, “<span><strong class="command">mysqlcheck</strong></span> — A Table Maintenance Program”</a>, <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility">Section 4.6.3, “<span><strong class="command">myisamchk</strong></span> — MyISAM Table-Maintenance Utility”</a>, and
    <a href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables">Section 4.6.5, “<span><strong class="command">myisampack</strong></span> — Generate Compressed, Read-Only MyISAM Tables”</a>.
  </p><p>
    <code class="literal">MyISAM</code> tables have the following characteristics:
  </p><div class="itemizedlist"><ul type="disc"><li><p>
        All data values are stored with the low byte first. This makes
        the data machine and operating system independent. The only
        requirements for binary portability are that the machine uses
        two's-complement signed integers and IEEE floating-point format.
        These requirements are widely used among mainstream machines.
        Binary compatibility might not be applicable to embedded
        systems, which sometimes have peculiar processors.
      </p><p>
        There is no significant speed penalty for storing data low byte
        first; the bytes in a table row normally are unaligned and it
        takes little more processing to read an unaligned byte in order
        than in reverse order. Also, the code in the server that fetches
        column values is not time critical compared to other code.
      </p></li><li><p>
        All numeric key values are stored with the high byte first to
        permit better index compression.
      </p></li><li><p>
        Large files (up to 63-bit file length) are supported on file
        systems and operating systems that support large files.
      </p></li><li><p>
        There is a limit of
        (2<sup>32</sup>)<sup>2</sup>
        (1.844E+19) rows in a <code class="literal">MyISAM</code> table.
      </p></li><li><p>
        The maximum number of indexes per <code class="literal">MyISAM</code>
        table is 64.
      </p><p>
        The maximum number of columns per index is 16.
      </p></li><li><p>
        The maximum key length is 1000 bytes. This can also be changed
        by changing the source and recompiling. For the case of a key
        longer than 250 bytes, a larger key block size than the default
        of 1024 bytes is used.
      </p></li><li><p>
        When rows are inserted in sorted order (as when you are using an
        <code class="literal">AUTO_INCREMENT</code> column), the index tree is
        split so that the high node only contains one key. This improves
        space utilization in the index tree.
      </p></li><li><p>
        Internal handling of one <code class="literal">AUTO_INCREMENT</code>
        column per table is supported. <code class="literal">MyISAM</code>
        automatically updates this column for
        <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> and
        <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> operations. This makes
        <code class="literal">AUTO_INCREMENT</code> columns faster (at least 10%).
        Values at the top of the sequence are not reused after being
        deleted. (When an <code class="literal">AUTO_INCREMENT</code> column is
        defined as the last column of a multiple-column index, reuse of
        values deleted from the top of a sequence does occur.) The
        <code class="literal">AUTO_INCREMENT</code> value can be reset with
        <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> or
        <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a>.
      </p></li><li><p>
        Dynamic-sized rows are much less fragmented when mixing deletes
        with updates and inserts. This is done by automatically
        combining adjacent deleted blocks and by extending blocks if the
        next block is deleted.
      </p></li><li><p>
        <code class="literal">MyISAM</code> supports concurrent inserts: If a
        table has no free blocks in the middle of the data file, you can
        <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> new rows into it at the
        same time that other threads are reading from the table. A free
        block can occur as a result of deleting rows or an update of a
        dynamic length row with more data than its current contents.
        When all free blocks are used up (filled in), future inserts
        become concurrent again. See
        <a href="optimization.html#concurrent-inserts" title="7.10.3. Concurrent Inserts">Section 7.10.3, “Concurrent Inserts”</a>.
      </p></li><li><p>
        You can put the data file and index file in different
        directories on different physical devices to get more speed with
        the <code class="literal">DATA DIRECTORY</code> and <code class="literal">INDEX
        DIRECTORY</code> table options to <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a>. See <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax">Section 12.1.17, “<code class="literal">CREATE TABLE</code> Syntax”</a>.
      </p></li><li><p>
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> and
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a> columns can be indexed.
      </p></li><li><p>
        <code class="literal">NULL</code> values are permitted in indexed columns.
        This takes 0 to 1 bytes per key.
      </p></li><li><p>
        Each character column can have a different character set. See
        <a href="globalization.html#charset" title="9.1. Character Set Support">Section 9.1, “Character Set Support”</a>.
      </p></li><li><p>
        There is a flag in the <code class="literal">MyISAM</code> index file that
        indicates whether the table was closed correctly. If
        <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> is started with the
        <a href="server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a> option,
        <code class="literal">MyISAM</code> tables are automatically checked when
        opened, and are repaired if the table wasn't closed properly.
      </p></li><li><p>
        <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> marks tables as checked if you run
        it with the <a href="programs.html#option_myisamchk_update-state"><code class="option">--update-state</code></a>
        option. <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk --fast</strong></span></a> checks only those
        tables that don't have this mark.
      </p></li><li><p>
        <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk --analyze</strong></span></a> stores statistics for
        portions of keys, as well as for entire keys.
      </p></li><li><p>
        <a href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span><strong class="command">myisampack</strong></span></a> can pack
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> and
        <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> columns.
      </p></li></ul></div><p>
    <code class="literal">MyISAM</code> also supports the following features:
  </p><div class="itemizedlist"><ul type="disc"><li><p>
        Support for a true <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> type;
        a <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> column starts with a
        length stored in one or two bytes.
      </p></li><li><p>
        Tables with <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> columns may
        have fixed or dynamic row length.
      </p></li><li><p>
        The sum of the lengths of the
        <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> and
        <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">CHAR</code></a> columns in a table may be up
        to 64KB.
      </p></li><li><p>
        Arbitrary length <code class="literal">UNIQUE</code> constraints.
      </p></li></ul></div><h3><a name="id1155932"></a>
    Additional Resources
  </h3><div class="itemizedlist"><ul type="disc"><li><p>
        A forum dedicated to the <code class="literal">MyISAM</code> storage
        engine is available at <a href="http://forums.mysql.com/list.php?21" target="_top">http://forums.mysql.com/list.php?21</a>.
      </p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="myisam-start"></a>13.5.1. <code class="literal">MyISAM</code> Startup Options</h3></div></div></div><p>
      The following options to <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> can be used to
      change the behavior of <code class="literal">MyISAM</code> tables. For
      additional information, see <a href="server-administration.html#server-options" title="5.1.2. Server Command Options">Section 5.1.2, “Server Command Options”</a>.
    </p><div class="table"><a name="id1155991"></a><p class="title"><b>Table 13.11. <code class="literal">MyISAM</code> Option/Variable
      Reference</b></p><table summary="MyISAM Option/Variable
      Reference" border="1"><colgroup><col><col><col><col><col><col><col></colgroup><thead><tr><th>Name</th><th>Cmd-Line</th><th>Option file</th><th>System Var</th><th>Status Var</th><th>Var Scope</th><th>Dynamic</th></tr></thead><tbody><tr><td><a href="server-administration.html#sysvar_bulk_insert_buffer_size">bulk_insert_buffer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td><a href="server-administration.html#sysvar_concurrent_insert">concurrent_insert</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="server-administration.html#option_mysqld_delay-key-write">delay-key-write</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>Yes</td></tr><tr><td> - <span class="emphasis"><em>Variable</em></span>: delay_key_write</td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="server-administration.html#sysvar_have_rtree_keys">have_rtree_keys</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#sysvar_key_buffer_size">key_buffer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="server-administration.html#option_mysqld_log-isam">log-isam</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td><a href="server-administration.html#option_mysqld_myisam-block-size">myisam-block-size</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td><a href="server-administration.html#sysvar_myisam_data_pointer_size">myisam_data_pointer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="server-administration.html#sysvar_myisam_max_sort_file_size">myisam_max_sort_file_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="server-administration.html#sysvar_myisam_mmap_size">myisam_mmap_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#option_mysqld_myisam-recover">myisam-recover</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> - <span class="emphasis"><em>Variable</em></span>: myisam_recover_options</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td><a href="server-administration.html#option_mysqld_myisam-recover-options">myisam-recover-options</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> - <span class="emphasis"><em>Variable</em></span>: myisam_recover_options</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td><a href="server-administration.html#sysvar_myisam_recover_options">myisam_recover_options</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td><a href="server-administration.html#sysvar_myisam_repair_threads">myisam_repair_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td><a href="server-administration.html#sysvar_myisam_sort_buffer_size">myisam_sort_buffer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td><a href="server-administration.html#sysvar_myisam_stats_method">myisam_stats_method</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td><a href="server-administration.html#sysvar_myisam_use_mmap">myisam_use_mmap</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td><a href="server-administration.html#option_mysqld_skip-concurrent-insert">skip-concurrent-insert</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td> - <span class="emphasis"><em>Variable</em></span>: concurrent_insert</td><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr><tr><td><a href="server-administration.html#sysvar_tmp_table_size">tmp_table_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr></tbody></table></div><div class="itemizedlist"><ul type="disc"><li><p>
          <a class="indexterm" name="id1156672"></a>

          <a class="indexterm" name="id1156685"></a>

          <a href="server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options=<em class="replaceable"><code>mode</code></em></code></a>
        </p><p>
          Set the mode for automatic recovery of crashed
          <code class="literal">MyISAM</code> tables.
        </p></li><li><p>
          <a class="indexterm" name="id1156723"></a>

          <a class="indexterm" name="id1156735"></a>

          <a href="server-administration.html#option_mysqld_delay-key-write"><code class="option">--delay-key-write=ALL</code></a>
        </p><p>
          Don't flush key buffers between writes for any
          <code class="literal">MyISAM</code> table.
        </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
            If you do this, you should not access
            <code class="literal">MyISAM</code> tables from another program (such
            as from another MySQL server or with
            <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a>) when the tables are in use.
            Doing so risks index corruption. Using
            <a href="server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a> does not
            eliminate this risk.
          </p></div></li></ul></div><p>
      The following system variables affect the behavior of
      <code class="literal">MyISAM</code> tables. For additional information, see
      <a href="server-administration.html#server-system-variables" title="5.1.3. Server System Variables">Section 5.1.3, “Server System Variables”</a>.
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          <a href="server-administration.html#sysvar_bulk_insert_buffer_size"><code class="literal">bulk_insert_buffer_size</code></a>
        </p><p>
          The size of the tree cache used in bulk insert optimization.
        </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
            This is a limit <span class="emphasis"><em>per thread</em></span>!
          </p></div></li><li><p>
          <a href="server-administration.html#sysvar_myisam_max_sort_file_size"><code class="literal">myisam_max_sort_file_size</code></a>
        </p><p>
          The maximum size of the temporary file that MySQL is permitted
          to use while re-creating a <code class="literal">MyISAM</code> index
          (during <a href="sql-syntax.html#repair-table" title="12.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>,
          <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, or
          <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD DATA
          INFILE</code></a>). If the file size would be larger than this
          value, the index is created using the key cache instead, which
          is slower. The value is given in bytes.
        </p></li><li><p>
          <a href="server-administration.html#sysvar_myisam_sort_buffer_size"><code class="literal">myisam_sort_buffer_size</code></a>
        </p><p>
          Set the size of the buffer used when recovering tables.
        </p></li></ul></div><p>
      Automatic recovery is activated if you start
      <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> with the
      <a href="server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a> option. In
      this case, when the server opens a <code class="literal">MyISAM</code>
      table, it checks whether the table is marked as crashed or whether
      the open count variable for the table is not 0 and you are running
      the server with external locking disabled. If either of these
      conditions is true, the following happens:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          The server checks the table for errors.
        </p></li><li><p>
          If the server finds an error, it tries to do a fast table
          repair (with sorting and without re-creating the data file).
        </p></li><li><p>
          If the repair fails because of an error in the data file (for
          example, a duplicate-key error), the server tries again, this
          time re-creating the data file.
        </p></li><li><p>
          If the repair still fails, the server tries once more with the
          old repair option method (write row by row without sorting).
          This method should be able to repair any type of error and has
          low disk space requirements.
        </p></li></ul></div><p>
      If the recovery wouldn't be able to recover all rows from
      previously completed statements and you didn't specify
      <code class="literal">FORCE</code> in the value of the
      <a href="server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a> option,
      automatic repair aborts with an error message in the error log:
    </p><pre class="programlisting">Error: Couldn't repair table: test.g00pages</pre><p>
      If you specify <code class="literal">FORCE</code>, a warning like this is
      written instead:
    </p><pre class="programlisting">Warning: Found 344 of 354 rows when repairing ./test/g00pages</pre><p>
      Note that if the automatic recovery value includes
      <code class="literal">BACKUP</code>, the recovery process creates files with
      names of the form
      <code class="filename"><em class="replaceable"><code>tbl_name-datetime</code></em>.BAK</code>.
      You should have a <span><strong class="command">cron</strong></span> script that
      automatically moves these files from the database directories to
      backup media.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="key-space"></a>13.5.2. Space Needed for Keys</h3></div></div></div><a class="indexterm" name="id1157043"></a><p>
      <code class="literal">MyISAM</code> tables use B-tree indexes. You can
      roughly calculate the size for the index file as
      <code class="literal">(key_length+4)/0.67</code>, summed over all keys. This
      is for the worst case when all keys are inserted in sorted order
      and the table doesn't have any compressed keys.
    </p><p>
      String indexes are space compressed. If the first index part is a
      string, it is also prefix compressed. Space compression makes the
      index file smaller than the worst-case figure if a string column
      has a lot of trailing space or is a
      <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> column that is not always
      used to the full length. Prefix compression is used on keys that
      start with a string. Prefix compression helps if there are many
      strings with an identical prefix.
    </p><p>
      In <code class="literal">MyISAM</code> tables, you can also prefix compress
      numbers by specifying the <code class="literal">PACK_KEYS=1</code> table
      option when you create the table. Numbers are stored with the high
      byte first, so this helps when you have many integer keys that
      have an identical prefix.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="myisam-table-formats"></a>13.5.3. <code class="literal">MyISAM</code> Table Storage Formats</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#static-format">13.5.3.1. Static (Fixed-Length) Table Characteristics</a></span></dt><dt><span class="section"><a href="storage-engines.html#dynamic-format">13.5.3.2. Dynamic Table Characteristics</a></span></dt><dt><span class="section"><a href="storage-engines.html#compressed-format">13.5.3.3. Compressed Table Characteristics</a></span></dt></dl></div><p>
      <code class="literal">MyISAM</code> supports three different storage
      formats. Two of them, fixed and dynamic format, are chosen
      automatically depending on the type of columns you are using. The
      third, compressed format, can be created only with the
      <a href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span><strong class="command">myisampack</strong></span></a> utility (see
      <a href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables">Section 4.6.5, “<span><strong class="command">myisampack</strong></span> — Generate Compressed, Read-Only MyISAM Tables”</a>).
    </p><p>
      When you use <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> for a table that has no
      <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> or
      <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a> columns, you can force the
      table format to <a href="data-types.html#numeric-types" title="10.2. Numeric Types"><code class="literal">FIXED</code></a> or
      <code class="literal">DYNAMIC</code> with the <code class="literal">ROW_FORMAT</code>
      table option.
    </p><p>
      See <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax">Section 12.1.17, “<code class="literal">CREATE TABLE</code> Syntax”</a>, for information about
      <code class="literal">ROW_FORMAT</code>.
    </p><p>
      You can decompress (unpack) compressed <code class="literal">MyISAM</code>
      tables using <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk
      <a href="programs.html#option_myisamchk_unpack"><code class="option">--unpack</code></a></strong></span></a>; see
      <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility">Section 4.6.3, “<span><strong class="command">myisamchk</strong></span> — MyISAM Table-Maintenance Utility”</a>, for more information.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="static-format"></a>13.5.3.1. Static (Fixed-Length) Table Characteristics</h4></div></div></div><p>
        Static format is the default for <code class="literal">MyISAM</code>
        tables. It is used when the table contains no variable-length
        columns (<a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a>,
        <a href="data-types.html#binary-varbinary" title="10.4.2. The BINARY and
        VARBINARY Types"><code class="literal">VARBINARY</code></a>,
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a>, or
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a>). Each row is stored using a
        fixed number of bytes.
      </p><p>
        Of the three <code class="literal">MyISAM</code> storage formats, static
        format is the simplest and most secure (least subject to
        corruption). It is also the fastest of the on-disk formats due
        to the ease with which rows in the data file can be found on
        disk: To look up a row based on a row number in the index,
        multiply the row number by the row length to calculate the row
        position. Also, when scanning a table, it is very easy to read a
        constant number of rows with each disk read operation.
      </p><p>
        The security is evidenced if your computer crashes while the
        MySQL server is writing to a fixed-format
        <code class="literal">MyISAM</code> file. In this case,
        <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> can easily determine where each row
        starts and ends, so it can usually reclaim all rows except the
        partially written one. Note that <code class="literal">MyISAM</code> table
        indexes can always be reconstructed based on the data rows.
      </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
          Fixed-length row format is only available for tables without
          <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> or
          <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a> columns. Creating a table
          with these columns with an explicit
          <code class="literal">ROW_FORMAT</code> clause will not raise an error
          or warning; the format specification will be ignored.
        </p></div><p>
        Static-format tables have these characteristics:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">CHAR</code></a> and
            <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> columns are
            space-padded to the specified column width, although the
            column type is not altered.
            <a href="data-types.html#binary-varbinary" title="10.4.2. The BINARY and
        VARBINARY Types"><code class="literal">BINARY</code></a> and
            <a href="data-types.html#binary-varbinary" title="10.4.2. The BINARY and
        VARBINARY Types"><code class="literal">VARBINARY</code></a> columns are padded
            with <code class="literal">0x00</code> bytes to the column width.
          </p></li><li><p>
            Very quick.
          </p></li><li><p>
            Easy to cache.
          </p></li><li><p>
            Easy to reconstruct after a crash, because rows are located
            in fixed positions.
          </p></li><li><p>
            Reorganization is unnecessary unless you delete a huge
            number of rows and want to return free disk space to the
            operating system. To do this, use
            <a href="sql-syntax.html#optimize-table" title="12.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> or
            <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk -r</strong></span></a>.
          </p></li><li><p>
            Usually require more disk space than dynamic-format tables.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="dynamic-format"></a>13.5.3.2. Dynamic Table Characteristics</h4></div></div></div><a class="indexterm" name="id1157457"></a><a class="indexterm" name="id1157466"></a><p>
        Dynamic storage format is used if a <code class="literal">MyISAM</code>
        table contains any variable-length columns
        (<a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a>,
        <a href="data-types.html#binary-varbinary" title="10.4.2. The BINARY and
        VARBINARY Types"><code class="literal">VARBINARY</code></a>,
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a>, or
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a>), or if the table was
        created with the <code class="literal">ROW_FORMAT=DYNAMIC</code> table
        option.
      </p><p>
        Dynamic format is a little more complex than static format
        because each row has a header that indicates how long it is. A
        row can become fragmented (stored in noncontiguous pieces) when
        it is made longer as a result of an update.
      </p><a class="indexterm" name="id1157528"></a><p>
        You can use <a href="sql-syntax.html#optimize-table" title="12.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> or
        <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk -r</strong></span></a> to defragment a table. If you
        have fixed-length columns that you access or change frequently
        in a table that also contains some variable-length columns, it
        might be a good idea to move the variable-length columns to
        other tables just to avoid fragmentation.
      </p><p>
        Dynamic-format tables have these characteristics:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            All string columns are dynamic except those with a length
            less than four.
          </p></li><li><p>
            Each row is preceded by a bitmap that indicates which
            columns contain the empty string (for string columns) or
            zero (for numeric columns). Note that this does not include
            columns that contain <code class="literal">NULL</code> values. If a
            string column has a length of zero after trailing space
            removal, or a numeric column has a value of zero, it is
            marked in the bitmap and not saved to disk. Nonempty strings
            are saved as a length byte plus the string contents.
          </p></li><li><p>
            Much less disk space usually is required than for
            fixed-length tables.
          </p></li><li><p>
            Each row uses only as much space as is required. However, if
            a row becomes larger, it is split into as many pieces as are
            required, resulting in row fragmentation. For example, if
            you update a row with information that extends the row
            length, the row becomes fragmented. In this case, you may
            have to run <a href="sql-syntax.html#optimize-table" title="12.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> or
            <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk -r</strong></span></a> from time to time to improve
            performance. Use <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk -ei</strong></span></a> to obtain
            table statistics.
          </p></li><li><p>
            More difficult than static-format tables to reconstruct
            after a crash, because rows may be fragmented into many
            pieces and links (fragments) may be missing.
          </p></li><li><p>
            The expected row length for dynamic-sized rows is calculated
            using the following expression:
          </p><pre class="programlisting">3
+ (<em class="replaceable"><code>number of columns</code></em> + 7) / 8
+ (<em class="replaceable"><code>number of char columns</code></em>)
+ (<em class="replaceable"><code>packed size of numeric columns</code></em>)
+ (<em class="replaceable"><code>length of strings</code></em>)
+ (<em class="replaceable"><code>number of NULL columns</code></em> + 7) / 8
</pre><p>
            There is a penalty of 6 bytes for each link. A dynamic row
            is linked whenever an update causes an enlargement of the
            row. Each new link is at least 20 bytes, so the next
            enlargement probably goes in the same link. If not, another
            link is created. You can find the number of links using
            <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk -ed</strong></span></a>. All links may be removed
            with <a href="sql-syntax.html#optimize-table" title="12.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> or
            <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk -r</strong></span></a>.
          </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="compressed-format"></a>13.5.3.3. Compressed Table Characteristics</h4></div></div></div><a class="indexterm" name="id1157712"></a><a class="indexterm" name="id1157724"></a><a class="indexterm" name="id1157733"></a><a class="indexterm" name="id1157745"></a><p>
        Compressed storage format is a read-only format that is
        generated with the <a href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span><strong class="command">myisampack</strong></span></a> tool.
        Compressed tables can be uncompressed with
        <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a>.
      </p><p>
        Compressed tables have the following characteristics:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            Compressed tables take very little disk space. This
            minimizes disk usage, which is helpful when using slow disks
            (such as CD-ROMs).
          </p></li><li><p>
            Each row is compressed separately, so there is very little
            access overhead. The header for a row takes up one to three
            bytes depending on the biggest row in the table. Each column
            is compressed differently. There is usually a different
            Huffman tree for each column. Some of the compression types
            are:
          </p><div class="itemizedlist"><ul type="circle"><li><p>
                Suffix space compression.
              </p></li><li><p>
                Prefix space compression.
              </p></li><li><p>
                Numbers with a value of zero are stored using one bit.
              </p></li><li><p>
                If values in an integer column have a small range, the
                column is stored using the smallest possible type. For
                example, a <a href="data-types.html#numeric-types" title="10.2. Numeric Types"><code class="literal">BIGINT</code></a> column
                (eight bytes) can be stored as a
                <a href="data-types.html#numeric-types" title="10.2. Numeric Types"><code class="literal">TINYINT</code></a> column (one byte)
                if all its values are in the range from
                <code class="literal">-128</code> to <code class="literal">127</code>.
              </p></li><li><p>
                If a column has only a small set of possible values, the
                data type is converted to
                <a href="data-types.html#enum" title="10.4.4. The ENUM Type"><code class="literal">ENUM</code></a>.
              </p></li><li><p>
                A column may use any combination of the preceding
                compression types.
              </p></li></ul></div></li><li><p>
            Can be used for fixed-length or dynamic-length rows.
          </p></li></ul></div><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
          While a compressed table is read only, and you cannot
          therefore update or add rows in the table, DDL (Data
          Definition Language) operations are still valid. For example,
          you may still use <code class="literal">DROP</code> to drop the table,
          and <a href="sql-syntax.html#truncate-table" title="12.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> to empty the
          table.
        </p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="myisam-table-problems"></a>13.5.4. <code class="literal">MyISAM</code> Table Problems</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#corrupted-myisam-tables">13.5.4.1. Corrupted <code class="literal">MyISAM</code> Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#myisam-table-close">13.5.4.2. Problems from Tables Not Being Closed Properly</a></span></dt></dl></div><p>
      The file format that MySQL uses to store data has been extensively
      tested, but there are always circumstances that may cause database
      tables to become corrupted. The following discussion describes how
      this can happen and how to handle it.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="corrupted-myisam-tables"></a>13.5.4.1. Corrupted <code class="literal">MyISAM</code> Tables</h4></div></div></div><p>
        Even though the <code class="literal">MyISAM</code> table format is very
        reliable (all changes to a table made by an SQL statement are
        written before the statement returns), you can still get
        corrupted tables if any of the following events occur:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            The <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> process is killed in the
            middle of a write.
          </p></li><li><p>
            An unexpected computer shutdown occurs (for example, the
            computer is turned off).
          </p></li><li><p>
            Hardware failures.
          </p></li><li><p>
            You are using an external program (such as
            <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a>) to modify a table that is
            being modified by the server at the same time.
          </p></li><li><p>
            A software bug in the MySQL or <code class="literal">MyISAM</code>
            code.
          </p></li></ul></div><p>
        Typical symptoms of a corrupt table are:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            You get the following error while selecting data from the
            table:
          </p><pre class="programlisting">Incorrect key file for table: '...'. Try to repair it</pre></li><li><p>
            Queries don't find rows in the table or return incomplete
            results.
          </p></li></ul></div><p>
        You can check the health of a <code class="literal">MyISAM</code> table
        using the <a href="sql-syntax.html#check-table" title="12.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> statement,
        and repair a corrupted <code class="literal">MyISAM</code> table with
        <a href="sql-syntax.html#repair-table" title="12.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>. When
        <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> is not running, you can also check or
        repair a table with the <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a> command.
        See <a href="sql-syntax.html#check-table" title="12.7.2.2. CHECK TABLE Syntax">Section 12.7.2.2, “<code class="literal">CHECK TABLE</code> Syntax”</a>,
        <a href="sql-syntax.html#repair-table" title="12.7.2.5. REPAIR TABLE Syntax">Section 12.7.2.5, “<code class="literal">REPAIR TABLE</code> Syntax”</a>, and <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility">Section 4.6.3, “<span><strong class="command">myisamchk</strong></span> — MyISAM Table-Maintenance Utility”</a>.
      </p><p>
        If your tables become corrupted frequently, you should try to
        determine why this is happening. The most important thing to
        know is whether the table became corrupted as a result of a
        server crash. You can verify this easily by looking for a recent
        <code class="literal">restarted mysqld</code> message in the error log. If
        there is such a message, it is likely that table corruption is a
        result of the server dying. Otherwise, corruption may have
        occurred during normal operation. This is a bug. You should try
        to create a reproducible test case that demonstrates the
        problem. See <a href="error-handling.html#crashing" title="C.5.4.2. What to Do If MySQL Keeps Crashing">Section C.5.4.2, “What to Do If MySQL Keeps Crashing”</a>, and
        <a href="http://forge.mysql.com/wiki/MySQL_Internals_Porting" target="_top">MySQL
        Internals: Porting</a>.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="myisam-table-close"></a>13.5.4.2. Problems from Tables Not Being Closed Properly</h4></div></div></div><p>
        Each <code class="literal">MyISAM</code> index file
        (<code class="filename">.MYI</code> file) has a counter in the header
        that can be used to check whether a table has been closed
        properly. If you get the following warning from
        <a href="sql-syntax.html#check-table" title="12.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> or
        <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk</strong></span></a>, it means that this counter has
        gone out of sync:
      </p><pre class="programlisting">clients are using or haven't closed the table properly</pre><p>
        This warning doesn't necessarily mean that the table is
        corrupted, but you should at least check the table.
      </p><p>
        The counter works as follows:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            The first time a table is updated in MySQL, a counter in the
            header of the index files is incremented.
          </p></li><li><p>
            The counter is not changed during further updates.
          </p></li><li><p>
            When the last instance of a table is closed (because a
            <a href="sql-syntax.html#flush" title="12.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
            TABLES</code></a> operation was performed or because there is
            no room in the table cache), the counter is decremented if
            the table has been updated at any point.
          </p></li><li><p>
            When you repair the table or check the table and it is found
            to be okay, the counter is reset to zero.
          </p></li><li><p>
            To avoid problems with interaction with other processes that
            might check the table, the counter is not decremented on
            close if it was zero.
          </p></li></ul></div><p>
        In other words, the counter can become incorrect only under
        these conditions:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            A <code class="literal">MyISAM</code> table is copied without first
            issuing <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK TABLES</code></a> and
            <a href="sql-syntax.html#flush" title="12.7.6.3. FLUSH Syntax"><code class="literal">FLUSH
            TABLES</code></a>.
          </p></li><li><p>
            MySQL has crashed between an update and the final close.
            (Note that the table may still be okay, because MySQL always
            issues writes for everything between each statement.)
          </p></li><li><p>
            A table was modified by <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk
            --recover</strong></span></a> or <a href="programs.html#myisamchk" title="4.6.3. myisamchk — MyISAM Table-Maintenance Utility"><span><strong class="command">myisamchk
            --update-state</strong></span></a> at the same time that it was in use
            by <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a>.
          </p></li><li><p>
            Multiple <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> servers are using the
            table and one server performed a <a href="sql-syntax.html#repair-table" title="12.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR
            TABLE</code></a> or <a href="sql-syntax.html#check-table" title="12.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK
            TABLE</code></a> on the table while it was in use by another
            server. In this setup, it is safe to use
            <a href="sql-syntax.html#check-table" title="12.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a>, although you
            might get the warning from other servers. However,
            <a href="sql-syntax.html#repair-table" title="12.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a> should be
            avoided because when one server replaces the data file with
            a new one, this is not known to the other servers.
          </p><p>
            In general, it is a bad idea to share a data directory among
            multiple servers. See <a href="server-administration.html#multiple-servers" title="5.6. Running Multiple MySQL Instances on One Machine">Section 5.6, “Running Multiple MySQL Instances on One Machine”</a>,
            for additional discussion.
          </p></li></ul></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="memory-storage-engine"></a>13.6. The <code class="literal">MEMORY</code> Storage Engine</h2></div></div></div><a class="indexterm" name="id1158396"></a><a class="indexterm" name="id1158405"></a><a class="indexterm" name="id1158414"></a><a class="indexterm" name="id1158426"></a><p>
    The <code class="literal">MEMORY</code> storage engine (formerly known as
    <code class="literal">HEAP</code>) creates special-purpose tables with
    contents that are stored in memory. Because the data is vulnerable
    to crashes, hardware issues, or power outages, only use these tables
    as temporary work areas or read-only caches for data pulled from
    other tables.
  </p><div class="table"><a name="id1158456"></a><p class="title"><b>Table 13.12. <code class="literal">MEMORY</code> Storage Engine
    Features</b></p><table summary="MEMORY Storage Engine
    Features" border="1"><colgroup><col><col><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Storage limits</strong></span></td><td>RAM</td><td><span class="bold"><strong>Transactions</strong></span></td><td>No</td><td><span class="bold"><strong>Locking granularity</strong></span></td><td>Table</td></tr><tr><td><span class="bold"><strong>MVCC</strong></span></td><td>No</td><td><span class="bold"><strong>Geospatial data type support</strong></span></td><td>No</td><td><span class="bold"><strong>Geospatial indexing support</strong></span></td><td>No</td></tr><tr><td><span class="bold"><strong>B-tree indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>Hash indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>Full-text search indexes</strong></span></td><td>No</td></tr><tr><td><span class="bold"><strong>Clustered indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Data caches</strong></span></td><td>N/A</td><td><span class="bold"><strong>Index caches</strong></span></td><td>N/A</td></tr><tr><td><span class="bold"><strong>Compressed data</strong></span></td><td>No</td><td><span class="bold"><strong>Encrypted data<sup>[<a name="id1158642" href="#ftn.id1158642">a</a>]</sup></strong></span></td><td>Yes</td><td><span class="bold"><strong>Cluster database support</strong></span></td><td>No</td></tr><tr><td><span class="bold"><strong>Replication support<sup>[<a name="id1158668" href="#ftn.id1158668">b</a>]</sup></strong></span></td><td>Yes</td><td><span class="bold"><strong>Foreign key support</strong></span></td><td>No</td><td><span class="bold"><strong>Backup / point-in-time recovery<sup>[<a name="id1158692" href="#ftn.id1158692">c</a>]</sup></strong></span></td><td>Yes</td></tr><tr><td><span class="bold"><strong>Query cache support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Update statistics for data dictionary</strong></span></td><td>Yes</td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr></tbody><tbody class="footnotes"><tr><td colspan="6"><div class="footnote"><p><sup>[<a name="ftn.id1158642" href="#id1158642">a</a>] </sup>Implemented in the server (via encryption functions), rather than in the storage engine.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1158668" href="#id1158668">b</a>] </sup>Implemented in the server, rather than in the storage product.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1158692" href="#id1158692">c</a>] </sup>Implemented in the server, rather than in the storage product.</p></div></td></tr></tbody></table></div><p><a name="memory-compared-cluster"></a><b>When to Use <code class="literal">MEMORY</code> or MySQL Cluster. </b>
      Developers looking to deploy applications that use the
      <code class="literal">MEMORY</code> storage engine for important, highly
      available, or frequently updated data should consider whether
      MySQL Cluster is a better choice. A typical use case for the
      <code class="literal">MEMORY</code> engine involves these characteristics:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
        Operations involving transient, non-critical data such as
        session management or caching. When the MySQL server halts or
        restarts, the data in <code class="literal">MEMORY</code> tables is lost.
      </p></li><li><p>
        In-memory storage for fast access and low latency. Data volume
        can fit entirely in memory without causing the operating system
        to swap out virtual memory pages.
      </p></li><li><p>
        A read-only or read-mostly data access pattern (limited
        updates).
      </p></li></ul></div><p>
    MySQL Cluster offers the same features as the
    <code class="literal">MEMORY</code> engine with higher performance levels, and
    provides additional features not available with
    <code class="literal">MEMORY</code>:
  </p><div class="itemizedlist"><ul type="disc"><li><p>
        Row-level locking and multiple-thread operation for low
        contention between clients.
      </p></li><li><p>
        Scalability even with statement mixes that include writes.
      </p></li><li><p>
        Optional disk-backed operation for data durability.
      </p></li><li><p>
        Shared-nothing architecture and multiple-host operation with no
        single point of failure, enabling 99.999% availability.
      </p></li><li><p>
        Automatic data distribution across nodes; application developers
        need not craft custom sharding or partitioning solutions.
      </p></li><li><p>
        Support for variable-length data types (including
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> and
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a>) not supported by
        <code class="literal">MEMORY</code>.
      </p></li></ul></div><p>
    For a white paper with more detailed comparison of the
    <code class="literal">MEMORY</code> storage engine and MySQL Cluster, see
    <a href="http://www.mysql.com/why-mysql/white-papers/mysql-wp_cluster-7.0_Cluster_MEMORY.php" target="_top">Scaling
    Web Services with MySQL Cluster: An Alternative to the MySQL Memory
    Storage Engine</a>. This white paper includes a performance
    study of the two technologies and a step-by-step guide describing
    how existing <code class="literal">MEMORY</code> users can migrate to MySQL
    Cluster.
  </p><h3><a name="id1158896"></a>
    Performance Characteristics
  </h3><p>
    <code class="literal">MEMORY</code> performance is constrained by contention
    resulting from single-thread execution and table lock overhead when
    processing updates. This limits scalability when load increases,
    particularly for statement mixes that include writes.
  </p><p>
    Despite the in-memory processing for <code class="literal">MEMORY</code>
    tables, they are not necessarily faster than
    <a href="storage-engines.html#innodb-storage-engine" title="13.3. The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> tables on a busy server, for
    general-purpose queries, or under a read/write workload. In
    particular, the table locking involved with performing updates can
    slow down concurrent usage of <code class="literal">MEMORY</code> tables from
    multiple sessions.
  </p><p>
    Depending on the kinds of queries performed on a
    <code class="literal">MEMORY</code> table, you might create indexes as either
    the default hash data structure (for looking up single values based
    on a unique key), or a general-purpose B-tree data structure (for
    all kinds of queries involving equality, inequality, or range
    operators such as less than or greater than). The following sections
    illustrate the syntax for creating both kinds of indexes. A common
    performance issue is using the default hash indexes in workloads
    where B-tree indexes are more efficient.
  </p><h3><a name="id1158949"></a>
    Physical Characteristics of <code class="literal">MEMORY</code> Tables
  </h3><p>
    The <code class="literal">MEMORY</code> storage engine associates each table
    with one disk file, which stores the table definition (not the
    data). The file name begins with the table name and has an extension
    of <code class="filename">.frm</code>.
  </p><p>
    <code class="literal">MEMORY</code> tables have the following characteristics:
  </p><div class="itemizedlist"><ul type="disc"><li><p>
        Space for <code class="literal">MEMORY</code> tables is allocated in small
        blocks. Tables use 100% dynamic hashing for inserts. No overflow
        area or extra key space is needed. No extra space is needed for
        free lists. Deleted rows are put in a linked list and are reused
        when you insert new data into the table.
        <code class="literal">MEMORY</code> tables also have none of the problems
        commonly associated with deletes plus inserts in hashed tables.
      </p></li><li><p>
        <code class="literal">MEMORY</code> tables use a fixed-length row-storage
        format. Variable-length types such as
        <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a> are stored using a fixed
        length.
      </p></li><li><p>
        <code class="literal">MEMORY</code> tables cannot contain
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> or
        <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a> columns.
      </p></li><li><p>
        <code class="literal">MEMORY</code> includes support for
        <code class="literal">AUTO_INCREMENT</code> columns.
      </p></li><li><p>
        Non-<code class="literal">TEMPORARY</code> <code class="literal">MEMORY</code>
        tables are shared among all clients, just like any other
        non-<code class="literal">TEMPORARY</code> table.
      </p></li></ul></div><h3><a name="id1159101"></a>
    DDL Operations for <code class="literal">MEMORY</code> Tables
  </h3><p>
    To create a <code class="literal">MEMORY</code> table, specify the clause
    <code class="literal">ENGINE=MEMORY</code> on the <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE
    TABLE</code></a> statement.
  </p><pre class="programlisting">CREATE TABLE t (i INT) ENGINE = MEMORY;</pre><p>
    As indicated by the engine name, <code class="literal">MEMORY</code> tables
    are stored in memory. They use hash indexes by default, which makes
    them very fast for single-value lookups, and very useful for
    creating temporary tables. However, when the server shuts down, all
    rows stored in <code class="literal">MEMORY</code> tables are lost. The tables
    themselves continue to exist because their definitions are stored in
    <code class="filename">.frm</code> files on disk, but they are empty when the
    server restarts.
  </p><p>
    This example shows how you might create, use, and remove a
    <code class="literal">MEMORY</code> table:
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE test ENGINE=MEMORY</code></strong>
    -&gt;     <strong class="userinput"><code>SELECT ip,SUM(downloads) AS down</code></strong>
    -&gt;     <strong class="userinput"><code>FROM log_table GROUP BY ip;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT COUNT(ip),AVG(down) FROM test;</code></strong>
mysql&gt; <strong class="userinput"><code>DROP TABLE test;</code></strong>
</pre><p>
    The maximum size of <code class="literal">MEMORY</code> tables is limited by
    the <a href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> system
    variable, which has a default value of 16MB. To enforce different
    size limits for <code class="literal">MEMORY</code> tables, change the value
    of this variable. The value in effect for
    <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>, or a subsequent
    <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> or
    <a href="sql-syntax.html#truncate-table" title="12.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a>, is the value used for
    the life of the table. A server restart also sets the maximum size
    of existing <code class="literal">MEMORY</code> tables to the global
    <a href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> value. You can
    set the size for individual tables as described later in this
    section.
  </p><h3><a name="id1159270"></a>
    Indexes
  </h3><p>
    The <code class="literal">MEMORY</code> storage engine supports both
    <code class="literal">HASH</code> and <code class="literal">BTREE</code> indexes. You
    can specify one or the other for a given index by adding a
    <code class="literal">USING</code> clause as shown here:
  </p><pre class="programlisting">CREATE TABLE lookup
    (id INT, INDEX USING HASH (id))
    ENGINE = MEMORY;
CREATE TABLE lookup
    (id INT, INDEX USING BTREE (id))
    ENGINE = MEMORY;</pre><p>
    For general characteristics of B-tree and hash indexes, see
    <a href="optimization.html#mysql-indexes" title="7.3.1. How MySQL Uses Indexes">Section 7.3.1, “How MySQL Uses Indexes”</a>.
  </p><p>
    <code class="literal">MEMORY</code> tables can have up to 64 indexes per
    table, 16 columns per index and a maximum key length of 3072 bytes.
  </p><p>
    If a <code class="literal">MEMORY</code> table hash index has a high degree of
    key duplication (many index entries containing the same value),
    updates to the table that affect key values and all deletes are
    significantly slower. The degree of this slowdown is proportional to
    the degree of duplication (or, inversely proportional to the index
    cardinality). You can use a <code class="literal">BTREE</code> index to avoid
    this problem.
  </p><p>
    <code class="literal">MEMORY</code> tables can have nonunique keys. (This is
    an uncommon feature for implementations of hash indexes.)
  </p><p>
    Columns that are indexed can contain <code class="literal">NULL</code> values.
  </p><h3><a name="id1159365"></a>
    User-Created and Temporary Tables
  </h3><p>
    <code class="literal">MEMORY</code> table contents are stored in memory, which
    is a property that <code class="literal">MEMORY</code> tables share with
    internal temporary tables that the server creates on the fly while
    processing queries. However, the two types of tables differ in that
    <code class="literal">MEMORY</code> tables are not subject to storage
    conversion, whereas internal temporary tables are:
  </p><div class="itemizedlist"><ul type="disc"><li><p>
        If an internal temporary table becomes too large, the server
        automatically converts it to on-disk storage, as described in
        <a href="optimization.html#internal-temporary-tables" title="7.4.3.3. How MySQL Uses Internal Temporary Tables">Section 7.4.3.3, “How MySQL Uses Internal Temporary Tables”</a>.
      </p></li><li><p>
        User-created <code class="literal">MEMORY</code> tables are never
        converted to disk tables.
      </p></li></ul></div><h3><a name="id1159421"></a>
    Loading Data
  </h3><p>
    To populate a <code class="literal">MEMORY</code> table when the MySQL server
    starts, you can use the <a href="server-administration.html#option_mysqld_init-file"><code class="option">--init-file</code></a>
    option. For example, you can put statements such as
    <a href="sql-syntax.html#insert-select" title="12.2.5.1. INSERT ...
        SELECT Syntax"><code class="literal">INSERT INTO ...
    SELECT</code></a> or <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax"><code class="literal">LOAD
    DATA INFILE</code></a> into this file to load the table from a
    persistent data source. See <a href="server-administration.html#server-options" title="5.1.2. Server Command Options">Section 5.1.2, “Server Command Options”</a>, and
    <a href="sql-syntax.html#load-data" title="12.2.6. LOAD DATA INFILE
      Syntax">Section 12.2.6, “<code class="literal">LOAD DATA INFILE</code>
      Syntax”</a>.
  </p><p>
    For loading data into <code class="literal">MEMORY</code> tables accessed by
    other sessions concurrently, <code class="literal">MEMORY</code> supports
    <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a>. See
    <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax">Section 12.2.5.2, “<code class="literal">INSERT DELAYED</code> Syntax”</a>.
  </p><h3><a name="id1159493"></a>
    <code class="literal">MEMORY</code> Tables and Replication
  </h3><p>
    A server's <code class="literal">MEMORY</code> tables become empty when it is
    shut down and restarted. If the server is a replication master, its
    slaves are not aware that these tables have become empty, so you see
    out-of-date content if you select data from the tables on the
    slaves. To synchronize master and slave <code class="literal">MEMORY</code>
    tables, when a <code class="literal">MEMORY</code> table is used on a master
    for the first time since it was started, a
    <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> statement is written to the
    master's binary log, to empty the table on the slaves also. The
    slave still has outdated data in the table during the interval
    between the master's restart and its first use of the table. To
    avoid this interval when a direct query to the slave could return
    stale data, use the <a href="server-administration.html#option_mysqld_init-file"><code class="option">--init-file</code></a>
    option to populate the <code class="literal">MEMORY</code> table on the master
    at startup.
  </p><h3><a name="id1159550"></a>
    Managing Memory Use
  </h3><p>
    The server needs sufficient memory to maintain all
    <code class="literal">MEMORY</code> tables that are in use at the same time.
  </p><p>
    Memory is not reclaimed if you delete individual rows from a
    <code class="literal">MEMORY</code> table. Memory is reclaimed only when the
    entire table is deleted. Memory that was previously used for deleted
    rows is re-used for new rows within the same table. To free all the
    memory used by a <code class="literal">MEMORY</code> table when you no longer
    require its contents, execute <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>
    or <a href="sql-syntax.html#truncate-table" title="12.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> to remove all rows,
    or remove the table altogether using <a href="sql-syntax.html#drop-table" title="12.1.28. DROP TABLE Syntax"><code class="literal">DROP
    TABLE</code></a>. To free up the memory used by deleted rows, use
    <code class="literal">ALTER TABLE ENGINE=MEMORY</code> to force a table
    rebuild.
  </p><p>
    The memory needed for one row in a <code class="literal">MEMORY</code> table
    is calculated using the following expression:
  </p><pre class="programlisting">SUM_OVER_ALL_BTREE_KEYS(<em class="replaceable"><code>max_length_of_key</code></em> + sizeof(char*) * 4)
+ SUM_OVER_ALL_HASH_KEYS(sizeof(char*) * 2)
+ ALIGN(<em class="replaceable"><code>length_of_row</code></em>+1, sizeof(char*))
</pre><p>
    <code class="literal">ALIGN()</code> represents a round-up factor to cause the
    row length to be an exact multiple of the <code class="literal">char</code>
    pointer size. <code class="literal">sizeof(char*)</code> is 4 on 32-bit
    machines and 8 on 64-bit machines.
  </p><p>
    As mentioned earlier, the
    <a href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> system variable
    sets the limit on the maximum size of <code class="literal">MEMORY</code>
    tables. To control the maximum size for individual tables, set the
    session value of this variable before creating each table. (Do not
    change the global
    <a href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> value unless
    you intend the value to be used for <code class="literal">MEMORY</code> tables
    created by all clients.) The following example creates two
    <code class="literal">MEMORY</code> tables, with a maximum size of 1MB and
    2MB, respectively:
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SET max_heap_table_size = 1024*1024;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (id INT, UNIQUE(id)) ENGINE = MEMORY;</code></strong>
Query OK, 0 rows affected (0.01 sec)

mysql&gt; <strong class="userinput"><code>SET max_heap_table_size = 1024*1024*2;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>CREATE TABLE t2 (id INT, UNIQUE(id)) ENGINE = MEMORY;</code></strong>
Query OK, 0 rows affected (0.00 sec)
</pre><p>
    Both tables revert to the server's global
    <a href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> value if the
    server restarts.
  </p><p>
    You can also specify a <code class="literal">MAX_ROWS</code> table option in
    <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements for
    <code class="literal">MEMORY</code> tables to provide a hint about the number
    of rows you plan to store in them. This does not enable the table to
    grow beyond the <a href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a>
    value, which still acts as a constraint on maximum table size. For
    maximum flexibility in being able to use
    <code class="literal">MAX_ROWS</code>, set
    <a href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a> at least as
    high as the value to which you want each <code class="literal">MEMORY</code>
    table to be able to grow.
  </p><h3><a name="id1159790"></a>
    Additional Resources
  </h3><p>
    A forum dedicated to the <code class="literal">MEMORY</code> storage engine is
    available at <a href="http://forums.mysql.com/list.php?92" target="_top">http://forums.mysql.com/list.php?92</a>.
  </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="csv-storage-engine"></a>13.7. The <code class="literal">CSV</code> Storage Engine</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#se-csv-repair">13.7.1. Repairing and Checking CSV Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#se-csv-limitations">13.7.2. CSV Limitations</a></span></dt></dl></div><a class="indexterm" name="id1159823"></a><a class="indexterm" name="id1159832"></a><p>
    The <code class="literal">CSV</code> storage engine stores data in text files
    using comma-separated values format.
  </p><p>
    The <code class="literal">CSV</code> storage engine is always compiled into
    the MySQL server.
  </p><p>
    To examine the source for the <code class="literal">CSV</code> engine, look in
    the <code class="filename">storage/csv</code> directory of a MySQL source
    distribution.
  </p><p>
    When you create a <code class="literal">CSV</code> table, the server creates a
    table format file in the database directory. The file begins with
    the table name and has an <code class="filename">.frm</code> extension. The
    storage engine also creates a data file. Its name begins with the
    table name and has a <code class="filename">.CSV</code> extension. The data
    file is a plain text file. When you store data into the table, the
    storage engine saves it into the data file in comma-separated values
    format.
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE test (i INT NOT NULL, c CHAR(10) NOT NULL)</code></strong>
    -&gt; <strong class="userinput"><code>ENGINE = CSV;</code></strong>
Query OK, 0 rows affected (0.12 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO test VALUES(1,'record one'),(2,'record two');</code></strong>
Query OK, 2 rows affected (0.00 sec)
Records: 2  Duplicates: 0  Warnings: 0

mysql&gt; <strong class="userinput"><code>SELECT * FROM test;</code></strong>
+------+------------+
| i    | c          |
+------+------------+
|    1 | record one |
|    2 | record two |
+------+------------+
2 rows in set (0.00 sec)
</pre><p>
    Creating a CSV table also creates a corresponding Metafile that
    stores the state of the table and the number of rows that exist in
    the table. The name of this file is the same as the name of the
    table with the extension <code class="filename">CSM</code>.
  </p><p>
    If you examine the <code class="filename">test.CSV</code> file in the
    database directory created by executing the preceding statements,
    its contents should look like this:
  </p><pre class="programlisting">"1","record one"
"2","record two"</pre><p>
    This format can be read, and even written, by spreadsheet
    applications such as Microsoft Excel or StarOffice Calc.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="se-csv-repair"></a>13.7.1. Repairing and Checking CSV Tables</h3></div></div></div><p>
      The CSV storage engines supports the <code class="literal">CHECK</code> and
      <code class="literal">REPAIR</code> statements to verify and if possible
      repair a damaged CSV table.
    </p><p>
      When running the <code class="literal">CHECK</code> statement, the CSV file
      will be checked for validity by looking for the correct field
      separators, escaped fields (matching or missing quotation marks),
      the correct number of fields compared to the table definition and
      the existence of a corresponding CSV metafile. The first invalid
      row discovered will report an error. Checking a valid table
      produces output like that shown below:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>check table csvtest;</code></strong>
+--------------+-------+----------+----------+
| Table        | Op    | Msg_type | Msg_text |
+--------------+-------+----------+----------+
| test.csvtest | check | status   | OK       |
+--------------+-------+----------+----------+
1 row in set (0.00 sec)</pre><p>
      A check on a corrupted table returns a fault:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>check table csvtest;</code></strong>
+--------------+-------+----------+----------+
| Table        | Op    | Msg_type | Msg_text |
+--------------+-------+----------+----------+
| test.csvtest | check | error    | Corrupt  |
+--------------+-------+----------+----------+
1 row in set (0.01 sec)</pre><p>
      If the check fails, the table is marked as crashed (corrupt). Once
      a table has been marked as corrupt, it is automatically repaired
      when you next run <code class="literal">CHECK</code> or execute a
      <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statement. The corresponding
      corrupt status and new status will be displayed when running
      <code class="literal">CHECK</code>:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>check table csvtest;</code></strong>
+--------------+-------+----------+----------------------------+
| Table        | Op    | Msg_type | Msg_text                   |
+--------------+-------+----------+----------------------------+
| test.csvtest | check | warning  | Table is marked as crashed |
| test.csvtest | check | status   | OK                         |
+--------------+-------+----------+----------------------------+
2 rows in set (0.08 sec)</pre><p>
      To repair a table you can use <code class="literal">REPAIR</code>, this
      copies as many valid rows from the existing CSV data as possible,
      and then replaces the existing CSV file with the recovered rows.
      Any rows beyond the corrupted data are lost.
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>repair table csvtest;</code></strong>
+--------------+--------+----------+----------+
| Table        | Op     | Msg_type | Msg_text |
+--------------+--------+----------+----------+
| test.csvtest | repair | status   | OK       |
+--------------+--------+----------+----------+
1 row in set (0.02 sec)</pre><div xmlns="http://www.w3.org/1999/xhtml" class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Warning</div><p xmlns="">
        Note that during repair, only the rows from the CSV file up to
        the first damaged row are copied to the new table. All other
        rows from the first damaged row to the end of the table are
        removed, even valid rows.
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="se-csv-limitations"></a>13.7.2. CSV Limitations</h3></div></div></div><p>
      The <code class="literal">CSV</code> storage engine does not support
      indexing.
    </p><p>
      Partitioning is not supported for tables using the
      <code class="literal">CSV</code> storage engine.
    </p><p>
      Tables using the <code class="literal">CSV</code> storage engine cannot be
      created with <code class="literal">NULL</code> columns. However, for
      backward compatibility, you can continue to use such tables that
      were created in previous MySQL releases. (Bug #32050)
    </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="archive-storage-engine"></a>13.8. The <code class="literal">ARCHIVE</code> Storage Engine</h2></div></div></div><a class="indexterm" name="id1160192"></a><a class="indexterm" name="id1160201"></a><p>
    The <code class="literal">ARCHIVE</code> storage engine is used for storing
    large amounts of data without indexes in a very small footprint.
  </p><div class="table"><a name="id1160224"></a><p class="title"><b>Table 13.13. <code class="literal">ARCHIVE</code> Storage Engine
    Features</b></p><table summary="ARCHIVE Storage Engine
    Features" border="1"><colgroup><col><col><col><col><col><col></colgroup><tbody><tr><td><span class="bold"><strong>Storage limits</strong></span></td><td>None</td><td><span class="bold"><strong>Transactions</strong></span></td><td>No</td><td><span class="bold"><strong>Locking granularity</strong></span></td><td>Table</td></tr><tr><td><span class="bold"><strong>MVCC</strong></span></td><td>No</td><td><span class="bold"><strong>Geospatial data type support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Geospatial indexing support</strong></span></td><td>No</td></tr><tr><td><span class="bold"><strong>B-tree indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Hash indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Full-text search indexes</strong></span></td><td>No</td></tr><tr><td><span class="bold"><strong>Clustered indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Data caches</strong></span></td><td>No</td><td><span class="bold"><strong>Index caches</strong></span></td><td>No</td></tr><tr><td><span class="bold"><strong>Compressed data</strong></span></td><td>Yes</td><td><span class="bold"><strong>Encrypted data<sup>[<a name="id1160410" href="#ftn.id1160410">a</a>]</sup></strong></span></td><td>Yes</td><td><span class="bold"><strong>Cluster database support</strong></span></td><td>No</td></tr><tr><td><span class="bold"><strong>Replication support<sup>[<a name="id1160436" href="#ftn.id1160436">b</a>]</sup></strong></span></td><td>Yes</td><td><span class="bold"><strong>Foreign key support</strong></span></td><td>No</td><td><span class="bold"><strong>Backup / point-in-time recovery<sup>[<a name="id1160460" href="#ftn.id1160460">c</a>]</sup></strong></span></td><td>Yes</td></tr><tr><td><span class="bold"><strong>Query cache support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Update statistics for data dictionary</strong></span></td><td>Yes</td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr></tbody><tbody class="footnotes"><tr><td colspan="6"><div class="footnote"><p><sup>[<a name="ftn.id1160410" href="#id1160410">a</a>] </sup>Implemented in the server (via encryption functions), rather than in the storage engine.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1160436" href="#id1160436">b</a>] </sup>Implemented in the server, rather than in the storage product.</p></div><div class="footnote"><p><sup>[<a name="ftn.id1160460" href="#id1160460">c</a>] </sup>Implemented in the server, rather than in the storage product.</p></div></td></tr></tbody></table></div><p>
    The <code class="literal">ARCHIVE</code> storage engine is included in MySQL
    binary distributions. To enable this storage engine if you build
    MySQL from source, invoke <span><strong class="command">CMake</strong></span> with the
    <a href="installing.html#option_cmake_storage_engine_options"><code class="option">-DWITH_ARCHIVE_STORAGE_ENGINE</code></a>
    option.
  </p><p>
    To examine the source for the <code class="literal">ARCHIVE</code> engine,
    look in the <code class="filename">storage/archive</code> directory of a
    MySQL source distribution.
  </p><p>
    You can check whether the <code class="literal">ARCHIVE</code> storage engine
    is available with the <a href="sql-syntax.html#show-engines" title="12.7.5.17. SHOW ENGINES Syntax"><code class="literal">SHOW ENGINES</code></a>
    statement.
  </p><p>
    When you create an <code class="literal">ARCHIVE</code> table, the server
    creates a table format file in the database directory. The file
    begins with the table name and has an <code class="filename">.frm</code>
    extension. The storage engine creates other files, all having names
    beginning with the table name. The data file has an extension of
    <code class="filename">.ARZ</code>. An <code class="filename">.ARN</code> file may
    appear during optimization operations.
  </p><p>
    The <code class="literal">ARCHIVE</code> engine supports
    <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> and
    <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>, but not
    <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
    <a href="sql-syntax.html#replace" title="12.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a>, or
    <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>. It does support
    <code class="literal">ORDER BY</code> operations,
    <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> columns, and basically all but
    spatial data types (see <a href="functions.html#mysql-spatial-datatypes" title="11.17.4.1. MySQL Spatial Data Types">Section 11.17.4.1, “MySQL Spatial Data Types”</a>).
    The <code class="literal">ARCHIVE</code> engine uses row-level locking.
  </p><p>
    The <code class="literal">ARCHIVE</code> engine supports the
    <code class="literal">AUTO_INCREMENT</code> column attribute. The
    <code class="literal">AUTO_INCREMENT</code> column can have either a unique or
    nonunique index. Attempting to create an index on any other column
    results in an error. The <code class="literal">ARCHIVE</code> engine also
    supports the <code class="literal">AUTO_INCREMENT</code> table option in
    <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
    <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements to specify the
    initial sequence value for a new table or reset the sequence value
    for an existing table, respectively.
  </p><p>
    The <code class="literal">ARCHIVE</code> engine ignores
    <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> columns if they are not
    requested and scans past them while reading.
  </p><p>
    <span class="bold"><strong>Storage:</strong></span> Rows are compressed as
    they are inserted. The <code class="literal">ARCHIVE</code> engine uses
    <code class="literal">zlib</code> lossless data compression (see
    <a href="http://www.zlib.net/" target="_top">http://www.zlib.net/</a>). You can use
    <a href="sql-syntax.html#optimize-table" title="12.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> to analyze the table
    and pack it into a smaller format (for a reason to use
    <a href="sql-syntax.html#optimize-table" title="12.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>, see later in this
    section). The engine also supports <a href="sql-syntax.html#check-table" title="12.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK
    TABLE</code></a>. There are several types of insertions that are
    used:
  </p><div class="itemizedlist"><ul type="disc"><li><p>
        An <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement just pushes
        rows into a compression buffer, and that buffer flushes as
        necessary. The insertion into the buffer is protected by a lock.
        A <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> forces a flush to occur,
        unless the only insertions that have come in were
        <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> (those flush as
        necessary). See <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax">Section 12.2.5.2, “<code class="literal">INSERT DELAYED</code> Syntax”</a>.
      </p></li><li><p>
        A bulk insert is visible only after it completes, unless other
        inserts occur at the same time, in which case it can be seen
        partially. A <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> never causes
        a flush of a bulk insert unless a normal insert occurs while it
        is loading.
      </p></li></ul></div><p>
    <span class="bold"><strong>Retrieval</strong></span>: On retrieval, rows are
    uncompressed on demand; there is no row cache. A
    <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> operation performs a complete
    table scan: When a <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> occurs, it
    finds out how many rows are currently available and reads that
    number of rows. <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> is performed
    as a consistent read. Note that lots of
    <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> statements during insertion
    can deteriorate the compression, unless only bulk or delayed inserts
    are used. To achieve better compression, you can use
    <a href="sql-syntax.html#optimize-table" title="12.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> or
    <a href="sql-syntax.html#repair-table" title="12.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>. The number of rows in
    <code class="literal">ARCHIVE</code> tables reported by
    <a href="sql-syntax.html#show-table-status" title="12.7.5.37. SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> is always accurate.
    See <a href="sql-syntax.html#optimize-table" title="12.7.2.4. OPTIMIZE TABLE Syntax">Section 12.7.2.4, “<code class="literal">OPTIMIZE TABLE</code> Syntax”</a>,
    <a href="sql-syntax.html#repair-table" title="12.7.2.5. REPAIR TABLE Syntax">Section 12.7.2.5, “<code class="literal">REPAIR TABLE</code> Syntax”</a>, and
    <a href="sql-syntax.html#show-table-status" title="12.7.5.37. SHOW TABLE STATUS Syntax">Section 12.7.5.37, “<code class="literal">SHOW TABLE STATUS</code> Syntax”</a>.
  </p><h3><a name="id1160898"></a>
    Additional Resources
  </h3><div class="itemizedlist"><ul type="disc"><li><p>
        A forum dedicated to the <code class="literal">ARCHIVE</code> storage
        engine is available at <a href="http://forums.mysql.com/list.php?112" target="_top">http://forums.mysql.com/list.php?112</a>.
      </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="blackhole-storage-engine"></a>13.9. The <code class="literal">BLACKHOLE</code> Storage Engine</h2></div></div></div><a class="indexterm" name="id1160937"></a><a class="indexterm" name="id1160946"></a><p>
    The <code class="literal">BLACKHOLE</code> storage engine acts as a
    “<span class="quote">black hole</span>” that accepts data but throws it away and
    does not store it. Retrievals always return an empty result:
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE test(i INT, c CHAR(10)) ENGINE = BLACKHOLE;</code></strong>
Query OK, 0 rows affected (0.03 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO test VALUES(1,'record one'),(2,'record two');</code></strong>
Query OK, 2 rows affected (0.00 sec)
Records: 2  Duplicates: 0  Warnings: 0

mysql&gt; <strong class="userinput"><code>SELECT * FROM test;</code></strong>
Empty set (0.00 sec)
</pre><p>
    To enable the <code class="literal">BLACKHOLE</code> storage engine if you
    build MySQL from source, invoke <span><strong class="command">CMake</strong></span> with the
    <a href="installing.html#option_cmake_storage_engine_options"><code class="option">-DWITH_BLACKHOLE_STORAGE_ENGINE</code></a>
    option.
  </p><p>
    To examine the source for the <code class="literal">BLACKHOLE</code> engine,
    look in the <code class="filename">sql</code> directory of a MySQL source
    distribution.
  </p><p>
    When you create a <code class="literal">BLACKHOLE</code> table, the server
    creates a table format file in the database directory. The file
    begins with the table name and has an <code class="filename">.frm</code>
    extension. There are no other files associated with the table.
  </p><p>
    The <code class="literal">BLACKHOLE</code> storage engine supports all kinds
    of indexes. That is, you can include index declarations in the table
    definition.
  </p><p>
    You can check whether the <code class="literal">BLACKHOLE</code> storage
    engine is available with the <a href="sql-syntax.html#show-engines" title="12.7.5.17. SHOW ENGINES Syntax"><code class="literal">SHOW
    ENGINES</code></a> statement.
  </p><p>
    Inserts into a <code class="literal">BLACKHOLE</code> table do not store any
    data, but if the binary log is enabled, the SQL statements are
    logged (and replicated to slave servers). This can be useful as a
    repeater or filter mechanism. Suppose that your application requires
    slave-side filtering rules, but transferring all binary log data to
    the slave first results in too much traffic. In such a case, it is
    possible to set up on the master host a “<span class="quote">dummy</span>” slave
    process whose default storage engine is
    <code class="literal">BLACKHOLE</code>, depicted as follows:
  </p><div class="mediaobject"><img src="images/blackhole-1.png" width="520" height="245" alt="Replication using BLACKHOLE
      for filtering"></div><p>
    The master writes to its binary log. The “<span class="quote">dummy</span>”
    <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> process acts as a slave, applying the
    desired combination of <code class="literal">replicate-do-*</code> and
    <code class="literal">replicate-ignore-*</code> rules, and writes a new,
    filtered binary log of its own. (See
    <a href="replication.html#replication-options" title="15.1.3. Replication and Binary Logging Options and Variables">Section 15.1.3, “Replication and Binary Logging Options and Variables”</a>.) This filtered log is
    provided to the slave.
  </p><p>
    The dummy process does not actually store any data, so there is
    little processing overhead incurred by running the additional
    <a href="programs.html#mysqld" title="4.3.1. mysqld — The MySQL Server"><span><strong class="command">mysqld</strong></span></a> process on the replication master host.
    This type of setup can be repeated with additional replication
    slaves.
  </p><p>
    <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> triggers for
    <code class="literal">BLACKHOLE</code> tables work as expected. However,
    because the <code class="literal">BLACKHOLE</code> table does not actually
    store any data, <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a> and
    <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> triggers are not activated:
    The <code class="literal">FOR EACH ROW</code> clause in the trigger definition
    does not apply because there are no rows.
  </p><p>
    Other possible uses for the <code class="literal">BLACKHOLE</code> storage
    engine include:
  </p><div class="itemizedlist"><ul type="disc"><li><p>
        Verification of dump file syntax.
      </p></li><li><p>
        Measurement of the overhead from binary logging, by comparing
        performance using <code class="literal">BLACKHOLE</code> with and without
        binary logging enabled.
      </p></li><li><p>
        <code class="literal">BLACKHOLE</code> is essentially a
        “<span class="quote">no-op</span>” storage engine, so it could be used for
        finding performance bottlenecks not related to the storage
        engine itself.
      </p></li></ul></div><p>
    The <code class="literal">BLACKHOLE</code> engine is transaction-aware, in the
    sense that committed transactions are written to the binary log and
    rolled-back transactions are not.
  </p><p>
    <span class="bold"><strong>Blackhole Engine and Auto Increment
    Columns</strong></span>
  </p><p>
    The Blackhole engine is a no-op engine. Any operations performed on
    a table using Blackhole will have no effect. This should be born in
    mind when considering the behavior of primary key columns that auto
    increment. The engine will not automatically increment field values,
    and does not retain auto increment field state. This has important
    implications in replication.
  </p><p>
    Consider the following replication scenario where all three of the
    following conditions apply:
  </p><div class="orderedlist"><ol type="1"><li><p>
        On a master server there is a blackhole table with an auto
        increment field that is a primary key.
      </p></li><li><p>
        On a slave the same table exists but using the MyISAM engine.
      </p></li><li><p>
        Inserts are performed into the master's table without explicitly
        setting the auto increment value in the
        <code class="literal">INSERT</code> statement itself or through using a
        <code class="literal">SET INSERT_ID</code> statement.
      </p></li></ol></div><p>
    In this scenario replication will fail with a duplicate entry error
    on the primary key column.
  </p><p>
    In statement based replication, the value of
    <code class="literal">INSERT_ID</code> in the context event will always be the
    same. Replication will therefore fail due to trying insert a row
    with a duplicate value for a primary key column.
  </p><p>
    In row based replication, the value that the engine returns for the
    row always be the same for each insert. This will result in the
    slave attempting to replay two insert log entries using the same
    value for the primary key column, and so replication will fail.
  </p><p>
    <span class="bold"><strong>Column Filtering</strong></span>
  </p><p>
    When using row-based replication,
    (<a href="replication.html#sysvar_binlog_format"><code class="literal">binlog_format=ROW</code></a>), a slave where
    the last columns are missing from a table is supported, as described
    in the section
    <a href="replication.html#replication-features-differing-tables" title="15.4.1.6. Replication with Differing Table Definitions on Master and Slave">Section 15.4.1.6, “Replication with Differing Table Definitions on Master and Slave”</a>.
  </p><p>
    This filtering works on the slave side, that is, the columns are
    copied to the slave before they are filtered out. There are at least
    two cases where it is not desirable to copy the columns to the
    slave:
  </p><div class="orderedlist"><ol type="1"><li><p>
        If the data is confidential, so the slave server should not have
        access to it.
      </p></li><li><p>
        If the master has many slaves, filtering before sending to the
        slaves may reduce network traffic.
      </p></li></ol></div><p>
    Master column filtering can be achieved using the
    <code class="literal">BLACKHOLE</code> engine. This is carried out in a way
    similar to how master table filtering is achieved - by using the
    <code class="literal">BLACKHOLE</code> engine and the option
    <code class="option">--replicate-[do|ignore]-table</code>.
  </p><p>
    The setup for the master is:
  </p><pre class="programlisting">CREATE TABLE t1 (public_col_1, ..., public_col_N,
                 secret_col_1, ..., secret_col_M) ENGINE=MyISAM;</pre><p>
    The setup for the trusted slave is:
  </p><pre class="programlisting">CREATE TABLE t1 (public_col_1, ..., public_col_N) ENGINE=BLACKHOLE;</pre><p>
    The setup for the untrusted slave is:
  </p><pre class="programlisting">CREATE TABLE t1 (public_col_1, ..., public_col_N) ENGINE=MyISAM;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="merge-storage-engine"></a>13.10. The <code class="literal">MERGE</code> Storage Engine</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#merge-table-advantages">13.10.1. <code class="literal">MERGE</code> Table Advantages and Disadvantages</a></span></dt><dt><span class="section"><a href="storage-engines.html#merge-table-problems">13.10.2. <code class="literal">MERGE</code> Table Problems</a></span></dt></dl></div><a class="indexterm" name="id1161489"></a><a class="indexterm" name="id1161498"></a><a class="indexterm" name="id1161510"></a><a class="indexterm" name="id1161523"></a><a class="indexterm" name="id1161535"></a><p>
    The <code class="literal">MERGE</code> storage engine, also known as the
    <code class="literal">MRG_MyISAM</code> engine, is a collection of identical
    <code class="literal">MyISAM</code> tables that can be used as one.
    “<span class="quote">Identical</span>” means that all tables have identical column
    and index information. You cannot merge <code class="literal">MyISAM</code>
    tables in which the columns are listed in a different order, do not
    have exactly the same columns, or have the indexes in different
    order. However, any or all of the <code class="literal">MyISAM</code> tables
    can be compressed with <a href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span><strong class="command">myisampack</strong></span></a>. See
    <a href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables">Section 4.6.5, “<span><strong class="command">myisampack</strong></span> — Generate Compressed, Read-Only MyISAM Tables”</a>. Differences in table options such as
    <code class="literal">AVG_ROW_LENGTH</code>, <code class="literal">MAX_ROWS</code>, or
    <code class="literal">PACK_KEYS</code> do not matter.
  </p><p>
    An alternative to a <code class="literal">MERGE</code> table is a partitioned
    table, which stores partitions of a single table in separate files.
    Partitioning enables some operations to be performed more
    efficiently and is not limited to the <code class="literal">MyISAM</code>
    storage engine. For more information, see
    <a href="partitioning.html" title="Chapter 17. Partitioning">Chapter 17, <i>Partitioning</i></a>.
  </p><p>
    When you create a <code class="literal">MERGE</code> table, MySQL creates two
    files on disk. The files have names that begin with the table name
    and have an extension to indicate the file type. An
    <code class="filename">.frm</code> file stores the table format, and an
    <code class="filename">.MRG</code> file contains the names of the underlying
    <code class="literal">MyISAM</code> tables that should be used as one. The
    tables do not have to be in the same database as the
    <code class="literal">MERGE</code> table.
  </p><p>
    You can use <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>,
    <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
    <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
    <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> on <code class="literal">MERGE</code>
    tables. You must have <a href="server-administration.html#priv_select"><code class="literal">SELECT</code></a>,
    <a href="server-administration.html#priv_delete"><code class="literal">DELETE</code></a>, and
    <a href="server-administration.html#priv_update"><code class="literal">UPDATE</code></a> privileges on the
    <code class="literal">MyISAM</code> tables that you map to a
    <code class="literal">MERGE</code> table.
  </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
      The use of <code class="literal">MERGE</code> tables entails the following
      security issue: If a user has access to <code class="literal">MyISAM</code>
      table <em class="replaceable"><code>t</code></em>, that user can create a
      <code class="literal">MERGE</code> table <em class="replaceable"><code>m</code></em> that
      accesses <em class="replaceable"><code>t</code></em>. However, if the user's
      privileges on <em class="replaceable"><code>t</code></em> are subsequently
      revoked, the user can continue to access
      <em class="replaceable"><code>t</code></em> by doing so through
      <em class="replaceable"><code>m</code></em>.
    </p></div><p>
    Use of <a href="sql-syntax.html#drop-table" title="12.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> with a
    <code class="literal">MERGE</code> table drops only the
    <code class="literal">MERGE</code> specification. The underlying tables are
    not affected.
  </p><p>
    To create a <code class="literal">MERGE</code> table, you must specify a
    <code class="literal">UNION=(<em class="replaceable"><code>list-of-tables</code></em>)</code>
    option that indicates which <code class="literal">MyISAM</code> tables to use.
    You can optionally specify an <code class="literal">INSERT_METHOD</code>
    option to control how inserts into the <code class="literal">MERGE</code>
    table take place. Use a value of <code class="literal">FIRST</code> or
    <code class="literal">LAST</code> to cause inserts to be made in the first or
    last underlying table, respectively. If you specify no
    <code class="literal">INSERT_METHOD</code> option or if you specify it with a
    value of <code class="literal">NO</code>, inserts into the
    <code class="literal">MERGE</code> table are not permitted and attempts to do
    so result in an error.
  </p><p>
    The following example shows how to create a <code class="literal">MERGE</code>
    table:
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (</code></strong>
    -&gt;    <strong class="userinput"><code>a INT NOT NULL AUTO_INCREMENT PRIMARY KEY,</code></strong>
    -&gt;    <strong class="userinput"><code>message CHAR(20)) ENGINE=MyISAM;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE TABLE t2 (</code></strong>
    -&gt;    <strong class="userinput"><code>a INT NOT NULL AUTO_INCREMENT PRIMARY KEY,</code></strong>
    -&gt;    <strong class="userinput"><code>message CHAR(20)) ENGINE=MyISAM;</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO t1 (message) VALUES ('Testing'),('table'),('t1');</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO t2 (message) VALUES ('Testing'),('table'),('t2');</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE TABLE total (</code></strong>
    -&gt;    <strong class="userinput"><code>a INT NOT NULL AUTO_INCREMENT,</code></strong>
    -&gt;    <strong class="userinput"><code>message CHAR(20), INDEX(a))</code></strong>
    -&gt;    <strong class="userinput"><code>ENGINE=MERGE UNION=(t1,t2) INSERT_METHOD=LAST;</code></strong>
</pre><p>
    Note that column <code class="literal">a</code> is indexed as a
    <code class="literal">PRIMARY KEY</code> in the underlying
    <code class="literal">MyISAM</code> tables, but not in the
    <code class="literal">MERGE</code> table. There it is indexed but not as a
    <code class="literal">PRIMARY KEY</code> because a <code class="literal">MERGE</code>
    table cannot enforce uniqueness over the set of underlying tables.
    (Similarly, a column with a <code class="literal">UNIQUE</code> index in the
    underlying tables should be indexed in the <code class="literal">MERGE</code>
    table but not as a <code class="literal">UNIQUE</code> index.)
  </p><p>
    After creating the <code class="literal">MERGE</code> table, you can use it to
    issue queries that operate on the group of tables as a whole:
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM total;</code></strong>
+---+---------+
| a | message |
+---+---------+
| 1 | Testing |
| 2 | table   |
| 3 | t1      |
| 1 | Testing |
| 2 | table   |
| 3 | t2      |
+---+---------+
</pre><p>
    To remap a <code class="literal">MERGE</code> table to a different collection
    of <code class="literal">MyISAM</code> tables, you can use one of the
    following methods:
  </p><div class="itemizedlist"><ul type="disc"><li><p>
        <code class="literal">DROP</code> the <code class="literal">MERGE</code> table and
        re-create it.
      </p></li><li><p>
        Use <code class="literal">ALTER TABLE <em class="replaceable"><code>tbl_name</code></em>
        UNION=(...)</code> to change the list of underlying tables.
      </p><p>
        It is also possible to use <code class="literal">ALTER TABLE ...
        UNION=()</code> (that is, with an empty
        <a href="sql-syntax.html#union" title="12.2.9.4. UNION Syntax"><code class="literal">UNION</code></a> clause) to remove all of
        the underlying tables.
      </p></li></ul></div><p>
    The underlying table definitions and indexes must conform closely to
    the definition of the <code class="literal">MERGE</code> table. Conformance is
    checked when a table that is part of a <code class="literal">MERGE</code>
    table is opened, not when the <code class="literal">MERGE</code> table is
    created. If any table fails the conformance checks, the operation
    that triggered the opening of the table fails. This means that
    changes to the definitions of tables within a
    <code class="literal">MERGE</code> may cause a failure when the
    <code class="literal">MERGE</code> table is accessed. The conformance checks
    applied to each table are:
  </p><div class="itemizedlist"><ul type="disc"><li><p>
        The underlying table and the <code class="literal">MERGE</code> table must
        have the same number of columns.
      </p></li><li><p>
        The column order in the underlying table and the
        <code class="literal">MERGE</code> table must match.
      </p></li><li><p>
        Additionally, the specification for each corresponding column in
        the parent <code class="literal">MERGE</code> table and the underlying
        tables are compared and must satisfy these checks:
      </p><div class="itemizedlist"><ul type="circle"><li><p>
            The column type in the underlying table and the
            <code class="literal">MERGE</code> table must be equal.
          </p></li><li><p>
            The column length in the underlying table and the
            <code class="literal">MERGE</code> table must be equal.
          </p></li><li><p>
            The column of the underlying table and the
            <code class="literal">MERGE</code> table can be
            <code class="literal">NULL</code>.
          </p></li></ul></div></li><li><p>
        The underlying table must have at least as many indexes as the
        <code class="literal">MERGE</code> table. The underlying table may have
        more indexes than the <code class="literal">MERGE</code> table, but cannot
        have fewer.
      </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
          A known issue exists where indexes on the same columns must be
          in identical order, in both the <code class="literal">MERGE</code> table
          and the underlying <code class="literal">MyISAM</code> table. See Bug
          #33653.
        </p></div><p>
        Each index must satisfy these checks:
      </p><div class="itemizedlist"><ul type="circle"><li><p>
            The index type of the underlying table and the
            <code class="literal">MERGE</code> table must be the same.
          </p></li><li><p>
            The number of index parts (that is, multiple columns within
            a compound index) in the index definition for the underlying
            table and the <code class="literal">MERGE</code> table must be the
            same.
          </p></li><li><p>
            For each index part:
          </p><div class="itemizedlist"><ul type="square"><li><p>
                Index part lengths must be equal.
              </p></li><li><p>
                Index part types must be equal.
              </p></li><li><p>
                Index part languages must be equal.
              </p></li><li><p>
                Check whether index parts can be
                <code class="literal">NULL</code>.
              </p></li></ul></div></li></ul></div></li></ul></div><p>
    If a <code class="literal">MERGE</code> table cannot be opened or used because
    of a problem with an underlying table, <a href="sql-syntax.html#check-table" title="12.7.2.2. CHECK TABLE Syntax"><code class="literal">CHECK
    TABLE</code></a> displays information about which table caused the
    problem.
  </p><h3><a name="id1162415"></a>
    Additional Resources
  </h3><div class="itemizedlist"><ul type="disc"><li><p>
        A forum dedicated to the <code class="literal">MERGE</code> storage engine
        is available at <a href="http://forums.mysql.com/list.php?93" target="_top">http://forums.mysql.com/list.php?93</a>.
      </p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="merge-table-advantages"></a>13.10.1. <code class="literal">MERGE</code> Table Advantages and Disadvantages</h3></div></div></div><p>
      <code class="literal">MERGE</code> tables can help you solve the following
      problems:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          Easily manage a set of log tables. For example, you can put
          data from different months into separate tables, compress some
          of them with <a href="programs.html#myisampack" title="4.6.5. myisampack — Generate Compressed, Read-Only MyISAM Tables"><span><strong class="command">myisampack</strong></span></a>, and then create a
          <code class="literal">MERGE</code> table to use them as one.
        </p></li><li><p>
          Obtain more speed. You can split a large read-only table based
          on some criteria, and then put individual tables on different
          disks. A <code class="literal">MERGE</code> table structured this way
          could be much faster than using a single large table.
        </p></li><li><p>
          Perform more efficient searches. If you know exactly what you
          are looking for, you can search in just one of the underlying
          tables for some queries and use a <code class="literal">MERGE</code>
          table for others. You can even have many different
          <code class="literal">MERGE</code> tables that use overlapping sets of
          tables.
        </p></li><li><p>
          Perform more efficient repairs. It is easier to repair
          individual smaller tables that are mapped to a
          <code class="literal">MERGE</code> table than to repair a single large
          table.
        </p></li><li><p>
          Instantly map many tables as one. A <code class="literal">MERGE</code>
          table need not maintain an index of its own because it uses
          the indexes of the individual tables. As a result,
          <code class="literal">MERGE</code> table collections are
          <span class="emphasis"><em>very</em></span> fast to create or remap. (You must
          still specify the index definitions when you create a
          <code class="literal">MERGE</code> table, even though no indexes are
          created.)
        </p></li><li><p>
          If you have a set of tables from which you create a large
          table on demand, you can instead create a
          <code class="literal">MERGE</code> table from them on demand. This is
          much faster and saves a lot of disk space.
        </p></li><li><p>
          Exceed the file size limit for the operating system. Each
          <code class="literal">MyISAM</code> table is bound by this limit, but a
          collection of <code class="literal">MyISAM</code> tables is not.
        </p></li><li><p>
          You can create an alias or synonym for a
          <code class="literal">MyISAM</code> table by defining a
          <code class="literal">MERGE</code> table that maps to that single table.
          There should be no really notable performance impact from
          doing this (only a couple of indirect calls and
          <code class="literal">memcpy()</code> calls for each read).
        </p></li></ul></div><p>
      The disadvantages of <code class="literal">MERGE</code> tables are:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          You can use only identical <code class="literal">MyISAM</code> tables
          for a <code class="literal">MERGE</code> table.
        </p></li><li><p>
          Some <code class="literal">MyISAM</code> features are unavailable in
          <code class="literal">MERGE</code> tables. For example, you cannot
          create <code class="literal">FULLTEXT</code> indexes on
          <code class="literal">MERGE</code> tables. (You can create
          <code class="literal">FULLTEXT</code> indexes on the underlying
          <code class="literal">MyISAM</code> tables, but you cannot search the
          <code class="literal">MERGE</code> table with a full-text search.)
        </p></li><li><p>
          If the <code class="literal">MERGE</code> table is nontemporary, all
          underlying <code class="literal">MyISAM</code> tables must be
          nontemporary. If the <code class="literal">MERGE</code> table is
          temporary, the <code class="literal">MyISAM</code> tables can be any mix
          of temporary and nontemporary.
        </p></li><li><p>
          <code class="literal">MERGE</code> tables use more file descriptors than
          <code class="literal">MyISAM</code> tables. If 10 clients are using a
          <code class="literal">MERGE</code> table that maps to 10 tables, the
          server uses (10 × 10) + 10 file descriptors. (10 data
          file descriptors for each of the 10 clients, and 10 index file
          descriptors shared among the clients.)
        </p></li><li><p>
          Index reads are slower. When you read an index, the
          <code class="literal">MERGE</code> storage engine needs to issue a read
          on all underlying tables to check which one most closely
          matches a given index value. To read the next index value, the
          <code class="literal">MERGE</code> storage engine needs to search the
          read buffers to find the next value. Only when one index
          buffer is used up does the storage engine need to read the
          next index block. This makes <code class="literal">MERGE</code> indexes
          much slower on <a href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>
          searches, but not much slower on
          <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a> searches. For more
          information about <a href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>
          and <a href="optimization.html#jointype_ref"><code class="literal">ref</code></a>, see
          <a href="sql-syntax.html#explain" title="12.8.2. EXPLAIN Syntax">Section 12.8.2, “<code class="literal">EXPLAIN</code> Syntax”</a>.
        </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="merge-table-problems"></a>13.10.2. <code class="literal">MERGE</code> Table Problems</h3></div></div></div><p>
      The following are known problems with <code class="literal">MERGE</code>
      tables:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          In versions of MySQL Server prior to 5.1.23, it was possible
          to create temporary merge tables with nontemporary child
          MyISAM tables.
        </p><p>
          From versions 5.1.23, MERGE children were locked through the
          parent table. If the parent was temporary, it was not locked
          and so the children were not locked either. Parallel use of
          the MyISAM tables corrupted them.
        </p></li><li><p>
          If you use <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to
          change a <code class="literal">MERGE</code> table to another storage
          engine, the mapping to the underlying tables is lost. Instead,
          the rows from the underlying <code class="literal">MyISAM</code> tables
          are copied into the altered table, which then uses the
          specified storage engine.
        </p></li><li><p>
          The <code class="literal">INSERT_METHOD</code> table option for a
          <code class="literal">MERGE</code> table indicates which underlying
          <code class="literal">MyISAM</code> table to use for inserts into the
          <code class="literal">MERGE</code> table. However, use of the
          <code class="literal">AUTO_INCREMENT</code> table option for that
          <code class="literal">MyISAM</code> table has no effect for inserts into
          the <code class="literal">MERGE</code> table until at least one row has
          been inserted directly into the <code class="literal">MyISAM</code>
          table.
        </p></li><li><p>
          A <code class="literal">MERGE</code> table cannot maintain uniqueness
          constraints over the entire table. When you perform an
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>, the data goes into the
          first or last <code class="literal">MyISAM</code> table (as determined
          by the <code class="literal">INSERT_METHOD</code> option). MySQL ensures
          that unique key values remain unique within that
          <code class="literal">MyISAM</code> table, but not over all the
          underlying tables in the collection.
        </p></li><li><p>
          Because the <code class="literal">MERGE</code> engine cannot enforce
          uniqueness over the set of underlying tables,
          <a href="sql-syntax.html#replace" title="12.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a> does not work as
          expected. The two key facts are:
        </p><div class="itemizedlist"><ul type="circle"><li><p>
              <a href="sql-syntax.html#replace" title="12.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a> can detect unique
              key violations only in the underlying table to which it is
              going to write (which is determined by the
              <code class="literal">INSERT_METHOD</code> option). This differs
              from violations in the <code class="literal">MERGE</code> table
              itself.
            </p></li><li><p>
              If <a href="sql-syntax.html#replace" title="12.2.8. REPLACE Syntax"><code class="literal">REPLACE</code></a> detects a unique
              key violation, it will change only the corresponding row
              in the underlying table it is writing to; that is, the
              first or last table, as determined by the
              <code class="literal">INSERT_METHOD</code> option.
            </p></li></ul></div><p>
          Similar considerations apply for
          <a href="sql-syntax.html#insert-on-duplicate" title="12.2.5.3. INSERT ... ON
        DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
          ... ON DUPLICATE KEY UPDATE</code></a>.
        </p></li><li><p>
          <code class="literal">MERGE</code> tables do not support partitioning.
          That is, you cannot partition a <code class="literal">MERGE</code>
          table, nor can any of a <code class="literal">MERGE</code> table's
          underlying <code class="literal">MyISAM</code> tables be partitioned.
        </p></li><li><p>
          You should not use <a href="sql-syntax.html#analyze-table" title="12.7.2.1. ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a>, <a href="sql-syntax.html#repair-table" title="12.7.2.5. REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>,
          <a href="sql-syntax.html#optimize-table" title="12.7.2.4. OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>,
          <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
          <a href="sql-syntax.html#drop-table" title="12.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a>,
          <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a> without a
          <code class="literal">WHERE</code> clause, or
          <a href="sql-syntax.html#truncate-table" title="12.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> on any of the
          tables that are mapped into an open <code class="literal">MERGE</code>
          table. If you do so, the <code class="literal">MERGE</code> table may
          still refer to the original table and yield unexpected
          results. To work around this problem, ensure that no
          <code class="literal">MERGE</code> tables remain open by issuing a
          <a href="sql-syntax.html#flush" title="12.7.6.3. FLUSH Syntax"><code class="literal">FLUSH TABLES</code></a>
          statement prior to performing any of the named operations.
        </p><p>
          The unexpected results include the possibility that the
          operation on the <code class="literal">MERGE</code> table will report
          table corruption. If this occurs after one of the named
          operations on the underlying <code class="literal">MyISAM</code> tables,
          the corruption message is spurious. To deal with this, issue a
          <a href="sql-syntax.html#flush" title="12.7.6.3. FLUSH Syntax"><code class="literal">FLUSH TABLES</code></a>
          statement after modifying the <code class="literal">MyISAM</code>
          tables.
        </p></li><li><p>
          <a href="sql-syntax.html#drop-table" title="12.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> on a table that is
          in use by a <code class="literal">MERGE</code> table does not work on
          Windows because the <code class="literal">MERGE</code> storage engine's
          table mapping is hidden from the upper layer of MySQL. Windows
          does not permit open files to be deleted, so you first must
          flush all <code class="literal">MERGE</code> tables (with
          <a href="sql-syntax.html#flush" title="12.7.6.3. FLUSH Syntax"><code class="literal">FLUSH TABLES</code></a>)
          or drop the <code class="literal">MERGE</code> table before dropping the
          table.
        </p></li><li><p>
          The definition of the <code class="literal">MyISAM</code> tables and the
          <code class="literal">MERGE</code> table are checked when the tables are
          accessed (for example, as part of a
          <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a> or
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement). The checks
          ensure that the definitions of the tables and the parent
          <code class="literal">MERGE</code> table definition match by comparing
          column order, types, sizes and associated indexes. If there is
          a difference between the tables, an error is returned and the
          statement fails. Because these checks take place when the
          tables are opened, any changes to the definition of a single
          table, including column changes, column ordering, and engine
          alterations will cause the statement to fail.
        </p></li><li><p>
          The order of indexes in the <code class="literal">MERGE</code> table and
          its underlying tables should be the same. If you use
          <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to add a
          <code class="literal">UNIQUE</code> index to a table used in a
          <code class="literal">MERGE</code> table, and then use
          <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to add a nonunique
          index on the <code class="literal">MERGE</code> table, the index
          ordering is different for the tables if there was already a
          nonunique index in the underlying table. (This happens because
          <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> puts
          <code class="literal">UNIQUE</code> indexes before nonunique indexes to
          facilitate rapid detection of duplicate keys.) Consequently,
          queries on tables with such indexes may return unexpected
          results.
        </p></li><li><p>
          If you encounter an error message similar to <span class="errortext">ERROR
          1017 (HY000): Can't find file:
          '<em class="replaceable"><code>tbl_name</code></em>.MRG' (errno:
          2)</span>, it generally indicates that some of the
          underlying tables do not use the <code class="literal">MyISAM</code>
          storage engine. Confirm that all of these tables are
          <code class="literal">MyISAM</code>.
        </p></li><li><p>
          The maximum number of rows in a <code class="literal">MERGE</code> table
          is 2<sup>64</sup> (~1.844E+19; the same as for
          a <code class="literal">MyISAM</code> table). It is not possible to
          merge multiple <code class="literal">MyISAM</code> tables into a single
          <code class="literal">MERGE</code> table that would have more than this
          number of rows.
        </p></li><li><p>
          The <code class="literal">MERGE</code> storage engine does not support
          <a href="sql-syntax.html#insert-delayed" title="12.2.5.2. INSERT DELAYED Syntax"><code class="literal">INSERT DELAYED</code></a> statements.
        </p></li><li><p>
          Use of underlying <code class="literal">MyISAM</code> tables of
          differing row formats with a parent <code class="literal">MERGE</code>
          table is currently known to fail. See Bug #32364.
        </p></li><li><p>
          You cannot change the union list of a nontemporary
          <code class="literal">MERGE</code> table when <a href="sql-syntax.html#lock-tables" title="12.3.5. LOCK TABLES and
      UNLOCK
      TABLES Syntax"><code class="literal">LOCK
          TABLES</code></a> is in effect. The following does
          <span class="emphasis"><em>not</em></span> work:
        </p><pre class="programlisting">CREATE TABLE m1 ... ENGINE=MRG_MYISAM ...;
LOCK TABLES t1 WRITE, t2 WRITE, m1 WRITE;
ALTER TABLE m1 ... UNION=(t1,t2) ...;</pre><p>
          However, you can do this with a temporary
          <code class="literal">MERGE</code> table.
        </p></li><li><p>
          You cannot create a <code class="literal">MERGE</code> table with
          <code class="literal">CREATE ... SELECT</code>, neither as a temporary
          <code class="literal">MERGE</code> table, nor as a nontemporary
          <code class="literal">MERGE</code> table. For example:
        </p><pre class="programlisting">CREATE TABLE m1 ... ENGINE=MRG_MYISAM ... SELECT ...;</pre><p>
          Attempts to do this result in an error:
          <em class="replaceable"><code>tbl_name</code></em> is not <code class="literal">BASE
          TABLE</code>.
        </p></li><li><p>
          In some cases, differing <code class="literal">PACK_KEYS</code> table
          option values among the <code class="literal">MERGE</code> and
          underlying tables cause unexpected results if the underlying
          tables contain <code class="literal">CHAR</code> or
          <code class="literal">BINARY</code> columns. As a workaround, use
          <code class="literal">ALTER TABLE</code> to ensure that all involved
          tables have the same <code class="literal">PACK_KEYS</code> value. (Bug
          #50646)
        </p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="federated-storage-engine"></a>13.11. The <code class="literal">FEDERATED</code> Storage Engine</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#federated-description">13.11.1. <code class="literal">FEDERATED</code> Storage Engine Overview</a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-create">13.11.2. How to Create <code class="literal">FEDERATED</code> Tables</a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-usagenotes">13.11.3. <code class="literal">FEDERATED</code> Storage Engine Notes and Tips</a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-storage-engine-resources">13.11.4. <code class="literal">FEDERATED</code> Storage Engine Resources</a></span></dt></dl></div><a class="indexterm" name="id1163640"></a><a class="indexterm" name="id1163649"></a><p>
    The <code class="literal">FEDERATED</code> storage engine lets you access data
    from a remote MySQL database without using replication or cluster
    technology. Querying a local <code class="literal">FEDERATED</code> table
    automatically pulls the data from the remote (federated) tables. No
    data is stored on the local tables.
  </p><p>
    To include the <code class="literal">FEDERATED</code> storage engine if you
    build MySQL from source, invoke <span><strong class="command">CMake</strong></span> with the
    <a href="installing.html#option_cmake_storage_engine_options"><code class="option">-DWITH_FEDERATED_STORAGE_ENGINE</code></a>
    option.
  </p><p>
    The <code class="literal">FEDERATED</code> storage engine is not enabled by
    default in the running server; to enable
    <code class="literal">FEDERATED</code>, you must start the MySQL server binary
    using the <code class="option">--federated</code> option.
  </p><p>
    To examine the source for the <code class="literal">FEDERATED</code> engine,
    look in the <code class="filename">storage/federated</code> directory of a
    MySQL source distribution.
  </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="federated-description"></a>13.11.1. <code class="literal">FEDERATED</code> Storage Engine Overview</h3></div></div></div><p>
      When you create a table using one of the standard storage engines
      (such as <code class="literal">MyISAM</code>, <code class="literal">CSV</code> or
      <code class="literal">InnoDB</code>), the table consists of the table
      definition and the associated data. When you create a
      <code class="literal">FEDERATED</code> table, the table definition is the
      same, but the physical storage of the data is handled on a remote
      server.
    </p><p>
      A <code class="literal">FEDERATED</code> table consists of two elements:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          A <span class="emphasis"><em>remote server</em></span> with a database table,
          which in turn consists of the table definition (stored in the
          <code class="filename">.frm</code> file) and the associated table. The
          table type of the remote table may be any type supported by
          the remote <code class="literal">mysqld</code> server, including
          <code class="literal">MyISAM</code> or <code class="literal">InnoDB</code>.
        </p></li><li><p>
          A <span class="emphasis"><em>local server</em></span> with a database table,
          where the table definition matches that of the corresponding
          table on the remote server. The table definition is stored
          within the <code class="filename">.frm</code> file. However, there is
          no data file on the local server. Instead, the table
          definition includes a connection string that points to the
          remote table.
        </p></li></ul></div><p>
      When executing queries and statements on a
      <code class="literal">FEDERATED</code> table on the local server, the
      operations that would normally insert, update or delete
      information from a local data file are instead sent to the remote
      server for execution, where they update the data file on the
      remote server or return matching rows from the remote server.
    </p><p>
      The basic structure of a <code class="literal">FEDERATED</code> table setup
      is shown in <a href="storage-engines.html#figure-se-federated-structure" title="Figure 13.2. FEDERATED Table Structure">Figure 13.2, “<code class="literal">FEDERATED</code> Table Structure”</a>.
    </p><div class="figure"><a name="figure-se-federated-structure"></a><p class="title"><b>Figure 13.2. <code class="literal">FEDERATED</code> Table Structure</b></p><div class="mediaobject"><img src="images/se-federated-structure.png" width="475" height="269" alt="FEDERATED table
          structure"></div></div><p>
      When a client issues an SQL statement that refers to a
      <code class="literal">FEDERATED</code> table, the flow of information
      between the local server (where the SQL statement is executed) and
      the remote server (where the data is physically stored) is as
      follows:
    </p><div class="orderedlist"><ol type="1"><li><p>
          The storage engine looks through each column that the
          <code class="literal">FEDERATED</code> table has and constructs an
          appropriate SQL statement that refers to the remote table.
        </p></li><li><p>
          The statement is sent to the remote server using the MySQL
          client API.
        </p></li><li><p>
          The remote server processes the statement and the local server
          retrieves any result that the statement produces (an
          affected-rows count or a result set).
        </p></li><li><p>
          If the statement produces a result set, each column is
          converted to internal storage engine format that the
          <code class="literal">FEDERATED</code> engine expects and can use to
          display the result to the client that issued the original
          statement.
        </p></li></ol></div><p>
      The local server communicates with the remote server using MySQL
      client C API functions. It invokes
      <a href="connectors-apis.html#mysql-real-query" title="21.9.3.54. mysql_real_query()"><code class="literal">mysql_real_query()</code></a> to send the
      statement. To read a result set, it uses
      <a href="connectors-apis.html#mysql-store-result" title="21.9.3.69. mysql_store_result()"><code class="literal">mysql_store_result()</code></a> and fetches
      rows one at a time using
      <a href="connectors-apis.html#mysql-fetch-row" title="21.9.3.21. mysql_fetch_row()"><code class="literal">mysql_fetch_row()</code></a>.
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="federated-create"></a>13.11.2. How to Create <code class="literal">FEDERATED</code> Tables</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="storage-engines.html#federated-create-connection">13.11.2.1. Creating a <code class="literal">FEDERATED</code> Table Using
        <code class="literal">CONNECTION</code></a></span></dt><dt><span class="section"><a href="storage-engines.html#federated-create-server">13.11.2.2. Creating a <code class="literal">FEDERATED</code> Table Using
        <code class="literal">CREATE SERVER</code></a></span></dt></dl></div><p>
      To create a <code class="literal">FEDERATED</code> table you should follow
      these steps:
    </p><div class="orderedlist"><ol type="1"><li><p>
          Create the table on the remote server. Alternatively, make a
          note of the table definition of an existing table, perhaps
          using the <a href="sql-syntax.html#show-create-table" title="12.7.5.12. SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE TABLE</code></a>
          statement.
        </p></li><li><p>
          Create the table on the local server with an identical table
          definition, but adding the connection information that links
          the local table to the remote table.
        </p></li></ol></div><p>
      For example, you could create the following table on the remote
      server:
    </p><pre class="programlisting">CREATE TABLE test_table (
    id     INT(20) NOT NULL AUTO_INCREMENT,
    name   VARCHAR(32) NOT NULL DEFAULT '',
    other  INT(20) NOT NULL DEFAULT '0',
    PRIMARY KEY  (id),
    INDEX name (name),
    INDEX other_key (other)
)
ENGINE=MyISAM
DEFAULT CHARSET=latin1;</pre><p>
      To create the local table that will be federated to the remote
      table, there are two options available. You can either create the
      local table and specify the connection string (containing the
      server name, login, password) to be used to connect to the remote
      table using the <code class="literal">CONNECTION</code>, or you can use an
      existing connection that you have previously created using the
      <a href="sql-syntax.html#create-server" title="12.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a> statement.
    </p><div xmlns="http://www.w3.org/1999/xhtml" class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Important</div><p xmlns="">
        When you create the local table it <span class="emphasis"><em>must</em></span>
        have an identical field definition to the remote table.
      </p></div><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
        You can improve the performance of a
        <code class="literal">FEDERATED</code> table by adding indexes to the
        table on the host. The optimization will occur because the query
        sent to the remote server will include the contents of the
        <code class="literal">WHERE</code> clause and will be sent to the remote
        server and subsequently executed locally. This reduces the
        network traffic that would otherwise request the entire table
        from the server for local processing.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="federated-create-connection"></a>13.11.2.1. Creating a <code class="literal">FEDERATED</code> Table Using
        <code class="literal">CONNECTION</code></h4></div></div></div><p>
        To use the first method, you must specify the
        <code class="literal">CONNECTION</code> string after the engine type in a
        <a href="sql-syntax.html#create-table" title="12.1.17. CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement. For
        example:
      </p><pre class="programlisting">CREATE TABLE federated_table (
    id     INT(20) NOT NULL AUTO_INCREMENT,
    name   VARCHAR(32) NOT NULL DEFAULT '',
    other  INT(20) NOT NULL DEFAULT '0',
    PRIMARY KEY  (id),
    INDEX name (name),
    INDEX other_key (other)
)
ENGINE=FEDERATED
DEFAULT CHARSET=latin1
CONNECTION='mysql://fed_user@remote_host:9306/federated/test_table';</pre><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
          <code class="literal">CONNECTION</code> replaces the
          <code class="literal">COMMENT</code> used in some previous versions of
          MySQL.
        </p></div><p>
        The <code class="literal">CONNECTION</code> string contains the
        information required to connect to the remote server containing
        the table that will be used to physically store the data. The
        connection string specifies the server name, login credentials,
        port number and database/table information. In the example, the
        remote table is on the server <code class="literal">remote_host</code>,
        using port 9306. The name and port number should match the host
        name (or IP address) and port number of the remote MySQL server
        instance you want to use as your remote table.
      </p><p>
        The format of the connection string is as follows:
      </p><pre class="programlisting"><em class="replaceable"><code>scheme</code></em>://<em class="replaceable"><code>user_name</code></em>[:<em class="replaceable"><code>password</code></em>]@<em class="replaceable"><code>host_name</code></em>[:<em class="replaceable"><code>port_num</code></em>]/<em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>tbl_name</code></em>
</pre><p>
        Where:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <em class="replaceable"><code>scheme</code></em>: A recognized connection
            protocol. Only <code class="literal">mysql</code> is supported as the
            <em class="replaceable"><code>scheme</code></em> value at this point.
          </p></li><li><p>
            <em class="replaceable"><code>user_name</code></em>: The user name for the
            connection. This user must have been created on the remote
            server, and must have suitable privileges to perform the
            required actions (<a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>,
            <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and so forth) on the
            remote table.
          </p></li><li><p>
            <em class="replaceable"><code>password</code></em>: (Optional) The
            corresponding password for
            <em class="replaceable"><code>user_name</code></em>.
          </p></li><li><p>
            <em class="replaceable"><code>host_name</code></em>: The host name or IP
            address of the remote server.
          </p></li><li><p>
            <em class="replaceable"><code>port_num</code></em>: (Optional) The port
            number for the remote server. The default is 3306.
          </p></li><li><p>
            <em class="replaceable"><code>db_name</code></em>: The name of the database
            holding the remote table.
          </p></li><li><p>
            <em class="replaceable"><code>tbl_name</code></em>: The name of the remote
            table. The name of the local and the remote table do not
            have to match.
          </p></li></ul></div><p>
        Sample connection strings:
      </p><pre class="programlisting">CONNECTION='mysql://username:password@hostname:port/database/tablename'
CONNECTION='mysql://username@hostname/database/tablename'
CONNECTION='mysql://username:password@hostname/database/tablename'</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="federated-create-server"></a>13.11.2.2. Creating a <code class="literal">FEDERATED</code> Table Using
        <code class="literal">CREATE SERVER</code></h4></div></div></div><p>
        If you are creating a number of <code class="literal">FEDERATED</code>
        tables on the same server, or if you want to simplify the
        process of creating <code class="literal">FEDERATED</code> tables, you can
        use the <a href="sql-syntax.html#create-server" title="12.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a> statement
        to define the server connection parameters, just as you would
        with the <code class="literal">CONNECTION</code> string.
      </p><p>
        The format of the <a href="sql-syntax.html#create-server" title="12.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a>
        statement is:
      </p><pre class="programlisting">CREATE SERVER<em class="replaceable"><code>server_name</code></em>
FOREIGN DATA WRAPPER <em class="replaceable"><code>wrapper_name</code></em>
OPTIONS (<em class="replaceable"><code>option</code></em> [, <em class="replaceable"><code>option</code></em>] ...)</pre><p>
        The <em class="replaceable"><code>server_name</code></em> is used in the
        connection string when creating a new
        <code class="literal">FEDERATED</code> table.
      </p><p>
        For example, to create a server connection identical to the
        <code class="literal">CONNECTION</code> string:
      </p><pre class="programlisting">CONNECTION='mysql://fed_user@remote_host:9306/federated/test_table';</pre><p>
        You would use the following statement:
      </p><pre class="programlisting">CREATE SERVER fedlink
FOREIGN DATA WRAPPER mysql
OPTIONS (USER 'fed_user', HOST 'remote_host', PORT 9306, DATABASE 'federated');</pre><p>
        To create a <code class="literal">FEDERATED</code> table that uses this
        connection, you still use the <code class="literal">CONNECTION</code>
        keyword, but specify the name you used in the
        <a href="sql-syntax.html#create-server" title="12.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a> statement.
      </p><pre class="programlisting">CREATE TABLE test_table (
    id     INT(20) NOT NULL AUTO_INCREMENT,
    name   VARCHAR(32) NOT NULL DEFAULT '',
    other  INT(20) NOT NULL DEFAULT '0',
    PRIMARY KEY  (id),
    INDEX name (name),
    INDEX other_key (other)
)
ENGINE=FEDERATED
DEFAULT CHARSET=latin1
CONNECTION='fedlink/test_table';</pre><p>
        The connection name in this example contains the name of the
        connection (<code class="literal">fedlink</code>) and the name of the
        table (<code class="literal">test_table</code>) to link to, separated by a
        slash. If you specify only the connection name without a table
        name, the table name of the local table is used instead.
      </p><p>
        For more information on <a href="sql-syntax.html#create-server" title="12.1.16. CREATE SERVER Syntax"><code class="literal">CREATE
        SERVER</code></a>, see <a href="sql-syntax.html#create-server" title="12.1.16. CREATE SERVER Syntax">Section 12.1.16, “<code class="literal">CREATE SERVER</code> Syntax”</a>.
      </p><p>
        The <a href="sql-syntax.html#create-server" title="12.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a> statement
        accepts the same arguments as the <code class="literal">CONNECTION</code>
        string. The <a href="sql-syntax.html#create-server" title="12.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a>
        statement updates the rows in the
        <code class="literal">mysql.servers</code> table. See the following table
        for information on the correspondence between parameters in a
        connection string, options in the <a href="sql-syntax.html#create-server" title="12.1.16. CREATE SERVER Syntax"><code class="literal">CREATE
        SERVER</code></a> statement, and the columns in the
        <code class="literal">mysql.servers</code> table. For reference, the
        format of the <code class="literal">CONNECTION</code> string is as
        follows:
      </p><pre class="programlisting"><em class="replaceable"><code>scheme</code></em>://<em class="replaceable"><code>user_name</code></em>[:<em class="replaceable"><code>password</code></em>]@<em class="replaceable"><code>host_name</code></em>[:<em class="replaceable"><code>port_num</code></em>]/<em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>tbl_name</code></em>
</pre><div class="informaltable"><table border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>Description</th><th><code class="literal">CONNECTION</code> string</th><th><a href="sql-syntax.html#create-server" title="12.1.16. CREATE SERVER Syntax"><code class="literal">CREATE SERVER</code></a> option</th><th><code class="literal">mysql.servers</code> column</th></tr></thead><tbody><tr><td>Connection scheme</td><td><em class="replaceable"><code>scheme</code></em></td><td><code class="literal">wrapper_name</code></td><td><code class="literal">Wrapper</code></td></tr><tr><td>Remote user</td><td><em class="replaceable"><code>user_name</code></em></td><td><code class="literal">USER</code></td><td><code class="literal">Username</code></td></tr><tr><td>Remote password</td><td><em class="replaceable"><code>password</code></em></td><td><code class="literal">PASSWORD</code></td><td><code class="literal">Password</code></td></tr><tr><td>Remote host</td><td><em class="replaceable"><code>host_name</code></em></td><td><code class="literal">HOST</code></td><td><code class="literal">Host</code></td></tr><tr><td>Remote port</td><td><em class="replaceable"><code>port_num</code></em></td><td><code class="literal">PORT</code></td><td><code class="literal">Port</code></td></tr><tr><td>Remote database</td><td><em class="replaceable"><code>db_name</code></em></td><td><code class="literal">DATABASE</code></td><td><code class="literal">Db</code></td></tr></tbody></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="federated-usagenotes"></a>13.11.3. <code class="literal">FEDERATED</code> Storage Engine Notes and Tips</h3></div></div></div><p>
      You should be aware of the following points when using the
      <code class="literal">FEDERATED</code> storage engine:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          <code class="literal">FEDERATED</code> tables may be replicated to other
          slaves, but you must ensure that the slave servers are able to
          use the user/password combination that is defined in the
          <code class="literal">CONNECTION</code> string (or the row in the
          <code class="literal">mysql.servers</code> table) to connect to the
          remote server.
        </p></li></ul></div><p>
      The following items indicate features that the
      <code class="literal">FEDERATED</code> storage engine does and does not
      support:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          The remote server must be a MySQL server.
        </p></li><li><p>
          The remote table that a <code class="literal">FEDERATED</code> table
          points to <span class="emphasis"><em>must</em></span> exist before you try to
          access the table through the <code class="literal">FEDERATED</code>
          table.
        </p></li><li><p>
          It is possible for one <code class="literal">FEDERATED</code> table to
          point to another, but you must be careful not to create a
          loop.
        </p></li><li><p>
          A <code class="literal">FEDERATED</code> table does not support indexes
          per se. Because access to the table is handled remotely, it is
          the remote table that supports the indexes. Care should be
          taken when creating a <code class="literal">FEDERATED</code> table since
          the index definition from an equivalent
          <code class="literal">MyISAM</code> or other table may not be supported.
          For example, creating a <code class="literal">FEDERATED</code> table
          with an index prefix on
          <a href="data-types.html#char" title="10.4.1. The CHAR and
        VARCHAR Types"><code class="literal">VARCHAR</code></a>,
          <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">TEXT</code></a> or
          <a href="data-types.html#blob" title="10.4.3. The BLOB and
        TEXT Types"><code class="literal">BLOB</code></a> columns will fail. The
          following definition in <code class="literal">MyISAM</code> is valid:
        </p><pre class="programlisting">CREATE TABLE `T1`(`A` VARCHAR(100),UNIQUE KEY(`A`(30))) ENGINE=MYISAM;</pre><p>
          The key prefix in this example is incompatible with the
          <code class="literal">FEDERATED</code> engine, and the equivalent
          statement will fail:
        </p><pre class="programlisting">CREATE TABLE `T1`(`A` VARCHAR(100),UNIQUE KEY(`A`(30))) ENGINE=FEDERATED
  CONNECTION='MYSQL://127.0.0.1:3306/TEST/T1';</pre><p>
          If possible, you should try to separate the column and index
          definition when creating tables on both the remote server and
          the local server to avoid these index issues.
        </p></li><li><p>
          Internally, the implementation uses
          <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>,
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>, but not
          <a href="sql-syntax.html#handler" title="12.2.4. HANDLER Syntax"><code class="literal">HANDLER</code></a>.
        </p></li><li><p>
          The <code class="literal">FEDERATED</code> storage engine supports
          <a href="sql-syntax.html#select" title="12.2.9. SELECT Syntax"><code class="literal">SELECT</code></a>,
          <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a href="sql-syntax.html#update" title="12.2.11. UPDATE Syntax"><code class="literal">UPDATE</code></a>,
          <a href="sql-syntax.html#delete" title="12.2.2. DELETE Syntax"><code class="literal">DELETE</code></a>,
          <a href="sql-syntax.html#truncate-table" title="12.1.33. TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a>, and indexes. It
          does not support <a href="sql-syntax.html#alter-table" title="12.1.7. ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
          or any Data Definition Language statements that directly
          affect the structure of the table, other than
          <a href="sql-syntax.html#drop-table" title="12.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a>. The current
          implementation does not use prepared statements.

          
        </p></li><li><p>
          <code class="literal">FEDERATED</code> accepts
          <a href="sql-syntax.html#insert-on-duplicate" title="12.2.5.3. INSERT ... ON
        DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
          ... ON DUPLICATE KEY UPDATE</code></a> statements, but if a
          duplicate-key violation occurs, the statement fails with an
          error.
        </p></li><li><p>
          Performance on a <code class="literal">FEDERATED</code> table when
          performing bulk inserts (for example, on a
          <a href="sql-syntax.html#insert-select" title="12.2.5.1. INSERT ...
        SELECT Syntax"><code class="literal">INSERT INTO ...
          SELECT ...</code></a> statement) is slower than with other
          table types because each selected row is treated as an
          individual <a href="sql-syntax.html#insert" title="12.2.5. INSERT Syntax"><code class="literal">INSERT</code></a> statement on
          the <code class="literal">FEDERATED</code> table.
        </p></li><li><p>
          Transactions are not supported.
        </p></li><li><p>
          <code class="literal">FEDERATED</code> performs bulk-insert handling
          such that multiple rows are sent to the remote table in a
          batch. This provides a performance improvement and enables the
          remote table to perform improvement. Also, if the remote table
          is transactional, it enables the remote storage engine to
          perform statement rollback properly should an error occur.
          This capability has the following limitations:
        </p><div class="itemizedlist"><ul type="circle"><li><p>
              The size of the insert cannot exceed the maximum packet
              size between servers. If the insert exceeds this size, it
              is broken into multiple packets and the rollback problem
              can occur.
            </p></li><li><p>
              Bulk-insert handling does not occur for
              <a href="sql-syntax.html#insert-on-duplicate" title="12.2.5.3. INSERT ... ON
        DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
              ... ON DUPLICATE KEY UPDATE</code></a>.
            </p></li></ul></div></li><li><p>
          There is no way for the <code class="literal">FEDERATED</code> engine to
          know if the remote table has changed. The reason for this is
          that this table must work like a data file that would never be
          written to by anything other than the database system. The
          integrity of the data in the local table could be breached if
          there was any change to the remote database.
        </p></li><li><p>
          When using a <code class="literal">CONNECTION</code> string, you cannot
          use an '@' character in the password. You can get round this
          limitation by using the <a href="sql-syntax.html#create-server" title="12.1.16. CREATE SERVER Syntax"><code class="literal">CREATE
          SERVER</code></a> statement to create a server connection.
        </p></li><li><p>
          The <a href="server-administration.html#sysvar_insert_id"><code class="literal">insert_id</code></a> and
          <a href="server-administration.html#sysvar_timestamp"><code class="literal">timestamp</code></a> options are not
          propagated to the data provider.
        </p></li><li><p>
          Any <a href="sql-syntax.html#drop-table" title="12.1.28. DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> statement issued
          against a <code class="literal">FEDERATED</code> table drops only the
          local table, not the remote table.
        </p></li><li><p>
          <code class="literal">FEDERATED</code> tables do not work with the query
          cache.
        </p></li><li><p>
          User-defined partitioning is not supported for
          <code class="literal">FEDERATED</code> tables.
        </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="federated-storage-engine-resources"></a>13.11.4. <code class="literal">FEDERATED</code> Storage Engine Resources</h3></div></div></div><p>
      The following additional resources are available for the
      <code class="literal">FEDERATED</code> storage engine:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          A forum dedicated to the <code class="literal">FEDERATED</code> storage
          engine is available at
          <a href="http://forums.mysql.com/list.php?105" target="_top">http://forums.mysql.com/list.php?105</a>.
        </p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="example-storage-engine"></a>13.12. The <code class="literal">EXAMPLE</code> Storage Engine</h2></div></div></div><a class="indexterm" name="id1165434"></a><a class="indexterm" name="id1165443"></a><p>
    The <code class="literal">EXAMPLE</code> storage engine is a stub engine that
    does nothing. Its purpose is to serve as an example in the MySQL
    source code that illustrates how to begin writing new storage
    engines. As such, it is primarily of interest to developers.
  </p><p>
    To enable the <code class="literal">EXAMPLE</code> storage engine if you build
    MySQL from source, invoke <span><strong class="command">CMake</strong></span> with the
    <a href="installing.html#option_cmake_storage_engine_options"><code class="option">-DWITH_EXAMPLE_STORAGE_ENGINE</code></a>
    option.
  </p><p>
    To examine the source for the <code class="literal">EXAMPLE</code> engine,
    look in the <code class="filename">storage/example</code> directory of a
    MySQL source distribution.
  </p><p>
    When you create an <code class="literal">EXAMPLE</code> table, the server
    creates a table format file in the database directory. The file
    begins with the table name and has an <code class="filename">.frm</code>
    extension. No other files are created. No data can be stored into
    the table. Retrievals return an empty result.
  </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE test (i INT) ENGINE = EXAMPLE;</code></strong>
Query OK, 0 rows affected (0.78 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO test VALUES(1),(2),(3);</code></strong>
ERROR 1031 (HY000): Table storage engine for 'test' doesn't »
                    have this option

mysql&gt; <strong class="userinput"><code>SELECT * FROM test;</code></strong>
Empty set (0.31 sec)
</pre><p>
    The <code class="literal">EXAMPLE</code> storage engine does not support
    indexing.
  </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="storage-engines-other"></a>13.13. Other Storage Engines</h2></div></div></div><p>
      Other storage engines may be available from third parties and
      community members that have used the Custom Storage Engine
      interface.
    </p><p>
      You can find more information on the list of third party storage
      engines on the
      <a href="http://forge.mysql.com/projects/search.php?t=tag&amp;k=storage%20engine" target="_top">MySQL
      Forge Storage Engines</a> page.
    </p><div xmlns="http://www.w3.org/1999/xhtml" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><div class="admon-title">Note</div><p xmlns="">
        Third party engines are not supported by MySQL. For further
        information, documentation, installation guides, bug reporting
        or for any help or assistance with these engines, please contact
        the developer of the engine directly.
      </p></div><p>
      Third party engines that are known to be available include the
      following; please see the MySQL Forge links provided for more
      information:
    </p><div class="itemizedlist"><ul type="disc"><li><p>
          <span class="bold"><strong><a href="http://forge.mysql.com/projects/project.php?id=43" target="_top">PrimeBase
          XT (PBXT)</a></strong></span>: PBXT has been designed for
          modern, web-based, high concurrency environments.
        </p></li><li><p>
          <span class="bold"><strong><a href="http://forge.mysql.com/projects/project.php?id=82" target="_top">RitmarkFS</a></strong></span>:
          RitmarkFS enables you to access and manipulate the file system
          using SQL queries. RitmarkFS also supports file system
          replication and directory change tracking.
        </p></li><li><p>
          <span class="bold"><strong><a href="http://forge.mysql.com/projects/project.php?id=91" target="_top">Distributed
          Data Engine</a></strong></span>: The Distributed Data Engine is
          an Open Source project that is dedicated to provide a Storage
          Engine for distributed data according to workload statistics.
        </p></li><li><p>
          <span class="bold"><strong><a href="http://forge.mysql.com/projects/project.php?id=98" target="_top">mdbtools</a></strong></span>:
          A pluggable storage engine that enables read-only access to
          Microsoft Access <code class="filename">.mdb</code> database files.
        </p></li><li><p>
          <span class="bold"><strong><a href="http://forge.mysql.com/projects/project.php?id=139" target="_top">solidDB
          for MySQL</a></strong></span>: solidDB Storage Engine for MySQL
          is an open source, transactional storage engine for MySQL
          Server. It is designed for mission-critical implementations
          that require a robust, transactional database. solidDB Storage
          Engine for MySQL is a multi-threaded storage engine that
          supports full ACID compliance with all expected transaction
          isolation levels, row-level locking, and Multi-Version
          Concurrency Control (MVCC) with nonblocking reads and writes.
        </p></li><li><p>
          <span class="bold"><strong><a href="http://www.blobstreaming.org/" target="_top">BLOB
          Streaming Engine (MyBS)</a></strong></span>: The Scalable BLOB
          Streaming infrastructure for MySQL will transform MySQL into a
          scalable media server capable of streaming pictures, films,
          MP3 files and other binary and text objects (BLOBs) directly
          in and out of the database.
        </p></li></ul></div><p>
      For more information on developing a customer storage engine that
      can be used with the Pluggable Storage Engine Architecture, see
      <a href="http://forge.mysql.com/wiki/MySQL_Internals_Custom_Engine" target="_top">Writing
      a Custom Storage Engine</a> on
      <a href="http://forge.mysql.com/wiki" target="_top">MySQL Forge</a>.
    </p></div></div><div class="copyright-footer">
    Copyright © 1997, 2012, Oracle and/or its affiliates. All
    rights reserved.
  <a href="preface.html#legalnotice">Legal Notices</a></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-syntax.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ha-overview.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 12. SQL Statement Syntax </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 14. High Availability and Scalability</td></tr></table></div></body></html>
