  <div id="fileHeader">
    <h1>whiny_nil.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activesupport/lib/active_support/whiny_nil.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Jul 10 12:41:59 -0700 2006</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre># Extensions to nil which allow for more helpful error messages for 
# people who are new to rails.
#
# The aim is to ensure that when users pass nil to methods where that isn't
# appropriate, instead of NoMethodError and the name of some method used
# by the framework users will see a message explaining what type of object 
# was expected.

class NilClass
  WHINERS = [ ::ActiveRecord::Base, ::Array ]
  
  @@method_class_map = Hash.new
  
  WHINERS.each do |klass|
    methods = klass.public_instance_methods - public_instance_methods
    methods.each do |method|
      @@method_class_map[method.to_sym] = klass
    end
  end
  
  def id
    raise RuntimeError, &quot;Called id for nil, which would mistakenly be 4 -- if you really wanted the id of nil, use object_id&quot;, caller
  end

  private
    def method_missing(method, *args, &amp;block)
      raise_nil_warning_for @@method_class_map[method], method, caller
    end

    def raise_nil_warning_for(klass = nil, selector = nil, with_caller = nil)
      message = &quot;You have a nil object when you didn't expect it!&quot;
      message &lt;&lt; &quot;\nYou might have expected an instance of #{klass}.&quot; if klass
      message &lt;&lt; &quot;\nThe error occurred while evaluating nil.#{selector}&quot; if selector
      
      raise NoMethodError, message, with_caller || caller
    end
end

</pre>
    </div>