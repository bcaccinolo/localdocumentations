  <div id="fileHeader">
    <h1>time_zone.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activesupport/lib/active_support/values/time_zone.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Wed May 31 15:43:53 -0700 2006</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre># A value object representing a time zone. A time zone is simply a named
# offset (in seconds) from GMT. Note that two time zone objects are only
# equivalent if they have both the same offset, and the same name.
#
# A TimeZone instance may be used to convert a Time value to the corresponding
# time zone.
#
# The class also includes #all, which returns a list of all TimeZone objects.
class TimeZone
  include Comparable

  attr_reader :name, :utc_offset

  # Create a new TimeZone object with the given name and offset. The offset is
  # the number of seconds that this time zone is offset from UTC (GMT). Seconds
  # were chosen as the offset unit because that is the unit that Ruby uses
  # to represent time zone offsets (see Time#utc_offset).
  def initialize(name, utc_offset)
    @name = name
    @utc_offset = utc_offset
  end

  # Returns the offset of this time zone as a formatted string, of the
  # format &quot;+HH:MM&quot;. If the offset is zero, this returns the empty
  # string. If +colon+ is false, a colon will not be inserted into the
  # result.
  def formatted_offset( colon=true )
    return &quot;&quot; if utc_offset == 0
    sign = (utc_offset &lt; 0 ? -1 : 1)
    hours = utc_offset.abs / 3600
    minutes = (utc_offset.abs % 3600) / 60
    &quot;%+03d%s%02d&quot; % [ hours * sign, colon ? &quot;:&quot; : &quot;&quot;, minutes ]
  end

  # Compute and return the current time, in the time zone represented by
  # +self+.
  def now
    adjust(Time.now)
  end

  # Return the current date in this time zone.
  def today
    now.to_date
  end

  # Adjust the given time to the time zone represented by +self+.
  def adjust(time)
    time = time.to_time
    time + utc_offset - time.utc_offset
  end

  # Reinterprets the given time value as a time in the current time
  # zone, and then adjusts it to return the corresponding time in the
  # local time zone.
  def unadjust(time)
    time = Time.local(*time.to_time.to_a)
    time - utc_offset + time.utc_offset
  end

  # Compare this time zone to the parameter. The two are comapred first on
  # their offsets, and then by name.
  def &lt;=&gt;(zone)
    result = (utc_offset &lt;=&gt; zone.utc_offset)
    result = (name &lt;=&gt; zone.name) if result == 0
    result
  end

  # Returns a textual representation of this time zone.
  def to_s
    &quot;(GMT#{formatted_offset}) #{name}&quot;
  end

  @@zones = nil

  class &lt;&lt; self
    # Create a new TimeZone instance with the given name and offset.
    def create(name, offset)
      zone = allocate
      zone.send :initialize, name, offset
      zone
    end

    # Return a TimeZone instance with the given name, or +nil+ if no
    # such TimeZone instance exists. (This exists to support the use of
    # this class with the #composed_of macro.)
    def new(name)
      self[name]
    end

    # Return an array of all TimeZone objects. There are multiple TimeZone
    # objects per time zone, in many cases, to make it easier for users to
    # find their own time zone.
    def all
      unless @@zones
        @@zones = []
        [[-43_200, &quot;International Date Line West&quot; ],
         [-39_600, &quot;Midway Island&quot;, &quot;Samoa&quot; ],
         [-36_000, &quot;Hawaii&quot; ],
         [-32_400, &quot;Alaska&quot; ],
         [-28_800, &quot;Pacific Time (US &amp; Canada)&quot;, &quot;Tijuana&quot; ],
         [-25_200, &quot;Mountain Time (US &amp; Canada)&quot;, &quot;Chihuahua&quot;, &quot;La Paz&quot;,
                   &quot;Mazatlan&quot;, &quot;Arizona&quot; ],
         [-21_600, &quot;Central Time (US &amp; Canada)&quot;, &quot;Saskatchewan&quot;, &quot;Guadalajara&quot;,
                   &quot;Mexico City&quot;, &quot;Monterrey&quot;, &quot;Central America&quot; ],
         [-18_000, &quot;Eastern Time (US &amp; Canada)&quot;, &quot;Indiana (East)&quot;, &quot;Bogota&quot;,
                   &quot;Lima&quot;, &quot;Quito&quot; ],
         [-14_400, &quot;Atlantic Time (Canada)&quot;, &quot;Caracas&quot;, &quot;La Paz&quot;, &quot;Santiago&quot; ],
         [-12_600, &quot;Newfoundland&quot; ],
         [-10_800, &quot;Brasilia&quot;, &quot;Buenos Aires&quot;, &quot;Georgetown&quot;, &quot;Greenland&quot; ],
         [ -7_200, &quot;Mid-Atlantic&quot; ],
         [ -3_600, &quot;Azores&quot;, &quot;Cape Verde Is.&quot; ],
         [      0, &quot;Dublin&quot;, &quot;Edinburgh&quot;, &quot;Lisbon&quot;, &quot;London&quot;, &quot;Casablanca&quot;,
                   &quot;Monrovia&quot; ],
         [  3_600, &quot;Belgrade&quot;, &quot;Bratislava&quot;, &quot;Budapest&quot;, &quot;Ljubljana&quot;, &quot;Prague&quot;,
                   &quot;Sarajevo&quot;, &quot;Skopje&quot;, &quot;Warsaw&quot;, &quot;Zagreb&quot;, &quot;Brussels&quot;,
                   &quot;Copenhagen&quot;, &quot;Madrid&quot;, &quot;Paris&quot;, &quot;Amsterdam&quot;, &quot;Berlin&quot;,
                   &quot;Bern&quot;, &quot;Rome&quot;, &quot;Stockholm&quot;, &quot;Vienna&quot;,
                   &quot;West Central Africa&quot; ],
         [  7_200, &quot;Bucharest&quot;, &quot;Cairo&quot;, &quot;Helsinki&quot;, &quot;Kyev&quot;, &quot;Riga&quot;, &quot;Sofia&quot;,
                   &quot;Tallinn&quot;, &quot;Vilnius&quot;, &quot;Athens&quot;, &quot;Istanbul&quot;, &quot;Minsk&quot;,
                   &quot;Jerusalem&quot;, &quot;Harare&quot;, &quot;Pretoria&quot; ],
         [ 10_800, &quot;Moscow&quot;, &quot;St. Petersburg&quot;, &quot;Volgograd&quot;, &quot;Kuwait&quot;, &quot;Riyadh&quot;,
                   &quot;Nairobi&quot;, &quot;Baghdad&quot; ],
         [ 12_600, &quot;Tehran&quot; ],
         [ 14_400, &quot;Abu Dhabi&quot;, &quot;Muscat&quot;, &quot;Baku&quot;, &quot;Tbilisi&quot;, &quot;Yerevan&quot; ],
         [ 16_200, &quot;Kabul&quot; ],
         [ 18_000, &quot;Ekaterinburg&quot;, &quot;Islamabad&quot;, &quot;Karachi&quot;, &quot;Tashkent&quot; ],
         [ 19_800, &quot;Chennai&quot;, &quot;Kolkata&quot;, &quot;Mumbai&quot;, &quot;New Delhi&quot; ],
         [ 20_700, &quot;Kathmandu&quot; ],
         [ 21_600, &quot;Astana&quot;, &quot;Dhaka&quot;, &quot;Sri Jayawardenepura&quot;, &quot;Almaty&quot;,
                   &quot;Novosibirsk&quot; ],
         [ 23_400, &quot;Rangoon&quot; ],
         [ 25_200, &quot;Bangkok&quot;, &quot;Hanoi&quot;, &quot;Jakarta&quot;, &quot;Krasnoyarsk&quot; ],
         [ 28_800, &quot;Beijing&quot;, &quot;Chongqing&quot;, &quot;Hong Kong&quot;, &quot;Urumqi&quot;,
                   &quot;Kuala Lumpur&quot;, &quot;Singapore&quot;, &quot;Taipei&quot;, &quot;Perth&quot;, &quot;Irkutsk&quot;,
                   &quot;Ulaan Bataar&quot; ],
         [ 32_400, &quot;Seoul&quot;, &quot;Osaka&quot;, &quot;Sapporo&quot;, &quot;Tokyo&quot;, &quot;Yakutsk&quot; ],
         [ 34_200, &quot;Darwin&quot;, &quot;Adelaide&quot; ],
         [ 36_000, &quot;Canberra&quot;, &quot;Melbourne&quot;, &quot;Sydney&quot;, &quot;Brisbane&quot;, &quot;Hobart&quot;,
                   &quot;Vladivostok&quot;, &quot;Guam&quot;, &quot;Port Moresby&quot; ],
         [ 39_600, &quot;Magadan&quot;, &quot;Solomon Is.&quot;, &quot;New Caledonia&quot; ],
         [ 43_200, &quot;Fiji&quot;, &quot;Kamchatka&quot;, &quot;Marshall Is.&quot;, &quot;Auckland&quot;,
                   &quot;Wellington&quot; ],
         [ 46_800, &quot;Nuku'alofa&quot; ]].
        each do |offset, *places|
          places.each { |place| @@zones &lt;&lt; create(place, offset).freeze }
        end
        @@zones.sort!
      end
      @@zones
    end

    # Locate a specific time zone object. If the argument is a string, it
    # is interpreted to mean the name of the timezone to locate. If it is a
    # numeric value it is either the hour offset, or the second offset, of the
    # timezone to find. (The first one with that offset will be returned.)
    # Returns +nil+ if no such time zone is known to the system.
    def [](arg)
      case arg
        when String
          all.find { |z| z.name == arg }
        when Numeric
          arg *= 3600 if arg.abs &lt;= 13
          all.find { |z| z.utc_offset == arg.to_i }
        else
          raise ArgumentError, &quot;invalid argument to TimeZone[]: #{arg.inspect}&quot;
      end
    end

    # A regular expression that matches the names of all time zones in
    # the USA.
    US_ZONES = /US|Arizona|Indiana|Hawaii|Alaska/ unless defined?(US_ZONES)

    # A convenience method for returning a collection of TimeZone objects
    # for time zones in the USA.
    def us_zones
      all.find_all { |z| z.name =~ US_ZONES }
    end
  end
end
</pre>
    </div>