  <div id="fileHeader">
    <h1>asset_tag_helper.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>actionpack/lib/action_view/helpers/asset_tag_helper.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Fri Jan 05 12:43:57 -0800 2007</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'cgi'
require File.dirname(__FILE__) + '/url_helper'
require File.dirname(__FILE__) + '/tag_helper'

module ActionView
  module Helpers #:nodoc:
    # Provides methods for linking an HTML page together with other assets such
    # as images, javascripts, stylesheets, and feeds. You can direct Rails to
    # link to assets from a dedicated assets server by setting ActionController::Base.asset_host
    # in your environment.rb. These methods do not verify the assets exist before
    # linking to them.
    #
    #   ActionController::Base.asset_host = &quot;http://assets.example.com&quot;
    #   image_tag(&quot;rails.png&quot;)  
    #     =&gt; &lt;img src=&quot;http://assets.example.com/images/rails.png&quot; alt=&quot;Rails&quot; /&gt;
    #   stylesheet_include_tag(&quot;application&quot;)
    #     =&gt; &lt;link href=&quot;http://assets.example.com/stylesheets/application.css&quot; media=&quot;screen&quot; rel=&quot;Stylesheet&quot; type=&quot;text/css&quot; /&gt;
    module AssetTagHelper
      # Returns a link tag that browsers and news readers can use to auto-detect
      # an RSS or ATOM feed. The +type+ can either be &lt;tt&gt;:rss&lt;/tt&gt; (default) or 
      # &lt;tt&gt;:atom&lt;/tt&gt;. Control the link options in url_for format using the
      # +url_options+. You can modify the LINK tag itself in +tag_options+.
      #
      # Tag Options:
      # * &lt;tt&gt;:rel&lt;/tt&gt;  - Specify the relation of this link, defaults to &quot;alternate&quot;
      # * &lt;tt&gt;:type&lt;/tt&gt;  - Override the auto-generated mime type
      # * &lt;tt&gt;:title&lt;/tt&gt;  - Specify the title of the link, defaults to the +type+
      #
      #  auto_discovery_link_tag # =&gt;
      #     &lt;link rel=&quot;alternate&quot; type=&quot;application/rss+xml&quot; title=&quot;RSS&quot; href=&quot;http://www.curenthost.com/controller/action&quot; /&gt;
      #  auto_discovery_link_tag(:atom) # =&gt;
      #     &lt;link rel=&quot;alternate&quot; type=&quot;application/atom+xml&quot; title=&quot;ATOM&quot; href=&quot;http://www.curenthost.com/controller/action&quot; /&gt;
      #  auto_discovery_link_tag(:rss, {:action =&gt; &quot;feed&quot;}) # =&gt;
      #     &lt;link rel=&quot;alternate&quot; type=&quot;application/rss+xml&quot; title=&quot;RSS&quot; href=&quot;http://www.curenthost.com/controller/feed&quot; /&gt;
      #  auto_discovery_link_tag(:rss, {:action =&gt; &quot;feed&quot;}, {:title =&gt; &quot;My RSS&quot;}) # =&gt;
      #     &lt;link rel=&quot;alternate&quot; type=&quot;application/rss+xml&quot; title=&quot;My RSS&quot; href=&quot;http://www.curenthost.com/controller/feed&quot; /&gt;
      def auto_discovery_link_tag(type = :rss, url_options = {}, tag_options = {})
        tag(
          &quot;link&quot;, 
          &quot;rel&quot;   =&gt; tag_options[:rel] || &quot;alternate&quot;,
          &quot;type&quot;  =&gt; tag_options[:type] || &quot;application/#{type}+xml&quot;,
          &quot;title&quot; =&gt; tag_options[:title] || type.to_s.upcase,
          &quot;href&quot;  =&gt; url_options.is_a?(Hash) ? url_for(url_options.merge(:only_path =&gt; false)) : url_options
        )
      end

      # Computes the path to a javascript asset in the public javascripts directory.
      # If the +source+ filename has no extension, .js will be appended.
      # Full paths from the document root will be passed through.
      # Used internally by javascript_include_tag to build the script path.
      #
      #   javascript_path &quot;xmlhr&quot; # =&gt; /javascripts/xmlhr.js
      #   javascript_path &quot;dir/xmlhr.js&quot; # =&gt; /javascripts/dir/xmlhr.js
      #   javascript_path &quot;/dir/xmlhr&quot; # =&gt; /dir/xmlhr.js
      def javascript_path(source)
        compute_public_path(source, 'javascripts', 'js')        
      end

      JAVASCRIPT_DEFAULT_SOURCES = ['prototype', 'effects', 'dragdrop', 'controls'] unless const_defined?(:JAVASCRIPT_DEFAULT_SOURCES)
      @@javascript_default_sources = JAVASCRIPT_DEFAULT_SOURCES.dup

      # Returns an html script tag for each of the +sources+ provided. You
      # can pass in the filename (.js extension is optional) of javascript files
      # that exist in your public/javascripts directory for inclusion into the
      # current page or you can pass the full path relative to your document
      # root. To include the Prototype and Scriptaculous javascript libraries in
      # your application, pass &lt;tt&gt;:defaults&lt;/tt&gt; as the source. When using 
      # :defaults, if an &lt;tt&gt;application.js&lt;/tt&gt; file exists in your public 
      # javascripts directory, it will be included as well. You can modify the 
      # html attributes of the script tag by passing a hash as the last argument. 
      #
      #   javascript_include_tag &quot;xmlhr&quot; # =&gt;
      #     &lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/xmlhr.js&quot;&gt;&lt;/script&gt;
      #
      #   javascript_include_tag &quot;common.javascript&quot;, &quot;/elsewhere/cools&quot; # =&gt;
      #     &lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/common.javascript&quot;&gt;&lt;/script&gt;
      #     &lt;script type=&quot;text/javascript&quot; src=&quot;/elsewhere/cools.js&quot;&gt;&lt;/script&gt;
      #
      #   javascript_include_tag :defaults # =&gt;
      #     &lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/prototype.js&quot;&gt;&lt;/script&gt;
      #     &lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/effects.js&quot;&gt;&lt;/script&gt;
      #     ...
      #     &lt;script type=&quot;text/javascript&quot; src=&quot;/javascripts/application.js&quot;&gt;&lt;/script&gt; *see below
      def javascript_include_tag(*sources)
        options = sources.last.is_a?(Hash) ? sources.pop.stringify_keys : { }

        if sources.include?(:defaults) 
          sources = sources[0..(sources.index(:defaults))] + 
            @@javascript_default_sources.dup + 
            sources[(sources.index(:defaults) + 1)..sources.length]

          sources.delete(:defaults) 
          sources &lt;&lt; &quot;application&quot; if defined?(RAILS_ROOT) &amp;&amp; File.exists?(&quot;#{RAILS_ROOT}/public/javascripts/application.js&quot;) 
        end

        sources.collect do |source|
          source = javascript_path(source)        
          content_tag(&quot;script&quot;, &quot;&quot;, { &quot;type&quot; =&gt; &quot;text/javascript&quot;, &quot;src&quot; =&gt; source }.merge(options))
        end.join(&quot;\n&quot;)
      end
      
      # Register one or more additional JavaScript files to be included when
      # &lt;tt&gt;javascript_include_tag :defaults&lt;/tt&gt; is called. This method is
      # only intended to be called from plugin initialization to register additional 
      # .js files that the plugin installed in &lt;tt&gt;public/javascripts&lt;/tt&gt;.
      def self.register_javascript_include_default(*sources)
        @@javascript_default_sources.concat(sources)
      end
      
      def self.reset_javascript_include_default #:nodoc:
        @@javascript_default_sources = JAVASCRIPT_DEFAULT_SOURCES.dup
      end

      # Computes the path to a stylesheet asset in the public stylesheets directory.
      # If the +source+ filename has no extension, .css will be appended.
      # Full paths from the document root will be passed through.
      # Used internally by stylesheet_link_tag to build the stylesheet path.
      #
      #   stylesheet_path &quot;style&quot; # =&gt; /stylesheets/style.css
      #   stylesheet_path &quot;dir/style.css&quot; # =&gt; /stylesheets/dir/style.css
      #   stylesheet_path &quot;/dir/style.css&quot; # =&gt; /dir/style.css
      def stylesheet_path(source)
        compute_public_path(source, 'stylesheets', 'css')
      end

      # Returns a stylesheet link tag for the sources specified as arguments. If
      # you don't specify an extension, .css will be appended automatically.
      # You can modify the link attributes by passing a hash as the last argument.
      #
      #   stylesheet_link_tag &quot;style&quot; # =&gt;
      #     &lt;link href=&quot;/stylesheets/style.css&quot; media=&quot;screen&quot; rel=&quot;Stylesheet&quot; type=&quot;text/css&quot; /&gt;
      #
      #   stylesheet_link_tag &quot;style&quot;, :media =&gt; &quot;all&quot; # =&gt;
      #     &lt;link href=&quot;/stylesheets/style.css&quot; media=&quot;all&quot; rel=&quot;Stylesheet&quot; type=&quot;text/css&quot; /&gt;
      #
      #   stylesheet_link_tag &quot;random.styles&quot;, &quot;/css/stylish&quot; # =&gt;
      #     &lt;link href=&quot;/stylesheets/random.styles&quot; media=&quot;screen&quot; rel=&quot;Stylesheet&quot; type=&quot;text/css&quot; /&gt;
      #     &lt;link href=&quot;/css/stylish.css&quot; media=&quot;screen&quot; rel=&quot;Stylesheet&quot; type=&quot;text/css&quot; /&gt;
      def stylesheet_link_tag(*sources)
        options = sources.last.is_a?(Hash) ? sources.pop.stringify_keys : { }
        sources.collect do |source|
          source = stylesheet_path(source)
          tag(&quot;link&quot;, { &quot;rel&quot; =&gt; &quot;Stylesheet&quot;, &quot;type&quot; =&gt; &quot;text/css&quot;, &quot;media&quot; =&gt; &quot;screen&quot;, &quot;href&quot; =&gt; source }.merge(options))
        end.join(&quot;\n&quot;)
      end

      # Computes the path to an image asset in the public images directory.
      # Full paths from the document root will be passed through.
      # Used internally by image_tag to build the image path. Passing
      # a filename without an extension is deprecated.
      #
      #   image_path(&quot;edit.png&quot;)  # =&gt; /images/edit.png
      #   image_path(&quot;icons/edit.png&quot;)  # =&gt; /images/icons/edit.png
      #   image_path(&quot;/icons/edit.png&quot;)  # =&gt; /icons/edit.png
      def image_path(source)
        unless (source.split(&quot;/&quot;).last || source).include?(&quot;.&quot;) || source.blank?
          ActiveSupport::Deprecation.warn(
            &quot;You've called image_path with a source that doesn't include an extension. &quot; +
            &quot;In Rails 2.0, that will not result in .png automatically being appended. &quot; +
            &quot;So you should call image_path('#{source}.png') instead&quot;, caller
          )
        end

        compute_public_path(source, 'images', 'png')
      end

      # Returns an html image tag for the +source+. The +source+ can be a full
      # path or a file that exists in your public images directory. Note that 
      # specifying a filename without the extension is now deprecated in Rails.
      # You can add html attributes using the +options+. The +options+ supports
      # two additional keys for convienence and conformance:
      #
      # * &lt;tt&gt;:alt&lt;/tt&gt;  - If no alt text is given, the file name part of the 
      #   +source+ is used (capitalized and without the extension)
      # * &lt;tt&gt;:size&lt;/tt&gt; - Supplied as &quot;{Width}x{Height}&quot;, so &quot;30x45&quot; becomes 
      #   width=&quot;30&quot; and height=&quot;45&quot;. &lt;tt&gt;:size&lt;/tt&gt; will be ignored if the
      #   value is not in the correct format.
      #
      #  image_tag(&quot;icon.png&quot;)  # =&gt;
      #    &lt;img src=&quot;/images/icon.png&quot; alt=&quot;Icon&quot; /&gt;
      #  image_tag(&quot;icon.png&quot;, :size =&gt; &quot;16x10&quot;, :alt =&gt; &quot;Edit Entry&quot;)  # =&gt;
      #    &lt;img src=&quot;/images/icon.png&quot; width=&quot;16&quot; height=&quot;10&quot; alt=&quot;Edit Entry&quot; /&gt;
      #  image_tag(&quot;/icons/icon.gif&quot;, :size =&gt; &quot;16x16&quot;)  # =&gt;
      #    &lt;img src=&quot;/icons/icon.gif&quot; width=&quot;16&quot; height=&quot;16&quot; alt=&quot;Icon&quot; /&gt;
      def image_tag(source, options = {})
        options.symbolize_keys!
                
        options[:src] = image_path(source)
        options[:alt] ||= File.basename(options[:src], '.*').split('.').first.capitalize
        
        if options[:size]
          options[:width], options[:height] = options[:size].split(&quot;x&quot;) if options[:size] =~ %r{^\d+x\d+$}
          options.delete(:size)
        end

        tag(&quot;img&quot;, options)
      end
      
      private
        def compute_public_path(source, dir, ext)
          source = source.dup
          source &lt;&lt; &quot;.#{ext}&quot; if File.extname(source).blank?
          unless source =~ %r{^[-a-z]+://}
            source = &quot;/#{dir}/#{source}&quot; unless source[0] == ?/
            asset_id = rails_asset_id(source)
            source &lt;&lt; '?' + asset_id if defined?(RAILS_ROOT) &amp;&amp; !asset_id.blank?
            source = &quot;#{ActionController::Base.asset_host}#{@controller.request.relative_url_root}#{source}&quot;
          end
          source
        end
        
        def rails_asset_id(source)
          ENV[&quot;RAILS_ASSET_ID&quot;] || 
            File.mtime(&quot;#{RAILS_ROOT}/public/#{source}&quot;).to_i.to_s rescue &quot;&quot;
        end
    end
  end
end
</pre>
    </div>