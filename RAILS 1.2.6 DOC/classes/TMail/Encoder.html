  <div id="C00000251">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />Encoder<br/>
  In:
<a href="#" onclick="jsHref('files/actionmailer/lib/action_mailer/vendor/tmail/encode_rb.html');">actionmailer/lib/action_mailer/vendor/tmail/encode.rb</a>

Parent:&nbsp;
Object
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
FIXME: This class can handle only (euc-jp/shift_jis -&gt; iso-2022-jp).
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M000869&name=dest" >dest</a></li>
  <li><a href="index.html?a=M000864&name=encode" >encode</a></li>
  <li><a href="index.html?a=M000882&name=encode_value" >encode_value</a></li>
  <li><a href="index.html?a=M000874&name=header_body" >header_body</a></li>
  <li><a href="index.html?a=M000872&name=header_line" >header_line</a></li>
  <li><a href="index.html?a=M000873&name=header_name" >header_name</a></li>
  <li><a href="index.html?a=M000881&name=kv_pair" >kv_pair</a></li>
  <li><a href="index.html?a=M000877&name=lwsp" >lwsp</a></li>
  <li><a href="index.html?a=M000878&name=meta" >meta</a></li>
  <li><a href="index.html?a=M000865&name=new" >new</a></li>
  <li><a href="index.html?a=M000866&name=normalize_encoding" >normalize_encoding</a></li>
  <li><a href="index.html?a=M000880&name=phrase" >phrase</a></li>
  <li><a href="index.html?a=M000870&name=puts" >puts</a></li>
  <li><a href="index.html?a=M000867&name=reset" >reset</a></li>
  <li><a href="index.html?a=M000875&name=space" >space</a></li>
  <li><a href="index.html?a=M000876&name=spc" >spc</a></li>
  <li><a href="index.html?a=M000868&name=terminate" >terminate</a></li>
  <li><a href="index.html?a=M000879&name=text" >text</a></li>
  <li><a href="index.html?a=M000871&name=write" >write</a></li>
  </ul>

<div class="sectiontitle">Included Modules</div>
<ul>
  <li><a href="#" onclick="jsHref('classes/TMail/TextUtils.html');">TextUtils</a></li>
</ul>



  <div class="sectiontitle">Constants</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class="attr-name">BENCODE_DEBUG</td>
    <td>=</td>
    <td class="attr-value">false unless defined?(BENCODE_DEBUG)</td>
  </tr>
  <tr valign='top'>
    <td class="attr-name">SPACER</td>
    <td>=</td>
    <td class="attr-value">&quot;\t&quot;</td>
  </tr>
  <tr valign='top'>
    <td class="attr-name">MAX_LINE_LEN</td>
    <td>=</td>
    <td class="attr-value">70</td>
  </tr>
  <tr valign='top'>
    <td class="attr-name">OPTIONS</td>
    <td>=</td>
    <td class="attr-value">{       'EUC'  =&gt; '-Ej -m0',       'SJIS' =&gt; '-Sj -m0',       'UTF8' =&gt; nil,      # FIXME       'NONE' =&gt; nil</td>
  </tr>
  <tr valign='top'>
    <td class="attr-name">METHOD_ID</td>
    <td>=</td>
    <td class="attr-value">{       ?j =&gt; :extract_J,       ?e =&gt; :extract_E,       ?a =&gt; :extract_A,       ?s =&gt; :extract_S</td>
  </tr>
  </table>


<div class="sectiontitle">Public Class methods</div>
<div id="M000864" class="method">
  <div id="M000864_title" class="title">
    <b>encode</b>( str )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000864_source')" id="l_M000864_source">show source</a> ]</p>
  <div id="M000864_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 172</span>
172:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Encoder</span>.<span class="ruby-identifier">encode</span>( <span class="ruby-identifier">str</span> )
173:       <span class="ruby-identifier">e</span> = <span class="ruby-identifier">new</span>()
174:       <span class="ruby-identifier">e</span>.<span class="ruby-identifier">header_body</span> <span class="ruby-identifier">str</span>
175:       <span class="ruby-identifier">e</span>.<span class="ruby-identifier">terminate</span>
176:       <span class="ruby-identifier">e</span>.<span class="ruby-identifier">dest</span>.<span class="ruby-identifier">string</span>
177:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000865" class="method">
  <div id="M000865_title" class="title">
    <b>new</b>( dest = nil, encoding = nil, eol = &quot;\r\n&quot;, limit = nil )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000865_source')" id="l_M000865_source">show source</a> ]</p>
  <div id="M000865_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 189</span>
189:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>( <span class="ruby-identifier">dest</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">encoding</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">eol</span> = <span class="ruby-value str">&quot;\r\n&quot;</span>, <span class="ruby-identifier">limit</span> = <span class="ruby-keyword kw">nil</span> )
190:       <span class="ruby-ivar">@f</span> = <span class="ruby-constant">StrategyInterface</span>.<span class="ruby-identifier">create_dest</span>(<span class="ruby-identifier">dest</span>)
191:       <span class="ruby-ivar">@opt</span> = <span class="ruby-constant">OPTIONS</span>[<span class="ruby-identifier">$KCODE</span>]
192:       <span class="ruby-ivar">@eol</span> = <span class="ruby-identifier">eol</span>
193:       <span class="ruby-identifier">reset</span>
194:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M000869" class="method">
  <div id="M000869_title" class="title">
    <b>dest</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000869_source')" id="l_M000869_source">show source</a> ]</p>
  <div id="M000869_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 214</span>
214:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dest</span>
215:       <span class="ruby-ivar">@f</span>
216:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000882" class="method">
  <div id="M000882_title" class="title">
    <b>encode_value</b>( str )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000882_source')" id="l_M000882_source">show source</a> ]</p>
  <div id="M000882_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 288</span>
288:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_value</span>( <span class="ruby-identifier">str</span> )
289:       <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">TOKEN_UNSAFE</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-value str">'%%%02x'</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">s</span>[<span class="ruby-value">0</span>] }
290:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000874" class="method">
  <div id="M000874_title" class="title">
    <b>header_body</b>( str )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000874_source')" id="l_M000874_source">show source</a> ]</p>
  <div id="M000874_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 241</span>
241:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">header_body</span>( <span class="ruby-identifier">str</span> )
242:       <span class="ruby-identifier">scanadd</span> <span class="ruby-identifier">normalize_encoding</span>(<span class="ruby-identifier">str</span>)
243:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000872" class="method">
  <div id="M000872_title" class="title">
    <b>header_line</b>( line )
  </div>
  <div class="description">
  <p>
add
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000872_source')" id="l_M000872_source">show source</a> ]</p>
  <div id="M000872_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 231</span>
231:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">header_line</span>( <span class="ruby-identifier">line</span> )
232:       <span class="ruby-identifier">scanadd</span> <span class="ruby-identifier">line</span>
233:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000873" class="method">
  <div id="M000873_title" class="title">
    <b>header_name</b>( name )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000873_source')" id="l_M000873_source">show source</a> ]</p>
  <div id="M000873_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 235</span>
235:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">header_name</span>( <span class="ruby-identifier">name</span> )
236:       <span class="ruby-identifier">add_text</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/-/</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">capitalize</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">'-'</span>)
237:       <span class="ruby-identifier">add_text</span> <span class="ruby-value str">':'</span>
238:       <span class="ruby-identifier">add_lwsp</span> <span class="ruby-value str">' '</span>
239:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000881" class="method">
  <div id="M000881_title" class="title">
    <b>kv_pair</b>( k, v )
  </div>
  <div class="description">
  <p>
FIXME: implement line folding
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000881_source')" id="l_M000881_source">show source</a> ]</p>
  <div id="M000881_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 274</span>
274:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">kv_pair</span>( <span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span> )
275:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nil?</span>
276:       <span class="ruby-identifier">v</span> = <span class="ruby-identifier">normalize_encoding</span>(<span class="ruby-identifier">v</span>)
277:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">token_safe?</span>(<span class="ruby-identifier">v</span>)
278:         <span class="ruby-identifier">add_text</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'='</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">v</span>
279:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-keyword kw">not</span> <span class="ruby-constant">CONTROL_CHAR</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">v</span>
280:         <span class="ruby-identifier">add_text</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'='</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">quote_token</span>(<span class="ruby-identifier">v</span>)
281:       <span class="ruby-keyword kw">else</span>
282:         <span class="ruby-comment cmt"># apply RFC2231 encoding</span>
283:         <span class="ruby-identifier">kv</span> = <span class="ruby-identifier">k</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'*='</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;iso-2022-jp'ja'&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">encode_value</span>(<span class="ruby-identifier">v</span>)
284:         <span class="ruby-identifier">add_text</span> <span class="ruby-identifier">kv</span>
285:       <span class="ruby-keyword kw">end</span>
286:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000877" class="method">
  <div id="M000877_title" class="title">
    <b>lwsp</b>( str )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000877_source')" id="l_M000877_source">show source</a> ]</p>
  <div id="M000877_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 251</span>
251:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">lwsp</span>( <span class="ruby-identifier">str</span> )
252:       <span class="ruby-identifier">add_lwsp</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/[\r\n]+[^\r\n]*\z/</span>, <span class="ruby-value str">''</span>)
253:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000878" class="method">
  <div id="M000878_title" class="title">
    <b>meta</b>( str )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000878_source')" id="l_M000878_source">show source</a> ]</p>
  <div id="M000878_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 255</span>
255:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">meta</span>( <span class="ruby-identifier">str</span> )
256:       <span class="ruby-identifier">add_text</span> <span class="ruby-identifier">str</span>
257:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000866" class="method">
  <div id="M000866_title" class="title">
    <b>normalize_encoding</b>( str )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000866_source')" id="l_M000866_source">show source</a> ]</p>
  <div id="M000866_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 196</span>
196:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">normalize_encoding</span>( <span class="ruby-identifier">str</span> )
197:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@opt</span>
198:       <span class="ruby-keyword kw">then</span> <span class="ruby-constant">NKF</span>.<span class="ruby-identifier">nkf</span>(<span class="ruby-ivar">@opt</span>, <span class="ruby-identifier">str</span>)
199:       <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">str</span>
200:       <span class="ruby-keyword kw">end</span>
201:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000880" class="method">
  <div id="M000880_title" class="title">
    <b>phrase</b>( str )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000880_source')" id="l_M000880_source">show source</a> ]</p>
  <div id="M000880_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 263</span>
263:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">phrase</span>( <span class="ruby-identifier">str</span> )
264:       <span class="ruby-identifier">str</span> = <span class="ruby-identifier">normalize_encoding</span>(<span class="ruby-identifier">str</span>)
265:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">CONTROL_CHAR</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">str</span>
266:         <span class="ruby-identifier">scanadd</span> <span class="ruby-identifier">str</span>
267:       <span class="ruby-keyword kw">else</span>
268:         <span class="ruby-identifier">add_text</span> <span class="ruby-identifier">quote_phrase</span>(<span class="ruby-identifier">str</span>)
269:       <span class="ruby-keyword kw">end</span>
270:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000870" class="method">
  <div id="M000870_title" class="title">
    <b>puts</b>( str = nil )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000870_source')" id="l_M000870_source">show source</a> ]</p>
  <div id="M000870_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 218</span>
218:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">puts</span>( <span class="ruby-identifier">str</span> = <span class="ruby-keyword kw">nil</span> )
219:       <span class="ruby-ivar">@f</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">str</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">str</span>
220:       <span class="ruby-ivar">@f</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@eol</span>
221:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000867" class="method">
  <div id="M000867_title" class="title">
    <b>reset</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000867_source')" id="l_M000867_source">show source</a> ]</p>
  <div id="M000867_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 203</span>
203:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset</span>
204:       <span class="ruby-ivar">@text</span> = <span class="ruby-value str">''</span>
205:       <span class="ruby-ivar">@lwsp</span> = <span class="ruby-value str">''</span>
206:       <span class="ruby-ivar">@curlen</span> = <span class="ruby-value">0</span>
207:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000875" class="method">
  <div id="M000875_title" class="title">
    <b>space</b>()
  </div>
<div class="aka">
  This method is also aliased as
  <a href="index.html?a=M000876&name=spc">spc</a>
</div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000875_source')" id="l_M000875_source">show source</a> ]</p>
  <div id="M000875_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 245</span>
245:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">space</span>
246:       <span class="ruby-identifier">add_lwsp</span> <span class="ruby-value str">' '</span>
247:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000876" class="method">
  <div id="M000876_title" class="title">
    <b>spc</b>()
  </div>
  <div class="description">
  <p>
Alias for <a href="index.html?a=M000875&name=space">space</a>
</p>
  </div>
</div>
<div id="M000868" class="method">
  <div id="M000868_title" class="title">
    <b>terminate</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000868_source')" id="l_M000868_source">show source</a> ]</p>
  <div id="M000868_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 209</span>
209:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">terminate</span>
210:       <span class="ruby-identifier">add_lwsp</span> <span class="ruby-value str">''</span>
211:       <span class="ruby-identifier">reset</span>
212:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000879" class="method">
  <div id="M000879_title" class="title">
    <b>text</b>( str )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000879_source')" id="l_M000879_source">show source</a> ]</p>
  <div id="M000879_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 259</span>
259:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">text</span>( <span class="ruby-identifier">str</span> )
260:       <span class="ruby-identifier">scanadd</span> <span class="ruby-identifier">normalize_encoding</span>(<span class="ruby-identifier">str</span>)
261:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000871" class="method">
  <div id="M000871_title" class="title">
    <b>write</b>( str )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000871_source')" id="l_M000871_source">show source</a> ]</p>
  <div id="M000871_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/lib/action_mailer/vendor/tmail/encode.rb, line 223</span>
223:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write</span>( <span class="ruby-identifier">str</span> )
224:       <span class="ruby-ivar">@f</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">str</span>
225:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>