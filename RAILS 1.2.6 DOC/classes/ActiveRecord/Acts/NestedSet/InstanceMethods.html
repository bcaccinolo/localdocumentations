  <div id="C00000379">
<div class='banner'>
  <span class="file-title-prefix">Module</span><br />InstanceMethods<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/lib/active_record/acts/nested_set_rb.html');">activerecord/lib/active_record/acts/nested_set.rb</a>

</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M001130&name=add_child" >add_child</a></li>
  <li><a href="index.html?a=M001133&name=all_children" >all_children</a></li>
  <li><a href="index.html?a=M001135&name=before_destroy" >before_destroy</a></li>
  <li><a href="index.html?a=M001128&name=child?" >child?</a></li>
  <li><a href="index.html?a=M001131&name=children_count" >children_count</a></li>
  <li><a href="index.html?a=M001134&name=direct_children" >direct_children</a></li>
  <li><a href="index.html?a=M001132&name=full_set" >full_set</a></li>
  <li><a href="index.html?a=M001127&name=root?" >root?</a></li>
  <li><a href="index.html?a=M001129&name=unknown?" >unknown?</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M001130" class="method">
  <div id="M001130_title" class="title">
    <b>add_child</b>( child )
  </div>
  <div class="description">
  <p>
Adds a child to this object in the tree. If this object hasn&#8217;t been
initialized, it gets set up as a root node. Otherwise, this method will
update all of the other elements in the tree and shift them to the right,
keeping everything balanced.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001130_source')" id="l_M001130_source">show source</a> ]</p>
  <div id="M001130_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/acts/nested_set.rb, line 141</span>
141:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_child</span>( <span class="ruby-identifier">child</span> )     
142:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reload</span>
143:           <span class="ruby-identifier">child</span>.<span class="ruby-identifier">reload</span>
144: 
145:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">root?</span>
146:             <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Adding sub-tree isn\'t currently supported&quot;</span>
147:           <span class="ruby-keyword kw">else</span>
148:             <span class="ruby-keyword kw">if</span> ( (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>) <span class="ruby-operator">||</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>) )
149:               <span class="ruby-comment cmt"># Looks like we're now the root node!  Woo</span>
150:               <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] = <span class="ruby-value">1</span>
151:               <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] = <span class="ruby-value">4</span>
152:               
153:               <span class="ruby-comment cmt"># What do to do about validation?</span>
154:               <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">save</span>
155:               
156:               <span class="ruby-identifier">child</span>[<span class="ruby-identifier">parent_column</span>] = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>
157:               <span class="ruby-identifier">child</span>[<span class="ruby-identifier">left_col_name</span>] = <span class="ruby-value">2</span>
158:               <span class="ruby-identifier">child</span>[<span class="ruby-identifier">right_col_name</span>]= <span class="ruby-value">3</span>
159:               <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">save</span>
160:             <span class="ruby-keyword kw">else</span>
161:               <span class="ruby-comment cmt"># OK, we need to add and shift everything else to the right</span>
162:               <span class="ruby-identifier">child</span>[<span class="ruby-identifier">parent_column</span>] = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>
163:               <span class="ruby-identifier">right_bound</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>]
164:               <span class="ruby-identifier">child</span>[<span class="ruby-identifier">left_col_name</span>] = <span class="ruby-identifier">right_bound</span>
165:               <span class="ruby-identifier">child</span>[<span class="ruby-identifier">right_col_name</span>] = <span class="ruby-identifier">right_bound</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
166:               <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">+=</span> <span class="ruby-value">2</span>
167:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">base_class</span>.<span class="ruby-identifier">transaction</span> {
168:                 <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">base_class</span>.<span class="ruby-identifier">update_all</span>( <span class="ruby-node">&quot;#{left_col_name} = (#{left_col_name} + 2)&quot;</span>,  <span class="ruby-node">&quot;#{scope_condition} AND #{left_col_name} &gt;= #{right_bound}&quot;</span> )
169:                 <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">base_class</span>.<span class="ruby-identifier">update_all</span>( <span class="ruby-node">&quot;#{right_col_name} = (#{right_col_name} + 2)&quot;</span>,  <span class="ruby-node">&quot;#{scope_condition} AND #{right_col_name} &gt;= #{right_bound}&quot;</span> )
170:                 <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">save</span>
171:                 <span class="ruby-identifier">child</span>.<span class="ruby-identifier">save</span>
172:               }
173:             <span class="ruby-keyword kw">end</span>
174:           <span class="ruby-keyword kw">end</span>                                   
175:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001133" class="method">
  <div id="M001133_title" class="title">
    <b>all_children</b>()
  </div>
  <div class="description">
  <p>
Returns a set of all of its children and nested children
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001133_source')" id="l_M001133_source">show source</a> ]</p>
  <div id="M001133_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/acts/nested_set.rb, line 188</span>
188:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_children</span>
189:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">base_class</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{left_col_name} &gt; #{self[left_col_name]}) and (#{right_col_name} &lt; #{self[right_col_name]})&quot;</span> )
190:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001135" class="method">
  <div id="M001135_title" class="title">
    <b>before_destroy</b>()
  </div>
  <div class="description">
  <p>
Prunes a branch off of the tree, shifting all of the elements on the right
back to the left so the counts still work.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001135_source')" id="l_M001135_source">show source</a> ]</p>
  <div id="M001135_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/acts/nested_set.rb, line 199</span>
199:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">before_destroy</span>
200:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>].<span class="ruby-identifier">nil?</span>
201:           <span class="ruby-identifier">dif</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">-</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
202: 
203:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">base_class</span>.<span class="ruby-identifier">transaction</span> {
204:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">base_class</span>.<span class="ruby-identifier">delete_all</span>( <span class="ruby-node">&quot;#{scope_condition} and #{left_col_name} &gt; #{self[left_col_name]} and #{right_col_name} &lt; #{self[right_col_name]}&quot;</span> )
205:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">base_class</span>.<span class="ruby-identifier">update_all</span>( <span class="ruby-node">&quot;#{left_col_name} = (#{left_col_name} - #{dif})&quot;</span>,  <span class="ruby-node">&quot;#{scope_condition} AND #{left_col_name} &gt;= #{self[right_col_name]}&quot;</span> )
206:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">base_class</span>.<span class="ruby-identifier">update_all</span>( <span class="ruby-node">&quot;#{right_col_name} = (#{right_col_name} - #{dif} )&quot;</span>,  <span class="ruby-node">&quot;#{scope_condition} AND #{right_col_name} &gt;= #{self[right_col_name]}&quot;</span> )
207:           }
208:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001128" class="method">
  <div id="M001128_title" class="title">
    <b>child?</b>()
  </div>
  <div class="description">
  <p>
Returns true is this is a child node
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001128_source')" id="l_M001128_source">show source</a> ]</p>
  <div id="M001128_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/acts/nested_set.rb, line 126</span>
126:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">child?</span>                          
127:           <span class="ruby-identifier">parent_id</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_column</span>]
128:           <span class="ruby-operator">!</span>(<span class="ruby-identifier">parent_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">parent_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>])
129:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001131" class="method">
  <div id="M001131_title" class="title">
    <b>children_count</b>()
  </div>
  <div class="description">
  <p>
Returns the number of nested children of this object.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001131_source')" id="l_M001131_source">show source</a> ]</p>
  <div id="M001131_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/acts/nested_set.rb, line 178</span>
178:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children_count</span>
179:           <span class="ruby-keyword kw">return</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">-</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)<span class="ruby-operator">/</span><span class="ruby-value">2</span>
180:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001134" class="method">
  <div id="M001134_title" class="title">
    <b>direct_children</b>()
  </div>
  <div class="description">
  <p>
Returns a set of only this entry&#8217;s immediate children
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001134_source')" id="l_M001134_source">show source</a> ]</p>
  <div id="M001134_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/acts/nested_set.rb, line 193</span>
193:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">direct_children</span>
194:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">base_class</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} and #{parent_column} = #{self.id}&quot;</span>)
195:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001132" class="method">
  <div id="M001132_title" class="title">
    <b>full_set</b>()
  </div>
  <div class="description">
  <p>
Returns a set of itself and all of its nested children
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001132_source')" id="l_M001132_source">show source</a> ]</p>
  <div id="M001132_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/acts/nested_set.rb, line 183</span>
183:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">full_set</span>
184:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">base_class</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{left_col_name} BETWEEN #{self[left_col_name]} and #{self[right_col_name]})&quot;</span> )
185:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001127" class="method">
  <div id="M001127_title" class="title">
    <b>root?</b>()
  </div>
  <div class="description">
  <p>
Returns true is this is a root node.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001127_source')" id="l_M001127_source">show source</a> ]</p>
  <div id="M001127_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/acts/nested_set.rb, line 120</span>
120:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">root?</span>
121:           <span class="ruby-identifier">parent_id</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_column</span>]
122:           (<span class="ruby-identifier">parent_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">parent_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>])
123:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001129" class="method">
  <div id="M001129_title" class="title">
    <b>unknown?</b>()
  </div>
  <div class="description">
  <p>
Returns true if we have no idea what this is
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001129_source')" id="l_M001129_source">show source</a> ]</p>
  <div id="M001129_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/acts/nested_set.rb, line 132</span>
132:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unknown?</span>
133:           <span class="ruby-operator">!</span><span class="ruby-identifier">root?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">child?</span>
134:         <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>