  <div id="C00000413">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />SybaseAdapterContext<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/lib/active_record/connection_adapters/sybase_adapter_rb.html');">activerecord/lib/active_record/connection_adapters/sybase_adapter.rb</a>

Parent:&nbsp;
SybSQLContext
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M001295&name=cltmsgCB" >cltmsgCB</a></li>
  <li><a href="index.html?a=M001292&name=deadlocked?" >deadlocked?</a></li>
  <li><a href="index.html?a=M001293&name=failed?" >failed?</a></li>
  <li><a href="index.html?a=M001290&name=init" >init</a></li>
  <li><a href="index.html?a=M001294&name=reset" >reset</a></li>
  <li><a href="index.html?a=M001291&name=srvmsgCB" >srvmsgCB</a></li>
  </ul>




  <div class="sectiontitle">Constants</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class="attr-name">DEADLOCK</td>
    <td>=</td>
    <td class="attr-value">1205</td>
  </tr>
  </table>

  <div class="sectiontitle">Attributes</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class='attr-rw'>
[R]
    </td>
    <td class='attr-name'>message</td>
    <td class='attr-desc'></td>
  </tr>
  </table>

<div class="sectiontitle">Public Instance methods</div>
<div id="M001295" class="method">
  <div id="M001295_title" class="title">
    <b>cltmsgCB</b>(con, msg)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001295_source')" id="l_M001295_source">show source</a> ]</p>
  <div id="M001295_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/connection_adapters/sybase_adapter.rb, line 612</span>
612:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cltmsgCB</span>(<span class="ruby-identifier">con</span>, <span class="ruby-identifier">msg</span>)
613:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">unless</span> ( <span class="ruby-identifier">msg</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>) )
614:         <span class="ruby-keyword kw">unless</span> ( <span class="ruby-identifier">msg</span>[ <span class="ruby-value str">&quot;severity&quot;</span> ] ) <span class="ruby-keyword kw">then</span>
615:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
616:         <span class="ruby-keyword kw">end</span>
617: 
618:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@logger</span>
619:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-value str">&quot;** SybSQLContext Client-Message: **&quot;</span>
620:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;  Message number: LAYER=#{msg[ 'layer' ]} ORIGIN=#{msg[ 'origin' ]} SEVERITY=#{msg[ 'severity' ]} NUMBER=#{msg[ 'number' ]}&quot;</span>
621:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;  Message String: #{msg['msgstring']}&quot;</span>
622:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;  OS Error: #{msg['osstring']}&quot;</span>
623: 
624:           <span class="ruby-ivar">@message</span> = <span class="ruby-identifier">msg</span>[<span class="ruby-value str">'msgstring'</span>]
625:         <span class="ruby-keyword kw">end</span>
626: 
627:         <span class="ruby-ivar">@failed</span> = <span class="ruby-keyword kw">true</span>
628: 
629:         <span class="ruby-comment cmt"># Not retry , CS_CV_RETRY_FAIL( probability TimeOut ) </span>
630:         <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">msg</span>[ <span class="ruby-value str">'severity'</span> ] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;RETRY_FAIL&quot;</span> ) <span class="ruby-keyword kw">then</span>
631:           <span class="ruby-ivar">@timeout_p</span> = <span class="ruby-keyword kw">true</span>
632:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
633:         <span class="ruby-keyword kw">end</span>
634: 
635:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
636:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001292" class="method">
  <div id="M001292_title" class="title">
    <b>deadlocked?</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001292_source')" id="l_M001292_source">show source</a> ]</p>
  <div id="M001292_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/connection_adapters/sybase_adapter.rb, line 598</span>
598:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">deadlocked?</span>
599:         <span class="ruby-ivar">@deadlocked</span>
600:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001293" class="method">
  <div id="M001293_title" class="title">
    <b>failed?</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001293_source')" id="l_M001293_source">show source</a> ]</p>
  <div id="M001293_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/connection_adapters/sybase_adapter.rb, line 602</span>
602:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">failed?</span>
603:         <span class="ruby-ivar">@failed</span>
604:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001290" class="method">
  <div id="M001290_title" class="title">
    <b>init</b>(logger = nil)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001290_source')" id="l_M001290_source">show source</a> ]</p>
  <div id="M001290_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/connection_adapters/sybase_adapter.rb, line 565</span>
565:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init</span>(<span class="ruby-identifier">logger</span> = <span class="ruby-keyword kw">nil</span>)
566:         <span class="ruby-ivar">@deadlocked</span> = <span class="ruby-keyword kw">false</span>
567:         <span class="ruby-ivar">@failed</span> = <span class="ruby-keyword kw">false</span>
568:         <span class="ruby-ivar">@logger</span> = <span class="ruby-identifier">logger</span>
569:         <span class="ruby-ivar">@message</span> = <span class="ruby-keyword kw">nil</span>
570:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001294" class="method">
  <div id="M001294_title" class="title">
    <b>reset</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001294_source')" id="l_M001294_source">show source</a> ]</p>
  <div id="M001294_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/connection_adapters/sybase_adapter.rb, line 606</span>
606:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset</span>
607:         <span class="ruby-ivar">@deadlocked</span> = <span class="ruby-keyword kw">false</span>
608:         <span class="ruby-ivar">@failed</span> = <span class="ruby-keyword kw">false</span>
609:         <span class="ruby-ivar">@message</span> = <span class="ruby-keyword kw">nil</span>
610:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001291" class="method">
  <div id="M001291_title" class="title">
    <b>srvmsgCB</b>(con, msg)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001291_source')" id="l_M001291_source">show source</a> ]</p>
  <div id="M001291_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/connection_adapters/sybase_adapter.rb, line 572</span>
572:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">srvmsgCB</span>(<span class="ruby-identifier">con</span>, <span class="ruby-identifier">msg</span>)
573:         <span class="ruby-comment cmt"># Do not log change of context messages.</span>
574:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">msg</span>[<span class="ruby-value str">'severity'</span>] <span class="ruby-operator">==</span> <span class="ruby-value">10</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">msg</span>[<span class="ruby-value str">'severity'</span>] <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
575:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
576:         <span class="ruby-keyword kw">end</span>
577: 
578:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">msg</span>[<span class="ruby-value str">'msgnumber'</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">DEADLOCK</span>
579:           <span class="ruby-ivar">@deadlocked</span> = <span class="ruby-keyword kw">true</span>
580:         <span class="ruby-keyword kw">else</span>
581:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-value str">&quot;SQL Command failed!&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@logger</span>
582:           <span class="ruby-ivar">@failed</span> = <span class="ruby-keyword kw">true</span>
583:         <span class="ruby-keyword kw">end</span>
584: 
585:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@logger</span>
586:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-value str">&quot;** SybSQLContext Server Message: **&quot;</span>
587:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;  Message number #{msg['msgnumber']} Severity #{msg['severity']} State #{msg['state']} Line #{msg['line']}&quot;</span>
588:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;  Server #{msg['srvname']}&quot;</span>
589:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;  Procedure #{msg['proc']}&quot;</span>
590:           <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">error</span> <span class="ruby-node">&quot;  Message String:  #{msg['text']}&quot;</span>
591:         <span class="ruby-keyword kw">end</span>
592: 
593:         <span class="ruby-ivar">@message</span> = <span class="ruby-identifier">msg</span>[<span class="ruby-value str">'text'</span>]
594: 
595:         <span class="ruby-keyword kw">true</span>
596:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>