  <div id="C00000611">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />Statement<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/lib/active_record/vendor/db2_rb.html');">activerecord/lib/active_record/vendor/db2.rb</a>

Parent:&nbsp;
Object
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M001830&name=adjust_content" >adjust_content</a></li>
  <li><a href="index.html?a=M001819&name=bind" >bind</a></li>
  <li><a href="index.html?a=M001818&name=bindParms" >bindParms</a></li>
  <li><a href="index.html?a=M001813&name=columns" >columns</a></li>
  <li><a href="index.html?a=M001821&name=exec_direct" >exec_direct</a></li>
  <li><a href="index.html?a=M001817&name=execute" >execute</a></li>
  <li><a href="index.html?a=M001827&name=fetch" >fetch</a></li>
  <li><a href="index.html?a=M001826&name=fetch_all" >fetch_all</a></li>
  <li><a href="index.html?a=M001828&name=fetch_as_hash" >fetch_as_hash</a></li>
  <li><a href="index.html?a=M001829&name=get_col_desc" >get_col_desc</a></li>
  <li><a href="index.html?a=M001823&name=get_cursor_name" >get_cursor_name</a></li>
  <li><a href="index.html?a=M001815&name=indexes" >indexes</a></li>
  <li><a href="index.html?a=M001812&name=new" >new</a></li>
  <li><a href="index.html?a=M001825&name=num_result_cols" >num_result_cols</a></li>
  <li><a href="index.html?a=M001816&name=prepare" >prepare</a></li>
  <li><a href="index.html?a=M001824&name=row_count" >row_count</a></li>
  <li><a href="index.html?a=M001822&name=set_cursor_name" >set_cursor_name</a></li>
  <li><a href="index.html?a=M001814&name=tables" >tables</a></li>
  <li><a href="index.html?a=M001820&name=tokens" >tokens</a></li>
  </ul>

<div class="sectiontitle">Included Modules</div>
<ul>
  <li><a href="#" onclick="jsHref('classes/DB2/DB2Util.html');">DB2Util</a></li>
</ul>





<div class="sectiontitle">Public Class methods</div>
<div id="M001812" class="method">
  <div id="M001812_title" class="title">
    <b>new</b>(connection)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001812_source')" id="l_M001812_source">show source</a> ]</p>
  <div id="M001812_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 101</span>
101:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">connection</span>)
102:       <span class="ruby-ivar">@conn</span> = <span class="ruby-identifier">connection</span>
103:       <span class="ruby-ivar">@handle_type</span> = <span class="ruby-constant">SQL_HANDLE_STMT</span>
104:       <span class="ruby-ivar">@parms</span> = []                           <span class="ruby-comment cmt">#yun</span>
105:       <span class="ruby-ivar">@sql</span> = <span class="ruby-value str">''</span>                             <span class="ruby-comment cmt">#yun</span>
106:       <span class="ruby-ivar">@numParms</span> = <span class="ruby-value">0</span>                         <span class="ruby-comment cmt">#yun</span>
107:       <span class="ruby-ivar">@prepared</span> = <span class="ruby-keyword kw">false</span>                     <span class="ruby-comment cmt">#yun</span>
108:       <span class="ruby-ivar">@parmArray</span> = []                       <span class="ruby-comment cmt">#yun. attributes of the parameter markers</span>
109:       <span class="ruby-identifier">rc</span>, <span class="ruby-ivar">@handle</span> = <span class="ruby-constant">SQLAllocHandle</span>(<span class="ruby-ivar">@handle_type</span>, <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">handle</span>)
110:       <span class="ruby-identifier">check_rc</span>(<span class="ruby-identifier">rc</span>)
111:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M001830" class="method">
  <div id="M001830_title" class="title">
    <b>adjust_content</b>(c)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001830_source')" id="l_M001830_source">show source</a> ]</p>
  <div id="M001830_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 340</span>
340:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">adjust_content</span>(<span class="ruby-identifier">c</span>)
341:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>
342:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'DB2CLI::NullClass'</span>
343:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
344:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'DB2CLI::Time'</span>
345:         <span class="ruby-value str">&quot;%02d:%02d:%02d&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">c</span>.<span class="ruby-identifier">hour</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">minute</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">second</span>]
346:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'DB2CLI::Date'</span>
347:         <span class="ruby-value str">&quot;%04d-%02d-%02d&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">c</span>.<span class="ruby-identifier">year</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">month</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">day</span>]
348:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'DB2CLI::Timestamp'</span>
349:         <span class="ruby-value str">&quot;%04d-%02d-%02d %02d:%02d:%02d&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">c</span>.<span class="ruby-identifier">year</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">month</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">day</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">hour</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">minute</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">second</span>]
350:       <span class="ruby-keyword kw">else</span>
351:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">c</span>
352:       <span class="ruby-keyword kw">end</span>
353:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001819" class="method">
  <div id="M001819_title" class="title">
    <b>bind</b>(sql, args)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001819_source')" id="l_M001819_source">show source</a> ]</p>
  <div id="M001819_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 219</span>
219:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bind</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>)                <span class="ruby-comment cmt">#does not use SQLBindParams</span>
220:       <span class="ruby-identifier">arg_index</span> = <span class="ruby-value">0</span>
221:       <span class="ruby-identifier">result</span> = <span class="ruby-value str">&quot;&quot;</span>
222:       <span class="ruby-identifier">tokens</span>(<span class="ruby-identifier">sql</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">part</span><span class="ruby-operator">|</span>
223:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">part</span>
224:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'?'</span>
225:           <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;'&quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">args</span>[<span class="ruby-identifier">arg_index</span>]) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;'&quot;</span>  <span class="ruby-comment cmt">#put it into quotes</span>
226:           <span class="ruby-identifier">arg_index</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
227:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'??'</span>
228:           <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;?&quot;</span>
229:         <span class="ruby-keyword kw">else</span>
230:           <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">part</span>
231:         <span class="ruby-keyword kw">end</span>
232:       <span class="ruby-keyword kw">end</span>
233:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arg_index</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span>
234:         <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Too many SQL parameters&quot;</span>
235:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">arg_index</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span>
236:         <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Not enough SQL parameters&quot;</span>
237:       <span class="ruby-keyword kw">end</span>
238:       <span class="ruby-identifier">result</span>
239:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001818" class="method">
  <div id="M001818_title" class="title">
    <b>bindParms</b>(parms)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001818_source')" id="l_M001818_source">show source</a> ]</p>
  <div id="M001818_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 199</span>
199:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bindParms</span>(<span class="ruby-identifier">parms</span>)        <span class="ruby-comment cmt"># This is the real thing. It uses SQLBindParms</span>
200:       <span class="ruby-value">1</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-ivar">@numParms</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>  <span class="ruby-comment cmt"># parameter number starts from 1</span>
201:         <span class="ruby-identifier">rc</span>, <span class="ruby-identifier">dataType</span>, <span class="ruby-identifier">parmSize</span>, <span class="ruby-identifier">decimalDigits</span> = <span class="ruby-constant">SQLDescribeParam</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-identifier">i</span>)
202:         <span class="ruby-identifier">check_rc</span>(<span class="ruby-identifier">rc</span>)
203:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parms</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>].<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">String</span>
204:           <span class="ruby-identifier">value</span> = <span class="ruby-identifier">parms</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>]
205:         <span class="ruby-keyword kw">else</span>
206:           <span class="ruby-identifier">value</span> = <span class="ruby-identifier">parms</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>].<span class="ruby-identifier">to_s</span>
207:         <span class="ruby-keyword kw">end</span>
208:         <span class="ruby-identifier">rc</span> = <span class="ruby-constant">SQLBindParameter</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-identifier">i</span>, <span class="ruby-identifier">dataType</span>, <span class="ruby-identifier">parmSize</span>, <span class="ruby-identifier">decimalDigits</span>, <span class="ruby-identifier">value</span>)
209:         <span class="ruby-identifier">check_rc</span>(<span class="ruby-identifier">rc</span>)
210:       <span class="ruby-keyword kw">end</span>
211:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001813" class="method">
  <div id="M001813_title" class="title">
    <b>columns</b>(table_name, schema_name = '%')
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001813_source')" id="l_M001813_source">show source</a> ]</p>
  <div id="M001813_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 113</span>
113:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">columns</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">schema_name</span> = <span class="ruby-value str">'%'</span>)
114:       <span class="ruby-identifier">check_rc</span>(<span class="ruby-constant">SQLColumns</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-value str">''</span>, <span class="ruby-identifier">schema_name</span>.<span class="ruby-identifier">upcase</span>, <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">upcase</span>, <span class="ruby-value str">'%'</span>))
115:       <span class="ruby-identifier">fetch_all</span>
116:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001821" class="method">
  <div id="M001821_title" class="title">
    <b>exec_direct</b>(sql)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001821_source')" id="l_M001821_source">show source</a> ]</p>
  <div id="M001821_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 254</span>
254:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">exec_direct</span>(<span class="ruby-identifier">sql</span>)
255:       <span class="ruby-identifier">check_rc</span>(<span class="ruby-constant">SQLExecDirect</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-identifier">sql</span>))
256:       <span class="ruby-keyword kw">self</span>
257:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001817" class="method">
  <div id="M001817_title" class="title">
    <b>execute</b>(*parms)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001817_source')" id="l_M001817_source">show source</a> ]</p>
  <div id="M001817_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 148</span>
148:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">execute</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">parms</span>)
149:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;The statement was not prepared&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@prepared</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
150: 
151:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parms</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">parms</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Array</span>
152:         <span class="ruby-identifier">parms</span> = <span class="ruby-identifier">parms</span>[<span class="ruby-value">0</span>]
153:       <span class="ruby-keyword kw">end</span>
154: 
155:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@numParms</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">parms</span>.<span class="ruby-identifier">size</span>
156:         <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Number of parameters supplied does not match with the SQL statement&quot;</span>
157:       <span class="ruby-keyword kw">end</span>
158: 
159:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@numParms</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>            <span class="ruby-comment cmt">#need to bind parameters</span>
160:         <span class="ruby-comment cmt">#--------------------------------------------------------------------</span>
161:         <span class="ruby-comment cmt">#calling bindParms may not be safe. Look comment below.</span>
162:         <span class="ruby-comment cmt">#--------------------------------------------------------------------</span>
163:         <span class="ruby-comment cmt">#bindParms(parms)</span>
164: 
165:         <span class="ruby-identifier">valueArray</span> = []
166:         <span class="ruby-value">1</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-ivar">@numParms</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>  <span class="ruby-comment cmt"># parameter number starts from 1</span>
167:           <span class="ruby-identifier">type</span> = <span class="ruby-ivar">@parmArray</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>].<span class="ruby-identifier">class</span>
168:           <span class="ruby-identifier">size</span> = <span class="ruby-ivar">@parmArray</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>].<span class="ruby-identifier">size</span>
169:           <span class="ruby-identifier">decimalDigits</span> = <span class="ruby-ivar">@parmArray</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>].<span class="ruby-identifier">decimalDigits</span>
170: 
171:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parms</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>].<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">String</span>
172:             <span class="ruby-identifier">valueArray</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">parms</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>]
173:           <span class="ruby-keyword kw">else</span>
174:             <span class="ruby-identifier">valueArray</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">parms</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>].<span class="ruby-identifier">to_s</span>
175:           <span class="ruby-keyword kw">end</span>
176: 
177:           <span class="ruby-identifier">rc</span> = <span class="ruby-constant">SQLBindParameter</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-identifier">i</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">size</span>, <span class="ruby-identifier">decimalDigits</span>, <span class="ruby-identifier">valueArray</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>])
178:           <span class="ruby-identifier">check_rc</span>(<span class="ruby-identifier">rc</span>)
179:         <span class="ruby-keyword kw">end</span>
180:       <span class="ruby-keyword kw">end</span>
181: 
182:       <span class="ruby-identifier">check_rc</span>(<span class="ruby-constant">SQLExecute</span>(<span class="ruby-ivar">@handle</span>))
183: 
184:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@numParms</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
185:         <span class="ruby-identifier">check_rc</span>(<span class="ruby-constant">SQLFreeStmt</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-constant">SQL_RESET_PARAMS</span>)) <span class="ruby-comment cmt"># Reset parameters</span>
186:       <span class="ruby-keyword kw">end</span>
187: 
188:       <span class="ruby-keyword kw">self</span>
189:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001827" class="method">
  <div id="M001827_title" class="title">
    <b>fetch</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001827_source')" id="l_M001827_source">show source</a> ]</p>
  <div id="M001827_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 296</span>
296:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fetch</span>
297:       <span class="ruby-identifier">cols</span> = <span class="ruby-identifier">get_col_desc</span>
298:       <span class="ruby-identifier">rc</span> = <span class="ruby-constant">SQLFetch</span>(<span class="ruby-ivar">@handle</span>)
299:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rc</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SQL_NO_DATA_FOUND</span>
300:         <span class="ruby-constant">SQLFreeStmt</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-constant">SQL_CLOSE</span>)        <span class="ruby-comment cmt"># Close cursor</span>
301:         <span class="ruby-constant">SQLFreeStmt</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-constant">SQL_RESET_PARAMS</span>) <span class="ruby-comment cmt"># Reset parameters</span>
302:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
303:       <span class="ruby-keyword kw">end</span>
304:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;ERROR&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">rc</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SQL_SUCCESS</span>
305: 
306:       <span class="ruby-identifier">retval</span> = []
307:       <span class="ruby-identifier">cols</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
308:         <span class="ruby-identifier">rc</span>, <span class="ruby-identifier">content</span> = <span class="ruby-constant">SQLGetData</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">c</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">+</span> <span class="ruby-value">1</span>) <span class="ruby-comment cmt">#yun added 1 to c[2]</span>
309:         <span class="ruby-identifier">retval</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">adjust_content</span>(<span class="ruby-identifier">content</span>)
310:       <span class="ruby-keyword kw">end</span>
311:       <span class="ruby-identifier">retval</span>
312:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001826" class="method">
  <div id="M001826_title" class="title">
    <b>fetch_all</b>() {|row| ...}
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001826_source')" id="l_M001826_source">show source</a> ]</p>
  <div id="M001826_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 282</span>
282:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fetch_all</span>
283:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
284:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">row</span> = <span class="ruby-identifier">fetch</span> <span class="ruby-keyword kw">do</span>
285:           <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">row</span>
286:         <span class="ruby-keyword kw">end</span>
287:       <span class="ruby-keyword kw">else</span>
288:         <span class="ruby-identifier">res</span> = []
289:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">row</span> = <span class="ruby-identifier">fetch</span> <span class="ruby-keyword kw">do</span>
290:           <span class="ruby-identifier">res</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">row</span>
291:         <span class="ruby-keyword kw">end</span>
292:         <span class="ruby-identifier">res</span>
293:       <span class="ruby-keyword kw">end</span>
294:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001828" class="method">
  <div id="M001828_title" class="title">
    <b>fetch_as_hash</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001828_source')" id="l_M001828_source">show source</a> ]</p>
  <div id="M001828_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 314</span>
314:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fetch_as_hash</span>
315:       <span class="ruby-identifier">cols</span> = <span class="ruby-identifier">get_col_desc</span>
316:       <span class="ruby-identifier">rc</span> = <span class="ruby-constant">SQLFetch</span>(<span class="ruby-ivar">@handle</span>)
317:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rc</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SQL_NO_DATA_FOUND</span>
318:         <span class="ruby-constant">SQLFreeStmt</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-constant">SQL_CLOSE</span>)        <span class="ruby-comment cmt"># Close cursor</span>
319:         <span class="ruby-constant">SQLFreeStmt</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-constant">SQL_RESET_PARAMS</span>) <span class="ruby-comment cmt"># Reset parameters</span>
320:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
321:       <span class="ruby-keyword kw">end</span>
322:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;ERROR&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">rc</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SQL_SUCCESS</span>
323: 
324:       <span class="ruby-identifier">retval</span> = {}
325:       <span class="ruby-identifier">cols</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
326:         <span class="ruby-identifier">rc</span>, <span class="ruby-identifier">content</span> = <span class="ruby-constant">SQLGetData</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">c</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)   <span class="ruby-comment cmt">#yun added 1 to c[2]</span>
327:         <span class="ruby-identifier">retval</span>[<span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>]] = <span class="ruby-identifier">adjust_content</span>(<span class="ruby-identifier">content</span>)
328:       <span class="ruby-keyword kw">end</span>
329:       <span class="ruby-identifier">retval</span>
330:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001829" class="method">
  <div id="M001829_title" class="title">
    <b>get_col_desc</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001829_source')" id="l_M001829_source">show source</a> ]</p>
  <div id="M001829_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 332</span>
332:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_col_desc</span>
333:       <span class="ruby-identifier">rc</span>, <span class="ruby-identifier">nr_cols</span> = <span class="ruby-constant">SQLNumResultCols</span>(<span class="ruby-ivar">@handle</span>)
334:       <span class="ruby-identifier">cols</span> = (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-identifier">nr_cols</span>).<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
335:         <span class="ruby-identifier">rc</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">bl</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">col_sz</span> = <span class="ruby-constant">SQLDescribeCol</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-identifier">c</span>, <span class="ruby-value">1024</span>)
336:         [<span class="ruby-identifier">name</span>.<span class="ruby-identifier">downcase</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">col_sz</span>]
337:       <span class="ruby-keyword kw">end</span>
338:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001823" class="method">
  <div id="M001823_title" class="title">
    <b>get_cursor_name</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001823_source')" id="l_M001823_source">show source</a> ]</p>
  <div id="M001823_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 264</span>
264:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_cursor_name</span>
265:       <span class="ruby-identifier">rc</span>, <span class="ruby-identifier">name</span> = <span class="ruby-constant">SQLGetCursorName</span>(<span class="ruby-ivar">@handle</span>)
266:       <span class="ruby-identifier">check_rc</span>(<span class="ruby-identifier">rc</span>)
267:       <span class="ruby-identifier">name</span>
268:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001815" class="method">
  <div id="M001815_title" class="title">
    <b>indexes</b>(table_name, schema_name = '')
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001815_source')" id="l_M001815_source">show source</a> ]</p>
  <div id="M001815_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 123</span>
123:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">indexes</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">schema_name</span> = <span class="ruby-value str">''</span>)
124:       <span class="ruby-identifier">check_rc</span>(<span class="ruby-constant">SQLStatistics</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-value str">''</span>, <span class="ruby-identifier">schema_name</span>.<span class="ruby-identifier">upcase</span>, <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">upcase</span>, <span class="ruby-constant">SQL_INDEX_ALL</span>, <span class="ruby-constant">SQL_ENSURE</span>))
125:       <span class="ruby-identifier">fetch_all</span>
126:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001825" class="method">
  <div id="M001825_title" class="title">
    <b>num_result_cols</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001825_source')" id="l_M001825_source">show source</a> ]</p>
  <div id="M001825_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 276</span>
276:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">num_result_cols</span>
277:       <span class="ruby-identifier">rc</span>, <span class="ruby-identifier">cols</span> = <span class="ruby-constant">SQLNumResultCols</span>(<span class="ruby-ivar">@handle</span>)
278:       <span class="ruby-identifier">check_rc</span>(<span class="ruby-identifier">rc</span>)
279:       <span class="ruby-identifier">cols</span>
280:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001816" class="method">
  <div id="M001816_title" class="title">
    <b>prepare</b>(sql)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001816_source')" id="l_M001816_source">show source</a> ]</p>
  <div id="M001816_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 128</span>
128:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare</span>(<span class="ruby-identifier">sql</span>)
129:       <span class="ruby-ivar">@sql</span> = <span class="ruby-identifier">sql</span>
130:       <span class="ruby-identifier">check_rc</span>(<span class="ruby-constant">SQLPrepare</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-identifier">sql</span>))
131:       <span class="ruby-identifier">rc</span>, <span class="ruby-ivar">@numParms</span> = <span class="ruby-constant">SQLNumParams</span>(<span class="ruby-ivar">@handle</span>) <span class="ruby-comment cmt">#number of question marks</span>
132:       <span class="ruby-identifier">check_rc</span>(<span class="ruby-identifier">rc</span>)
133:       <span class="ruby-comment cmt">#--------------------------------------------------------------------------</span>
134:       <span class="ruby-comment cmt"># parameter attributes are stored in instance variable @parmArray so that</span>
135:       <span class="ruby-comment cmt"># they are available when execute method is called.</span>
136:       <span class="ruby-comment cmt">#--------------------------------------------------------------------------</span>
137:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@numParms</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>           <span class="ruby-comment cmt"># get parameter marker attributes</span>
138:         <span class="ruby-value">1</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-ivar">@numParms</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-comment cmt"># parameter number starts from 1</span>
139:           <span class="ruby-identifier">rc</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">size</span>, <span class="ruby-identifier">decimalDigits</span> = <span class="ruby-constant">SQLDescribeParam</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-identifier">i</span>)
140:           <span class="ruby-identifier">check_rc</span>(<span class="ruby-identifier">rc</span>)
141:           <span class="ruby-ivar">@parmArray</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Parameter</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">size</span>, <span class="ruby-identifier">decimalDigits</span>)
142:         <span class="ruby-keyword kw">end</span>
143:       <span class="ruby-keyword kw">end</span>
144:       <span class="ruby-ivar">@prepared</span> = <span class="ruby-keyword kw">true</span>
145:       <span class="ruby-keyword kw">self</span>
146:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001824" class="method">
  <div id="M001824_title" class="title">
    <b>row_count</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001824_source')" id="l_M001824_source">show source</a> ]</p>
  <div id="M001824_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 270</span>
270:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">row_count</span>
271:       <span class="ruby-identifier">rc</span>, <span class="ruby-identifier">rowcount</span> = <span class="ruby-constant">SQLRowCount</span>(<span class="ruby-ivar">@handle</span>)
272:       <span class="ruby-identifier">check_rc</span>(<span class="ruby-identifier">rc</span>)
273:       <span class="ruby-identifier">rowcount</span>
274:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001822" class="method">
  <div id="M001822_title" class="title">
    <b>set_cursor_name</b>(name)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001822_source')" id="l_M001822_source">show source</a> ]</p>
  <div id="M001822_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 259</span>
259:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_cursor_name</span>(<span class="ruby-identifier">name</span>)
260:       <span class="ruby-identifier">check_rc</span>(<span class="ruby-constant">SQLSetCursorName</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-identifier">name</span>))
261:       <span class="ruby-keyword kw">self</span>
262:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001814" class="method">
  <div id="M001814_title" class="title">
    <b>tables</b>(schema_name = '%')
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001814_source')" id="l_M001814_source">show source</a> ]</p>
  <div id="M001814_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 118</span>
118:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tables</span>(<span class="ruby-identifier">schema_name</span> = <span class="ruby-value str">'%'</span>)
119:       <span class="ruby-identifier">check_rc</span>(<span class="ruby-constant">SQLTables</span>(<span class="ruby-ivar">@handle</span>, <span class="ruby-value str">''</span>, <span class="ruby-identifier">schema_name</span>.<span class="ruby-identifier">upcase</span>, <span class="ruby-value str">'%'</span>, <span class="ruby-value str">'TABLE'</span>))
120:       <span class="ruby-identifier">fetch_all</span>
121:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001820" class="method">
  <div id="M001820_title" class="title">
    <b>tokens</b>(sql)
  </div>
  <div class="description">
  <pre>
 Break the sql string into parts.
</pre>
<p>
This is NOT a full lexer for SQL. It just breaks up the SQL string enough
so that question marks, double question marks and quoted strings are
separated. This is used when binding arguments to &quot;?&quot; in the SQL
string. Note: comments are not handled.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001820_source')" id="l_M001820_source">show source</a> ]</p>
  <div id="M001820_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/lib/active_record/vendor/db2.rb, line 249</span>
249:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tokens</span>(<span class="ruby-identifier">sql</span>)
250:       <span class="ruby-identifier">toks</span> = <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/('([^'\\]|''|\\.)*'|&quot;([^&quot;\\]|&quot;&quot;|\\.)*&quot;|\?\??|[^'&quot;?]+)/</span>)
251:       <span class="ruby-identifier">toks</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>[<span class="ruby-value">0</span>] }
252:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>